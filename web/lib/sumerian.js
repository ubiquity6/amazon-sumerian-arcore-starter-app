! function(e) {
    function t(n) {
        if (r[n]) return r[n].exports;
        var i = r[n] = {
            i: n,
            l: !1,
            exports: {}
        };
        return e[n].call(i.exports, i, i.exports, t), i.l = !0, i.exports
    }
    var n = window.webpackJsonp;
    window.webpackJsonp = function(r, o, a) {
        for (var s, u, l, f = 0, c = []; f < r.length; f++) u = r[f], i[u] && c.push(i[u][0]), i[u] = 0;
        for (s in o) Object.prototype.hasOwnProperty.call(o, s) && (e[s] = o[s]);
        for (n && n(r, o, a); c.length;) c.shift()();
        if (a)
            for (f = 0; f < a.length; f++) l = t(t.s = a[f]);
        return l
    };
    var r = {},
        i = {
            21: 0
        };
    t.e = function(e) {
        function n() {
            s.onerror = s.onload = null, clearTimeout(u);
            var t = i[e];
            0 !== t && (t && t[1](new Error("Loading chunk " + e + " failed.")), i[e] = void 0)
        }
        var r = i[e];
        if (0 === r) return new Promise(function(e) {
            e()
        });
        if (r) return r[2];
        var o = new Promise(function(t, n) {
            r = i[e] = [t, n]
        });
        r[2] = o;
        var a = document.getElementsByTagName("head")[0],
            s = document.createElement("script");
        s.type = "text/javascript", s.charset = "utf-8", s.async = !0, s.timeout = 12e4, t.nc && s.setAttribute("nonce", t.nc), s.src = t.p + "" + e + ".js";
        var u = setTimeout(n, 12e4);
        return s.onerror = s.onload = n, a.appendChild(s), o
    }, t.m = e, t.c = r, t.d = function(e, n, r) {
        t.o(e, n) || Object.defineProperty(e, n, {
            configurable: !1,
            enumerable: !0,
            get: r
        })
    }, t.n = function(e) {
        var n = e && e.__esModule ? function() {
            return e.default
        } : function() {
            return e
        };
        return t.d(n, "a", n), n
    }, t.o = function(e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
    }, t.p = "", t.oe = function(e) {
        throw console.error(e), e
    }, t(t.s = 518)
}([function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        this._x = 0, this._y = 0, this._z = 0, 0 === arguments.length ? (this.x = 0, this.y = 0, this.z = 0) : 1 === arguments.length && "object" === o(arguments[0]) ? arguments[0] instanceof i ? this.copy(arguments[0]) : (this.x = arguments[0][0], this.y = arguments[0][1], this.z = arguments[0][2]) : (this.x = e, this.y = t, this.z = n), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(3),
        s = r(a),
        u = n(4),
        l = r(u),
        f = n(117),
        c = r(f),
        d = n(36),
        h = r(d);
    i.prototype = Object.create(c.default.prototype), i.prototype.constructor = i, c.default.setupAliases(i.prototype, [
            ["x"],
            ["y"],
            ["z"]
        ]), c.default.setupIndices(i.prototype, 3), c.default.setupAliases(i.prototype, [
            ["u", "r"],
            ["v", "g"],
            ["w", "b"]
        ]), i.ZERO = new i(0, 0, 0), i.ONE = new i(1, 1, 1), i.UNIT_X = new i(1, 0, 0), i.UNIT_Y = new i(0, 1, 0), i.UP = new i(0, 1, 0), i.DOWN = new i(0, -1, 0), i.UNIT_Z = new i(0, 0, 1), i.prototype.getComponent = function(e) {
            switch (e) {
                case 0:
                    return this.x;
                case 1:
                    return this.y;
                case 2:
                    return this.z
            }
        }, i.prototype.toString = function() {
            return "(" + this.x + ", " + this.y + ", " + this.z + ")"
        }, i.prototype.setComponent = function(e, t) {
            switch (e) {
                case 0:
                    this.x = t;
                    break;
                case 1:
                    this.y = t;
                    break;
                case 2:
                    this.z = t
            }
            return this
        }, i.prototype.add = function(e) {
            return e instanceof i ? (this.x += e.x, this.y += e.y, this.z += e.z) : e instanceof h.default ? (console.warn("Passing a Vector4 argument to Vector3.prototype.add is deprecated. Consider using .addDirect instead."), this.x += e.x, this.y += e.y, this.z += e.z) : "object" === (void 0 === e ? "undefined" : o(e)) && "number" == typeof e.length ? (console.warn("Passing arrays to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."), this.x += e[0], this.y += e[1], this.z += e[2]) : "number" == typeof e ? (console.warn("Passing numbers to Vector3.prototype.add is deprecated - use Vector3.prototype.addDirect instead."), this.x += e, this.y += e, this.z += e) : console.warn("Vector3.prototype.add only supports vector arguments now."), this
        }, i.prototype.addDirect = function(e, t, n) {
            return this.x += e, this.y += t, this.z += n, this
        }, i.prototype.sub = function(e) {
            return this.x -= e.x, this.y -= e.y, this.z -= e.z, this
        }, i.prototype.subDirect = function(e, t, n) {
            return this.x -= e, this.y -= t, this.z -= n, this
        }, i.prototype.negate = function() {
            return this.x = -this.x, this.y = -this.y, this.z = -this.z, this
        }, i.prototype.mul = function(e) {
            return "number" == typeof e ? (console.warn("Vector3.prototype.mul only accepts vector arguments now. Please use Vector3.prototype.scale instead."), this.x *= e, this.y *= e, this.z *= e) : (this.x *= e.x, this.y *= e.y, this.z *= e.z), this
        }, i.prototype.mulDirect = function(e, t, n) {
            return this.x *= e, this.y *= t, this.z *= n, this
        }, i.prototype.scale = function(e) {
            return this.x *= e, this.y *= e, this.z *= e, this
        }, i.prototype.div = function(e) {
            return "number" == typeof e ? (console.warn("Passing a number argument to Vector3.prototype.div is deprecated. Use Vector3.prototype.divDirect instead."), this.x /= e, this.y /= e, this.z /= e) : (this.x /= e.x, this.y /= e.y, this.z /= e.z), this
        }, i.prototype.divDirect = function(e, t, n) {
            return this.x /= e, this.y /= t, this.z /= n, this
        }, i.prototype.dot = function(e) {
            return this.x * e.x + this.y * e.y + this.z * e.z
        }, i.prototype.dotDirect = function(e, t, n) {
            return this.x * e + this.y * t + this.z * n
        }, i.prototype.equals = function(e) {
            var t = l.default.EPSILON;
            return Math.abs(this.x - e.x) <= t && Math.abs(this.y - e.y) <= t && Math.abs(this.z - e.z) <= t
        }, i.prototype.equalsDirect = function(e, t, n) {
            var r = l.default.EPSILON;
            return Math.abs(this.x - e) <= r && Math.abs(this.y - t) <= r && Math.abs(this.z - n) <= r
        }, i.prototype.cross = function(e) {
            var t = this.x,
                n = this.y,
                r = this.z;
            return this.x = e.z * n - e.y * r, this.y = e.x * r - e.z * t, this.z = e.y * t - e.x * n, this
        }, i.prototype.crossDirect = function(e, t, n) {
            var r = this.x,
                i = this.y,
                o = this.z;
            return this.x = n * i - t * o, this.y = e * o - n * r, this.z = t * r - e * i, this
        }, i.prototype.lerp = function(e, t) {
            return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this.z += (e.z - this.z) * t, this
        },
        function() {
            var e = new i;
            i.prototype.reflect = function(t) {
                return e.copy(t), e.scale(2 * this.dot(t)), this.sub(e), this
            }
        }(), i.prototype.set = function(e) {
            return e instanceof i || e instanceof h.default ? (this.x = e.x, this.y = e.y, this.z = e.z) : (this.x = arguments[0], this.y = arguments[1], this.z = arguments[2]), this
        }, i.prototype.setDirect = function(e, t, n) {
            return this.x = e, this.y = t, this.z = n, this
        }, i.prototype.lengthSquared = function() {
            return this.x * this.x + this.y * this.y + this.z * this.z
        }, i.prototype.length = function() {
            return Math.sqrt(this.lengthSquared())
        }, i.prototype.normalize = function() {
            var e = this.length();
            return e < l.default.EPSILON ? (this.x = 0, this.y = 0, this.z = 0) : (this.x /= e, this.y /= e, this.z /= e), this
        }, i.prototype.unsafeNormalize = function() {
            var e = this.length();
            return this.x /= e, this.y /= e, this.z /= e, this
        }, i.prototype.distanceSquared = function(e) {
            var t = this.x - e.x,
                n = this.y - e.y,
                r = this.z - e.z;
            return t * t + n * n + r * r
        }, i.prototype.distance = function(e) {
            return Math.sqrt(this.distanceSquared(e))
        }, i.prototype.applyPre = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z;
            return this.x = t[0] * n + t[1] * r + t[2] * i, this.y = t[3] * n + t[4] * r + t[5] * i, this.z = t[6] * n + t[7] * r + t[8] * i, this
        }, i.prototype.applyPost = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z;
            return this.x = t[0] * n + t[3] * r + t[6] * i, this.y = t[1] * n + t[4] * r + t[7] * i, this.z = t[2] * n + t[5] * r + t[8] * i, this
        }, i.prototype.applyPostPoint = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z;
            return this.x = t[0] * n + t[4] * r + t[8] * i + t[12], this.y = t[1] * n + t[5] * r + t[9] * i + t[13], this.z = t[2] * n + t[6] * r + t[10] * i + t[14], this
        }, i.prototype.applyPostVector = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z;
            return this.x = t[0] * n + t[4] * r + t[8] * i, this.y = t[1] * n + t[5] * r + t[9] * i, this.z = t[2] * n + t[6] * r + t[10] * i, this
        }, i.prototype.applyRotation = function(e) {
            var t = 1 - 2 * e.y * e.y - 2 * e.z * e.z,
                n = 2 * e.x * e.y - 2 * e.z * e.w,
                r = 2 * e.x * e.z + 2 * e.y * e.w,
                i = 2 * e.x * e.y + 2 * e.z * e.w,
                o = 1 - 2 * e.x * e.x - 2 * e.z * e.z,
                a = 2 * e.y * e.z - 2 * e.x * e.w,
                s = 2 * e.x * e.z - 2 * e.y * e.w,
                u = 2 * e.y * e.z + 2 * e.x * e.w,
                l = 1 - 2 * e.x * e.x - 2 * e.y * e.y,
                f = t * this.x + n * this.y + r * this.z,
                c = i * this.x + o * this.y + a * this.z,
                d = s * this.x + u * this.y + l * this.z;
            return this.x = f, this.y = c, this.z = d, this
        }, i.prototype.clone = function() {
            return new i(this.x, this.y, this.z)
        }, i.prototype.copy = i.prototype.set, i.prototype.copyTo = function(e) {
            return e.x = this.x, e.y = this.y, e.z = this.z, this
        }, i.prototype.toArray = function() {
            return [this.x, this.y, this.z]
        }, i.fromArray = function(e) {
            return new i(e[0], e[1], e[2])
        }, i.fromAny = function() {
            if (3 === arguments.length) return i.fromArray(arguments);
            if (arguments[0] instanceof Array) return i.fromArray(arguments[0]);
            var e = arguments[0];
            return new i(e.x, e.y, e.z)
        }, i.prototype.setArray = function(e) {
            return this.x = e[0], this.y = e[1], this.z = e[2], this
        }, i.prototype.calcAngleBetween = function(e) {
            var t = this.clone().normalize().dot(e.clone().normalize());
            return Math.acos(l.default.clamp(t, -1, 1))
        }, i.prototype.calcAngleDegreesBetween = function(e) {
            return this.calcAngleBetween(e) * l.default.RAD_TO_DEG
        }, i.prototype.smoothDamp = function() {
            var e = {
                x: 0,
                y: 0
            };
            return function(t, n, r, i, o) {
                e.y = n.x, this.x = l.default.smoothDamp(this.x, t.x, e, r, i, o), n.x = e.y, e.y = n.y, this.y = l.default.smoothDamp(this.y, t.y, e, r, i, o), n.y = e.y, e.y = n.z, this.z = l.default.smoothDamp(this.z, t.z, e, r, i, o), n.z = e.y
            }
        }(), Object.defineProperty(i.prototype, "data", {
            get: s.default.warnOnce("The .data property of Vector3 was removed. Please use the .x, .y and .z properties instead.", function() {
                var e = [],
                    t = this;
                return Object.defineProperties(e, {
                    0: {
                        get: function() {
                            return t.x
                        },
                        set: function(e) {
                            t.x = e
                        }
                    },
                    1: {
                        get: function() {
                            return t.y
                        },
                        set: function(e) {
                            t.y = e
                        }
                    },
                    2: {
                        get: function() {
                            return t.z
                        },
                        set: function(e) {
                            t.z = e
                        }
                    }
                }), e
            })
        }), i.prototype.setVector = s.default.warnOnce("The setVector method of Vector3 is deprecated. Please use the set method instead.", function(e) {
            return this.set(e)
        }), i.add = s.default.warnOnce("Vector3.add is deprecated. Use Vector3.prototype.add instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e]), "number" == typeof t && (t = [t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] + o[0], n.data[1] = r[1] + o[1], n.data[2] = r[2] + o[2], n
        }), i.cross = s.default.warnOnce("Vector3.cross is deprecated. Use Vector3.prototype.cross instead.", function(e, t, n) {
            n || (n = new i);
            var r = e.data || e,
                o = t.data || t,
                a = o[2] * r[1] - o[1] * r[2],
                s = o[0] * r[2] - o[2] * r[0],
                u = o[1] * r[0] - o[0] * r[1];
            return n.data[0] = a, n.data[1] = s, n.data[2] = u, n
        }), i.distance = s.default.warnOnce("Vector3.distance is deprecated. Use Vector3.prototype.distance instead.", function(e, t) {
            return Math.sqrt(i.distanceSquared(e, t))
        }), i.distanceSquared = s.default.warnOnce("Vector3.distanceSquared is deprecated. Use Vector3.prototype.distanceSquared instead.", function(e, t) {
            var n = e.x - t.x,
                r = e.y - t.y,
                i = e.z - t.z;
            return n * n + r * r + i * i
        }), i.div = s.default.warnOnce("Vector3.div is deprecated. Use Vector3.prototype.div instead.", function(e, t, n) {
            if (n || (n = new i), "number" == typeof e) {
                var r = t.data || t;
                n.data[0] = e / r[0], n.data[1] = e / r[1], n.data[2] = e / r[2]
            } else if ("number" == typeof t) {
                var o = 1 / t,
                    a = e.data || e;
                n.data[0] = a[0] * o, n.data[1] = a[1] * o, n.data[2] = a[2] * o
            } else {
                var s = e.data || e,
                    u = t.data || t;
                n.data[0] = s[0] / u[0], n.data[1] = s[1] / u[1], n.data[2] = s[2] / u[2]
            }
            return n
        }), i.dot = s.default.warnOnce("Vector3.dot is deprecated. Use Vector3.prototype.dot instead.", function(e, t) {
            "number" == typeof e && (e = [e, e, e]), "number" == typeof t && (t = [t, t, t]);
            var n = e.data || e,
                r = t.data || t;
            return n[0] * r[0] + n[1] * r[1] + n[2] * r[2]
        }), i.mul = s.default.warnOnce("Vector3.mul is deprecated. Use Vector3.prototype.mul instead.", function(e, t, n) {
            if (n || (n = new i), "number" == typeof e) {
                var r = t.data || t;
                n.data[0] = e * r[0], n.data[1] = e * r[1], n.data[2] = e * r[2]
            } else if ("number" == typeof t) {
                var o = e.data || e;
                n.data[0] = o[0] * t, n.data[1] = o[1] * t, n.data[2] = o[2] * t
            } else {
                var a = e.data || e,
                    s = t.data || t;
                n.data[0] = a[0] * s[0], n.data[1] = a[1] * s[1], n.data[2] = a[2] * s[2]
            }
            return n
        }), i.prototype.addVector = s.default.warnOnce("Vector3.prototype.addVector is deprecated. Use Vector3.prototype.add instead.", function(e) {
            return this.x += e.x, this.y += e.y, this.z += e.z, this
        }), i.prototype.mulVector = s.default.warnOnce("Vector3.prototype.mulVector is deprecated. Use .mul instead.", function(e) {
            return this.x *= e.x, this.y *= e.y, this.z *= e.z, this
        }), i.prototype.dotVector = s.default.warnOnce("Vector3.prototype.dotVector is deprecated. Use .dot instead.", function(e) {
            var t = this.data,
                n = e.data;
            return t[0] * n[0] + t[1] * n[1] + t[2] * n[2]
        }), i.prototype.invert = s.default.warnOnce("Vector3.prototype.invert is deprecated. Use .negate instead.", function() {
            return this.x = 0 - this.x, this.y = 0 - this.y, this.z = 0 - this.z, this
        }), i.prototype.subVector = s.default.warnOnce("Vector3.prototype.subVector is deprecated. Use .sub instead.", function(e) {
            return this.x -= e.x, this.y -= e.y, this.z -= e.z, this
        }), i.sub = s.default.warnOnce("Vector3.sub is deprecated. Use Vector3.prototype.sub instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e]), "number" == typeof t && (t = [t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] - o[0], n.data[1] = r[1] - o[1], n.data[2] = r[2] - o[2], n
        }), c.default.addReturnChecks(i.prototype, ["dot", "dotDirect", "length", "lengthSquared", "distance", "distanceSquared"]), t.default = i
}, function(e, t, n) {
    var r = n(13),
        i = n(71),
        o = n(40),
        a = n(41),
        s = n(72),
        u = function(e, t, n) {
            var l, f, c, d, h = e & u.F,
                p = e & u.G,
                m = e & u.S,
                y = e & u.P,
                v = e & u.B,
                _ = p ? r : m ? r[t] || (r[t] = {}) : (r[t] || {}).prototype,
                g = p ? i : i[t] || (i[t] = {}),
                b = g.prototype || (g.prototype = {});
            p && (n = t);
            for (l in n) f = !h && _ && void 0 !== _[l], c = (f ? _ : n)[l], d = v && f ? s(c, r) : y && "function" == typeof c ? s(Function.call, c) : c, _ && a(_, l, c, e & u.U), g[l] != c && o(g, l, d), y && b[l] != c && (b[l] = c)
        };
    r.core = i, u.F = 1, u.G = 2, u.S = 4, u.P = 8, u.B = 16, u.W = 32, u.U = 64, u.R = 128, e.exports = u
}, , function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    } : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    };
    r.contains = function(e, t) {
        return -1 !== e.indexOf(t)
    }, r.find = function(e, t) {
        for (var n = 0; n < e.length; n += 1) {
            var r = e[n];
            if (t(r, n)) return r
        }
    }, r.defaults = function(e, t) {
        for (var n = Object.keys(t), r = 0; r < n.length; r += 1) {
            var i = n[r];
            void 0 !== e[i] && null !== e[i] || (e[i] = t[i])
        }
        return e
    }, r.copyOptions = function(e, t, n) {
        var i = Object.keys(n);
        if (t)
            for (var o = 0; o < i.length; o += 1) {
                var a = i[o],
                    s = t[a];
                e[a] = void 0 === s || null === s ? n[a] : s
            } else r.extend(e, n);
        return e
    }, r.extend = function(e, t) {
        if (!t) return !1;
        for (var n = Object.keys(t), r = 0; r < n.length; r += 1) {
            var i = n[r];
            e[i] = t[i]
        }
        return e
    }, r.clone = function(e) {
        return r.isObject(e) ? Array.isArray(e) ? e.slice() : r.extend({}, e) : e
    };
    var o = Array.prototype.forEach;
    r.forEach = function(e, t, n, r) {
        if (void 0 !== e && null !== e)
            if (o && e.forEach === o) e.forEach(t, n);
            else if (e.length === +e.length)
            for (var i = 0, a = e.length; i < a; i += 1) t.call(n, e[i], i, e);
        else {
            var s = Object.keys(e);
            void 0 !== r && s.sort(function(t, n) {
                return e[t][r] - e[n][r]
            });
            for (var u = 0, l = s.length; u < l; u += 1) t.call(n, e[s[u]], s[u], e)
        }
    }, r.each = r.forEach, r.map = function(e, t, n, i) {
        var o = [];
        return r.forEach(e, function(r, i) {
            o.push(t.call(n, r, i, e))
        }, n, i), o
    }, r.deepClone = function(e) {
        if (null === e || "object" !== (void 0 === e ? "undefined" : i(e))) return e;
        if ("[object ArrayBuffer]" === Object.prototype.toString.call(e.buffer)) return new e.constructor(e);
        if (e instanceof Array) return e.map(r.deepClone);
        if (e.nodeType && "function" == typeof e.cloneNode) return e.cloneNode(!0);
        for (var t = {}, n = Object.keys(e), o = 0; o < n.length; o += 1) {
            var a = n[o];
            t[a] = r.deepClone(e[a])
        }
        return t
    }, r.shallowSelectiveClone = function(e, t) {
        var n = {};
        return t.forEach(function(t) {
            n[t] = e[t]
        }), n
    }, r.cloneMap = function(e) {
        var t = new Map;
        return e.forEach(function(e, n) {
            t.set(n, e)
        }), t
    }, r.cloneSet = function(e) {
        var t = new Set;
        return e.forEach(function(e) {
            t.add(e)
        }), t
    }, r.warnOnce = function(e, t) {
        var n = !1;
        return function() {
            return n || (console.warn(e), n = !0), t.apply(this, arguments)
        }
    }, r.constant = function(e) {
        return function() {
            return e
        }
    }, r.property = function(e) {
        return function(t) {
            return t[e]
        }
    }, r.isArray = function(e) {
        return Array.isArray(e)
    }, r.isObject = function(e) {
        return e === Object(e)
    }, r.isString = function(e) {
        return "string" == typeof e
    }, r.isBoolean = function(e) {
        return !0 === e || !1 === e
    }, r.isNumber = function(e) {
        return "number" == typeof e
    }, r.isInteger = function(e) {
        return r.isNumber(e) && e % 1 == 0
    }, r.getExtension = function(e) {
        if (r.isString(e)) {
            var t = e.lastIndexOf(".");
            if (t >= -1) return e.substr(t + 1).toLowerCase()
        }
        return ""
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
            value: !0
        }), r.DEG_TO_RAD = Math.PI / 180, r.RAD_TO_DEG = 180 / Math.PI, r.HALF_PI = .5 * Math.PI, r.TWO_PI = 2 * Math.PI, r.EPSILON = 1e-5, //! AT: unfortunately Matrix.invert is too unstable to use a smaller epsilon
        //! AT: why do we have both these functions and the constant above?
        r.radFromDeg = function(e) {
            return e * r.DEG_TO_RAD
        }, r.degFromRad = function(e) {
            return e * r.RAD_TO_DEG
        }, r.lerp = function(e, t, n) {
            return t === n ? t : t + (n - t) * e
        }, r.inverseLerp = function(e, t, n) {
            return t === n ? 1 : (e - t) / (n - t)
        }, r.clamp = function(e, t, n) {
            return t < n ? e < t ? t : e > n ? n : e : e < n ? n : e > t ? t : e
        }, r.radialClamp = function(e, t, n) {
            var i = (t + n) / 2 + (n > t ? Math.PI : 0),
                o = r.moduloPositive(e - i, r.TWO_PI),
                a = r.moduloPositive(t - i, r.TWO_PI),
                s = r.moduloPositive(n - i, r.TWO_PI);
            return e < 0 && t > 0 ? t -= r.TWO_PI : e > 0 && t < 0 && (t += r.TWO_PI), e > r.TWO_PI && n < r.TWO_PI && (n += r.TWO_PI), o < a ? t : o > s ? n : e
        }, r.moduloPositive = function(e, t) {
            var n = e % t;
            return n += n < 0 ? t : 0
        }, r.scurve3 = function(e) {
            return (-2 * e + 3) * e * e
        }, r.scurve5 = function(e) {
            return ((6 * e - 15) * e + 10) * e * e * e
        }, r.sphericalToCartesian = function(e, t, n, r) {
            var i = e * Math.cos(n);
            r.x = i * Math.cos(t), r.y = e * Math.sin(n), r.z = i * Math.sin(t)
        }, r.cartesianToSpherical = function(e, t, n, r) {
            var i = Math.sqrt(e * e + n * n);
            r.x = Math.sqrt(e * e + t * t + n * n), r.y = Math.atan2(n, e), r.z = Math.atan2(t, i)
        }, r.getTriangleNormal = function(e, t, n, r, i, o, a, s, u) {
            var l = r - e,
                f = i - t,
                c = o - n,
                d = a - e,
                h = s - t,
                p = u - n;
            return [f * p - c * h, c * d - l * p, l * h - f * d]
        }, r.isPowerOfTwo = function(e) {
            return 0 == (e & e - 1)
        }, r.nearestPowerOfTwo = function(e) {
            return e--, e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, e |= e >> 16, ++e
        }, r.nearestHigherPowerOfTwo = r.nearestPowerOfTwo, r.closeTo = function(e, t, n) {
            return n = void 0 !== n ? n : .001, Math.abs(e - t) <= n
        }, r.sign = function(e) {
            return e < 0 ? -1 : e > 0 ? 1 : 0
        }, r.triangleArea = function(e, t, n) {
            return Math.abs(e.x * t.y + t.x * n.y + n.x * e.y - t.y * n.x - n.y * e.x - e.y * t.x) / 2
        }, r.barycentricInterpolation = function(e, t, n, i) {
            var o = r.triangleArea(t, n, i),
                a = r.triangleArea(e, n, i),
                s = r.triangleArea(e, t, i),
                u = o + a + s;
            if (!u) {
                if (i[0] === e[0] && i[2] === e[2]) return e;
                if (i[0] === t[0] && i[2] === t[2]) return t;
                if (i[0] === n[0] && i[2] === n[2]) return n
            }
            return i.z = (o * e.z + a * t.z + s * n.z) / u, i
        }, r.smoothstep = function(e, t, n) {
            return (n = r.clamp((n - e) / (t - e), 0, 1)) * n * (3 - 2 * n)
        }, r.randomSeed = 1337, r.fastRandom = function() {
            return r.randomSeed = (9301 * r.randomSeed + 49297) % 233280, r.randomSeed / 233280
        }, r.randomInRange = function(e, t) {
            return Math.random() * (t - e) + e
        }, r.floatToHalfFloat = function() {
            var e = new Float32Array(1),
                t = new Int32Array(e.buffer);
            return function(n) {
                e[0] = n;
                var r = t[0],
                    i = r >> 16 & 32768,
                    o = 4096 + (2147483647 & r);
                return o >= 1199570944 ? (2147483647 & r) >= 1199570944 ? o < 2139095040 ? 31744 | i : 31744 | i | (8388607 & r) >> 13 : 31743 | i : o >= 947912704 ? i | o - 939524096 >> 13 : o < 855638016 ? i : (o = (2147483647 & r) >> 23, i | (8388607 & r | 8388608) + (8388608 >>> o - 102) >> 126 - o)
            }
        }(), r.warnNaN = function(e, t) {
            var n = e[t];
            Object.defineProperty(e, t, {
                get: function() {
                    return n
                },
                set: function(e) {
                    if (isNaN(e)) throw new Error("Tried to assign NaN to " + t);
                    n = e
                }
            })
        }, r.smoothDamp = function(e, t, n, r, i, o) {
            void 0 === i && (i = .3), void 0 === o && (o = 1e7), i = Math.max(1e-4, i);
            var a = 2 / i,
                s = a * r,
                u = 1 / (1 + s + .48 * s * s + .235 * s * s * s),
                l = e - t,
                f = t,
                c = o * i;
            l = Math.max(-c, Math.min(c, l)), t = e - l;
            var d = n.y,
                h = (d + a * l) * r;
            d = (d - a * h) * u;
            var p = t + (l + h) * u;
            return f - e > 0 == p > f && (p = f, d = (p - f) / r), n.x = p, n.y = d, p
        }, r.logicalXOR = function(e, t) {
            return (e || t) && !(e && t)
        }, t.default = r
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = n(268),
        i = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(r),
        o = new i.default;
    t.default = o
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        this.attributeMap = e, this.vertexCount = this._vertexCountStore = void 0 !== t ? t : 0, this.indexCount = void 0 !== n ? n : 0, this.primitiveCounts = [0], this.vertexData = null, this.indexData = null, this.dataViews = {}, this.indexLengths = null, this.indexModes = ["Triangles"], this.type = i.MESH, this.paletteMap = void 0, this.weightsPerVertex = void 0, this.boundingBox = void 0, this.store = void 0, this.wireframeData = void 0, this.flatMeshData = void 0, this.__boundingTree = void 0, this._attributeDataNeedsRefresh = !1, this._dirtyAttributeNames = new Set, this.glVAO = [], this.rebuildData(this.vertexCount, this.indexCount), Object.seal(this)
    }

    function o(e) {
        for (var t = {}, n = 0; n < e.length; n++) {
            var r = e[n];
            if (void 0 === S[r]) throw new Error("No default attribute named: " + r);
            t[r] = g.default.deepClone(S[r])
        }
        return t
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(271),
        s = r(a),
        u = n(147),
        l = r(u),
        f = n(146),
        c = r(f),
        d = n(37),
        h = r(d),
        p = n(0),
        m = r(p),
        y = n(36),
        v = r(y),
        _ = n(3),
        g = r(_);
    i.MESH = 0, i.SKINMESH = 1, i.prototype.rebuildData = function(e, t, n) {
        var r = {},
            i = null;
        if (n) {
            for (var o = Object.keys(this.attributeMap), a = 0; a < o.length; a++) {
                var s = o[a],
                    u = this.dataViews[s];
                u && (r[s] = u)
            }
            t > 0 && this.indexData && (i = this.indexData.data)
        }
        if (this.rebuildVertexData(e), this.rebuildIndexData(t), n) {
            for (var l = Object.keys(this.attributeMap), f = 0; f < l.length; f++) {
                var c = l[f],
                    d = r[c];
                d && this.dataViews[c].set(d)
            }
            t > 0 && i && this.indexData.data.set(i)
        }
    }, i.prototype.rebuildVertexData = function(e) {
        if (isNaN(e) || (this.vertexCount = e, this._vertexCountStore = this.vertexCount), this.vertexCount > 0) {
            for (var t = 0, n = Object.keys(this.attributeMap), r = 0; r < n.length; r++) {
                var i = this.attributeMap[n[r]];
                t += l.default.getByteSize(i.type) * i.count
            }
            this.vertexData = new s.default(new ArrayBuffer(t * this.vertexCount), "ArrayBuffer"), this.generateAttributeData()
        }
    }, i.prototype.rebuildIndexData = function(e) {
        if (void 0 !== e && (this.indexCount = e), this.indexCount > 0) {
            var t = c.default.createIndexBuffer(this.indexCount, this.vertexCount);
            this.indexData = new s.default(t, "ElementArrayBuffer")
        } else this.indexData = null, this.indexLengths = null, this.indexModes = ["Triangles"]
    }, i.prototype.setVertexDataUpdated = function() {
        this.vertexData._dataNeedsRefresh = !0
    }, i.prototype.setAttributeDataUpdated = function(e) {
        this._dirtyAttributeNames.add(e), this._attributeDataNeedsRefresh = !0
    }, i.prototype.getSectionCount = function() {
        return this.indexLengths ? this.indexLengths.length : 1
    }, i.prototype.getPrimitiveCount = function(e) {
        return e >= 0 && e < this.primitiveCounts.length ? this.primitiveCounts[e] : 0
    }, i.prototype.getPrimitiveVertices = function(e, t, n) {
        var r = this.getPrimitiveCount(t);
        if (e >= r || e < 0) throw new Error("Invalid primitiveIndex '" + e + "'.  Count is " + r);
        var o = this.indexModes[t],
            a = i.getVertexCount(o),
            s = n || [];
        s.length = a;
        for (var u = this.getAttributeBuffer(i.POSITION), l = 0; l < a; l++)
            if (s[l] || (s[l] = new m.default), this.getIndexBuffer()) {
                var f = this.getIndexBuffer()[this.getVertexIndex(e, l, t)];
                s[l].x = u[3 * f + 0], s[l].y = u[3 * f + 1], s[l].z = u[3 * f + 2]
            } else {
                var c = this.getVertexIndex(e, l, t);
                s[l].x = u[3 * c + 0], s[l].y = u[3 * c + 1], s[l].z = u[3 * c + 2]
            }
        return s
    }, i.prototype.getVertexIndex = function(e, t, n) {
        for (var r = 0, o = 0; o < n; o++) r += this.indexLengths[o];
        switch (this.indexModes[n]) {
            case "Triangles":
                r += 3 * e + t;
                break;
            case "TriangleStrip":
                r += e + t;
                break;
            case "TriangleFan":
                r += 0 === t ? 0 : e + t;
                break;
            case "Points":
                r += e;
                break;
            case "Lines":
                r += 2 * e + t;
                break;
            case "LineStrip":
            case "LineLoop":
                r += e + t;
                break;
            default:
                return i.logger.warning("unimplemented index mode: " + this.indexModes[n]), -1
        }
        return r
    }, i.prototype.getTotalPrimitiveCount = function() {
        for (var e = 0, t = 0, n = this.primitiveCounts.length; t < n; t++) e += this.primitiveCounts[t];
        return e
    }, i.prototype.updatePrimitiveCounts = function() {
        var e = this.indexData ? this.indexData.data.length : this.vertexCount,
            t = this.getSectionCount();
        this.primitiveCounts.length !== t && (this.primitiveCounts = []);
        for (var n = 0; n < t; n++) {
            var r = this.indexLengths ? this.indexLengths[n] : e,
                o = i.getPrimitiveCount(this.indexModes[n], r);
            this.primitiveCounts[n] = o
        }
    }, i.getPrimitiveCount = function(e, t) {
        switch (e) {
            case "Triangles":
                return t / 3;
            case "TriangleFan":
            case "TriangleStrip":
                return t - 2;
            case "Lines":
                return t / 2;
            case "LineStrip":
                return t - 1;
            case "LineLoop":
            case "Points":
                return t;
            default:
                throw new Error("unimplemented index mode: " + e)
        }
    }, i.getVertexCount = function(e) {
        switch (e) {
            case "Triangles":
            case "TriangleFan":
            case "TriangleStrip":
                return 3;
            case "Lines":
            case "LineStrip":
            case "LineLoop":
                return 2;
            case "Points":
                return 1;
            default:
                throw new Error("unimplemented index mode: " + e)
        }
    };
    var b = {
        Byte: Int8Array,
        UnsignedByte: Uint8Array,
        UnsignedByteClamped: Uint8ClampedArray,
        Short: Int16Array,
        UnsignedShort: Uint16Array,
        Int: Int32Array,
        UnsignedInt: Uint32Array,
        Float: Float32Array
    };
    i.prototype.generateAttributeData = function() {
            var e = this.vertexData.data,
                t = void 0,
                n = 0;
            for (var r in this.attributeMap) {
                var i = this.attributeMap[r];
                i.offset = n;
                var o = this.vertexCount * i.count;
                n += o * l.default.getByteSize(i.type);
                var a = b[i.type];
                if (!a) throw new Error("Unsupported DataType: " + i.type);
                t = new a(e, i.offset, o), this.dataViews[r] = t, i.hashKey = i.count + "_" + i.type + "_" + i.stride + "_" + i.offset + "_" + i.normalized
            }
        }, i.prototype.deIndex = function() {
            var e = this.getIndexBuffer();
            if (e) {
                for (var t = {}, n = Object.keys(this.attributeMap), r = 0, i = n.length; r < i; r++)
                    for (var o = n[r], a = this.attributeMap[o], s = this.getAttributeBuffer(o), u = t[o] = [], l = 0; l < e.length; l++)
                        for (var f = e[l], c = 0; c < a.count; c++) u[l * a.count + c] = s[f * a.count + c];
                this.rebuildData(this.indexCount, 0);
                for (var d = 0, h = n.length; d < h; d++) {
                    var p = n[d];
                    this.getAttributeBuffer(p).set(t[p])
                }
                this.setVertexDataUpdated(), this.glVAO = []
            }
        },
        //! AT: unused
        i.prototype.makeInterleavedData = function() {
            var e = 0,
                t = 0;
            for (var n in this.attributeMap) {
                var r = this.attributeMap[n];
                r.offset = e, e += r.count * l.default.getByteSize(r.type)
            }
            var i = new s.default(new ArrayBuffer(e * this.vertexCount), this.vertexData.target);
            i._dataUsage = this.vertexData._dataUsage, i._dataNeedsRefresh = !0;
            var o = new DataView(i.data);
            for (var a in this.attributeMap) {
                var u = this.dataViews[a],
                    f = this.attributeMap[a];
                f.stride = e, t = f.offset;
                for (var c = f.count, d = l.default.getByteSize(f.type), h = this.getDataMethod(f.type), p = o[h], m = 0; m < this.vertexCount; m++)
                    for (var y = 0; y < c; y++) p.apply(o, [t + e * m + y * d, u[m * c + y], !0])
            }
            this.vertexData = i
        }, i.prototype.getDataMethod = function(e) {
            switch (e) {
                case "Byte":
                    return "setInt8";
                case "UnsignedByte":
                    return "setUInt8";
                case "Short":
                    return "setInt16";
                case "UnsignedShort":
                    return "setUInt16";
                case "Int":
                    return "setInt32";
                case "HalfFloat":
                    return "setInt16";
                case "Float":
                    return "setFloat32"
            }
        }, i.prototype.getAttributeBuffer = function(e) {
            return this.dataViews[e]
        },
        //! schteppe: are simple getters like this really needed? Why not just use the property?
        i.prototype.getIndexData = function() {
            return this.indexData
        }, i.prototype.getIndexBuffer = function() {
            return null !== this.indexData ? this.indexData.data : null
        }, i.prototype.getIndexLengths = function() {
            return this.indexLengths
        }, i.prototype.getIndexModes = function() {
            return this.indexModes
        },
        //! AT: unused and undocumented; remove?
        i.prototype.resetVertexCount = function() {
            this.vertexCount = this._vertexCountStore
        }, i.prototype.applyTransform = function(e, t) {
            var n = new m.default,
                r = this.getAttributeBuffer(e),
                o = r.length;
            if (e === i.POSITION)
                for (var a = 0; a < o; a += 3) n.setDirect(r[a + 0], r[a + 1], r[a + 2]), n.applyPostPoint(t.matrix), r[a + 0] = n.x, r[a + 1] = n.y, r[a + 2] = n.z;
            else if (e === i.NORMAL)
                for (var s = 0; s < o; s += 3) n.setDirect(r[s + 0], r[s + 1], r[s + 2]), n.applyPost(t.rotation), r[s + 0] = n.x, r[s + 1] = n.y, r[s + 2] = n.z;
            else if (e === i.TANGENT)
                for (var u = 0; u < o; u += 3) n.setDirect(r[u + 0], r[u + 1], r[u + 2]), n.applyPost(t.rotation), r[u + 0] = n.x, r[u + 1] = n.y, r[u + 2] = n.z;
            return this
        }, i.prototype.applyFunction = function(e, t) {
            //! AT: fun should return a vector3, not an array
            var n = void 0,
                r = void 0,
                i = this.getAttributeBuffer(e),
                o = i.length;
            switch (this.attributeMap[e].count) {
                case 1:
                    for (var a = 0; a < o; a++) i[a] = t(i[a]);
                    break;
                case 2:
                    n = new h.default;
                    for (var s = 0; s < o; s += 2) n.setDirect(i[s + 0], i[s + 1]), r = t(n), i[s + 0] = r.x, i[s + 1] = r.y;
                    break;
                case 3:
                    n = new m.default;
                    for (var u = 0; u < o; u += 3) n.setDirect(i[u + 0], i[u + 1], i[u + 2]), r = t(n), i[u + 0] = r.x, i[u + 1] = r.y, i[u + 2] = r.z;
                    break;
                case 4:
                    n = new v.default;
                    for (var l = 0; l < o; l += 4) n.setDirect(i[l + 0], i[l + 1], i[l + 2], i[l + 3]), r = t(n), i[l + 0] = r.x, i[l + 1] = r.y, i[l + 2] = r.z, i[l + 3] = r.w
            }
            return this
        }, i.prototype.getNormalsMeshData = function(e) {
            if (void 0 !== this.getAttributeBuffer("POSITION") && void 0 !== this.getAttributeBuffer("NORMAL")) {
                e = void 0 !== e ? e : 1;
                for (var t = [], n = [], r = this.dataViews.POSITION.length / 3, o = 0; o < r; o++) t.push(this.dataViews.POSITION[3 * o + 0], this.dataViews.POSITION[3 * o + 1], this.dataViews.POSITION[3 * o + 2], this.dataViews.POSITION[3 * o + 0] + this.dataViews.NORMAL[3 * o + 0] * e, this.dataViews.POSITION[3 * o + 1] + this.dataViews.NORMAL[3 * o + 1] * e, this.dataViews.POSITION[3 * o + 2] + this.dataViews.NORMAL[3 * o + 2] * e);
                for (var a = 0; a < 2 * r; a += 2) n.push(a, a + 1);
                var s = new i(i.defaultMap([i.POSITION]), t.length, n.length);
                return s.getAttributeBuffer(i.POSITION).set(t), s.getIndexBuffer().set(n), s.indexModes[0] = "Lines", s
            }
        }, i.prototype.buildWireframeData = function() {
            var e = g.default.deepClone(this.attributeMap),
                t = new i(e, this.vertexCount, 0);
            t.indexModes[0] = "Lines";
            var n = this.getIndexBuffer(),
                r = this,
                o = void 0;
            o = n ? function(e, t, i) {
                return n[r.getVertexIndex(e, t, i)]
            } : function(e, t, n) {
                return r.getVertexIndex(e, t, n)
            };
            var a = [],
                s = 0;
            this.updatePrimitiveCounts();
            for (var u = 0; u < this.getSectionCount(); u++)
                for (var l = this.indexModes[u], f = this.getPrimitiveCount(u), c = 0; c < f; c++) switch (l) {
                    case "Triangles":
                    case "TriangleFan":
                    case "TriangleStrip":
                        var d = o(c, 0, u),
                            h = o(c, 1, u),
                            p = o(c, 2, u);
                        a[s + 0] = d, a[s + 1] = h, a[s + 2] = h, a[s + 3] = p, a[s + 4] = p, a[s + 5] = d, s += 6;
                        break;
                    case "Lines":
                    case "LineStrip":
                        var m = o(c, 0, u),
                            y = o(c, 1, u);
                        a[s + 0] = m, a[s + 1] = y, s += 2;
                        break;
                    case "LineLoop":
                        var v = o(c, 0, u),
                            _ = o(c, 1, u);
                        c === f - 1 && (_ = o(0, 0, u)), a[s + 0] = v, a[s + 1] = _, s += 2
                }
            if (s > 0) {
                t.rebuildIndexData(s);
                for (var b in e) t.getAttributeBuffer(b).set(this.getAttributeBuffer(b));
                t.getIndexBuffer().set(a)
            }
            return t.paletteMap = this.paletteMap, t.weightsPerVertex = this.weightsPerVertex, t
        };
    var x = new m.default,
        w = new m.default,
        E = new m.default;
    i.prototype.buildFlatMeshData = function() {
        var e = this.getIndexBuffer();
        if (null === e) return console.debug("No indices, probably a point mesh"), this;
        var t = g.default.deepClone(this.attributeMap),
            n = {};
        for (var r in t) n[r] = {
            oldBuffer: this.getAttributeBuffer(r),
            values: []
        };
        var o = 0;
        this.updatePrimitiveCounts();
        for (var a = 0; a < this.getSectionCount(); a++)
            for (var s = this.indexModes[a], u = this.getPrimitiveCount(a), l = !1, f = 0; f < u; f++) switch (s) {
                case "TriangleStrip":
                    l = f % 2 == 1;
                case "Triangles":
                case "TriangleFan":
                    var c = e[this.getVertexIndex(f, 0, a)],
                        d = e[this.getVertexIndex(f, 1, a)],
                        h = e[this.getVertexIndex(f, 2, a)];
                    if (l) {
                        var p = h;
                        h = d, d = p
                    }
                    for (var m in n)
                        if (m !== i.NORMAL) {
                            for (var y = t[m].count, v = 0; v < y; v++) n[m].values[o * y + v] = n[m].oldBuffer[c * y + v], n[m].values[(o + 1) * y + v] = n[m].oldBuffer[d * y + v], n[m].values[(o + 2) * y + v] = n[m].oldBuffer[h * y + v];
                            m === i.POSITION && (x.setDirect(n[m].values[3 * o], n[m].values[3 * o + 1], n[m].values[3 * o + 2]), w.setDirect(n[m].values[3 * (o + 1)], n[m].values[3 * (o + 1) + 1], n[m].values[3 * (o + 1) + 2]), E.setDirect(n[m].values[3 * (o + 2)], n[m].values[3 * (o + 2) + 1], n[m].values[3 * (o + 2) + 2]), w.sub(x), E.sub(x), w.cross(E).normalize(), n[i.NORMAL] && (n[i.NORMAL].values[3 * o] = w.x, n[i.NORMAL].values[3 * o + 1] = w.y, n[i.NORMAL].values[3 * o + 2] = w.z, n[i.NORMAL].values[3 * (o + 1)] = w.x, n[i.NORMAL].values[3 * (o + 1) + 1] = w.y, n[i.NORMAL].values[3 * (o + 1) + 2] = w.z, n[i.NORMAL].values[3 * (o + 2)] = w.x, n[i.NORMAL].values[3 * (o + 2) + 1] = w.y, n[i.NORMAL].values[3 * (o + 2) + 2] = w.z))
                        }
                    o += 3
            }
        if (0 === o) return console.warn("Could not build flat data"), this;
        var _ = new i(t, o);
        for (var b in n) _.getAttributeBuffer(b).set(n[b].values);
        return _.paletteMap = this.paletteMap, _.weightsPerVertex = this.weightsPerVertex, _
    }, i.prototype.destroy = function(e) {
        this.vertexData && this.vertexData.destroy(e), this.indexData && this.indexData.destroy(e)
    }, i.prototype.clone = function() {
        var e = g.default.deepClone(this.attributeMap),
            t = new i(e, this.vertexCount, this.indexCount);
        return t.primitiveCounts = this.primitiveCounts.slice(0), t.vertexData.copy(this.vertexData), t.indexData.copy(this.indexData), t.indexLengths = Array.isArray(this.indexLengths) ? this.indexLengths.slice(0) : this.indexLengths, t.indexModes = this.indexModes.slice(0), t.type = this.type, this.paletteMap && (t.paletteMap = this.paletteMap.slice(0)), t.weightsPerVertex = this.weightsPerVertex, t
    }, i.POSITION = "POSITION", i.NORMAL = "NORMAL", i.COLOR = "COLOR", i.TANGENT = "TANGENT", i.TEXCOORD0 = "TEXCOORD0", i.TEXCOORD1 = "TEXCOORD1", i.TEXCOORD2 = "TEXCOORD2", i.TEXCOORD3 = "TEXCOORD3", i.WEIGHTS = "WEIGHTS", i.JOINTIDS = "JOINTIDS", i.createAttribute = function(e, t, n) {
        return {
            count: e,
            type: t,
            stride: 0,
            offset: 0,
            normalized: void 0 !== n && n
        }
    };
    var S = {
        POSITION: i.createAttribute(3, "Float"),
        NORMAL: i.createAttribute(3, "Float"),
        COLOR: i.createAttribute(4, "Float"),
        TANGENT: i.createAttribute(4, "Float"),
        TEXCOORD0: i.createAttribute(2, "Float"),
        TEXCOORD1: i.createAttribute(2, "Float"),
        TEXCOORD2: i.createAttribute(2, "Float"),
        TEXCOORD3: i.createAttribute(2, "Float"),
        WEIGHTS: i.createAttribute(4, "Float"),
        JOINTIDS: i.createAttribute(4, "Float")
    };
    i.defaultMap = function(e) {
        return o(void 0 === e ? Object.keys(S) : e)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e) {
        return e.charAt(0).toLowerCase() + e.substr(1)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        a = function() {
            function e(t, n) {
                r(this, e), this.world = null, this.type = t, this.interests = n, this._activeEntities = [], this.passive = !1, this.priority = 0
            }
            return o(e, [{
                key: "process",
                value: function() {}
            }, {
                key: "fixedUpdate",
                value: function() {}
            }, {
                key: "added",
                value: function(e) {
                    this._check(e)
                }
            }, {
                key: "inserted",
                value: function() {}
            }, {
                key: "deleted",
                value: function() {}
            }, {
                key: "changed",
                value: function(e) {
                    this._check(e)
                }
            }, {
                key: "removed",
                value: function(e) {
                    var t = this._activeEntities.indexOf(e); - 1 !== t && (this._activeEntities.splice(t, 1), this.deleted(e))
                }
            }, {
                key: "setup",
                value: function(e) {
                    e.entityManager.getEntities().forEach(this._check.bind(this))
                }
            }, {
                key: "cleanup",
                value: function() {
                    for (var e = 0; e < this._activeEntities.length; e++) {
                        var t = this._activeEntities[e];
                        this.deleted(t)
                    }
                }
            }, {
                key: "_check",
                value: function(e) {
                    if (!this.interests || 0 !== this.interests.length) {
                        var t = null === this.interests;
                        if (!t && this.interests.length <= e._components.length) {
                            t = !0;
                            for (var n = 0; n < this.interests.length; n++) {
                                if (!e[i(this.interests[n])]) {
                                    t = !1;
                                    break
                                }
                            }
                        }
                        var r = this._activeEntities.indexOf(e);
                        t && -1 === r ? (this._activeEntities.push(e), this.inserted(e)) : t || -1 === r || (this._activeEntities.splice(r, 1), this.deleted(e))
                    }
                }
            }, {
                key: "_fixedUpdate",
                value: function(e) {
                    this.fixedUpdate(this._activeEntities, e)
                }
            }, {
                key: "_process",
                value: function(e) {
                    this.process(this._activeEntities, e)
                }
            }, {
                key: "_lateProcess",
                value: function(e) {
                    this.lateProcess(this._activeEntities, e)
                }
            }, {
                key: "clear",
                value: function() {
                    this._activeEntities.length = 0
                }
            }, {
                key: "onPreRender",
                value: function() {}
            }, {
                key: "onPostRender",
                value: function() {}
            }]), e
        }();
    t.default = a
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        o = n(63),
        a = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(o),
        s = function() {
            function e() {
                r(this, e), this.enabled = !0, this.entity = null, this.installedAPI = new Set, this.debugLevel = "normal"
            }
            return i(e, [{
                key: "attached",
                value: function() {}
            }, {
                key: "detached",
                value: function() {}
            }, {
                key: "applyAPI",
                value: function(e) {
                    var t = this.api;
                    if (t)
                        for (var n = Object.keys(t), r = 0; r < n.length; r++) {
                            var i = n[r];
                            if (void 0 !== e[i]) throw new Error("Could not install method " + i + " of " + this.type + " as it is already taken");
                            e[i] = t[i], this.installedAPI.add(i)
                        }
                }
            }, {
                key: "removeAPI",
                value: function(e) {
                    this.installedAPI.forEach(function(t) {
                        delete e[t]
                    })
                }
            }], [{
                key: "applyOnEntity",
                value: function() {
                    return !1
                }
            }, {
                key: "applyEntitySelectionAPI",
                value: function(e, t) {
                    if (e)
                        for (var n = Object.keys(e), r = 0; r < n.length; r++) {
                            var i = n[r];
                            if (void 0 !== a.default[i]) throw new Error("Could not install method " + i + " on EntitySelection as it is already taken");
                            a.default.installMethod(e[i], i, t)
                        }
                }
            }]), e
        }();
    t.default = s
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.id = null, this.name = "Default Material", this.shader = null,
            //! AT: horrendous type checking follows
            "string" == typeof e ? (this.name = e, -1 !== e.indexOf(".glsl") ? this.shader = new a.default(this.name) : t && t.vshader && t.fshader && (this.shader = i.createShader(t))) : e && e.vshader && e.fshader && (this.shader = i.createShader(e), "string" == typeof t && (this.name = t)), this.uniforms = {}, this._textureMaps = {}, this._samplerMaps = {}, this.cullState = {
                enabled: !0,
                cullFace: "Back",
                frontFace: "CCW"
            }, this.blendState = {
                blending: "NoBlending",
                blendEquation: "AddEquation",
                blendSrc: "SrcAlphaFactor",
                blendDst: "OneMinusSrcAlphaFactor"
            }, this.depthState = {
                enabled: !0,
                write: !0,
                depthFunc: "LessEqual"
            }, this.offsetState = {
                enabled: !1,
                factor: 1,
                units: 1
            }, this.dualTransparency = !1, this.wireframe = !1, this.flat = !1, this.lineWidth = 1, this.renderQueue = null, this.fullOverride = !1, this.errorOnce = !1, this.bIsInstanced = !1, this.instanceCount = 1, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(29),
        a = r(o),
        s = n(197),
        u = r(s),
        l = n(3),
        f = r(l),
        c = n(26),
        d = r(c);
    i.prototype.setTexture = function(e, t, n) {
            this._textureMaps[e] = t;
            var r = !1,
                i = !0;
            if (Array.isArray(t) && t.length > 0)
                for (var o = 0; o < t.length; o++) {
                    if (t[o].anisotropy > 1) {
                        r = !0;
                        break
                    }
                    if (0 == t[o].sampler) {
                        i = !1;
                        break
                    }
                } else t.anisotropy > 1 && (r = !0), 0 == t.sampler && (i = !1);
            if (0 == r && i)
                if (n) this._samplerMaps[e] = n;
                else if (Array.isArray(t)) {
                for (var a = new Array(t.length), s = 0; s < t.length; s++) a[s] = new u.default({
                    wrapS: t[s].wrapS,
                    wrapT: t[s].wrapT,
                    magFilter: t[s].magFilter,
                    minFilter: t[s].minFilter
                });
                this._samplerMaps[e] = a
            } else this._samplerMaps[e] = new u.default({
                wrapS: t.wrapS,
                wrapT: t.wrapT,
                magFilter: t.magFilter,
                minFilter: t.minFilter
            });
            else this._samplerMaps[e] = void 0
        }, i.prototype.getTexture = function(e) {
            return this._textureMaps[e]
        }, i.prototype.getSampler = function(e) {
            return this._samplerMaps[e]
        }, i.prototype.setSampler = function(e, t) {
            Array.isArray(t) || (t = [t]), this._samplerMaps[e] = t
        }, i.prototype.removeTexture = function(e) {
            delete this._textureMaps[e]
        }, i.prototype.getTextures = function() {
            var e = [];
            for (var t in this._textureMaps) e.push(this._textureMaps[t]);
            return e
        }, i.prototype.getSamplers = function() {
            var e = [];
            for (var t in this._samplerMaps) e.push(this._samplerMaps[t]);
            return e
        }, i.prototype.getTextureEntries = function() {
            return this._textureMaps
        }, i.prototype.getSamplerEntries = function() {
            return this._samplerMaps
        }, i.prototype.getRenderQueue = function() {
            return null !== this.renderQueue ? this.renderQueue : null !== this.shader ? this.shader.renderQueue : 1e3
        }, i.prototype.setRenderQueue = function(e) {
            this.renderQueue = e
        }, i.prototype.clone = function(e) {
            e = e || {};
            var t = new i(this.name);
            if (t.id = this.id, t.name = this.name, t.shader = this.shader.clone(), e.shareUniforms ? t.uniforms = this.uniforms : t.uniforms = f.default.deepClone(this.uniforms), e.shareTextures)
                for (var n = Object.keys(this._textureMaps), r = 0; r < n.length; r++) {
                    var o = n[r];
                    t._textureMaps[o] = this._textureMaps[o]
                } else
                    for (var a = Object.keys(this._textureMaps), s = 0; s < a.length; s++) {
                        var u = a[s];
                        t._textureMaps[u] = this._textureMaps[u].clone()
                    }
            for (var l = Object.keys(this._samplerMaps), c = 0; c < l; c++) {
                var d = l[c];
                t._samplerMaps[d] = this._samplerMaps[d].clone()
            }
            return t.cullState.enabled = this.cullState.enabled, t.cullState.cullFace = this.cullState.cullFace, t.cullState.frontFace = this.cullState.frontFace, t.blendState.blending = this.blendState.blending, t.blendState.blendEquation = this.blendState.blendEquation, t.blendState.blendSrc = this.blendState.blendSrc, t.blendState.blendDst = this.blendState.blendDst, t.depthState.enabled = this.depthState.enabled, t.depthState.write = this.depthState.write, t.offsetState.enabled = this.offsetState.enabled, t.offsetState.factor = this.offsetState.factor, t.offsetState.units = this.offsetState.units, t.dualTransparency = this.dualTransparency, t.wireframe = this.wireframe, t.flat = this.flat, t.renderQueue = this.renderQueue, t.fullOverride = this.fullOverride, t.errorOnce = this.errorOnce, t
        }, i.createShader = function(e, t) {
            //! AT: function has parameters in reverse order than the constructor
            var n = new a.default(t || null, e);
            return null === n.name && (n.name = "DefaultShader" + n._id), n
        }, i.prototype.makeInstanced = function(e) {
            return void 0 == d.default.Webgl2 ? void console.error("Material.makeInstanced() called before initializing Sumerian. Call 'V.initSumerian();' before Material.makeInstanced()") : d.default.InstancedArrays || !1 !== d.default.Webgl2 ? (this.shader = this.shader.clone(), this.shader.makeInstanced(e, this), this.bIsInstanced = !0, void(this.instanceCount = e)) : void console.error("Instanced rendering is not supported on this platform (ANGLE_instanced_arrays extension not supported [WebGL1])")
        }, i.clearShaderCache = function() {}, i.createEmptyMaterial = function(e, t) {
            var n = new i(t || "Empty Material");
            return n.empty(), n.shader = e ? i.createShader(e) : void 0, n
        },
        //! AT: how about a immutable material named EMPTY and a clone method for materials instead of this mutable madness?
        i.prototype.empty = function() {
            this.cullState = {}, this.blendState = {}, this.depthState = {}, this.offsetState = {}, this.wireframe = void 0, this.renderQueue = void 0, this.flat = void 0, this._textureMaps = {}, this._samplerMaps = {}, this.shader = void 0, this.uniforms = {}
        }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.matrix = new f.default, this.normalMatrix = new u.default, this.translation = new a.default, this.rotation = new u.default, this.scale = new a.default(1, 1, 1), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(31),
        u = r(s),
        l = n(38),
        f = r(l),
        c = n(4),
        d = r(c),
        h = new a.default,
        p = new a.default,
        m = new u.default;
    i.combine = function(e, t, n) {
        return n = n || new i, h.set(t.translation), h.applyPost(e.rotation), h.mul(e.scale), h.add(e.translation), p.set(t.scale), p.mul(e.scale), m.mul2(e.rotation, t.rotation), n.rotation.copy(m), n.scale.set(p), n.translation.set(h), n.update(), n
    }, i.prototype.combine = function(e) {
        return i.combine(this, e, this)
    }, i.prototype.multiply = function(e, t) {
        return this.matrix.mul2(e.matrix, t.matrix), m.data.set(e.rotation.data), this.rotation.data.set(t.rotation.data), this.rotation.mul2(m, this.rotation), this.translation.set(t.translation), this.translation.mul(e.scale), this.translation.applyPost(m).add(e.translation), h.set(e.scale).mul(t.scale), this.scale.set(h), this
    }, i.prototype.setIdentity = function() {
        return this.matrix.setIdentity(), this.translation.set(a.default.ZERO), this.rotation.setIdentity(), this.scale.set(a.default.ONE), this
    }, i.prototype.applyForward = function(e, t) {
        return t.set(e), t.applyPostPoint(this.matrix), t
    }, i.prototype.applyForwardVector = function(e, t) {
        return t.copy(e), t.setDirect(t.x * this.scale.x, t.y * this.scale.y, t.z * this.scale.z), t.applyPost(this.rotation), t
    }, i.prototype.update = function() {
        var e = this.matrix.data,
            t = this.rotation.data,
            n = this.scale,
            r = this.translation;
        return e[0] = n.x * t[0], e[1] = n.x * t[1], e[2] = n.x * t[2], e[3] = 0, e[4] = n.y * t[3], e[5] = n.y * t[4], e[6] = n.y * t[5], e[7] = 0, e[8] = n.z * t[6], e[9] = n.z * t[7], e[10] = n.z * t[8], e[11] = 0, e[12] = r.x, e[13] = r.y, e[14] = r.z, e[15] = 1, this
    }, i.prototype.updateNormalMatrix = function() {
        var e = this.normalMatrix.data,
            t = this.matrix.data;
        e[0] = t[0], e[1] = t[1], e[2] = t[2], e[3] = t[4], e[4] = t[5], e[5] = t[6], e[6] = t[8], e[7] = t[9], e[8] = t[10];
        var n = this.scale;
        return n.x === n.y && n.x === n.z || this.normalMatrix.invert().transpose(), this
    }, i.prototype.copy = function(e) {
        return this.matrix.copy(e.matrix), this.translation.set(e.translation), this.rotation.copy(e.rotation), this.scale.set(e.scale), this
    }, i.prototype.setRotationXYZ = function(e, t, n) {
        return this.rotation.fromAngles(e, t, n), this
    }, i.prototype.lookAt = function(e, t) {
        return t || (t = a.default.UNIT_Y), h.set(e).sub(this.translation), h.lengthSquared() > d.default.EPSILON && (h.normalize(), this.rotation.lookAt(h, t)), this
    }, i.prototype.invert = function(e) {
        var t = e;
        return t || (t = new i), t.matrix.copy(this.matrix), t.matrix.invert(), t.rotation.copy(this.rotation).transpose(), t.scale.set(a.default.ONE).div(this.scale), t.translation.copy(this.translation).negate().mul(t.scale), t.translation.applyPost(t.rotation), t
    }, i.prototype.clone = function() {
        var e = new i;
        return e.matrix.copy(this.matrix), e.normalMatrix.copy(this.normalMatrix), e.translation.copy(this.translation), e.rotation.copy(this.rotation), e.scale.copy(this.scale), e
    }, t.default = i
}, function(e, t, n) {
    var r = n(19);
    e.exports = function(e) {
        if (!r(e)) throw TypeError(e + " is not an object!");
        return e
    }
}, function(e, t, n) {
    "use strict";
    (function(e) {
        function n(e, t) {
            u.async(function() {
                e.trigger("promise:resolved", {
                    detail: t
                }), e.isResolved = !0, e.resolvedValue = t
            })
        }

        function r(e, t) {
            u.async(function() {
                e.trigger("promise:failed", {
                    detail: t
                }), e.isRejected = !0, e.rejectedValue = t
            })
        }

        function i(e) {
            var t = void 0,
                n = [],
                r = new _,
                i = e.length;
            0 === i && r.resolve([]);
            var o = function(e, t) {
                    n[e] = t, 0 === (i -= 1) && r.resolve(n)
                },
                a = function(e) {
                    r.reject(e)
                };
            for (t = 0; t < i; t += 1) e[t].then(function(e) {
                return function(t) {
                    o(e, t)
                }
            }(t), a);
            return r
        }

        function o(e, t) {
            u[e] = t
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
                return typeof e
            } : function(e) {
                return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
            },
            s = function() {
                function e(e, t) {
                    var n = [],
                        r = !0,
                        i = !1,
                        o = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                    } catch (e) {
                        i = !0, o = e
                    } finally {
                        try {
                            !r && s.return && s.return()
                        } finally {
                            if (i) throw o
                        }
                    }
                    return n
                }
                return function(t, n) {
                    if (Array.isArray(t)) return t;
                    if (Symbol.iterator in Object(t)) return e(t, n);
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }
            }(),
            u = {},
            l = "undefined" != typeof window ? window : {},
            f = l.MutationObserver || l.WebKitMutationObserver;
        if (void 0 !== e && "[object process]" === {}.toString.call(e)) u.async = function(t, n) {
            e.nextTick(function() {
                t.call(n)
            })
        };
        else if (f) {
            var c = [],
                d = new f(function() {
                    var e = c.slice();
                    c = [], e.forEach(function(e) {
                        var t = s(e, 2),
                            n = t[0],
                            r = t[1];
                        n.call(r)
                    })
                }),
                h = document.createElement("div");
            d.observe(h, {
                attributes: !0
            }), window.addEventListener("unload", function() {
                d.disconnect(), d = null
            }), u.async = function(e, t) {
                c.push([e, t]), h.setAttribute("drainQueue", "drainQueue")
            }
        } else u.async = function(e, t) {
            setTimeout(function() {
                e.call(t)
            }, 1)
        };
        var p = function(e, t) {
                this.type = e;
                for (var n in t) Object.hasOwnProperty.call(t, n) && (this[n] = t[n])
            },
            m = function(e, t) {
                for (var n = 0, r = e.length; n < r; n += 1)
                    if (e[n][0] === t) return n;
                return -1
            },
            y = function(e) {
                var t = e._promiseCallbacks;
                return t || (e._promiseCallbacks = {}, t = e._promiseCallbacks), t
            },
            v = {
                mixin: function(e) {
                    return e.on = this.on, e.off = this.off, e.trigger = this.trigger, e
                },
                on: function(e, t, n) {
                    var r = y(this),
                        i = void 0,
                        o = void 0;
                    for (e = e.split(/\s+/), n = n || this, o = e.shift(); void 0 !== o;) i = r[o], i || (r[o] = [], i = r[o]), -1 === m(i, t) && i.push([t, n]), o = e.shift()
                },
                off: function(e, t) {
                    var n = y(this),
                        r = void 0,
                        i = void 0,
                        o = void 0;
                    for (e = e.split(/\s+/), i = e.shift(); void 0 !== i;) t ? (r = n[i], -1 !== (o = m(r, t)) && r.splice(o, 1)) : n[i] = [], i = e.shift()
                },
                trigger: function(e, t) {
                    var n = y(this),
                        r = void 0,
                        i = void 0,
                        o = void 0,
                        s = void 0;
                    "object" !== (void 0 === t ? "undefined" : a(t)) && (t = {
                        detail: t
                    });
                    var u = n[e];
                    if (u)
                        for (var l = 0, f = u.length; l < f; l += 1) r = u[l], i = r[0], o = r[1], s = new p(e, t), i.call(o, s)
                }
            },
            _ = t.Promise = function(e) {
                var t = this;
                this.on("promise:resolved", function(e) {
                    this.trigger("success", {
                        detail: e.detail
                    })
                }, this), this.on("promise:failed", function(e) {
                    this.trigger("error", {
                        detail: e.detail
                    })
                }, this), e && e(function(e) {
                    return t.resolve(e)
                }, function(e) {
                    return t.reject(e)
                })
            },
            g = function() {},
            b = function(e, t, n, r) {
                var i = "function" == typeof n,
                    o = void 0,
                    a = void 0,
                    s = void 0,
                    u = void 0;
                if (i) try {
                    o = n(r.detail), s = !0
                } catch (e) {
                    u = !0, a = e
                } else o = r.detail, s = !0;
                o && "function" == typeof o.then ? o.then(function(e) {
                    t.resolve(e)
                }, function(e) {
                    t.reject(e)
                }) : i && s ? t.resolve(o) : u ? t.reject(a) : t[e](o)
            };
        _.prototype = {
            then: function(e, t) {
                var n = new _;
                return this.isResolved && u.async(function() {
                    b("resolve", n, e, {
                        detail: this.resolvedValue
                    })
                }, this), this.isRejected && u.async(function() {
                    b("reject", n, t, {
                        detail: this.rejectedValue
                    })
                }, this), this.on("promise:resolved", function(t) {
                    b("resolve", n, e, t)
                }), this.on("promise:failed", function(e) {
                    b("reject", n, t, e)
                }), n
            },
            resolve: function(e) {
                n(this, e), this.resolve = g, this.reject = g
            },
            reject: function(e) {
                r(this, e), this.resolve = g, this.reject = g
            },
            catch: function(e) {
                return this.then(function(e) {
                    return e
                }, e)
            },
            finally: function(e) {
                return this.then(function(t) {
                    return new _(function(t) {
                        return t(e())
                    }).then(function() {
                        return t
                    })
                }, function(t) {
                    return new _(function(t) {
                        return t(e())
                    }).then(function() {
                        throw t
                    })
                })
            }
        }, _.resolve = function(e) {
            return new _(function(t, n) {
                return t(e)
            })
        }, _.reject = function(e) {
            return new _(function(t, n) {
                return n(e)
            })
        }, _.all = i, v.mixin(_.prototype), t.default = {
            Promise: _,
            Event: p,
            EventTarget: v,
            all: i,
            configure: o
        }
    }).call(t, n(262))
}, function(e, t) {
    var n = e.exports = "undefined" != typeof window && window.Math == Math ? window : "undefined" != typeof self && self.Math == Math ? self : Function("return this")();
    "number" == typeof __g && (__g = n)
}, function(e, t) {
    e.exports = function(e) {
        try {
            return !!e()
        } catch (e) {
            return !0
        }
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(29),
        u = r(s),
        l = n(58),
        f = r(l),
        c = n(67),
        d = r(c);
    i.uber = {
        name: "ShaderLib.uber",
        glslversion: 300,
        processors: [d.default.uber.processor, d.default.light.processor, d.default.animation.processor],
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexNormal: a.default.NORMAL,
            vertexTangent: a.default.TANGENT,
            vertexColor: a.default.COLOR,
            vertexUV0: a.default.TEXCOORD0,
            vertexUV1: a.default.TEXCOORD1,
            vertexJointIDs: a.default.JOINTIDS,
            vertexWeights: a.default.WEIGHTS
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            normalMatrix: u.default.NORMAL_MATRIX,
            cameraPosition: u.default.CAMERA,
            diffuseMap: u.default.DIFFUSE_MAP,
            offsetRepeat: [0, 0, 1, 1],
            normalMap: u.default.NORMAL_MAP,
            normalMultiplier: 1,
            specularMap: u.default.SPECULAR_MAP,
            emissiveMap: u.default.EMISSIVE_MAP,
            aoMap: u.default.AO_MAP,
            lightMap: u.default.LIGHT_MAP,
            environmentCube: "ENVIRONMENT_CUBE",
            environmentSphere: "ENVIRONMENT_SPHERE",
            reflectionMap: "REFLECTION_MAP",
            transparencyMap: "TRANSPARENCY_MAP",
            opacity: 1,
            reflectivity: 0,
            refractivity: 0,
            etaRatio: -.5,
            fresnel: 0,
            discardThreshold: -.01,
            fogSettings: [0, 1e4],
            fogColor: [1, 1, 1],
            vertexColorAmount: 1,
            lodBias: 0,
            wrapSettings: [.5, 0]
        },
        builder: function(e, t) {
            d.default.light.builder(e, t)
        },
        vshader: function() {
            return "\n    \n    // BACKWARDS COMPAT\n    //---------------------------------------------\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    \n    // ATTRIBUTES\n    //---------------------------------------------\n    in vec3 vertexPosition;\n\n    #ifdef NORMAL\n      in vec3 vertexNormal;\n    #endif\n    #ifdef TANGENT\n      in vec4 vertexTangent;\n    #endif\n    #ifdef COLOR\n      in vec4 vertexColor;\n    #endif\n    #ifdef TEXCOORD0\n      in vec2 vertexUV0;\n      out vec2 texCoord0;\n    #endif\n    #ifdef TEXCOORD1\n      in vec2 vertexUV1;\n      out vec2 texCoord1;\n    #endif\n    \n    out vec3 vWorldPos;\n    out vec3 viewPosition;\n\n    // UNIFORMS\n    //---------------------------------------------\n    #ifdef WEBGL_1\n      #ifdef TEXCOORD0\n        uniform vec4 offsetRepeat;\n      #endif\n\n      uniform mat4 viewProjectionMatrix;\n      uniform vec3 cameraPosition;\n      \n      #ifdef INSTANCED_DRAW\n        attribute mat4 normalMatrix;\n        attribute mat4 worldMatrix;\n      #else\n        uniform mat4 worldMatrix;\n        uniform mat3 normalMatrix;\n      #endif\n    #else // WEBGL_2\n      uniform uniformBlockVS \n      {\n        #ifdef TEXCOORD0\n          vec4 offsetRepeat;\n        #endif\n\n        mat4 viewProjectionMatrix;\n        vec3 cameraPosition;\n\n        #ifdef INSTANCED_DRAW\n          mat4 worldMatrix[INSTANCE_COUNT];\n          mat3 normalMatrix[INSTANCE_COUNT];\n        #else\n          mat4 worldMatrix;\n          mat3 normalMatrix;\n        #endif\n      };\n    #endif\n\n    #ifdef NORMAL\n      out vec3 normal;\n    #endif\n    #ifdef TANGENT\n      out vec3 binormal;\n      out vec3 tangent;\n    #endif\n    #ifdef COLOR\n      out vec4 color;\n    #endif\n\n    // PRE-VERTEX FOR OTHER SYSTEMS\n    //---------------------------------------------\n    " + d.default.light.prevertex + "\n\n    " + d.default.animation.prevertex + "\n\n    #ifdef WEBGL_1  \n      // undefine in and out (varying/attrib) so that the functions\n      // that take parameter with 'in' qualifier won't get affected.\n      // the defines are aimed to alter in/out of vertex attributes, not function argument qualifiers.\n      #undef in\n      #undef out\n    #endif\n\n    // MAIN\n    //-------------------------------------\n    void main() {\n\n      #ifdef INSTANCED_DRAW\n        #ifdef WEBGL_1\n          mat4 wMatrix = worldMatrix;\n        #else\n          mat4 wMatrix = worldMatrix[gl_InstanceID];\n        #endif\n\n        #ifdef NORMAL\n          #ifdef WEBGL_1\n            mat3 nMatrix = mat3(normalMatrix);\n          #else\n            mat3 nMatrix = normalMatrix[gl_InstanceID];\n          #endif\n        #endif\n\n      #else // NON-INSTANCED_DRAW\n        mat4 wMatrix = worldMatrix;\n        #ifdef NORMAL\n          mat3 nMatrix = normalMatrix;\n        #endif\n      #endif\n\n      " + d.default.animation.vertex + "\n      vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);\n      vWorldPos = worldPos.xyz;\n      gl_Position = viewProjectionMatrix * worldPos;\n\n      viewPosition = cameraPosition - worldPos.xyz;\n\n      #ifdef NORMAL\n        normal = normalize(nMatrix * vertexNormal);\n      #endif\n      #ifdef TANGENT\n        tangent = normalize(nMatrix * vertexTangent.xyz);\n        binormal = cross(normal, tangent) * vec3(vertexTangent.w);\n      #endif\n      #ifdef COLOR\n        color = vertexColor;\n      #endif\n      #ifdef TEXCOORD0\n        texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;\n      #endif\n      #ifdef TEXCOORD1\n        texCoord1 = vertexUV1;\n      #endif\n\n      " + d.default.light.vertex + "\n    }"
        },
        fshader: function() {
            return "\n    \n    // BACKWARDS COMPAT FS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n\n    // SAMPLERS/TEXTURES\n    //---------------------------------------------\n    #ifdef DIFFUSE_MAP\n      uniform sampler2D diffuseMap;\n    #endif\n    #ifdef NORMAL_MAP\n      uniform sampler2D normalMap;\n    #endif\n    #ifdef SPECULAR_MAP\n      uniform sampler2D specularMap;\n    #endif\n    #ifdef EMISSIVE_MAP\n      uniform sampler2D emissiveMap;\n    #endif\n    #ifdef AO_MAP\n      uniform sampler2D aoMap;\n    #endif\n    #ifdef LIGHT_MAP\n      uniform sampler2D lightMap;\n    #endif\n    #ifdef TRANSPARENCY_MAP\n      uniform sampler2D transparencyMap;\n    #endif\n    #ifdef REFLECTIVE\n      #ifdef ENVIRONMENT_CUBE\n        uniform samplerCube environmentCube;\n      #elif defined(ENVIRONMENT_SPHERE)\n        uniform sampler2D environmentSphere;\n      #endif\n      #ifdef REFLECTION_MAP\n        uniform sampler2D reflectionMap;\n      #endif\n    #endif\n    \n    // UNIFORMS\n    //---------------------------------------------\n    #ifdef WEBGL_1\n    \n      uniform float lodBias;      \n      #ifdef NORMAL_MAP\n        uniform float normalMultiplier;\n      #endif\n      \n      #ifdef REFLECTIVE\n        uniform vec4 clearColor;\n        uniform float reflectivity;\n        uniform float fresnel;\n        uniform float refractivity;\n        uniform float etaRatio;\n      #endif\n\n      #ifdef OPACITY\n        uniform float opacity;\n      #endif\n      #ifdef DISCARD\n        uniform float discardThreshold;\n      #endif\n\n      #ifdef FOG\n        uniform vec2 fogSettings;\n        uniform vec3 fogColor;\n      #endif\n\n      #ifdef COLOR\n        uniform float vertexColorAmount;\n      #endif\n\n    #else // WEBGL_2\n\n    uniform uniformBlockFS {\n      float lodBias;      \n      #ifdef NORMAL_MAP\n        float normalMultiplier;\n      #endif\n      \n      #ifdef REFLECTIVE\n        vec4 clearColor;\n        float reflectivity;\n        float fresnel;\n        float refractivity;\n        float etaRatio;\n      #endif\n\n      #ifdef OPACITY\n        float opacity;\n      #endif\n      #ifdef DISCARD\n        float discardThreshold;\n      #endif\n\n      #ifdef FOG\n        vec2 fogSettings;\n        vec3 fogColor;\n      #endif\n\n      #ifdef COLOR\n        float vertexColorAmount;\n      #endif\n    };\n    #endif\n\n    // SHADER INPUT / ATTRIBUTES\n    //---------------------------------------------\n    in vec3 vWorldPos;\n    in vec3 viewPosition;\n    #ifdef NORMAL\n      in vec3 normal;\n    #endif\n    #ifdef TANGENT\n      in vec3 binormal;\n      in vec3 tangent;\n    #endif\n    #ifdef COLOR\n      in vec4 color;\n    #endif\n    #ifdef TEXCOORD0\n      in vec2 texCoord0;\n    #endif\n    #ifdef TEXCOORD1\n      in vec2 texCoord1;\n    #endif\n\n    \n    // BACKWARDS COMPAT FS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #undef in\n      #define fragColor gl_FragColor\n      #define texture texture2D\n    #else\n      out vec4 fragColor;\n    #endif\n    \n    \n    // SHADER BUILDERS & HELPER FUNCTIONS & DEFINES\n    //-------------------------------------\n    " + d.default.light.prefragment + "\n\n    #define M_PI 3.14159265358979323846264338328\n    #define EPSILON 0.00001\n\n    float atanSafe(in float y, in float x)\n      { return abs(x) < EPSILON ? sign(y) * M_PI / 2.0 : atan(y, x);\n    }\n\n    #ifdef WEBGL_1\n      // cubemap sampling taken care of in the shader code. rest of the samplers\n      // seem to be texture2D so here we define it for backwards compat\n      #define texture texture2D\n    #endif\n\n    // MAIN\n    //-------------------------------------\n    void main(void)\n    {\n      vec4 final_color = vec4(1.0);\n\n      #if defined(DIFFUSE_MAP) && defined(TEXCOORD0)\n        final_color *= texture(diffuseMap, texCoord0, lodBias);\n      #endif\n\n      #ifdef COLOR\n        final_color *= mix(vec4(1.0), color, vertexColorAmount);\n      #endif\n\n      #if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)\n        #ifdef TRANSPARENCY_BW\n          final_color.a = texture(transparencyMap, texCoord0).r;\n        #else\n          final_color.a = texture(transparencyMap, texCoord0).a;\n        #endif\n      #endif\n      #ifdef OPACITY\n        final_color.a *= opacity;\n      #endif\n\n      #ifdef DISCARD\n        if (final_color.a < discardThreshold) discard;\n      #endif\n\n      #ifdef AO_MAP\n        #ifdef TEXCOORD1\n          final_color.rgb *= texture(aoMap, texCoord1).rgb;\n        #elif defined(TEXCOORD0)\n          final_color.rgb *= texture(aoMap, texCoord0).rgb;\n        #endif\n      #endif\n\n      #ifdef LIGHT_MAP\n        #ifdef TEXCOORD1\n          final_color.rgb *= texture(lightMap, texCoord1).rgb * 2.0;\n        #elif defined(TEXCOORD0)\n          final_color.rgb *= texture(lightMap, texCoord0).rgb * 2.0;\n        #endif\n      #else\n        vec3 N = vec3(0.0, 1.0, 0.0);\n        #if defined(NORMAL) // Do nasty doublework for IE compliance\n          N = normalize(normal);\n        #endif\n        #if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)\n          mat3 tangentToWorld = mat3(tangent, binormal, normal);\n          vec3 tangentNormal = texture(normalMap, texCoord0, lodBias).xyz * vec3(2.0) - vec3(1.0);\n          tangentNormal = mix(vec3(0.0, 0.0, 1.0), tangentNormal, normalMultiplier);\n          vec3 worldNormal = (tangentToWorld * tangentNormal);\n          N = normalize(worldNormal);\n        #endif\n\n        N = N * (-1.0 + 2.0 * float(gl_FrontFacing));\n\n        " + d.default.light.fragment + "\n      #endif\n\n      #ifdef REFLECTIVE\n        if (refractivity > 0.0) {\n          vec4 environment = vec4(0.0);\n          #ifdef ENVIRONMENT_CUBE\n            vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);\n            refractionVector.x = -refractionVector.x;\n            #ifdef WEBGL_1\n              environment = textureCube(environmentCube, refractionVector);\n            #else\n              environment = texture(environmentCube, refractionVector);\n            #endif\n          #elif defined(ENVIRONMENT_SPHERE)\n            vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);\n            refractionVector = -refractionVector;\n            float xx = (atanSafe(refractionVector.z, refractionVector.x) + M_PI) / (2.0 * M_PI);\n            float yy = refractionVector.y * 0.5 + 0.5;\n            environment = texture(environmentSphere, vec2(xx, yy));\n          #endif\n          environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);\n\n          final_color.rgb = mix(final_color.rgb, environment.rgb, refractivity);\n        }\n\n        if (reflectivity > 0.0) {\n          vec4 environment = vec4(0.0);\n          #ifdef ENVIRONMENT_CUBE\n            vec3 reflectionVector = reflect(normalize(viewPosition), N);\n            reflectionVector.yz = -reflectionVector.yz;\n            #ifdef WEBGL_1\n              environment = textureCube(environmentCube, refractionVector);\n            #else\n              environment = texture(environmentCube, refractionVector);\n            #endif\n          #elif defined(ENVIRONMENT_SPHERE)\n            vec3 reflectionVector = reflect(normalize(viewPosition), N);\n            float xx = (atanSafe(reflectionVector.z, -reflectionVector.x) + M_PI) / (2.0 * M_PI);\n            float yy = asin(-reflectionVector.y) / M_PI + 0.5;\n            environment = texture(environmentSphere, vec2(xx, yy));\n          #endif\n          environment.rgb = mix(clearColor.rgb, environment.rgb, environment.a);\n\n          float reflectionAmount = reflectivity;\n          #if defined(REFLECTION_MAP) && defined(TEXCOORD0)\n            reflectionAmount *= texture(reflectionMap, texCoord0).r;\n          #endif\n\n          float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);\n          reflectionAmount *= fresnelVal;\n\n          #if REFLECTION_TYPE == 0\n            final_color.rgb = mix(final_color.rgb, environment.rgb, reflectionAmount);\n          #elif REFLECTION_TYPE == 1\n            final_color.rgb += environment.rgb * reflectionAmount;\n          #elif REFLECTION_TYPE == 2\n            final_color.rgb *= environment.rgb * reflectionAmount;\n          #endif\n          final_color.a = min(final_color.a + reflectionAmount, 1.0);\n        }\n      #endif\n\n      #ifndef LIGHT_MAP\n        final_color.rgb += totalSpecular;\n        final_color.a = min(final_color.a + length(totalSpecular) / 3.0, 1.0);\n      #endif\n\n      #ifdef FOG\n        float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);\n        final_color.rgb = mix(final_color.rgb, fogColor, d);\n      #endif\n\n      fragColor = final_color;\n    }"
        }
    }, i.screenCopy = {
        name: "ShaderLib.screenCopy",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n  in vec3 vertexPosition;\n  in vec2 vertexUV0;\n\n  out vec2 texCoord0;\n\n  void main(void) {\n    texCoord0 = vertexUV0;\n    gl_Position = vec4(vertexPosition, 1.0);\n  }",
        fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n    #define texture texture2D\n  #endif\n\n  uniform sampler2D diffuseMap;\n  \n  in vec2 texCoord0;\n\n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n    out vec4 fragColor;\n  #endif\n\n  void main(void)\n  {\n    fragColor = texture(diffuseMap, texCoord0);\n  }"
    }, i.copy = {
        name: "ShaderLib.copy",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            opacity: 1,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n  in vec3 vertexPosition;\n  in vec2 vertexUV0;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n  uniform uniformBlockVS {\n    mat4 viewProjectionMatrix;\n    mat4 worldMatrix;\n  };\n  #endif\n\n  out vec2 texCoord0;\n\n  void main(void) {\n    texCoord0 = vertexUV0;\n    gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n  }",
        fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n    #define texture texture2D\n  #endif\n\n  uniform sampler2D diffuseMap;\n  uniform float opacity;\n\n  in vec2 texCoord0;\n  \n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n    out vec4 fragColor;\n  #endif\n\n  void main(void)\n  {\n    fragColor = vec4(texture(diffuseMap, texCoord0).rgb, opacity);\n  }"
    }, i.copyPure = {
        name: "ShaderLib.copyPure",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            opacity: 1,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n  in vec3 vertexPosition;\n  in vec2 vertexUV0;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n  uniform uniformBlockVS {\n    mat4 viewProjectionMatrix;\n    mat4 worldMatrix;\n  };\n  #endif\n\n  out vec2 texCoord0;\n\n  void main(void) {\n    texCoord0 = vertexUV0;\n    gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n  }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n    #endif\n\n  uniform sampler2D diffuseMap;\n  uniform float opacity;\n\n  in vec2 texCoord0;\n  \n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n    out vec4 fragColor;\n  #endif\n  \n  void main(void)\n  {\n    vec4 col = texture(diffuseMap, texCoord0);\n    fragColor = vec4(col.rgb, col.a * opacity);\n  }"
    }, i.simple = {
        name: "ShaderLib.simple",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX
        },
        vshader: "\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n  in vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n    };\n  #endif\n\n  void main(void) {\n    gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n  }",
        fshader: "\n\n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n    out vec4 fragColor;\n  #endif\n\n  void main(void)\n  {\n    fragColor = vec4(1.0);\n  }"
    }, i.simpleColored = {
        name: "ShaderLib.simpleColored",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            color: [1, 1, 1],
            opacity: 1
        },
        vshader: "\n  // BACKWARDS COMPAT VS\n  //-------------------------------------\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n\tin vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    #ifdef INSTANCED_DRAW\n      attribute mat4 worldMatrix;\n    #else\n      uniform mat4 worldMatrix;\n    #endif\n  #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        mat4 worldMatrix[INSTANCE_COUNT];\n      #else\n        mat4 worldMatrix;\n      #endif\n    };\n  #endif\n\n  #ifdef WEBGL_1\n    #undef in\n    #undef out\n  #endif\n\n\tvoid main(void) {\n    #ifdef INSTANCED_DRAW\n      #ifdef WEBGL_1\n        mat4 wMatrix = worldMatrix;\n      #else\n        mat4 wMatrix = worldMatrix[gl_InstanceID];\n      #endif\n    #else\n      mat4 wMatrix = worldMatrix;\n    #endif\n\n\t\tgl_Position = viewProjectionMatrix * (wMatrix * vec4(vertexPosition, 1.0));\n\t}",
        fshader: "\n  // BACKWARDS COMPAT FS\n  //-------------------------------------\n  #ifdef WEBGL_1\n    #define in varying\n  #endif\n\n  #ifdef WEBGL_1\n    uniform vec3 color;\n    uniform float opacity;\n  #else\n  uniform uniformBlockFS {\n    vec3 color;\n    float opacity;\n  };\n  #endif\n\n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n\t  out vec4 fragColor;\n  #endif\n\n\tvoid main(void)\n\t{\n\t\tif (opacity == 0.0) {\n\t\t\tdiscard;\n    }\n\t\tfragColor = vec4(color, opacity);\n\t}"
    }, i.simpleColoredMRT = {
        name: "ShaderLib.simpleColoredMRT",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            color: [1, 1, 1],
            opacity: 1,
            intensity: 1
        },
        vshader: "\n  // BACKWARDS COMPAT VS\n  //-------------------------------------\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n\tin vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    #ifdef INSTANCED_DRAW\n      attribute mat4 worldMatrix;\n    #else\n      uniform mat4 worldMatrix;\n    #endif\n  #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        mat4 worldMatrix[INSTANCE_COUNT];\n      #else\n        mat4 worldMatrix;\n      #endif\n    };\n  #endif\n\n  #ifdef WEBGL_1\n    #undef in\n    #undef out\n  #endif\n\n\tvoid main(void) {\n    #ifdef INSTANCED_DRAW\n      #ifdef WEBGL_1\n        mat4 wMatrix = worldMatrix;\n      #else\n        mat4 wMatrix = worldMatrix[gl_InstanceID];\n      #endif\n    #else\n      mat4 wMatrix = worldMatrix;\n    #endif\n\n\t\tgl_Position = viewProjectionMatrix * (wMatrix * vec4(vertexPosition, 1.0));\n\t}",
        fshader: "\n  // BACKWARDS COMPAT FS\n  //-------------------------------------\n  #ifdef WEBGL_1\n    #define in varying\n  #endif\n\n  #ifdef WEBGL_1\n    uniform vec3 color;\n    uniform float opacity;\n    uniform float intensity;\n  #else\n  uniform uniformBlockFS {\n    vec3 color;\n    float opacity;\n    float intensity;\n  };\n  #endif\n\n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n\t  out vec4 fragColor;\n  #endif\n\n\tvoid main(void)\n\t{\n\t\tif (opacity == 0.0) {\n\t\t\tdiscard;\n    }\n\t\tfragColor = vec4(intensity * color, opacity);\n\t}"
    }, i.simpleColoredMRT = {
        glslversion: 300,
        gl1Extensions: {
            drawBuffers: "GL_EXT_draw_buffers"
        },
        attributes: {
            vertexPosition: a.default.POSITION
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            color: [1, 1, 1],
            opacity: 1
        },
        vshader: "\n#ifdef WEBGL_1\n  #define in attribute\n  #define out varying\n#endif\n\n\tin vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n    uniform uniformBlockVS {\n\t    mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n    };\n  #endif\n\n\tvoid main(void) {\n\t\tgl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n\t}",
        fshader: "\n  #ifdef WEBGL_1\n    uniform vec3 color;\n    uniform float opacity;\n  #else\n  uniform uniformBlockFS {\n\t  vec3 color;\n    float opacity;\n  };\n  #endif\n\n  #ifdef WEBGL_1\n    #define outColorFirst  gl_FragData[0]\n    #ifdef GL_EXT_draw_buffers\n      #define outColorSecond  gl_FragData[1]\n      #define outColorThird   gl_FragData[2]\n      #define outColorFourth  gl_FragData[3]\n    #else\n      #define outColorSecond  gl_FragData[0]\n      #define outColorThird   gl_FragData[0]\n      #define outColorFourth  gl_FragData[0]\n    #endif\n  #else\n\t  layout(location = 0) out vec4 outColorFirst;\n\t  layout(location = 1) out vec4 outColorSecond;\n    layout(location = 2) out vec4 outColorThird;\n    layout(location = 3) out vec4 outColorFourth;\n  #endif\n\n\tvoid main(void)\n\t{\n\t\t//if (opacity == 0.0) {\n\t\t//\tdiscard;\n\t\t//}\n\t\toutColorSecond = vec4(color.x, 0 ,0, 1.0) ;\n\t\toutColorThird = vec4(0, color.y, 0, 1.0) ;\n    outColorFourth  = vec4(0,0,color.z, 1.0) ;\n    outColorFirst  = vec4(color, 1.0) ;\n\t}"
    }, i.simpleColoredMRTDepth = {
        name: "ShaderLib.simpleColoredMRTDepth",
        glslversion: 300,
        gl1Extensions: {
            drawBuffers: "GL_EXT_draw_buffers"
        },
        attributes: {
            vertexPosition: a.default.POSITION
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            color: [1, 1, 1],
            opacity: 1
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n\tin vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n  uniform uniformBlockVS {\n\t  mat4 viewProjectionMatrix;\n    mat4 worldMatrix;\n  };\n  #endif\n\n\tvoid main(void) {\n\t\tgl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n\t}",
        fshader: "\n  #ifdef WEBGL_1\n    uniform vec3 color;\n    uniform float opacity;\n  #else\n  uniform uniformBlockFS {\n\t  vec3 color;\n    float opacity;\n  };\n  #endif\n\n  #ifdef WEBGL_1\n  #define fragColorFirst  gl_FragData[0]\n    #ifdef GL_EXT_draw_buffers\n      #define fragColorSecond gl_FragData[1]\n    #else\n      #define fragColorSecond gl_FragData[0]\n    #endif\n  #else\n\t  layout(location = 0) out vec4 fragColorFirst;\n    layout(location = 1) out vec4 fragColorSecond;\n  #endif\n\n\tvoid main(void)\n\t{\n\t\tif (opacity == 0.0) {\n\t\t\tdiscard;\n\t\t}\n\t\tfragColorFirst = vec4(0,color.y,0, 1.0) ;\n\t\tfragColorSecond  = vec4(0,0,color.z, 1.0) ;\n\t}"
    }, i.simpleLit = {
        name: "ShaderLib.simpleLit",
        glslversion: 300,
        processors: [d.default.light.processor],
        defines: {
            NORMAL: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexNormal: a.default.NORMAL
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            cameraPosition: u.default.CAMERA,
            opacity: 1
        },
        builder: function(e, t) {
            d.default.light.builder(e, t)
        },
        vshader: function() {
            return "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec3 vertexNormal;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        attribute mat4 worldMatrix;\n      #else\n        uniform mat4 worldMatrix;\n      #endif\n      uniform vec3 cameraPosition;\n    \n    #else // WEBGL2 UNIFORMS\n      uniform uniformBlockVS {\n        mat4 viewProjectionMatrix;\n        #ifdef INSTANCED_DRAW\n          mat4 worldMatrix[INSTANCE_COUNT];\n        #else\n          mat4 worldMatrix;\n        #endif\n        vec3 cameraPosition;\n      };\n    #endif\n\n    " + d.default.light.prevertex + "\n\n    out vec3 normal;\n    out vec3 vWorldPos;\n    out vec3 viewPosition;\n\n    #ifdef WEBGL_1\n      #undef in\n      #undef out\n    #endif\n    \n    void main(void) {\n\n      #ifdef INSTANCED_DRAW\n        #ifdef WEBGL_1\n          mat4 wMatrix = worldMatrix;\n        #else\n          mat4 wMatrix = worldMatrix[gl_InstanceID];\n        #endif\n      #else\n        mat4 wMatrix = worldMatrix;\n      #endif\n\n      vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);\n      vWorldPos = worldPos.xyz;\n      gl_Position = viewProjectionMatrix * worldPos;\n\n      " + d.default.light.vertex + "\n\n      normal = (wMatrix * vec4(vertexNormal, 0.0)).xyz;\n      viewPosition = cameraPosition - worldPos.xyz;\n    }"
        },
        fshader: function() {
            return "\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n    #endif\n\n    #ifdef SPECULAR_MAP\n      #ifdef TEXCOORD0\n        in vec2 texCoord0;\n      #endif\n    #endif\n    #ifdef SPECULAR_MAP\n      uniform sampler2D specularMap;\n    #endif\n    \n    uniform float opacity;\n    \n    #ifdef NORMAL\n      in vec3 normal;\n    #endif\n\n    in vec3 vWorldPos;\n    in vec3 viewPosition;\n\n    \n    #ifdef WEBGL_1\n      #undef in\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    " + d.default.light.prefragment + "\n    \n    void main(void)\n    {\n      if (opacity == 0.0) {\n        discard;\n      }\n    #ifdef NORMAL\n      vec3 N = normalize(normal);\n    #else\n      vec3 N = vec3(0,0,1);\n    #endif\n      vec4 final_color = vec4(1.0);\n\n      " + d.default.light.fragment + "\n\n      final_color.a = opacity;\n      fragColor = final_color;\n    }"
        }
    }, i.textured = {
        name: "ShaderLib.textured",
        glslversion: 300,
        defines: {
            TEXCOORD0: !0,
            DIFFUSE_MAP: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec2 vertexUV0;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      uniform mat4 worldMatrix;\n    #else\n    uniform uniformBlockVS\n    {\n      mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n    };\n    #endif\n\n    out vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n      gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n    #endif\n\n    #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\n      uniform sampler2D diffuseMap;\n      in vec2 texCoord0;\n    #endif\n\n    #ifdef WEBGL_1\n      #undef in\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main(void)\n    {\n    #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\n      fragColor = texture(diffuseMap, texCoord0);\n    #else\n      fragColor = vec4(1.0);\n    #endif\n    }"
    }, i.texturedFloatTest = {
        name: "ShaderLib.texturedFloatTest",
        glslversion: 300,
        defines: {
            TEXCOORD0: !0,
            DIFFUSE_MAP: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n\tin vec3 vertexPosition;\n\tin vec2 vertexUV0;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n  uniform uniformBlockVS {\n\t  mat4 viewProjectionMatrix;\n    mat4 worldMatrix;\n  };\n  #endif\n\n\tout vec2 texCoord0;\n\n\tvoid main(void) {\n\t\ttexCoord0 = vertexUV0;\n\t\tgl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n\t}",
        fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n    #define texture texture2D\n  #endif\n\n  #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\n    uniform sampler2D diffuseMap;  \n\t  in vec2 texCoord0;\n  #endif\n  \n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n  #else\n    out vec4 fragColor;\n  #endif\n\n\tvoid main(void)\n\t{\n\t#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)\n    fragColor = texture(diffuseMap, texCoord0);\n\t\tif(fragColor.x > 1.8) fragColor = vec4(1,0,0,1);\n\t\telse if(fragColor.y > 1.8) fragColor = vec4(0,1,0,1);\n\t\telse if(fragColor.z > 1.8) fragColor = vec4(0,0,1,1);\n\t\telse fragColor = vec4(0.0);\n\t#else\n    fragColor = vec4(1.0);\n\t#endif\n\t}"
    }, i.texturedLit = {
        name: "ShaderLib.texturedLit",
        glslversion: 300,
        processors: [d.default.light.processor],
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexNormal: a.default.NORMAL,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            cameraPosition: u.default.CAMERA,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        builder: function(e, t) {
            d.default.light.builder(e, t)
        },
        vshader: function() {
            return "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec3 vertexNormal;\n    in vec2 vertexUV0;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        attribute mat4 worldMatrix;\n      #else\n        uniform mat4 worldMatrix;\n      #endif\n      uniform vec3 cameraPosition;\n\n    #else   // WEBGL 2\n\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        mat4 worldMatrix[INSTANCE_COUNT];\n      #else\n        mat4 worldMatrix;\n      #endif\n      vec3 cameraPosition;\n    };\n    #endif\n\n    " + d.default.light.prevertex + "\n\n    out vec3 normal;\n    out vec3 vWorldPos;\n    out vec3 viewPosition;\n    out vec2 texCoord0;\n\n    void main(void) {\n\n      #ifdef INSTANCED_DRAW\n        mat4 wMatrix = worldMatrix[gl_InstanceID];\n      #else\n        mat4 wMatrix = worldMatrix;\n      #endif\n\n      vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);\n      vWorldPos = worldPos.xyz;\n      gl_Position = viewProjectionMatrix * worldPos;\n\n      " + d.default.light.vertex + "\n\n      normal = (wMatrix * vec4(vertexNormal, 0.0)).xyz;\n      texCoord0 = vertexUV0;\n      viewPosition = cameraPosition - worldPos.xyz;\n    }"
        },
        fshader: function() {
            return "\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n    \n    in vec3 normal;\n    in vec3 vWorldPos;\n    in vec3 viewPosition;\n    in vec2 texCoord0;\n\n    #ifdef WEBGL_1\n      #undef in\n      #define fragColor gl_FragColor\n      #define texture texture2D\n    #else\n      out vec4 fragColor;\n    #endif\n\n    uniform sampler2D diffuseMap;\n    \n    " + d.default.light.prefragment + "\n\n    void main(void)\n    {\n      vec3 N = normalize(normal);\n      vec4 final_color = texture(diffuseMap, texCoord0);\n\n      " + d.default.light.fragment + "\n\n      fragColor = final_color;\n    }"
        }
    }, i.convolution = {
        name: "ShaderLib.convolution",
        glslversion: 300,
        defines: {
            KERNEL_SIZE_FLOAT: "25.0",
            KERNEL_SIZE_INT: "25"
        },
        attributes: {
            position: a.default.POSITION,
            uv: a.default.TEXCOORD0
        },
        uniforms: {
            viewMatrix: u.default.VIEW_MATRIX,
            projectionMatrix: u.default.PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            tDiffuse: u.default.DIFFUSE_MAP,
            uImageIncrement: [.001953125, 0],
            cKernel: [],
            size: 1
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n  in vec3 position;\n  in vec2 uv;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform mat4 worldMatrix;\n    uniform float size;\n    uniform vec2 uImageIncrement;\n  #else\n  uniform uniformBlockFVS {\n    mat4 viewMatrix;\n    mat4 projectionMatrix;\n    mat4 worldMatrix;\n    float size;\n    vec2 uImageIncrement;\n  };\n  #endif\n\n  out vec2 vUv;\n  \n  #ifndef WEBGL_1\n    flat out float outSize;\n    flat out vec2 outImageIncrement;\n  #endif\n\n  void main() {\n    vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;\n    gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n\n    #ifndef WEBGL_1\n      // we send imageIncrement and size from vertex attributes with WEBGL_2 with the reason being\n      // uniform blocks with the same uniform names between shader stages raising issues.\n      outSize = size;\n      outImageIncrement = uImageIncrement;\n    #endif\n  }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define fragColor gl_FragColor\n      #define texture texture2D\n    #else\n      flat in float outSize;\n      flat in vec2 outImageIncrement;\n      out vec4 fragColor;\n    #endif\n\n  in vec2 vUv;\n\n\n  uniform sampler2D tDiffuse;\n\n  // uniform float arrays inside uniform blocks will be padded.\n  // each float element of the cKernel will be stored in individual\n  // vec4's and the uniform buffer block size would become 400 (25 * 4 * 4) instead of 100 (25 * 4)\n  // given the fact that KERNEL_SIZE_INT = 25. Therefore, we'll be using regular uniforms\n  // for the convolution kernel.\n  uniform float cKernel[ KERNEL_SIZE_INT ];\n  \n  #ifdef WEBGL_1\n    // we receive imageIncrement and size from vertex attributes with WEBGL_2\n    // with WebGL_1, we'll receive them as uniforms as usual\n    uniform vec2 uImageIncrement;\n    uniform float size;\n  #endif\n\n  void main() {\n    vec2 imageCoord = vUv;\n    vec4 sum = vec4( 0.0 );\n\n    #ifndef WEBGL_1\n      vec2 uImageIncrement = outImageIncrement;\n      float size = outSize;\n    #endif\n\n     for ( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n      // sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n      // imageCoord += uImageIncrement * size;\n    // }\n    // Hack for Android, who seems to crash on int looping\n    //for (float i = 0.0; i < KERNEL_SIZE_FLOAT; i++) {\n      sum += texture( tDiffuse, imageCoord ) * cKernel[int(i)];\n      imageCoord += uImageIncrement * size;\n    }\n\n    fragColor = sum;\n  }",
        buildKernel: function(e) {
            e = Math.abs(e);
            var t = void 0,
                n = void 0,
                r = 2 * Math.ceil(3 * e) + 1;
            r > 25 && (r = 25);
            var i = .5 * (r - 1),
                o = new Array(r);
            for (n = 0, t = 0; t < r; ++t) o[t] = function(e, t) {
                return Math.exp(-e * e / (2 * t * t))
            }(t - i, e), n += o[t];
            for (t = 0; t < r; ++t) o[t] /= n;
            return o
        }
    }, i.showNormals = {
        name: "ShaderLib.showNormals",
        glslversion: 300,
        defines: {
            NORMAL: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexNormal: a.default.NORMAL
        },
        uniforms: {
            viewMatrix: u.default.VIEW_MATRIX,
            projectionMatrix: u.default.PROJECTION_MATRIX,
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            opacity: 1
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n    \n    in vec3 vertexPosition;\n    in vec3 vertexNormal;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      uniform mat4 worldMatrix;\n    #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n    };\n    #endif\n\n    out vec3 normal;\n\n    void main() {\n      normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));\n      gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n\n    uniform float opacity;\n\n    #ifdef NORMAL\n      in vec3 normal;\n    #else\n      vec3 normal = vec3(0,0,1);\n    #endif\n\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main() {\n      fragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );\n    }"
    }, i.particles = {
        name: "ShaderLib.particles",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexColor: a.default.COLOR,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            diffuseMap: u.default.DIFFUSE_MAP
        },
        vshader: "\n    // BACKWARDS COMPAT VS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec4 vertexColor;\n    in vec2 vertexUV0;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      #ifdef INSTANCED_DRAW\n        attribute mat4 worldMatrix;\n      #else\n        uniform mat4 worldMatrix;\n      #endif\n    #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      \n      #ifdef INSTANCED_DRAW\n        mat4 worldMatrix[INSTANCE_COUNT];\n      #else\n        mat4 worldMatrix;\n      #endif\n    };\n    #endif\n\n    out vec2 texCoord0;\n    out vec4 color;\n\n    void main(void) {\n      #ifdef INSTANCED_DRAW\n        #ifdef WEBGL_1\n          mat4 wMatrix = worldMatrix;\n        #else\n          mat4 wMatrix = worldMatrix[gl_InstanceID];\n        #endif\n      #else\n        mat4 wMatrix = worldMatrix;\n      #endif\n\n      texCoord0 = vertexUV0;\n      color = vertexColor;\n      gl_Position = viewProjectionMatrix * (wMatrix * vec4(vertexPosition, 1.0));\n    }",
        fshader: "\n    // BACKWARDS COMPAT FS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n    #endif\n\n    uniform sampler2D diffuseMap;\n    \n    in vec2 texCoord0;\n    in vec4 color;\n\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main(void)\n    {\n      vec4 texCol = texture(diffuseMap, texCoord0);\n      if (color.a == 0.0 || texCol.a == 0.0) discard;\n      else fragColor = texCol * color;\n    }"
    }, i.normalmap = {
        name: "ShaderLib.normalmap",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            heightMap: u.default.DIFFUSE_MAP,
            resolution: [512, 512],
            height: .05
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec2 vertexUV0;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      uniform mat4 worldMatrix;\n    #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n    };\n    #endif\n\n    out vec2 vUv;\n    void main() {\n      vUv = vertexUV0;\n      gl_Position = viewProjectionMatrix * (worldMatrix * vec4( vertexPosition, 1.0 ));\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define fragColor gl_FragColor\n      #define texture texture2D\n    #else\n      out vec4 fragColor;\n    #endif\n    \n    in vec2 vUv; \n\n    uniform sampler2D heightMap;\n\n    #ifdef WEBGL_1\n      uniform float height;\n      uniform vec2 resolution;\n    #else\n    uniform uniformBlockFS {\n      float height;\n      vec2 resolution;\n    };\n    #endif\n\n    void main() {\n      float val = texture( heightMap, vUv ).x;\n      float valU = texture( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;\n      float valV = texture( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;\n\n      fragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );\n    }"
    }, i.point = {
        name: "ShaderLib.point",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexColor: a.default.COLOR
        },
        uniforms: {
            viewProjectionMatrix: u.default.VIEW_PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            pointSize: 2
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec4 vertexColor;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewProjectionMatrix;\n      uniform mat4 worldMatrix;\n      uniform float pointSize;\n    #else\n    uniform uniformBlockVS {\n      mat4 viewProjectionMatrix;\n      mat4 worldMatrix;\n      float pointSize;\n    };\n    #endif\n\n    out vec4 color;\n\n    void main(void) {\n      color = vertexColor;\n      gl_Position = viewProjectionMatrix * (worldMatrix * vec4(vertexPosition, 1.0));\n      gl_PointSize = pointSize;\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n\n    in vec4 color;\n\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main(void)\n    {\n      fragColor = color;\n    }"
    }, i.downsample = {
        name: "ShaderLib.downsample",
        glslversion: 300,
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            viewMatrix: u.default.VIEW_MATRIX,
            projectionMatrix: u.default.PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            tDiffuse: u.default.DIFFUSE_MAP
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec2 vertexUV0;\n\n    #ifdef WEBGL_1\n      uniform mat4 viewMatrix;\n      uniform mat4 projectionMatrix;\n      uniform mat4 worldMatrix;\n    #else\n    uniform uniformBlockVS {\n      mat4 viewMatrix;\n      mat4 projectionMatrix;\n      mat4 worldMatrix;\n    };\n    #endif\n\n    out vec2 vUv;\n    void main() {\n      vUv = vertexUV0;\n      gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n    #endif\n\n    uniform sampler2D tDiffuse;\n    \n    in vec2 vUv;\n\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main() {\n      fragColor = texture( tDiffuse, vUv );\n    }"
    }, i.lightDepth = {
        name: "ShaderLib.lightDepth",
        glslversion: 300,
        processors: [d.default.animation.processor],
        defines: {
            SHADOW_TYPE: 0,
            WEIGHTS: !0,
            JOINTIDS: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexJointIDs: a.default.JOINTIDS,
            vertexWeights: a.default.WEIGHTS
        },
        uniforms: {
            viewMatrix: u.default.VIEW_MATRIX,
            projectionMatrix: u.default.PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            cameraScale: u.default.MAIN_DEPTH_SCALE
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n  in vec3 vertexPosition;\n\n  #ifdef WEBGL_1\n    uniform mat4 viewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform mat4 worldMatrix;\n  #else\n  uniform uniformBlockVS {\n    mat4 viewMatrix;\n    mat4 projectionMatrix;\n    mat4 worldMatrix;\n  };\n  #endif\n\n  out vec4 worldPosition;\n  " + d.default.animation.prevertex + "\n\n  #ifdef WEBGL_1\n    #undef in\n    #undef out\n  #endif\n\n  void main(void) {\n    mat4 wMatrix = worldMatrix;\n    " + d.default.animation.vertex + "\n    worldPosition = viewMatrix * (wMatrix * vec4(vertexPosition, 1.0));\n    gl_Position = projectionMatrix * worldPosition;\n  }",
        fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n  #endif\n\n  #if SHADOW_TYPE == 2\n    uniform float cameraScale;\n  #endif\n\n  in vec4 worldPosition;\n  \n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n      #undef in\n    #else\n      out vec4 fragColor;\n    #endif\n\n  " + f.default.methods.packDepth + "\n\n  void main(void)\n  {\n    #if SHADOW_TYPE == 0\n      fragColor = packDepth(gl_FragCoord.z);\n    #elif SHADOW_TYPE == 1\n      fragColor = packDepth(gl_FragCoord.z);\n    #elif SHADOW_TYPE == 2\n      float linearDepth = length(worldPosition) * cameraScale;\n      fragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);\n    #endif\n  }"
    }, i.pickingShader = {
        name: "ShaderLib.pickingShader",
        glslversion: 300,
        defines: {
            WEIGHTS: !0,
            JOINTIDS: !0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexJointIDs: a.default.JOINTIDS,
            vertexWeights: a.default.WEIGHTS,
            vertexNormal: a.default.NORMAL
        },
        uniforms: {
            normalMatrix: u.default.NORMAL_MATRIX,
            viewMatrix: u.default.VIEW_MATRIX,
            projectionMatrix: u.default.PROJECTION_MATRIX,
            worldMatrix: u.default.WORLD_MATRIX,
            cameraFar: u.default.FAR_PLANE,
            thickness: 0,
            id: function(e) {
                return null != e.renderable._index ? e.renderable._index + 1 : e.renderable.id + 1
            }
        },
        processors: [d.default.animation.processor, function(e) {
            e.setDefine("NORMAL", !0)
        }],
        vshader: "\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n  in vec3 vertexPosition;\n\n  #ifdef NORMAL\n    in vec3 vertexNormal;\n  #endif\n\n  #ifdef WEBGL_1\n    uniform mat4 viewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform mat4 worldMatrix;\n    uniform float cameraFar;\n    uniform float thickness;\n    uniform mat3 normalMatrix;\n  #else\n  uniform uniformBlockVS {\n    mat4 viewMatrix;\n    mat4 projectionMatrix;\n    mat4 worldMatrix;\n    float cameraFar;\n    float thickness;\n    mat3 normalMatrix;\n  };\n  #endif\n\n  " + d.default.animation.prevertex + "\n\n  out float depth;\n\n  void main() {\n\n    #ifdef NORMAL\n      mat3 nMatrix = normalMatrix;\n    #endif\n\n    mat4 wMatrix = worldMatrix;\n    " + d.default.animation.vertex + "\n\n    #ifdef NORMAL\n      vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 ));\n    #else\n      vec4 mvPosition = viewMatrix * (wMatrix * vec4( vertexPosition, 1.0 ));\n    #endif\n\n    depth = -mvPosition.z / cameraFar;\n    gl_Position = projectionMatrix * mvPosition;\n  }",
        fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n  #endif\n\n  uniform float id;\n\n  in float depth;\n\n  #ifdef WEBGL_1\n    #define fragColor gl_FragColor\n    #undef in\n  #else\n    out vec4 fragColor;\n  #endif\n\n  " + f.default.methods.packDepth16 + "\n\n  void main() {\n    vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);\n    vec2 packedDepth = packDepth16(depth);\n    fragColor = vec4(packedId, packedDepth);\n  }"
    }, i.PanoToCube = {
        name: "ShaderLib.PanoToCube",
        defines: {
            RGBE: !1
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            diffuseMap: u.default.DIFFUSE_MAP,
            faceIdx: 0
        },
        vshader: "\n    attribute vec3 vertexPosition;\n    attribute vec2 vertexUV0;\n\n    varying vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n      gl_Position = vec4(vertexPosition, 1.0);\n    }",
        fshader: "\n    varying vec2 texCoord0;\n\n    uniform sampler2D diffuseMap;\n    uniform int faceIdx;\n\n    const vec2 invAtan = vec2(0.1591, 0.3183);\n\n    void main(void){\n      vec3 sphereDir;\n      if(faceIdx <= 0) {\n        sphereDir = normalize(vec3(0.5, -(texCoord0.y - 0.5), -(texCoord0.x - 0.5)));\n      }\n      else if(faceIdx <= 1) {\n        sphereDir = normalize(vec3(-0.5, -(texCoord0.y - 0.5), texCoord0.x - 0.5));\n      }\n      else if(faceIdx <= 2) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, 0.5, texCoord0.y - 0.5));\n      }\n      else if(faceIdx <= 3) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -0.5, -(texCoord0.y - 0.5)));\n      }\n      else if(faceIdx <= 4) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -(texCoord0.y - 0.5), 0.5));\n      }\n      else if(faceIdx <= 5) {\n        sphereDir = normalize(vec3(-(texCoord0.x - 0.5), -(texCoord0.y - 0.5), -0.5));\n      }\n\n      vec2 panoUVs = vec2(atan(sphereDir.z, sphereDir.x), asin(sphereDir.y));\n      panoUVs *= invAtan;\n      panoUVs += 0.5;\n\n      vec4 outColor = texture2D(diffuseMap, panoUVs);\n      #ifdef RGBE\n      outColor.rgb *= pow(2.0, outColor.a * 255.0 - 128.0);\n      outColor.a = 1.0;\n      #endif\n      gl_FragColor = outColor;\n    }"
    }, i.IrradianceConvolution = {
        name: "ShaderLib.IrradianceConvolution",
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            envMap: u.default.DIFFUSE_MAP,
            faceIdx: 0,
            skyDimensions: [1, 1, 1]
        },
        vshader: "\n    attribute vec3 vertexPosition;\n    attribute vec2 vertexUV0;\n\n    varying vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n      gl_Position = vec4(vertexPosition, 1.0);\n    }",
        fshader: "\n    varying vec2 texCoord0;\n\n    uniform samplerCube envMap;\n    uniform int faceIdx;\n\n    const float PI = 3.14159265359;\n    const float sampleDelta = 0.025;\n\n    vec4 computeIrradiance(vec3 N){\n      vec4 irradiance = vec4(0.0);  \n      \n      vec3 up    = vec3(0.0, 1.0, 0.0);\n      vec3 right = cross(up, N);\n      up         = cross(N, right);\n      \n      float nrSamples = 0.0; \n      for(float phi = 0.0; phi < 2.0 * PI; phi += sampleDelta)\n      {\n        for(float theta = 0.0; theta < 0.5 * PI; theta += sampleDelta)\n        {\n          // spherical to cartesian (in tangent space)\n          vec3 tangentSample = vec3(sin(theta) * cos(phi),  sin(theta) * sin(phi), cos(theta));\n          // tangent space to world\n          vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * N; \n  \n          vec4 sampledValue = textureCube(envMap, sampleVec);\n          irradiance += vec4(sampledValue.rgb * cos(theta) * sin(theta), sampledValue.a);\n          nrSamples++;\n        }\n      }\n      return PI * irradiance * (1.0 / float(nrSamples));\n    }\n\n    void main(void){\n      vec3 sphereDir;\n      if(faceIdx <= 0) {\n        sphereDir = normalize(vec3(0.5, -(texCoord0.y - 0.5), -(texCoord0.x - 0.5)));\n      }\n      else if(faceIdx <= 1) {\n        sphereDir = normalize(vec3(-0.5, -(texCoord0.y - 0.5), texCoord0.x - 0.5));\n      }\n      else if(faceIdx <= 2) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, 0.5, texCoord0.y - 0.5));\n      }\n      else if(faceIdx <= 3) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -0.5, -(texCoord0.y - 0.5)));\n      }\n      else if(faceIdx <= 4) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -(texCoord0.y - 0.5), 0.5));\n      }\n      else if(faceIdx <= 5) {\n        sphereDir = normalize(vec3(-(texCoord0.x - 0.5), -(texCoord0.y - 0.5), -0.5));\n      }\n      \n      gl_FragColor = computeIrradiance(sphereDir);\n    }"
    }, i.SpecularConvolution = {
        name: "ShaderLib.SpecularConvolution",
        glslversion: 300,
        gl1Extensions: {
            textureLod: "GL_EXT_shader_texture_lod"
        },
        defines: {
            PBR_MODEL: 0
        },
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            envMap: u.default.DIFFUSE_MAP,
            faceIdx: 0,
            roughness: 0,
            sourceResolution: 0
        },
        vshader: "\n    // BACKWARDS COMPAT VS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec2 vertexUV0;\n    out vec2 texCoord0;\n\n    #ifdef WEBGL_1\n\t\t// undefine in and out (varying/attrib) so that the functions\n      \t// that take parameter with 'in' qualifier won't get affected.\n      \t// the defines are aimed to alter in/out of vertex attributes, not function argument qualifiers.\n    \t#undef in\n    \t#undef out\n  \t#endif\n\n    void main(void) {\n      gl_Position = vec4(vertexPosition, 1.0);\n      texCoord0 = vertexUV0;\n    }",
        fshader: "\n    // BACKWARDS COMPAT FS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n\n    in vec2 texCoord0;\n\n    #ifndef PBR_MODEL\n      #def PBR_MODEL 0\n    #endif\n\n    uniform samplerCube envMap;\n\n    #ifdef WEBGL_1\n      uniform float faceIdx;\n      uniform float roughness;\n      uniform float sourceResolution;\n    #else // WEBGL_2\n      uniform uniformBlockFS {\n        float faceIdx;\n        float roughness;\n        float sourceResolution;\n      };\n    #endif\n\n    // BACKWARDS COMPAT FS\n    //-------------------------------------\n    #ifdef WEBGL_1\n      #undef in\n      #define fragColor gl_FragColor\n      #define textureLod textureCubeLodEXT      \n    #else // WEBGL_2\n      out vec4 fragColor;\n    #endif\n\n    const float PI = 3.14159265359;\n    const int SAMPLE_COUNT = 1024;\n\n    float VanDerCorpus(int n, int base)\n    {\n      float invBase = 1.0 / float(base);\n      float denom   = 1.0;\n      float result  = 0.0;\n  \n      for(int i = 0; i < 32; ++i)\n      {\n          if(n > 0)\n          {\n              denom   = mod(float(n), 2.0);\n              result += denom * invBase;\n              invBase = invBase / 2.0;\n              n       = int(float(n) / 2.0);\n          }\n      }\n      return result;\n    }\n    vec2 Hammersley(int i, int N)\n    {\n      return vec2(float(i)/float(N), VanDerCorpus(i, 2));\n    }\n\n    float DistributionGGX(vec3 N, vec3 H, float roughness)\n    {\n      float a = roughness*roughness;\n      float a2 = a*a;\n      float NdotH = max(dot(N, H), 0.0);\n      float NdotH2 = NdotH*NdotH;\n  \n      float nom   = a2;\n      float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n      denom = PI * denom * denom;\n  \n      return nom / denom;\n    }\n    \n    float DistributionBeckmann(vec3 N, vec3 H, float roughness)\n    {\n      float a = roughness*roughness ;\n      float a2 = a*a;\n      float NdotH = max(dot(N, H), 0.0);\n      float NdotH2 = NdotH*NdotH;\n      float denom = (PI * a2 * NdotH2 * NdotH2);\n      denom = max(denom, 0.00001);\n\t    return exp( (NdotH2 - 1.0) / (a2 * NdotH2) ) / denom;\n    }\n    \n    float DistributionBlinn(vec3 N, vec3 H, float roughness)\n    {\n      float a = roughness*roughness ;\n      float a2 = a*a;\n      float n = 2.0 / a2 - 2.0;\n      float NdotH = max(dot(N, H), 0.0);\n      float clampedPow = pow(NdotH,n);\n      clampedPow = max(clampedPow,0.000001);\n      return ((n + 2.0) / (2.0*PI)) * clampedPow;\n    }\n\n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n      float a = roughness*roughness;\n    \n      float phi = 2.0 * PI * Xi.x;\n      #if (PBR_MODEL == 0 || PBR_MODEL > 2)\n        //ggx\n        float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n      #elif (PBR_MODEL == 1)\n        //beckmann\n        float cosTheta = sqrt(1.0 / (1.0 - a *a * log2(1.0 - Xi.y)));\n      #elif (PBR_MODEL == 2)\n        //phong specular powaa\n        float n = 2.0 / (a * a) - 2.0;\n        float cosTheta = pow(Xi.y, (1.0 / (n+1.0)));\n      #endif\n      \n\n      float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n\n    \n      // from spherical coordinates to cartesian coordinates\n      vec3 H;\n      H.x = cos(phi) * sinTheta;\n      H.y = sin(phi) * sinTheta;\n      H.z = cosTheta;\n    \n      // from tangent-space vector to world-space sample vector\n      vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n      vec3 tangent   = normalize(cross(up, N));\n      vec3 bitangent = cross(N, tangent);\n    \n      vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n      return normalize(sampleVec);\n    }\n\n    void main(void){\n      vec3 sphereDir;\n      if(faceIdx <= 0.0) {\n        sphereDir = normalize(vec3(0.5, -(texCoord0.y - 0.5), -(texCoord0.x - 0.5)));\n      }\n      else if(faceIdx <= 1.0) {\n        sphereDir = normalize(vec3(-0.5, -(texCoord0.y - 0.5), texCoord0.x - 0.5));\n      }\n      else if(faceIdx <= 2.0) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, 0.5, texCoord0.y - 0.5));\n      }\n      else if(faceIdx <= 3.0) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -0.5, -(texCoord0.y - 0.5)));\n      }\n      else if(faceIdx <= 4.0) {\n        sphereDir = normalize(vec3(texCoord0.x - 0.5, -(texCoord0.y - 0.5), 0.5));\n      }\n      else if(faceIdx <= 5.0) {\n        sphereDir = normalize(vec3(-(texCoord0.x - 0.5), -(texCoord0.y - 0.5), -0.5));\n      }\n\n      vec3 N = sphereDir;    \n      vec3 R = N;\n      vec3 V = R;\n  \n      float totalWeight = 0.0;   \n      vec4 prefilteredColor = vec4(0.0);\n\n      for(int i = 0; i < SAMPLE_COUNT; ++i)\n      {\n        vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n        vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(dot(N, L), 0.0);\n        if(NdotL > 0.0)\n        {\n          // sample from the environment's mip level based on roughness/pdf\n          #if (PBR_MODEL == 0 || PBR_MODEL > 2 )\n            float D = DistributionGGX(N, H, roughness);\n          #elif (PBR_MODEL == 1)\n            float D = DistributionBeckmann(N, H, roughness);\n          #elif (PBR_MODEL == 2)\n            float D = DistributionBlinn(N,H,roughness);\n          #endif\n\n          //totalWeight += NdotL;\n          //prefilteredColor += vec3(D,D,D);\n          //continue;\n\n          float NdotH = max(dot(N, H), 0.0);\n          float HdotV = max(dot(H, V), 0.0);\n          float pdf = D * NdotH / (4.0 * HdotV) + 0.0001; \n\n          float resolution = sourceResolution; // resolution of source cubemap (per face)\n          float saTexel  = 4.0 * PI / (6.0 * resolution * resolution);\n          float saSample = 1.0 / (float(SAMPLE_COUNT) * pdf + 0.0001);\n\n          float mipLevel = roughness == 0.0 ? 0.0 : 0.5 * log2(saSample / saTexel); \n\n          prefilteredColor += textureLod(envMap, L, mipLevel) * NdotL;\n          totalWeight      += NdotL;\n        }\n      }\n      prefilteredColor = prefilteredColor / totalWeight;\n      fragColor = prefilteredColor;\n    }"
    }, i.BRDFIntegration = {
        name: "ShaderLib.BRDFIntegration",
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        vshader: "\n    attribute vec3 vertexPosition;\n    attribute vec2 vertexUV0;\n    varying vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n      gl_Position = vec4(vertexPosition, 1.0);\n    }",
        fshader: "\n    varying vec2 texCoord0;\n\n    const float PI = 3.14159265359;\n    const int SAMPLE_COUNT = 1024;\n\n    float VanDerCorpus(int n, int base)\n    {\n      float invBase = 1.0 / float(base);\n      float denom   = 1.0;\n      float result  = 0.0;\n  \n      for(int i = 0; i < 32; ++i)\n      {\n          if(n > 0)\n          {\n              denom   = mod(float(n), 2.0);\n              result += denom * invBase;\n              invBase = invBase / 2.0;\n              n       = int(float(n) / 2.0);\n          }\n      }\n      return result;\n    }\n    vec2 Hammersley(int i, int N)\n    {\n      return vec2(float(i)/float(N), VanDerCorpus(i, 2));\n    }\n    \n    vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness)\n    {\n      float a = roughness*roughness;\n    \n      float phi = 2.0 * PI * Xi.x;\n      //ggx\n      float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n      \n      //phong\n      //phong specular powaa\n      //float n = 2.0 / (a * a) - 2.0;\n      //float cosTheta = pow(Xi.y, (1.0 / (n+1.0)));\n\n      float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n    \n      // from spherical coordinates to cartesian coordinates\n      vec3 H;\n      H.x = cos(phi) * sinTheta;\n      H.y = sin(phi) * sinTheta;\n      H.z = cosTheta;\n    \n      // from tangent-space vector to world-space sample vector\n      vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n      vec3 tangent   = normalize(cross(up, N));\n      vec3 bitangent = cross(N, tangent);\n    \n      vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n      return normalize(sampleVec);\n    }\n\n    float GeometrySchlickGGX(float NdotV, float roughness)\n    {\n      // note that we use a different k for IBL\n      float a = roughness;\n      float k = (a * a) / 2.0;\n  \n      float nom   = NdotV;\n      float denom = NdotV * (1.0 - k) + k;\n  \n      return nom / denom;\n    }\n\n    float GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n    {\n      float NdotV = max(dot(N, V), 0.0);\n      float NdotL = max(dot(N, L), 0.0);\n      float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n      float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n  \n      return ggx1 * ggx2;\n    }\n\n    vec2 IntegrateBRDF(float NdotV, float roughness)\n    {\n      vec3 V;\n      V.x = sqrt(1.0 - NdotV*NdotV);\n      V.y = 0.0;\n      V.z = NdotV;\n  \n      float A = 0.0;\n      float B = 0.0; \n  \n      vec3 N = vec3(0.0, 0.0, 1.0);\n      \n      for(int i = 0; i < SAMPLE_COUNT; ++i)\n      {\n        // generates a sample vector that's biased towards the\n        // preferred alignment direction (importance sampling).\n        vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n        vec3 H = ImportanceSampleGGX(Xi, N, roughness);\n        vec3 L = normalize(2.0 * dot(V, H) * H - V);\n\n        float NdotL = max(L.z, 0.0);\n        float NdotH = max(H.z, 0.0);\n        float VdotH = max(dot(V, H), 0.0);\n\n        if(NdotL > 0.0)\n        {\n          float G = GeometrySmith(N, V, L, roughness);\n          float G_Vis = (G * VdotH) / (NdotH * NdotV);\n          float Fc = pow(1.0 - VdotH, 5.0);\n\n          A += (1.0 - Fc) * G_Vis;\n          B += Fc * G_Vis;\n        }\n      }\n      A /= float(SAMPLE_COUNT);\n      B /= float(SAMPLE_COUNT);\n      return vec2(A, B);\n    }\n\n    void main(void){\n      vec2 integrateBRDF = IntegrateBRDF(texCoord0.x, texCoord0.y);\n      gl_FragColor = vec4(integrateBRDF, 0.0, 1.0);\n    }"
    }, i.CombineTextures = {
        attributes: {
            vertexPosition: a.default.POSITION,
            vertexUV0: a.default.TEXCOORD0
        },
        uniforms: {
            textureA: "TEXTURE_A",
            textureB: "TEXTURE_B",
            textureC: "TEXTURE_C",
            textureD: "TEXTURE_D"
        },
        vshader: "\n    attribute vec3 vertexPosition;\n    attribute vec2 vertexUV0;\n\n    varying vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n      gl_Position = vec4(vertexPosition, 1.0);\n    }",
        fshader: "\n    varying vec2 texCoord0;\n\n    uniform sampler2D textureA;\n    uniform sampler2D textureB;\n    uniform sampler2D textureC;\n    uniform sampler2D textureD;\n\n    void main(void){\n      #if defined(R_R_R_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).r, texture2D(textureC, texCoord0).r, texture2D(textureD, texCoord0).r);\n      #elif defined(R_R_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).r, texture2D(textureC, texCoord0).r, 0.0);\n      #elif defined(R_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).r, 0.0, 0.0);\n      #elif defined(RG_R_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).rg, texture2D(textureB, texCoord0).r, texture2D(textureC, texCoord0).r);\n      #elif defined(RG_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).rg, texture2D(textureB, texCoord0).r, 0.0);\n      #elif defined(R_RG_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).rg, texture2D(textureC, texCoord0).r);\n      elif defined(R_RG_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).rg, 0.0);\n      #elif defined(R_R_RG_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).r, texture2D(textureC, texCoord0).rg);\n      #elif defined(RGB_R_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).rgb, texture2D(textureB, texCoord0).r);\n      #elif defined(R_RGB_)\n      gl_FragColor = vec4(texture2D(textureA, texCoord0).r, texture2D(textureB, texCoord0).rgb);\n      #endif\n    }"
    }, t.default = i
}, , function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(12),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    //! AT: converting from PromiseUtils.createPromise to new RSVP.Promise is going to be trivial
    r.createPromise = function(e) {
            return new o.default.Promise(e)
        },
        //! AT: in line with the native Promise.resolve
        r.resolve = function(e) {
            return o.default.Promise.resolve(e)
        },
        //! AT: in line with the native Promise.reject
        r.reject = function(e) {
            return o.default.Promise.reject(e)
        }, r.optimisticAll = function(e) {
            var t = 0,
                n = e.length,
                r = [];
            return new o.default.Promise(function(i) {
                if (n > 0)
                    for (var o = 0; o < n; o += 1) ! function(o) {
                        e[o].then(function(e) {
                            r[o] = e, (t += 1) === n && i(r)
                        }, function(e) {
                            console.error("[Sumerian] An unhandled error has occured:", e.message, e.stack), r[o] = e, (t += 1) === n && i(r)
                        })
                    }(o);
                else i(r)
            })
        }, t.default = r
}, , function(e, t) {
    e.exports = function(e) {
        return "object" == typeof e ? null !== e : "function" == typeof e
    }
}, function(e, t, n) {
    "use strict";

    function r(e, t, n, r) {
        //! schteppe: this._type seem to be assumed to be set by the subclass. Why not pass it as a parameter to this constructor?
        this.world = e, this.getConfig = t, this.updateObject = n, this.loadObject = r
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(17),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype._prepare = function() {}, r.prototype._create = function() {
        throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")
    }, r.prototype._remove = function(e) {
        e.clearComponent(this._type)
    }, r.prototype._load = function(e, t) {
        return this.loadObject(e, t)
    }, r.prototype.update = function(e, t) {
        if (!e) return o.default.reject("Entity is missing");
        if (!t) return this._remove(e), o.default.resolve();
        var n = e.getComponent(this._type);
        return n || (n = this._create(), e.setComponent(n)), this._prepare(t), o.default.resolve(n)
    }, r.handlerClasses = {}, r.getHandler = function(e) {
        return r.handlerClasses[e]
    }, r._registerClass = function(e, t) {
        r.handlerClasses[e] = t
    }, t.default = r
}, , , function(e, t, n) {
    var r = n(132)("wks"),
        i = n(83),
        o = n(13).Symbol,
        a = "function" == typeof o;
    (e.exports = function(e) {
        return r[e] || (r[e] = a && o[e] || (a ? o : i)("Symbol." + e))
    }).store = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        if (Array.isArray(e)) {
            for (var t = 0, n = Array(e.length); t < e.length; t++) n[t] = e[t];
            return n
        }
        return Array.from(e)
    }

    function o(e, t) {
        var n = this;
        t = t || {};
        var r = t.canvas;
        void 0 === r && (r = document.createElement("canvas"), r.width = 500, r.height = 500), r.screencanvas = !0, this.domElement = r, this._alpha = void 0 !== t.alpha && t.alpha, this._premultipliedAlpha = void 0 === t.premultipliedAlpha || t.premultipliedAlpha, this._antialias = void 0 === t.antialias || t.antialias, this._stencil = void 0 !== t.stencil && t.stencil, this._preserveDrawingBuffer = void 0 !== t.preserveDrawingBuffer && t.preserveDrawingBuffer, this._useDevicePixelRatio = void 0 !== t.useDevicePixelRatio && t.useDevicePixelRatio, this._onError = t.onError, this._rightVRCamera = null, this._leftVRCamera = null, this._contextSettings = {
                alpha: this._alpha,
                premultipliedAlpha: this._premultipliedAlpha,
                antialias: this._antialias,
                stencil: this._stencil,
                preserveDrawingBuffer: this._preserveDrawingBuffer
            }, this.context = null, this.establishContext(), this._setupContextLost(), t.debug && this.setupDebugging(t), this.rendererRecord = new f.default, this.maxTextureSize = isNaN(t.maxTextureSize) ? u.default.maxTexureSize : Math.min(t.maxTextureSize, u.default.maxTexureSize), this.maxCubemapSize = isNaN(t.maxTextureSize) ? u.default.maxCubemapSize : Math.min(t.maxTextureSize, u.default.maxCubemapSize), this.shaderPrecision = t.shaderPrecision || "highp", "highp" === this.shaderPrecision && u.default.vertexShaderHighpFloat.precision > 0 && u.default.fragmentShaderHighpFloat.precision > 0 ? this.shaderPrecision = "highp" : "lowp" !== this.shaderPrecision && u.default.vertexShaderMediumpFloat.precision > 0 && u.default.fragmentShaderMediumpFloat.precision > 0 ? this.shaderPrecision = "mediump" : this.shaderPrecision = "lowp", this.downScale = t.downScale || 1,
            //! AT: why are there 2 clear colors?
            this.clearColor = new _.default, this._clearColor = new _.default, this.setClearColor(.3, .3, .3, 1), this.viewportX = 0, this.viewportY = 0, this.viewportWidth = 0, this.viewportHeight = 0, this.currentWidth = 0, this.currentHeight = 0, this.devicePixelRatio = 1, this._overrideMaterials = [], this._mergedMaterial = new E.default("Merged Material"), this.renderQueue = new M.default, this.info = new P.default, this.shadowHandler = new A.default, this.samplerObjects = [], this.hardwarePicking = null, I.default.addListener("sumerian.setClearColor", function(e) {
                n.setClearColor.apply(n, i(e))
            }),
            //! AT: ugly fix for the resizing style-less canvas to 1 px for desktop
            document.createElementNS ? (this.svg = document.createElementNS("http://www.w3.org/2000/svg", "svg"), this.svg.setAttribute("xmlns", "http://www.w3.org/2000/svg"), this.svg.setAttribute("version", "1.1"), this.svg.style.position = "absolute", this.svg.style.display = "none", document.body.appendChild(this.svg)) :
            //! AT: placeholder to avoid another conditional below in checkResize
            this.svg = {
                currentScale: 1
            }, I.default.addListener("sumerian.setCurrentCamera", function(e) {
                o.mainCamera = e.camera, n.checkResize(o.mainCamera)
            }), I.default.addListener(N.default.START_VRCAMERAS, function(e) {
                n._leftVRCamera = e.leftEye, n._rightVRCamera = e.rightEye
            }), I.default.addListener(N.default.STOP_VRCAMERAS, function(e) {
                n._leftVRCamera = null, n._rightVRCamera = null
            }), this._definesIndices = [], Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        s = n(26),
        u = r(s),
        l = n(196),
        f = r(l),
        c = n(147),
        d = r(c),
        h = n(108),
        p = r(h),
        m = n(33),
        y = r(m),
        v = n(36),
        _ = r(v),
        g = n(45),
        b = r(g),
        x = n(197);
    r(x);
    n(144);
    var w = n(9),
        E = r(w),
        S = n(150),
        M = r(S),
        C = n(15),
        T = r(C),
        R = n(282),
        A = r(R),
        O = n(283),
        P = r(O),
        D = n(5),
        I = r(D),
        k = n(69),
        N = r(k),
        L = n(284),
        B = r(L),
        F = n(280),
        j = r(F),
        U = n(285),
        V = r(U),
        z = n(4),
        G = r(z),
        W = n(57),
        H = r(W),
        X = n(30),
        Y = (r(X), n(199)),
        q = r(Y),
        K = n(95),
        Q = (r(K), function() {});
    o.prototype.setupDebugging = function(e) {
        if (!e.debugscript) return void console.warn("[Sumerian][DEBUG] You need to set the path of webgl-debug.js to enable debug");
        var t = new XMLHttpRequest;
        t.open("GET", e.debugscript, !1), t.onreadystatechange = function() {
            4 === t.readyState && t.status >= 200 && t.status <= 299 && window.eval.call(window, t.responseText)
        }, t.send(null), void 0 === window.WebGLDebugUtils ? console.warn("[Sumerian][DEBUG] You need to include webgl-debug.js in your script definition to run in debug mode.") : (this._logFunctions = e.debugfunctions || [], console.log("[Sumerian][DEBUG] Running in webgl debug mode. DebugFunctions: " + this._logFunctions), e.validate ? (console.log('[Sumerian][DEBUG] Running with "undefined arguments" validation.'), this.context = window.WebGLDebugUtils.makeDebugContext(this.context, this.onDebugError.bind(this), this.onDebugLogAndValidate.bind(this))) : this.context = window.WebGLDebugUtils.makeDebugContext(this.context, this.onDebugError.bind(this), this.onDebugLog.bind(this)))
    }, o.prototype.establishContext = function() {
        var e = "";
        if (window.WebGLRenderingContext) {
            for (var t = ["webgl2", "experimental-webgl", "webgl", "moz-webgl", "webkit-3d"], n = 0; n < t.length; n++) try {
                if (this.context = this.domElement.getContext(t[n], this._contextSettings), this.context && "function" == typeof this.context.getParameter) {
                    e = t[n];
                    break
                }
            } catch (e) {}
            if (!this.context) throw new Error("WebGL is supported but disabled")
        }
        var r = this.context;
        r.clearDepth(1), r.clearStencil(0), r.stencilMask(0), r.enable(r.DEPTH_TEST), r.depthFunc(r.LEQUAL),
            //! AT: is this still necessary?
            void 0 === r.getShaderPrecisionFormat && (this.context.getShaderPrecisionFormat = function() {
                return {
                    rangeMin: 1,
                    rangeMax: 1,
                    precision: 1
                }
            }), u.default.init(this.context, e)
    }, o.prototype._setupContextLost = function() {
        var e = this;
        this.domElement.addEventListener("webglcontextlost", function(e) {
            e.preventDefault(), I.default.emit("sumerian.contextLost")
        }, !1), this.domElement.addEventListener("webglcontextrestored", function() {
            e._restoreContext(), I.default.emit("sumerian.contextRestored")
        }, !1)
    }, o.prototype._restoreContext = Q, o.prototype.onDebugError = function(e, t, n) {
        window.WebGLDebugUtils.init(this.context);
        for (var r = "[Sumerian][DEBUG] WebGL error " + window.WebGLDebugUtils.glEnumToString(e) + " in " + t + "(", i = 0; i < n.length; ++i) r += (0 === i ? "" : ", ") + window.WebGLDebugUtils.glFunctionArgToString(t, i, n[i]);
        r += ")", console.error(r), this._onError && this._onError(r)
    }, o.prototype.onDebugLogAndValidate = function(e, t) {
        window.WebGLDebugUtils.init(this.context), this.onDebugLog(e, t);
        for (var n = 0; n < t.length; ++n) void 0 === t[n] && console.error("[Sumerian][DEBUG] undefined passed to gl." + e + "(" + window.WebGLDebugUtils.glFunctionArgsToString(e, t) + ")")
    }, o.prototype.onDebugLog = function(e, t) {
        this._logFunctions && (this._logFunctions.indexOf(e) >= 0 || "ALL" === this._logFunctions) && console.debug("[Sumerian][DEBUG] gl." + e + "(" + window.WebGLDebugUtils.glFunctionArgsToString(e, t) + ")")
    }, o.mainCamera = null, o.prototype.checkResize = function(e, t) {
        if (this._leftVRCamera && this._rightVRCamera) {
            var n = this._leftVRCamera.resolutionWidth + this._rightVRCamera.resolutionWidth,
                r = Math.max(this._leftVRCamera.resolutionHeight, this._rightVRCamera.resolutionHeight);
            t || this.setSize(n, r)
        } else {
            var i = this.devicePixelRatio = this._useDevicePixelRatio && window.devicePixelRatio ? window.devicePixelRatio / this.svg.currentScale : 1,
                o = void 0,
                a = void 0;
            navigator.isCocoonJS ? (o = window.innerWidth, a = window.innerHeight) : (o = this.domElement.offsetWidth, a = this.domElement.offsetHeight), o = Math.max(o * i / this.downScale, 1), a = Math.max(a * i / this.downScale, 1);
            var s = o,
                u = a;
            e && !0 === e.lockedRatio && e.aspect && (o = a * e.aspect);
            var l = o / a;
            t || this.setSize(o, a, s, u), e && !1 === e.lockedRatio && e.aspect !== l && (e.aspect = l, 0 === e.projectionMode ? e.setFrustumPerspective() : e.setFrustum(), e.onFrameChange())
        }
    }, o.prototype.setSize = function(e, t, n, r) {
        if (void 0 === n && (n = e), void 0 === r && (r = t), this.domElement.width = n, this.domElement.height = r, e > n) {
            var i = n / e;
            e = n, t = r * i
        }
        var o = .5 * (n - e),
            a = .5 * (r - t);
        o === this.viewportX && a === this.viewportY && e === this.viewportWidth && t === this.viewportHeight || (this.setViewport(o, a, e, t), null !== this.hardwarePicking && (this.hardwarePicking.pickingTarget = null))
    }, o.prototype.setViewport = function(e, t, n, r) {
        this.viewportX = void 0 !== e ? e : 0, this.viewportY = void 0 !== t ? t : 0, this.viewportWidth = void 0 !== n ? n : this.domElement.width, this.viewportHeight = void 0 !== r ? r : this.domElement.height, this.context.viewport(this.viewportX, this.viewportY, this.viewportWidth, this.viewportHeight), I.default.emit("sumerian.viewportResize", {
            x: this.viewportX,
            y: this.viewportY,
            width: this.viewportWidth,
            height: this.viewportHeight
        }, !0)
    }, o.prototype.setClearColor = function(e, t, n, r) {
        //! AT: is exact equality important here?
        this._clearColor.r === e && this._clearColor.g === t && this._clearColor.b === n && this._clearColor.a === r || (this._clearColor.r = e, this._clearColor.g = t, this._clearColor.b = n, this._clearColor.a = r, this.clearColor.copy(this._clearColor), this.context.clearColor(e, t, n, r))
    }, o.prototype.bindData = function(e) {
        var t = e.glBuffer;
        this.context;
        null !== t ? this.bindBuffer(t, e.target) : console.log("ERROR: bindData")
    }, o.prototype.updateData = function(e) {
        var t = e.glBuffer,
            n = this.context;
        null !== t && e._dataNeedsRefresh && (this.bindBuffer(t, e.target), n.bufferSubData(d.default.getGLBufferTarget(n, e.target), 0, e.data), e._dataNeedsRefresh = !1, this.bindBuffer(null, e.target))
    }, o.prototype.createBufferDataIfNeeded = function(e) {
        var t = e.glBuffer,
            n = this.context;
        null === t && (t = n.createBuffer(), e.glBuffer = t, this.rendererRecord.invalidateBuffer(e.target), this.bindBuffer(t, e.target), n.bufferData(d.default.getGLBufferTarget(n, e.target), e.data, d.default.getGLBufferUsage(n, e._dataUsage)), this.bindBuffer(null, e.target))
    }, o.prototype.updateAttributeData = function(e, t) {
        this.context.bufferSubData(this.context.ARRAY_BUFFER, t, e)
    }, o.prototype.setShadowType = function(e) {
        this.shadowHandler.shadowType = e
    }, o.prototype.updateShadows = function(e, t, n) {
        this.shadowHandler.checkShadowRendering(this, e, t, n)
    }, o.prototype.preloadTexture = function(e, t) {
        //! schteppe: Is there any case where we want to preload a texture to another context than this.context?
        //! AT: the code will diverge; it was initially copy-pasted and adapted to suit the need, but it will have to be iterated on; adding more ifs for different code paths is not gonna make the code nicer
        //! schteppe: What if the .glTexture is not allocated yet?
        e.bindTexture(d.default.getGLType(e, t.variant), t.glTexture), e.pixelStorei(e.UNPACK_ALIGNMENT, t.unpackAlignment), e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, t.premultiplyAlpha), e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL, t.flipY);
        var n = t.image;
        if ("2D" === t.variant) n ? (!n.isCompressed && (t.generateMipmaps || n.width > this.maxTextureSize || n.height > this.maxTextureSize) && (this.checkRescale(t, n, n.width, n.height, this.maxTextureSize), n = t.image), !0 === n.isData ? n.isCompressed ? this.loadCompressedTexture(e, e.TEXTURE_2D, t, n.data) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), n.width, n.height, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n.data) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n), t.generateMipmaps && !n.isCompressed && e.generateMipmap(e.TEXTURE_2D)) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), t.width, t.height, 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null);
        else if ("CUBE" === t.variant) {
            if (n && !n.isData && (t.generateMipmaps || n.width > this.maxCubemapSize || n.height > this.maxCubemapSize)) {
                for (var r = 0; r < b.default.CUBE_FACES.length; r++) n.data[r] && !n.data[r].buffer ? d.default.scaleImage(t, n.data[r], n.width, n.height, this.maxCubemapSize, r) : d.default.getBlankImage(t, [.3, .3, .3, 0], n.width, n.height, this.maxCubemapSize, r);
                t.image.width = Math.min(this.maxCubemapSize, G.default.nearestPowerOfTwo(t.image.width)), t.image.height = Math.min(this.maxCubemapSize, G.default.nearestPowerOfTwo(t.image.height)), n = t.image
            }
            for (var i = 0; i < b.default.CUBE_FACES.length; i++) {
                var o = b.default.CUBE_FACES[i];
                n ? !0 === n.isData ? n.isCompressed ? this.loadCompressedTexture(e, d.default.getGLCubeMapFace(e, o), t, n.data[i]) : e.texImage2D(d.default.getGLCubeMapFace(e, o), 0, d.default.getGLInternalFormat(e, t.format), n.width, n.height, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n.data[i]) : e.texImage2D(d.default.getGLCubeMapFace(e, o), 0, d.default.getGLInternalFormat(e, t.format), d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n.data[i]) : e.texImage2D(d.default.getGLCubeMapFace(e, o), 0, d.default.getGLInternalFormat(e, t.format), t.width, t.height, 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null)
            }
            n && t.generateMipmaps && !n.isCompressed && e.generateMipmap(e.TEXTURE_CUBE_MAP)
        } else if ("2DArray" === t.variant || "3D" === t.variant) {
            var a = "2DArray" === t.variant ? e.TEXTURE_2D_ARRAY : e.TEXTURE_3D;
            n ? !0 === n.isData ? e.texImage3D(a, 0, d.default.getGLInternalFormat3D(e, t.format), n.width, n.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n.data) : e.texImage3D(a, 0, d.default.getGLInternalFormat3D(e, t.format), t.width, t.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), n.data) : e.texImage3D(a, 0, d.default.getGLInternalFormat3D(e, t.format), t.width, t.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null), n && t.generateMipmaps && !n.isCompressed && e.generateMipmap(a)
        }
    }, o.prototype.preloadTextures = function(e, t) {
        var n = this.context;
        Object.keys(e._textureMaps).forEach(function(r) {
            var i = e.getTexture(r);
            if (void 0 !== i) {
                var o = i;
                i instanceof Array == 0 && (o = [i]), o.forEach(function(e) {
                    var r = this;
                    e && t.push(function() {
                        e instanceof y.default != 0 || void 0 !== e.image && !1 !== e.checkDataReady() || ("2D" === e.variant ? e = p.default.DEFAULT_TEXTURE_2D : "CUBE" === e.variant ? e = p.default.DEFAULT_TEXTURE_CUBE : "sampler2DArray" === textureSlot.format ? e = p.default.DEFAULT_TEXTURE_2DArray : "sampler3D" === textureSlot.format && (e = p.default.DEFAULT_TEXTURE_3D)), null === e.glTexture ? (e.glTexture = n.createTexture(), r.preloadTexture(n, e), e.needsUpdate = !1) : e instanceof b.default && e.checkNeedsUpdate() && (r.preloadTexture(n, e), e.needsUpdate = !1)
                    })
                }, this)
            }
        }, this)
    };
    var Z = new V.default;
    o.prototype.preloadMaterials = function(e) {
        var t = [],
            n = Z;
        if (n.reset(), Array.isArray(e))
            for (var r = 0; r < e.length; r++) {
                var i = e[r];
                if (!(i.isSkybox && this._overrideMaterials.length > 0)) {
                    n.fill(i);
                    for (var o = 0; o < n.materials.length; o++) this.preloadTextures(n.materials[o], t)
                }
            } else {
                n.fill(e);
                for (var a = 0; a < n.materials.length; a++) this.preloadTextures(n.materials[a], t)
            }
        return B.default.each(t)
    }, o.prototype.precompileShader = function(e, t) {
        var n = e.shader;
        n.updateProcessors(t), this.findOrCacheMaterialShader(e, t), n = e.shader, n.precompile(this)
    }, o.prototype.clearShaderCache = function() {
        this.rendererRecord.shaderCache.clear()
    }, o.prototype.precompileShaders = function(e, t) {
        var n = new V.default;
        t && (n.lights = t);
        var r = [];
        if (Array.isArray(e))
            for (var i = 0; i < e.length; i++) {
                var o = e[i];
                if (!(o.isSkybox && this._overrideMaterials.length > 0)) {
                    n.fill(o);
                    for (var a = 0; a < n.materials.length; a++) n.material = n.materials[a], this.precompileShader(n.materials[a], n, r)
                }
            } else {
                n.fill(e);
                for (var s = 0; s < n.materials.length; s++) n.material = n.materials[s], this.precompileShader(n.materials[s], n, r)
            }
        return B.default.each(r)
    };
    for (var J = new V.default, $ = [], ee = 0; ee < 1e3; ++ee) $.push(new j.default);
    var te = function(e) {
            e.startFrame()
        },
        ne = new H.default,
        re = [new E.default("occluderMat", T.default.simple)];
    re[0].cullState.enabled = !1, re[0].depthState.write = !1;
    var ie = [],
        oe = 60;
    o.prototype.render = function(e, t, n, r, i, s, l, f, c) {
        if (this.clearError(), oe = this._leftVRCamera && this._rightVRCamera ? 90 : 60, this._overrideMaterials = l ? l instanceof Array ? l : [l] : [], n) {
            if (null !== o.mainCamera || i || (o.mainCamera = n), this.setRenderTarget(i, c), void 0 === s || null === s || !0 === s ? this.clear() : "object" === (void 0 === s ? "undefined" : a(s)) && this.clear(s.color, s.depth, s.stencil), this.rendererRecord.shaderCache.forEach(te), null != t)
                for (var d = ie.length, h = 0; h < d; h++) {
                    var p = ie.shift();
                    if (p.parent.occluder.isOccluded) {
                        p.occluder.isOccluded = !0, p.occluder.isOccludedR = !0, p.occluder.isOccludedL = !0, p.occluder.wasOccluded = !1, p.occluder.isOccQueryRunning = !1, p.occluder.isOccQueryRunning = !1, p.occluder.nFramesUntilQuery = 0, p.occluder.nCoherentVisibilityFrames = 0;
                        for (var m = 0; m < p.entities.length; m++) p.entities[m].isOccluded = p.occluder.isOccluded
                    } else {
                        var y = !1;
                        if (p.occluder.isOccQueryRunningR && this.context.getQueryParameter(p.occluder.occlusionQueryR, this.context.QUERY_RESULT_AVAILABLE) && (p.occluder.isOccQueryRunningR = !1, p.occluder.isOccludedR = 0 == this.context.getQueryParameter(p.occluder.occlusionQueryR, this.context.QUERY_RESULT), y = !0), p.occluder.isOccQueryRunning && this.context.getQueryParameter(p.occluder.occlusionQuery, this.context.QUERY_RESULT_AVAILABLE) && (p.occluder.isOccQueryRunning = !1, p.occluder.isOccludedL = 0 == this.context.getQueryParameter(p.occluder.occlusionQuery, this.context.QUERY_RESULT), y = !0), y && (p.occluder.wasOccluded = p.occluder.isOccluded), p.occluder.wasOccluded != p.occluder.isOccludedL || p.occluder.wasOccluded != p.occluder.isOccludedR) {
                            p.occluder.nCoherentVisibilityFrames = 0;
                            for (var v = 0; v < p.entities.length; v++) p.entities[v].isOccluded = p.occluder.isOccluded = 60 == oe ? p.occluder.isOccludedL : p.occluder.isOccludedL && p.occluder.isOccludedR
                        } else p.occluder.nCoherentVisibilityFrames++;
                        (p.occluder.isOccQueryRunning || p.occluder.isOccQueryRunningR) && (p.occluder.nCoherentVisibilityFrames++, ie.push(p))
                    }
                }
            if (this._leftVRCamera && this._rightVRCamera ? this._doRender(e, f, t, [this._leftVRCamera, this._rightVRCamera], r) : this._doRender(e, f, t, n, r), this._updateRenderTarget(i), this.rendererRecord.maxBoundSamplerUnit > -1 && u.default.Webgl2) {
                for (var _ = 0; _ < this.rendererRecord.maxBoundSamplerUnit + 1; _++) this.context.bindSampler(_, null);
                this.rendererRecord.maxBoundSamplerUnit = -1
            }
            this.checkError()
        }
    }, o.prototype.checkError = function() {
        var e = d.default.checkGLError(this.context);
        e && console.error(e)
    }, o.prototype.clearError = function() {
        for (var e = this.context.getError(); e;) e = this.context.getError()
    }, o.prototype._updateRenderTarget = function(e) {
        if (Array.isArray(e))
            for (var t = e.length, n = 0, r = 0; r < t; r++) e[r] && e[r].multiSampledRenderBufffer && this.updateMultiSampledRenderTarget(e[r], n), e[r].colorBuffer && (n += 1), e[r] && e[r].generateMipmaps && (G.default.isPowerOfTwo(e[r].width) && G.default.isPowerOfTwo(e[r].height) || u.default.Webgl2) && this.updateRenderTargetMipmap(e[r]);
        else e && e.multiSampledRenderBufffer && this.updateMultiSampledRenderTarget(e, -1), e && e.generateMipmaps && (G.default.isPowerOfTwo(e.width) && G.default.isPowerOfTwo(e.height) || u.default.Webgl2) && this.updateRenderTargetMipmap(e)
    }, o.prototype._renderMeshWithLRSupport = function(e, t, n) {
        n ? (this.context.viewport(0, this.domElement.height - this._leftVRCamera.resolutionHeight, this._leftVRCamera.resolutionWidth, this._leftVRCamera.resolutionHeight), t.camera = this._leftVRCamera, t.fill(e), this.renderMesh(t), this.context.viewport(this._leftVRCamera.resolutionWidth, this.domElement.height - this._rightVRCamera.resolutionHeight, this._rightVRCamera.resolutionWidth, this._rightVRCamera.resolutionHeight), t.camera = this._rightVRCamera, this.renderMesh(t)) : (t.fill(e), this.renderMesh(t))
    };
    var ae = [],
        se = 0;
    o.prototype._renderMeshInstancedWithLRSupport = function(e, t) {
        t ? (this.context.viewport(0, this.domElement.height - this._leftVRCamera.resolutionHeight, this._leftVRCamera.resolutionWidth, this._leftVRCamera.resolutionHeight), e.camera = this._leftVRCamera, this.renderMeshInstanced(e), this.context.viewport(this._leftVRCamera.resolutionWidth, this.domElement.height - this._rightVRCamera.resolutionHeight, this._rightVRCamera.resolutionWidth, this._rightVRCamera.resolutionHeight), e.camera = this._rightVRCamera, this.renderMeshInstanced(e)) : this.renderMeshInstanced(e)
    }, o.prototype._doRender = function(e, t, n, r, i) {
        var a = J,
            s = !1;
        if (Array.isArray(r) && r[0] instanceof q.default && (s = !0), a.reset(), a.camera = r, a.mainCamera = o.mainCamera, a.lights = i, a.shadowHandler = this.shadowHandler, a.renderer = this, Array.isArray(e) && e.length > 0) {
            !0 === s ? this.renderQueue.sort(e, this._leftVRCamera) : this.renderQueue.sort(e, r);
            for (var l = 0; l < e.length; l++) {
                var f = e[l];
                f.isSkybox && this._overrideMaterials.length > 0 || (null != n && u.default.Webgl2 && void 0 != f.meshRendererComponent && "Never" != f.meshRendererComponent.cullMode && f.isOccluded ? this.info.occluded++ : this._renderMeshWithLRSupport(f, a, s))
            }
        } else this._renderMeshWithLRSupport(e, a, s);
        if (void 0 != t && t.size > 0) {
            se = 0;
            var c = 0,
                d = 0,
                h = this,
                p = this.renderQueue,
                m = !0,
                y = !1,
                v = void 0;
            try {
                for (var _, g = t[Symbol.iterator](); !(m = (_ = g.next()).done); m = !0) {
                    var b = _.value,
                        x = b[1].meshLookup,
                        w = b[0],
                        E = !0,
                        S = !1,
                        C = void 0;
                    try {
                        for (var T, R = x[Symbol.iterator](); !(E = (T = R.next()).done); E = !0) {
                            for (var A = T.value, O = A[0], P = A[1].objs, D = A[1].IDs, I = P.length > 0 ? P[0].meshRendererComponent.materials[0].instanceCount : 0, k = Math.ceil(P.length / I), N = d; N < d + k; ++N) {
                                var L = $[N];
                                L.reset(), L.camera = 1 == s ? r[0] : r, L.mainCamera = o.mainCamera, L.lights = i, L.shadowHandler = h.shadowHandler, L.renderer = h, L.meshData = O, L.materials = w
                            }
                            w.renderQueue == M.default.TRANSPARENT && (ae[se++] = P);
                            for (var B = 0, F = 0; F < P.length; ++F) {
                                var j = P[F],
                                    U = D[F];
                                if (!(j.isSkybox && this._overrideMaterials.length > 0)) {
                                    null != n && u.default.Webgl2 && void 0 != j.meshRendererComponent && "Never" != j.meshRendererComponent.cullMode && j.isOccluded ? h.info.occluded++ : $[d].addRenderableInstance(j, U, d);
                                    var V = F === I * (B + 1) - 1,
                                        z = F === P.length - 1;
                                    (V || z) && (c += $[d].materials.instanceCount - $[d].currentInstanceCount, ++d, ++B, $[d].padding = c)
                                }
                            }
                        }
                    } catch (e) {
                        S = !0, C = e
                    } finally {
                        try {
                            !E && R.return && R.return()
                        } finally {
                            if (S) throw C
                        }
                    }
                }
            } catch (e) {
                y = !0, v = e
            } finally {
                try {
                    !m && g.return && g.return()
                } finally {
                    if (y) throw v
                }
            }
            var W = d;
            W > $.length && (console.warn("Instanced Rendering: numBatches is larger than pre-allocated array length of batchRenderInfo."), W = $.length);
            for (var H = 0; H < W; ++H) $[H].material.getRenderQueue() === M.default.OPAQUE && this._renderMeshInstancedWithLRSupport($[H], s);
            for (var X = 0; X < se; ++X) p.sort(ae[X], 1 == s ? r[0] : r);
            for (var Y = 0; Y < W; ++Y) $[Y].material.getRenderQueue() >= M.default.TRANSPARENT && this._renderMeshInstancedWithLRSupport($[Y], s)
        }
        if (this.context.colorMask(!1, !1, !1, !1), this.context.depthMask(!1), a.meshData = ne, a.materials = re, a.occlusionDrawing = !0, null != n && u.default.Webgl2)
            for (var K = [n]; K.length > 0;) {
                var Q = K.shift();
                if (null != Q.parent)
                    if (null == Q.occluder.occlusionQuery && (Q.occluder.occlusionQuery = this.context.createQuery()), null == Q.occluder.occlusionQueryR && (Q.occluder.occlusionQueryR = this.context.createQuery()), Q.occluder.nFramesUntilQuery <= 0 && !Q.occluder.isOccQueryRunning) {
                        if (a.transform = Q.occluder.transform, a.renderable = Q.occluder, !0 === s || r === this._leftVRCamera) this.context.viewport(0, this.domElement.height - this._leftVRCamera.resolutionHeight, this._leftVRCamera.resolutionWidth, this._leftVRCamera.resolutionHeight), this.context.beginQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE, Q.occluder.occlusionQuery), a.camera = this._leftVRCamera, this.renderMesh(a), this.context.endQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE), this.context.viewport(this._leftVRCamera.resolutionWidth, this.domElement.height - this._rightVRCamera.resolutionHeight, this._rightVRCamera.resolutionWidth, this._rightVRCamera.resolutionHeight), this.context.beginQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE, Q.occluder.occlusionQueryR), a.camera = this._rightVRCamera, this.renderMesh(a), this.context.endQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE), Q.occluder.isOccQueryRunning = !0, Q.occluder.isOccQueryRunningR = !0;
                        else {
                            if (r === this._rightVRCamera) break;
                            this.context.beginQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE, Q.occluder.occlusionQuery), this.renderMesh(a), this.context.endQuery(this.context.ANY_SAMPLES_PASSED_CONSERVATIVE), Q.occluder.isOccQueryRunning = !0, Q.occluder.isOccQueryRunningR = !1
                        }
                        var Z = G.default.clamp(Q.occluder.nCoherentVisibilityFrames / oe, 0, 1),
                            ee = G.default.lerp(Z, 5, 10);
                        Q.occluder.nFramesUntilQuery = Math.floor(Math.random() * ee), ie.push(Q)
                    } else Q.occluder.nFramesUntilQuery--;
                if (!Q.occluder.isOccluded) {
                    for (var te = 0; te < 8; te++) Q.activeChildren & 1 << te && K.push(Q.children[te]);
                    for (var ue = 0; ue < Q.leafNodes.length; ue++) K.push(Q.leafNodes[ue])
                }
            }
        this.context.colorMask(!0, !0, !0, !0), this.context.depthMask(!0), a.occlusionDrawing = !1
    }, o.prototype.updateMultiSampledRenderTarget = function(e, t, n) {
        if (void 0 === n && (n = 0), 0 == e._glMSFrameBuffers[0].length) return void console.log("Tried to update Multi sampled render target that does not have a MS framebuffer.");
        var r = this.context;
        if ("CUBE" == e.variant ? (r.bindFramebuffer(r.READ_FRAMEBUFFER, e._glMSFrameBuffers[n]), r.bindFramebuffer(r.DRAW_FRAMEBUFFER, e._glFrameBuffers[n])) : (r.bindFramebuffer(r.READ_FRAMEBUFFER, e._glMSFrameBuffers[0]), r.bindFramebuffer(r.DRAW_FRAMEBUFFER, e._glFrameBuffers[0])), e.colorBuffer) {
            if (t > -1) {
                for (var i = new Array(t + 1), o = 0; o < t; o++) i[o] = r.NONE;
                i[t] = r.COLOR_ATTACHMENT0 + t, r.readBuffer(r.COLOR_ATTACHMENT0), r.drawBuffers(i)
            }
            r.clearBufferfv(r.COLOR, 0, [0, 0, 0, 1]), r.blitFramebuffer(0, 0, e.width, e.height, 0, 0, e.width, e.height, r.COLOR_BUFFER_BIT, r.NEAREST)
        } else {
            var a = 0,
                s = null;
            e.depthBuffer && (a = r.DEPTH_BUFFER_BIT, s = r.DEPTH), e.stencilBuffer && (a |= r.STENCIL_BUFFER_BIT, s = null == s ? r.STENCIL : r.DEPTH_STENCIL), r.clearBufferfv(s, 0, [0, 0, 0, 1]), r.blitFramebuffer(0, 0, e.width, e.height, 0, 0, e.width, e.height, a, r.NEAREST)
        }
    }, o.prototype._override = function(e, t, n) {
        n.empty();
        for (var r = Object.keys(n), i = 0, o = r.length; i < o; i++) {
            var a = r[i],
                s = n[a],
                u = e[a],
                l = t[a];
            if (s instanceof Object && "shader" !== a) {
                for (var f = Object.keys(u), c = 0, d = f.length; c < d; c++) {
                    var h = f[c];
                    s[h] = u[h]
                }
                f = Object.keys(l);
                for (var p = 0, m = f.length; p < m; p++) {
                    var y = f[p];
                    void 0 === s[y] && (s[y] = l[y])
                }
            } else n[a] = void 0 !== u ? u : l
        }
    }, o.prototype.renderMesh = function(e) {
        var t = e.meshData;
        if (!(!t || null === t.vertexData || null !== t.vertexData && 0 === t.vertexData.data.byteLength || null !== t.indexData && 0 === t.indexData.data.byteLength)) {
            var n = e.materials,
                r = t,
                i = 0;
            i = 0 === this._overrideMaterials.length ? n.length : this._overrideMaterials.length;
            for (var o = 0; o < i; o++) this.renderMeshMaterial(o, n, null, r, e)
        }
    }, o.prototype.renderMeshInstanced = function(e) {
        var t = e.meshData;
        if (!(!t || null === t.vertexData || null !== t.vertexData && 0 === t.vertexData.data.byteLength || null !== t.indexData && 0 === t.indexData.data.byteLength)) {
            var n = e.materials;
            n.shader.updateProcessors(e), this.findOrCacheMaterialShader(n, e), n.shader.apply(e, this), this.updateBuffers(n, t, e), this.updateDepthTest(n), this.updateCulling(n), this.updateBlending(n), this.updateOffset(n), this.updateTextures(n), this.updateLineAndPointSettings(n), this._checkDualTransparency(n, t), this.updateCulling(n);
            var r = e.currentInstanceCount;
            this._drawBuffersInstanced(t, r), this.bindVertexArray(null), this.info.calls++, this.info.vertices += t.vertexCount * r, this.info.indices += t.indexCount * r
        }
    }, o.prototype.callShaderProcessors = function(e, t) {
        e.shader.updateProcessors(t), this.findOrCacheMaterialShader(e, t)
    }, o.prototype.createVertexArray = function() {
        return u.default.VertexArrayObject ? u.default.VertexArrayObject.createVertexArrayOES() : this.context.createVertexArray()
    }, o.prototype.bindVertexArray = function(e) {
        u.default.VertexArrayObject ? u.default.VertexArrayObject.bindVertexArrayOES(e) : this.context.bindVertexArray(e)
    }, o.prototype.updateBuffers = function(e, t, n) {
        this.createBufferDataIfNeeded(t.vertexData), null !== t.getIndexBuffer() && this.createBufferDataIfNeeded(t.getIndexData()), this.updateData(t.vertexData), null !== t.getIndexBuffer() && this.updateData(t.getIndexData()), t._attributeDataNeedsRefresh && (this.bindData(t.vertexData), t._dirtyAttributeNames.forEach(function(e) {
            this.updateAttributeData(t.dataViews[e], t.attributeMap[e].offset)
        }, this), t._attributeDataNeedsRefresh = !1, t._dirtyAttributeNames.clear());
        var r = e.shader,
            i = r._id,
            o = t.glVAO[i];
        void 0 == o ? (o = this.createVertexArray(), t.glVAO[i] = o, this.bindVertexArray(o), this.bindData(t.vertexData), null !== t.getIndexBuffer() && this.bindData(t.getIndexData()), r.bindAttributes(this, t.attributeMap), r.bInstancedShader && !u.default.Webgl2 && r.bindAttributeArrays(this.context, n)) : (this.bindVertexArray(o), r.bInstancedShader && !u.default.Webgl2 && r.bindAttributeArrays(this.context, n))
    }, o.prototype.renderMeshMaterial = function(e, t, n, r, i) {
        var o = null,
            a = null;
        e < t.length && (o = t[e]), e < this._overrideMaterials.length && (a = this._overrideMaterials[e]), o = this.configureRenderInfo(i, e, o, a, r, n);
        var s = i.meshData;
        this.callShaderProcessors(o, i), o.shader.apply(i, this), this.updateBuffers(o, s), this.updateDepthTest(o), this.updateCulling(o), this.updateBlending(o), this.updateOffset(o), this.updateTextures(o), this.updateLineAndPointSettings(o), this._checkDualTransparency(o, s), this.updateCulling(o), this._drawBuffers(s), this.bindVertexArray(null), this.info.calls++, this.info.vertices += s.vertexCount, this.info.indices += s.indexCount
    }, o.prototype._drawBuffers = function(e) {
        null !== e.getIndexBuffer() ? null !== e.getIndexLengths() ? this.drawElementsVBO(e.getIndexBuffer(), e.getIndexModes(), e.getIndexLengths()) : this.drawElementsVBO(e.getIndexBuffer(), e.getIndexModes(), [e.getIndexBuffer().length]) : null !== e.getIndexLengths() ? this.drawArraysVBO(e.getIndexModes(), e.getIndexLengths()) : this.drawArraysVBO(e.getIndexModes(), [e.vertexCount])
    }, o.prototype._drawBuffersInstanced = function(e, t) {
        null !== e.getIndexBuffer() ? null !== e.getIndexLengths() ? this.drawElementsVBOInstanced(e.getIndexBuffer(), e.getIndexModes(), e.getIndexLengths(), t) : this.drawElementsVBOInstanced(e.getIndexBuffer(), e.getIndexModes(), [e.getIndexBuffer().length], t) : null !== e.getIndexLengths() ? this.drawArraysVBOInstanced(e.getIndexModes(), e.getIndexLengths(), t) : this.drawArraysVBOInstanced(e.getIndexModes(), [e.vertexCount], t)
    }, o.prototype.configureRenderInfo = function(e, t, n, r, i, o) {
        var a = e.meshData;
        return t < this._overrideMaterials.length && (r = this._overrideMaterials[t]), n && r && !0 !== r.fullOverride ? (this._override(r, n, this._mergedMaterial), n = this._mergedMaterial) : r && (n = r), n.shader ? (n.errorOnce = !1, n.wireframe && "wire" !== o ? (a.wireframeData || (a.wireframeData = a.buildWireframeData()), a = a.wireframeData, o = "wire") : n.flat && "flat" !== o ? (a.flatMeshData || (a.flatMeshData = a.buildFlatMeshData()), a = a.flatMeshData, o = "flat") : n.wireframe || n.flat || null === o || (a = i, o = null), e.material = n, e.meshData = a, n) : void(n.errorOnce || (console.warn("No shader set on material: " + n.name), n.errorOnce = !0))
    }, o.prototype.findOrCacheMaterialShader = function(e, t) {
        var n = e.shader,
            r = this.rendererRecord.shaderCache;
        n.endFrame();
        var i = n.getDefineKey(this._definesIndices),
            o = r.get(i);
        if (o !== e.shader)
            if (o) {
                if (o.defines = {}, e.shader.defines) {
                    for (var a = Object.keys(e.shader.defines), s = 0, u = a.length; s < u; s++) {
                        var l = a[s];
                        o.defines[l] = e.shader.defines[l]
                    }
                    o.defineKey = e.shader.defineKey
                }
                for (var f = e.shader.uniforms, c = Object.keys(f), d = 0, h = c.length; d < h; d++) {
                    var p = c[d],
                        m = o.uniforms[p] = f[p];
                    m instanceof Array && (o.uniforms[p] = m.slice(0))
                }
                e.shader = o
            } else n.builder && n.builder(n, t), n = n.clone(), r.set(i, n), e.shader = n
    }, o.prototype._checkDualTransparency = function(e, t) {
        if (e.dualTransparency) {
            var n = e.cullState.cullFace,
                r = "Front" === n ? "Back" : "Front";
            e.cullState.cullFace = r, this.updateCulling(e), this._drawBuffers(t), e.cullState.cullFace = n
        }
    }, o.prototype.readPixels = function(e, t, n, r, i) {
        i = i || new Uint8Array(n * r * 4);
        var o = this.context;
        return o.readPixels(e, t, n, r, o.RGBA, o.UNSIGNED_BYTE, i), i
    }, o.prototype.readTexturePixels = function(e, t, n, r, i, o) {
        o = o || new Uint8Array(r * i * 4);
        var a = this.context,
            s = a.createFramebuffer();
        return a.bindFramebuffer(a.FRAMEBUFFER, s), a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_2D, e.glTexture, 0), a.checkFramebufferStatus(a.FRAMEBUFFER) === a.FRAMEBUFFER_COMPLETE && a.readPixels(t, n, r, i, a.RGBA, a.UNSIGNED_BYTE, o), o
    }, o.prototype.drawElementsVBO = function(e, t, n) {
        for (var r = 0, i = 0, o = e.type = e.type || d.default.getGLArrayType(this.context, e), a = d.default.getGLByteSize(e), s = 0; s < n.length; s++) {
            var u = n[s],
                l = d.default.getGLIndexMode(this.context, t[i]);
            this.context.drawElements(l, u, o, r * a), r += u, i < t.length - 1 && i++
        }
    }, o.prototype.drawElementsVBOInstanced = function(e, t, n, r) {
        for (var i = 0, o = 0, a = e.type = e.type || d.default.getGLArrayType(this.context, e), s = d.default.getGLByteSize(e), l = 0; l < n.length; l++) {
            var f = n[l],
                c = d.default.getGLIndexMode(this.context, t[o]);
            u.default.Webgl2 ? this.context.drawElementsInstanced(c, f, a, i * s, r) : u.default.InstancedArrays.drawElementsInstancedANGLE(c, f, a, i * s, r), i += f, o < t.length - 1 && o++
        }
    }, o.prototype.drawArraysVBO = function(e, t) {
        for (var n = 0, r = 0, i = 0; i < t.length; i++) {
            var o = Math.max(1, t[i]),
                a = d.default.getGLIndexMode(this.context, e[r]);
            this.context.drawArrays(a, n, o), n += o, r < e.length - 1 && r++
        }
    }, o.prototype.drawArraysVBOInstanced = function(e, t, n) {
        for (var r = 0, i = 0, o = 0; o < t.length; o++) {
            var a = t[o],
                s = d.default.getGLIndexMode(this.context, e[i]);
            u.default.Webgl2 ? this.context.drawArraysInstanced(s, r, a, n) : u.default.InstancedArrays.drawArraysInstancedANGLE(s, r, a, n), r += a, i < e.length - 1 && i++
        }
    }, o.prototype.renderPanoramaToCube = function(e, t, n) {
        var r = Math.floor(e.image.width / 4),
            i = n || new y.default(r, r, {
                format: "RGBA",
                type: u.default.Webgl2 ? "Float" : "UnsignedByte",
                minFilter: "Trilinear",
                depthBuffer: !1,
                stencilBuffer: !1,
                readDepthStencilBuffer: !1,
                readColorBuffer: !0,
                generateMipmaps: !0,
                variant: "CUBE"
            }),
            o = new Shader("PanoToCube", ObjectUtils.clone(T.default.PanoToCube));
        t && o.setDefine("RGBE", !0);
        var a = new E.default(o.getShaderDefinition()),
            s = sumerianRunner.world.createEntity(FullscreenUtils.quad, a, [0, 0, 0]),
            l = J;
        l.reset(), l.renderer = this, l.fill(s);
        for (var f = 0; f < b.default.CUBE_FACES.length; f++) a.setTexture(Shader.DIFFUSE_MAP, e), a.uniforms.faceIdx = f, this.setRenderTarget(i, f), this.renderMesh(l);
        return this.updateRenderTargetMipmap(i), i
    }, o.prototype.computeIrradianceMap = function(e, t, n) {
        var r = n || new y.default(t, t, {
                format: "RGBA",
                type: u.default.Webgl2 ? "Float" : "UnsignedByte",
                depthBuffer: !1,
                stencilBuffer: !1,
                readDepthStencilBuffer: !1,
                readColorBuffer: !0,
                variant: "CUBE"
            }),
            i = new E.default(T.default.IrradianceConvolution),
            o = sumerianRunner.world.createEntity(FullscreenUtils.quad, i, [0, 0, 0]),
            a = J;
        a.reset(), a.renderer = this, a.fill(o);
        for (var s = 0; s < b.default.CUBE_FACES.length; s++) i.setTexture(Shader.DIFFUSE_MAP, e), i.uniforms.faceIdx = s, this.setRenderTarget(r, s), this.renderMesh(a);
        return r
    }, o.prototype.computeSpecularMap = function(e, t, n, r) {
        var i = new E.default(T.default.SpecularConvolution);
        void 0 == r && (r = 0), i.shader.setDefine("PBR_MODEL", r);
        var o = sumerianRunner.world.createEntity(FullscreenUtils.quad, i, [0, 0, 0]),
            a = J;
        a.reset(), a.renderer = this, a.fill(o);
        var s = n || new y.default(t, t, {
            format: "RGBA",
            type: u.default.Webgl2 ? "Float" : "UnsignedByte",
            minFilter: "Trilinear",
            depthBuffer: !1,
            stencilBuffer: !1,
            readDepthStencilBuffer: !1,
            readColorBuffer: !0,
            generateMipmaps: !0,
            variant: "CUBE"
        });
        this.setRenderTarget(s, 0);
        for (var l = 0; l < 5; l++)
            for (var f = Math.floor(t * Math.pow(.5, l)), c = new y.default(f, f, {
                    format: "RGBA",
                    type: u.default.Webgl2 ? "Float" : "UnsignedByte",
                    minFilter: "BilinearNoMipMaps",
                    depthBuffer: !1,
                    stencilBuffer: !1,
                    readDepthStencilBuffer: !1,
                    readColorBuffer: !0,
                    variant: "CUBE"
                }), h = l / 4, p = 0; p < b.default.CUBE_FACES.length; p++) i.setTexture(Shader.DIFFUSE_MAP, e), i.uniforms.faceIdx = p, i.uniforms.roughness = h, i.uniforms.sourceResolution = e.width, this.setRenderTarget(c, p), this.renderMesh(a), this.context.bindTexture(this.context.TEXTURE_CUBE_MAP, s.glTexture), this.context.copyTexImage2D(d.default.getGLCubeMapFace(this.context, b.default.CUBE_FACES[p]), l, u.default.Webgl2 ? this.context.RGBA32F : this.context.RGBA, 0, 0, f, f, 0), this.context.bindTexture(this.context.TEXTURE_CUBE_MAP, null);
        return s
    }, o.prototype.computeBRDFIntegrationMap = function(e) {
        var t = new y.default(e, e, {
                format: "RGBA",
                type: u.default.Webgl2 ? "Float" : "UnsignedByte",
                depthBuffer: !1,
                stencilBuffer: !1,
                readDepthStencilBuffer: !1,
                readColorBuffer: !0
            }),
            n = new E.default(T.default.BRDFIntegration),
            r = sumerianRunner.world.createEntity(FullscreenUtils.quad, n, [0, 0, 0]);
        this.setRenderTarget(t, 0);
        var i = J;
        return i.reset(), i.mainCamera = o.mainCamera, i.renderer = this, i.fill(r), this.renderMesh(i), t
    }, o.prototype.combineTextures = function(e, t, n, r, i, a, s, u) {
        for (var l = Math.max(e.image.width, n.image.width, i ? i.image.width : 0, s ? s.image.width : 0), f = new y.default(l, l, {
                wrapS: "Repeat",
                wrapT: "Repeat",
                minFilter: "Trilinear",
                format: "RGBA",
                depthBuffer: !1,
                stencilBuffer: !1,
                readDepthStencilBuffer: !1,
                readColorBuffer: !0,
                generateMipmaps: !0
            }), c = 0, d = "", h = [t, r, a, u], p = 0; p < h.length; p++)
            if (h[p]) switch (c += h[p], h[p]) {
                case 1:
                    d = d.concat("R_");
                    break;
                case 2:
                    d = d.concat("RG_");
                    break;
                case 3:
                    d = d.concat("RGB_")
            }
        c > 4 && console.error("Trying to combine more than 4 channels into one texture.");
        var m = new E.default(T.default.CombineTextures);
        m.shader.setDefine(d, !0), m.setTexture("TEXTURE_A", e), m.setTexture("TEXTURE_B", n), i && m.setTexture("TEXTURE_C", i), s && m.setTexture("TEXTURE_D", s);
        var v = sumerianRunner.world.createEntity(FullscreenUtils.quad, m, [0, 0, 0]);
        this.setRenderTarget(f, 0);
        var _ = J;
        return _.reset(), _.mainCamera = o.mainCamera, _.renderer = this, _.fill(v), this.renderMesh(_), this.updateRenderTargetMipmap(f), f
    }, o.prototype.renderToPick = function(e, t, n, r, i, o, a, s, u) {
        if (this.viewportWidth * this.viewportHeight != 0) {
            if (null === this.hardwarePicking) {
                var l = E.default.createEmptyMaterial(T.default.pickingShader, "pickingMaterial");
                l.blendState = {
                    blending: "NoBlending",
                    blendEquation: "AddEquation",
                    blendSrc: "SrcAlphaFactor",
                    blendDst: "OneMinusSrcAlphaFactor"
                }, l.wireframe = !1, this.hardwarePicking = {
                    pickingTarget: new y.default(this.viewportWidth / 4, this.viewportHeight / 4, {
                        minFilter: "NearestNeighborNoMipMaps",
                        magFilter: "NearestNeighbor"
                    }),
                    pickingMaterial: l,
                    pickingBuffer: new Uint8Array(4),
                    clearColorStore: new _.default
                }, r = !1
            } else null === this.hardwarePicking.pickingTarget && (this.hardwarePicking.pickingTarget = new y.default(this.viewportWidth / 4, this.viewportHeight / 4, {
                minFilter: "NearestNeighborNoMipMaps",
                magFilter: "NearestNeighbor"
            }), r = !1);
            if (r) this.setRenderTarget(this.hardwarePicking.pickingTarget);
            else {
                if (this.hardwarePicking.clearColorStore.set(this.clearColor), i && void 0 !== o && void 0 !== a) {
                    var f = this._useDevicePixelRatio && window.devicePixelRatio ? window.devicePixelRatio / this.svg.currentScale : 1,
                        c = Math.floor((o * f - this.viewportX) / 4),
                        d = Math.floor((this.viewportHeight - (a * f - this.viewportY)) / 4);
                    this.context.enable(this.context.SCISSOR_TEST), this.context.scissor(c, d, 1, 1)
                }
                for (var h = [], p = 0, m = e.length; p < m; p++) {
                    var v = e[p];
                    v.meshRendererComponent && !v.meshRendererComponent.isPickable || h.push(v)
                }
                u ? this.render(h, null, t, [], this.hardwarePicking.pickingTarget, n) : this.render(h, null, t, [], this.hardwarePicking.pickingTarget, n, s || this.hardwarePicking.pickingMaterial), i && this.context.disable(this.context.SCISSOR_TEST)
            }
        }
    }, o.prototype.pick = function(e, t, n, r) {
        if (this.viewportWidth * this.viewportHeight == 0) return n.id = -1, void(n.depth = 0);
        var i = this._useDevicePixelRatio && window.devicePixelRatio ? window.devicePixelRatio / this.svg.currentScale : 1,
            o = Math.floor((e * i - this.viewportX) / 4),
            a = Math.floor((this.viewportHeight - (t * i - this.viewportY)) / 4);
        this.readPixels(o, a, 1, 1, this.hardwarePicking.pickingBuffer);
        var s = 255 * this.hardwarePicking.pickingBuffer[0] + this.hardwarePicking.pickingBuffer[1] - 1,
            u = (this.hardwarePicking.pickingBuffer[2] / 255 + this.hardwarePicking.pickingBuffer[3] / 65025) * r.far;
        n.id = s, n.depth = u
    }, o.prototype.updateLineAndPointSettings = function(e) {
        var t = this.rendererRecord.lineRecord,
            n = e.lineWidth || 1;
        t.lineWidth !== n && (this.context.lineWidth(n), t.lineWidth = n)
    }, o.prototype.updateDepthTest = function(e) {
        var t = this.rendererRecord.depthRecord,
            n = e.depthState,
            r = e.blendState.blending;
        t.enabled !== n.enabled && (n.enabled ? this.context.enable(this.context.DEPTH_TEST) : this.context.disable(this.context.DEPTH_TEST), t.enabled = n.enabled), t.write !== n.write && (n.write ? this.context.depthMask(!0) : this.context.depthMask(!1), t.write = n.write), "NoBlending" != r && (this.context.depthMask(!1), t.write = !1), t.depthFunc !== n.depthFunc && (this.context.depthFunc(d.default.getGLDepthFunc(this.context, n.depthFunc)), t.depthFunc = n.depthFunc)
    }, o.prototype.updateCulling = function(e) {
        var t = this.rendererRecord.cullRecord,
            n = e.cullState.cullFace,
            r = e.cullState.frontFace,
            i = e.cullState.enabled;
        if (t.enabled !== i && (i ? this.context.enable(this.context.CULL_FACE) : this.context.disable(this.context.CULL_FACE), t.enabled = i), t.cullFace !== n) {
            var o = "Front" === n ? this.context.FRONT : "Back" === n ? this.context.BACK : this.context.FRONT_AND_BACK;
            this.context.cullFace(o), t.cullFace = n
        }
        if (t.frontFace !== r) {
            switch (r) {
                case "CCW":
                    this.context.frontFace(this.context.CCW);
                    break;
                case "CW":
                    this.context.frontFace(this.context.CW)
            }
            t.frontFace = r
        }
    }, o.prototype.updateTextures = function(e) {
        for (var t = this.context, n = e.shader.textureSlots, r = 0; r < n.length; r++) {
            var i = n[r],
                o = e.getTexture(i.mapping),
                a = e.getSampler(i.mapping),
                s = !0;
            void 0 === o && ("sampler2D" === i.format ? o = p.default.DEFAULT_TEXTURE_2D : "samplerCube" === i.format ? o = p.default.DEFAULT_TEXTURE_CUBE : "sampler2DArray" === i.format ? o = p.default.DEFAULT_TEXTURE_2DArray : "sampler3D" === i.format && (o = p.default.DEFAULT_TEXTURE_3D));
            var u = o;
            o instanceof Array == !1 && (u = [o]);
            var l = a;
            !1 !== Array.isArray(l) && void 0 !== l || (void 0 === a ? (s = !1, l = []) : l = [a]);
            for (var f = 0; f < u.length; f++) {
                o = u[f];
                var c = i.index instanceof Array ? i.index[f] : i.index;
                (null === o || o instanceof y.default && null === o.glTexture || o instanceof y.default == !1 && (void 0 === o.image || !1 === o.checkDataReady())) && ("sampler2D" === i.format ? o = p.default.DEFAULT_TEXTURE_2D : "samplerCube" === i.format ? o = p.default.DEFAULT_TEXTURE_CUBE : "sampler2DArray" === i.format ? o = p.default.DEFAULT_TEXTURE_2DArray : "sampler3D" === i.format && (o = p.default.DEFAULT_TEXTURE_3D));
                var h = void 0;
                if (s) {
                    h = l[f < l.length ? f : l.length - 1], h && (h.minFilter = d.default.getSamplerFilterFallBack(h.minFilter))
                }
                var m = this.rendererRecord.textureRecord[c];
                void 0 === m && (m = this.rendererRecord.textureRecord[c] = {}), null === o.glTexture ? (o.glTexture = t.createTexture(), this.updateTexture(t, o, c, m, h), o.needsUpdate = !1) : o instanceof y.default == !1 && o.checkNeedsUpdate() ? (this.updateTexture(t, o, c, m, h), o.needsUpdate = !1) : this.bindTexture(t, o, c, m, h);
                var v = void 0 !== o.image ? o.image : o,
                    _ = G.default.isPowerOfTwo(v.width) && G.default.isPowerOfTwo(v.height);
                this.updateTextureParameters(o, _)
            }
        }
    }, o.prototype.updateTextureParameters = function(e, t) {
        var n = this.context,
            r = e.textureRecord,
            i = d.default.getGLType(n, e.variant),
            o = d.default.getTextureFilterFallBack(e.magFilter, t);
        r.magFilter !== o && (n.texParameteri(i, n.TEXTURE_MAG_FILTER, d.default.getGLMagFilter(n, o)), r.magFilter = o);
        var a = d.default.getTextureFilterFallBack(e.minFilter, t);
        r.minFilter !== a && (n.texParameteri(i, n.TEXTURE_MIN_FILTER, d.default.getGLMinFilter(n, a)), r.minFilter = a);
        var s = d.default.getTextureWrapFallBack(e.wrapS, t);
        if (r.wrapS !== s) {
            var l = d.default.getGLWrap(n, s);
            n.texParameteri(i, n.TEXTURE_WRAP_S, l), r.wrapS = s
        }
        var f = d.default.getTextureWrapFallBack(e.wrapT, t);
        if (r.wrapT !== f) {
            var c = d.default.getGLWrap(n, f);
            n.texParameteri(i, n.TEXTURE_WRAP_T, c), r.wrapT = f
        }
        if (u.default.Webgl2) {
            var h = d.default.getTextureWrapFallBack(e.wrapR, t);
            if (r.wrapR !== h) {
                var p = d.default.getGLWrap(n, h);
                n.texParameteri(i, n.TEXTURE_WRAP_R, p), r.wrapR = h
            }
        }
        if (u.default.TextureFilterAnisotropic && "Float" !== e.type) {
            var m = e.anisotropy;
            r.anisotropy !== m && (n.texParameterf(i, u.default.TextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(m, u.default.maxAnisotropy)), r.anisotropy = m)
        }
    }, o.prototype.getSamplerObject = function(e) {
        if (!u.default.Webgl2) return null;
        for (var t = this.context, n = 0; n < this.samplerObjects.length; n++)
            if (this.samplerObjects[n].compareTo(e)) return this.samplerObjects[n].glSampler;
        if (void 0 !== e) {
            var r = e.clone();
            return r.glSampler = t.createSampler(), r.initialize(t), this.samplerObjects.push(r), r.glSampler
        }
        return null
    }, o.prototype.bindTexture = function(e, t, n, r, i) {
        if ((void 0 === r.boundTexture || void 0 !== t.glTexture && r.boundTexture !== t.glTexture) && (e.activeTexture(e.TEXTURE0 + n), e.bindTexture(d.default.getGLType(e, t.variant), t.glTexture), r.boundTexture = t.glTexture, u.default.Webgl2))
            if (i) {
                var o = void 0;
                i.glSampler ? o = i.glSampler : (o = this.getSamplerObject(i), i.glSampler = o), void 0 != o && e.bindSampler(n, o), this.rendererRecord.maxBoundSamplerUnit = Math.max(n, this.rendererRecord.maxBoundSamplerUnit)
            } else e.bindSampler(n, null)
    }, o.prototype.unbindTexture = function(e, t, n, r) {
        e.activeTexture(e.TEXTURE0 + n), e.bindTexture(d.default.getGLType(e, t.variant), null), e.bindSampler(n, null), r.boundTexture = void 0
    }, o.prototype.loadCompressedTexture = function(e, t, n, r) {
        if (void 0 != n.image) {
            var i = n.image.mipmapSizes,
                o = 0,
                a = 0,
                s = n.image.width,
                l = n.image.height,
                f = u.default.CompressedTextureS3TC,
                c = u.default.CompressedTexturePVRTC,
                d = u.default.CompressedTextureETC;
            if (!f && !c && !d) return n.image = void 0, n.needsUpdate = !0, void console.warn("No compressed texture extension available");
            var h = !1,
                p = !1,
                m = !1,
                y = null;
            if (f && ("PrecompressedDXT1" === n.format ? (y = f.COMPRESSED_RGB_S3TC_DXT1_EXT, p = !0) : "PrecompressedDXT1A" === n.format ? (y = f.COMPRESSED_RGBA_S3TC_DXT1_EXT, p = !0) : "PrecompressedDXT3" === n.format ? (y = f.COMPRESSED_RGBA_S3TC_DXT3_EXT, p = !0) : "PrecompressedDXT5" === n.format && (y = f.COMPRESSED_RGBA_S3TC_DXT5_EXT, p = !0)), c && null == y && ("PVR_2BPP_RGB" === n.format ? (y = c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG, h = !0) : "PVR_2BPP_RGBA" === n.format ? (y = c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG, h = !0) : "PVR_4BPP_RGB" === n.format ? (y = c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG, h = !0) : "PVR_4BPP_RGBA" === n.format && (y = c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG, h = !0)), d && null == y && ("KTX_UR11_EAC" === n.format ? (y = d.COMPRESSED_R11_EAC, m = !0) : "KTX_R11_EAC" === n.format ? (y = d.COMPRESSED_SIGNED_R11_EAC, m = !0) : "KTX_URG11_EAC" === n.format ? (y = d.COMPRESSED_RG11_EAC, m = !0) : "KTX_RG11_EAC" === n.format ? (y = d.COMPRESSED_SIGNED_RG11_EAC, m = !0) : "KTX_URGB8_ETC2" === n.format ? (y = d.COMPRESSED_RGB8_ETC2, m = !0) : "KTX_SRGB8_ETC2" === n.format ? (y = d.COMPRESSED_SRGB8_ETC2, m = !0) : "KTX_RGB8A1_ETC2" === n.format ? (y = d.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2, m = !0) : "KTX_SRGB8A1_ETC2" === n.format ? (y = d.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2, m = !0) : "KTX_RGBA8_ETC2_EAC" === n.format ? (y = d.COMPRESSED_RGBA8_ETC2_EAC, m = !0) : "KTX_SRGBA8_ETC2_EAC" === n.format && (y = d.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC, m = !0)), null == y || !p && !c && !m) return n.image = void 0, n.needsUpdate = !0, void console.warn("Tried to load unsupported compressed texture.");
            if (void 0 === i || null === i) r instanceof Uint8Array ? e.compressedTexImage2D(t, 0, y, s, l, 0, r) : e.compressedTexImage2D(t, 0, y, s, l, 0, new Uint8Array(r.buffer, r.byteOffset, r.byteLength));
            else {
                if (n.generateMipmaps = !1, r instanceof Array)
                    for (var v = 0; v < r.length; v++) e.compressedTexImage2D(t, v, y, s, l, 0, r[v]),
                        //! SH: REVIEW: this operation is being done many times, not very DRY; also Math.floor is practically as fast as ~~, does the same thing, and is more readable. http://jsperf.com/jsfvsbitnot/15
                        s = ~~(s / 2) > 1 ? ~~(s / 2) : 1, l = ~~(l / 2) > 1 ? ~~(l / 2) : 1;
                else
                    for (var _ = 0; _ < i.length; _++) a = i[_], e.compressedTexImage2D(t, _, y, s, l, 0, new Uint8Array(r.buffer, r.byteOffset + o, a)), s = ~~(s / 2) > 1 ? ~~(s / 2) : 1, l = ~~(l / 2) > 1 ? ~~(l / 2) : 1, o += a;
                var g = 1 + Math.ceil(Math.log(Math.max(n.image.height, n.image.width)) / Math.log(2)),
                    b = i[i.length - 1];
                if (i.length < g)
                    for (var x = i.length; x < g; x++) p ? (b = ~~((s + 3) / 4) * ~~((l + 3) / 4) * n.image.bpp * 2, e.compressedTexImage2D(t, x, y, s, l, 0, new Uint8Array(b)), s = ~~(s / 2) > 1 ? ~~(s / 2) : 1, l = ~~(l / 2) > 1 ? ~~(l / 2) : 1) : h ? (b = 4 == n.image.bpp ? Math.floor((Math.max(s, 8) * Math.max(l, 8) * 4 + 7) / 8) : Math.floor((Math.max(s, 16) * Math.max(l, 8) * 2 + 7) / 8), e.compressedTexImage2D(t, x, y, s, l, 0, new Uint8Array(b)), s = ~~(s / 2) > 1 ? ~~(s / 2) : 1, l = ~~(l / 2) > 1 ? ~~(l / 2) : 1) : m && (b = 4 == n.image.bpp ? Math.floor((s + 3) / 4) * Math.floor((l + 3) / 4) * 8 : Math.floor((s + 3) / 4) * Math.floor((l + 3) / 4) * 16, e.compressedTexImage2D(t, x, y, s, l, 0, new Uint8Array(b)), s = ~~(s / 2) > 1 ? ~~(s / 2) : 1, l = ~~(l / 2) > 1 ? ~~(l / 2) : 1)
            }
        }
    }, o.prototype.updateTexture = function(e, t, n, r, i) {
        this.bindTexture(e, t, n, r, i), e.pixelStorei(e.UNPACK_ALIGNMENT, t.unpackAlignment), e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, t.premultiplyAlpha), e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL, t.flipY);
        var o = t.image;
        if ("2D" === t.variant) o ? (o instanceof HTMLVideoElement || o.isCompressed || !(!u.default.Webgl2 && (t.generateMipmaps || "EdgeClamp" !== t.wrapS || "EdgeClamp" !== t.wrapT) || o.width > this.maxTextureSize || o.height > this.maxTextureSize) || (this.checkRescale(t, o, o.width, o.height, this.maxTextureSize), o = t.image), !0 === o.isData ? o.isCompressed ? this.loadCompressedTexture(e, e.TEXTURE_2D, t, o.data) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), o.width, o.height, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), o.data) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), o), t.generateMipmaps && !o.isCompressed && e.generateMipmap(e.TEXTURE_2D)) : e.texImage2D(e.TEXTURE_2D, 0, d.default.getGLInternalFormat(e, t.format), t.width, t.height, 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null);
        else if ("CUBE" === t.variant) {
            if (o && !o.isData && (t.generateMipmaps || o.width > this.maxCubemapSize || o.height > this.maxCubemapSize)) {
                for (var a = 0; a < b.default.CUBE_FACES.length; a++) o.data[a] && !o.data[a].buffer ? d.default.scaleImage(t, o.data[a], o.width, o.height, this.maxCubemapSize, a) : d.default.getBlankImage(t, [.3, .3, .3, 0], o.width, o.height, this.maxCubemapSize, a);
                t.image.width = Math.min(this.maxCubemapSize, G.default.nearestPowerOfTwo(t.image.width)), t.image.height = Math.min(this.maxCubemapSize, G.default.nearestPowerOfTwo(t.image.height)), o = t.image
            }
            for (var s = 0; s < b.default.CUBE_FACES.length; s++) {
                var l = b.default.CUBE_FACES[s];
                o ? !0 === o.isData ? o.isCompressed ? this.loadCompressedTexture(e, d.default.getGLCubeMapFace(e, l), t, o.data[s]) : e.texImage2D(d.default.getGLCubeMapFace(e, l), 0, d.default.getGLInternalFormat(e, t.format), o.width, o.height, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), o.data[s]) : e.texImage2D(d.default.getGLCubeMapFace(e, l), 0, d.default.getGLInternalFormat(e, t.format), d.default.getGLInternalFormat(e, t.format), d.default.getGLDataType(e, t.type), o.data[s]) : e.texImage2D(d.default.getGLCubeMapFace(e, l), 0, d.default.getGLInternalFormat(e, t.format), t.width, t.height, 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null)
            }
            o && t.generateMipmaps && !o.isCompressed && e.generateMipmap(e.TEXTURE_CUBE_MAP)
        } else if ("2DArray" === t.variant || "3D" === t.variant) {
            if (!u.default.Webgl2) return void console.warn("Texture Arrays / 3D textures are supported only on WebGL2 platform.");
            var f = "2DArray" === t.variant ? e.TEXTURE_2D_ARRAY : e.TEXTURE_3D;
            o ? !0 === o.isData ? e.texImage3D(f, 0, d.default.getGLInternalFormat3D(e, t.format), o.width, o.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), o.data) : e.texImage3D(f, 0, d.default.getGLInternalFormat3D(e, t.format), t.width, t.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), o.data) : e.texImage3D(f, 0, d.default.getGLInternalFormat3D(e, t.format), t.width, t.height, t.nSlices, t.hasBorder ? 1 : 0, d.default.getGlFormatFromInternal(e, t.format), d.default.getGLDataType(e, t.type), null), o && t.generateMipmaps && !o.isCompressed && e.generateMipmap(f)
        }
    }, o.prototype.checkRescale = function(e, t, n, r, i, o) {
        d.default.scaleImage(e, t, n, r, i, o)
    }, o.prototype.updateBlending = function(e) {
        var t = this.rendererRecord.blendRecord,
            n = this.context,
            r = e.blendState.blending;
        if (r !== t.blending && ("NoBlending" === r ? n.disable(n.BLEND) : "AdditiveBlending" === r ? (n.enable(n.BLEND), n.blendEquation(n.FUNC_ADD), n.blendFunc(n.SRC_ALPHA, n.ONE)) : "SubtractiveBlending" === r ? (n.enable(n.BLEND), n.blendEquation(n.FUNC_REVERSE_SUBTRACT), n.blendFunc(n.SRC_ALPHA, n.ONE)) : "MultiplyBlending" === r ? (n.enable(n.BLEND), n.blendEquation(n.FUNC_ADD), n.blendFunc(n.DST_COLOR, n.ONE_MINUS_SRC_ALPHA)) : "AlphaBlending" === r ? (n.enable(n.BLEND), n.blendEquation(n.FUNC_ADD), n.blendFunc(n.SRC_ALPHA, n.ONE_MINUS_SRC_ALPHA)) : "TransparencyBlending" === r ? (n.enable(n.BLEND), n.blendEquationSeparate(n.FUNC_ADD, n.FUNC_ADD), n.blendFuncSeparate(n.SRC_ALPHA, n.ONE_MINUS_SRC_ALPHA, n.ONE, n.ONE_MINUS_SRC_ALPHA)) : "CustomBlending" === r ? n.enable(n.BLEND) : "SeparateBlending" === r ? (n.enable(n.BLEND), n.blendEquationSeparate(d.default.getGLBlendParam(n, e.blendState.blendEquationColor), d.default.getGLBlendParam(n, e.blendState.blendEquationAlpha)), n.blendFuncSeparate(d.default.getGLBlendParam(n, e.blendState.blendSrcColor), d.default.getGLBlendParam(n, e.blendState.blendDstColor), d.default.getGLBlendParam(n, e.blendState.blendSrcAlpha), d.default.getGLBlendParam(n, e.blendState.blendDstAlpha))) : (n.enable(n.BLEND), n.blendEquationSeparate(n.FUNC_ADD, n.FUNC_ADD), n.blendFuncSeparate(n.SRC_ALPHA, n.ONE_MINUS_SRC_ALPHA, n.ONE, n.ONE_MINUS_SRC_ALPHA)), t.blending = r), "CustomBlending" === r) {
            var i = e.blendState.blendEquation,
                o = e.blendState.blendSrc,
                a = e.blendState.blendDst;
            i !== t.blendEquation && (n.blendEquation(d.default.getGLBlendParam(n, i)), t.blendEquation = i), o === t.blendSrc && a === t.blendDst || (n.blendFunc(d.default.getGLBlendParam(n, o), d.default.getGLBlendParam(n, a)), t.blendSrc = o, t.blendDst = a)
        } else t.blendEquation = null, t.blendSrc = null, t.blendDst = null
    }, o.prototype.updateOffset = function(e) {
        var t = this.rendererRecord.offsetRecord,
            n = this.context,
            r = e.offsetState.enabled,
            i = e.offsetState.factor,
            o = e.offsetState.units;
        t.enabled !== r && (r ? n.enable(n.POLYGON_OFFSET_FILL) : n.disable(n.POLYGON_OFFSET_FILL), t.enabled = r), !r || t.factor === i && t.units === o || (n.polygonOffset(i, o), t.factor = i, t.units = o)
    }, o.prototype.bindBuffer = function(e, t) {
        this.context.bindBuffer(d.default.getGLBufferTarget(this.context, t), e)
    }, o.prototype.bindVertexAttribute = function(e, t) {
        this.context.vertexAttribPointer(e, t.count, d.default.getGLDataType(this.context, t.type), t.normalized, t.stride, t.offset), this.context.enableVertexAttribArray(e)
    }, o.prototype.clear = function(e, t, n) {
        var r = 0;
        (void 0 === e || e) && (r |= this.context.COLOR_BUFFER_BIT), (void 0 === t || t) && (r |= this.context.DEPTH_BUFFER_BIT), (void 0 === n || n) && (r |= this.context.STENCIL_BUFFER_BIT);
        var i = this.rendererRecord.depthRecord;
        !0 !== i.write && (this.context.depthMask(!0), i.write = !0), r && this.context.clear(r)
    }, o.prototype.flush = function() {
        this.context.flush()
    }, o.prototype.finish = function() {
        this.context.finish()
    }, o.prototype.setupFrameBuffer = function(e, t, n, r) {
        var i = this.context;
        i.bindFramebuffer(i.FRAMEBUFFER, e);
        var o = null,
            a = u.default.Webgl2 ? i.getParameter(i.MAX_COLOR_ATTACHMENTS) : u.default.DrawBuffersExtension ? i.getParameter(u.default.DrawBuffersExtension.MAX_COLOR_ATTACHMENTS_WEBGL) : 1,
            s = !0;
        if (!u.default.Webgl2 && !u.default.DrawBuffersExtension && r > 0 && (s = !1, console.warn("WARNING: Multiple render targets are not supported. WEBGL_draw_buffers extension is not available.\nThe shader author should handle this case in the fragment shader (see ShaderLib.simpleColoredMRT).")), t.colorBuffer && t.readColorBuffer) {
            var l = u.default.Webgl2 ? i.COLOR_ATTACHMENT0 : u.default.DrawBuffersExtension ? u.default.DrawBuffersExtension.COLOR_ATTACHMENT0_WEBGL : i.COLOR_ATTACHMENT0;
            o = Number.isInteger(r) && r >= 0 && r <= a && s ? l + r : l
        } else t.depthBuffer && !t.stencilBuffer && t.readDepthStencilBuffer ? o = this.context.DEPTH_ATTACHMENT : !t.depthBuffer && t.stencilBuffer && t.readDepthStencilBuffer ? o = this.context.STENCIL_ATTACHMENT : t.depthBuffer && t.stencilBuffer && t.readDepthStencilBuffer && (o = this.context.DEPTH_STENCIL_ATTACHMENT);
        null != o && (this.context.framebufferTexture2D(this.context.FRAMEBUFFER, o, n, t.glTexture, 0), d.default.checkFrameBufferStatus(i))
    }, o.prototype.setupRenderBuffer = function(e, t) {
        var n = this.context,
            r = null,
            i = null;
        if (!e.depthBuffer || e.stencilBuffer || e.readDepthStencilBuffer && !e.multiSampledRenderBufffer)
            if (e.depthBuffer || !e.stencilBuffer || e.readDepthStencilBuffer && !e.multiSampledRenderBufffer) {
                if (e.depthBuffer && e.stencilBuffer && (!e.readDepthStencilBuffer || e.multiSampledRenderBufffer)) {
                    var o = null;
                    o = u.default.Webgl2 ? 32 == e.depthBits ? n.DEPTH32F_STENCIL8 : n.DEPTH24_STENCIL8 : n.DEPTH_STENCIL, r = o, i = n.DEPTH_STENCIL_ATTACHMENT
                } else if (e.colorBuffer && (!e.readColorBuffer || e.multiSampledRenderBufffer)) {
                    var a = d.default.getGLRenderBufferInternalFormat(n, e.format);
                    r = a, i = n.COLOR_ATTACHMENT0 + t
                }
            } else r = n.STENCIL_INDEX8, i = n.STENCIL_ATTACHMENT;
        else {
            var s = n.DEPTH_COMPONENT16;
            24 == e.depthBits ? s = n.DEPTH_COMPONENT24 : 32 == e.depthBits && (s = n.DEPTH_COMPONENT32F), r = s, i = n.DEPTH_ATTACHMENT
        }
        for (var l = "2D" == e.variant ? 1 : 6, f = 0; f < l; f++) null !== r && null !== i && (e._glRenderBuffers.push(n.createRenderbuffer()), n.bindRenderbuffer(n.RENDERBUFFER, e._glRenderBuffers[f]), e.multiSampledRenderBufffer ? (e.multisamplingSamples < 1 ? e.multisamplingSamples = 1 : e.multisamplingSamples > n.MAX_SAMPLES && (e.multisamplingSamples = n.MAX_SAMPLES), n.renderbufferStorageMultisample(n.RENDERBUFFER, e.multisamplingSamples, r, e.width, e.height), n.bindFramebuffer(n.FRAMEBUFFER, e._glMSFrameBuffers[f]), n.framebufferRenderbuffer(n.FRAMEBUFFER, i, n.RENDERBUFFER, e._glRenderBuffers[f])) : (n.bindFramebuffer(n.FRAMEBUFFER, e._glFrameBuffers[f]), n.renderbufferStorage(n.RENDERBUFFER, r, e.width, e.height), n.framebufferRenderbuffer(n.FRAMEBUFFER, i, n.RENDERBUFFER, e._glRenderBuffers[f])))
    }, o.prototype.setRenderTarget = function(e, t) {
        if (void 0 === t && (t = 0), Array.isArray(e)) return void this.setMultipleRenderTarget(e);
        var n = this.context;
        if (e && 0 == e._glFrameBuffers.length) {
            this.initRenderTarget(e, null, null);
            for (var r = "2D" == e.variant ? 1 : 6, i = 0; i < r; i++) {
                var o = 1 == r ? n.TEXTURE_2D : d.default.getGLCubeMapFace(n, b.default.CUBE_FACES[i]);
                this.setupFrameBuffer(e._glFrameBuffers[i], e, o, 0)
            }
            this.setupRenderBuffer(e, 0);
            var a = G.default.isPowerOfTwo(e.width) && G.default.isPowerOfTwo(e.height);
            e.generateMipmaps && (a || u.default.Webgl2) && this.context.generateMipmap(1 == r ? n.TEXTURE_2D : n.TEXTURE_CUBE_MAP), this.context.bindTexture(1 == r ? n.TEXTURE_2D : n.TEXTURE_CUBE_MAP, null), this.context.bindRenderbuffer(n.RENDERBUFFER, null), this.context.bindFramebuffer(n.FRAMEBUFFER, null)
        }
        var s = void 0,
            l = void 0,
            f = void 0,
            c = void 0,
            h = void 0;
        if (e) {
            s = "CUBE" == e.variant ? e.multiSampledRenderBufffer ? e._glMSFrameBuffers[t] : e._glFrameBuffers[t] : e.multiSampledRenderBufffer ? e._glMSFrameBuffers[0] : e._glFrameBuffers[0], c = 0, h = 0, l = e.width, f = e.height
        } else s = null, c = this.viewportX, h = this.viewportY, l = this.viewportWidth, f = this.viewportHeight;
        s !== this.rendererRecord.currentFrameBuffer && (n.bindFramebuffer(n.FRAMEBUFFER, s), n.viewport(c, h, l, f), this.rendererRecord.currentFrameBuffer = s, this.rendererRecord.textureRecord = []), this.currentWidth = l, this.currentHeight = f
    }, o.prototype.initRenderTarget = function(e, t, n) {
        var r = this.context;
        if (null != e && void 0 != e) {
            if (void 0 === e.depthBuffer && (e.depthBuffer = !0), void 0 === e.stencilBuffer && (e.stencilBuffer = !0), null === e.glTexture && (e.colorBuffer && e.readColorBuffer || (e.depthBuffer || e.stencilBuffer) && e.readDepthStencilBuffer) && (e.glTexture = this.context.createTexture()), !u.default.Webgl2) {
                var i = -1 !== navigator.userAgent.toLowerCase().indexOf("iphone");
                e.multiSampledRenderBufffer && (e.multiSampledRenderBufffer = !1, e.multisamplingSamples = 1, console.warn("WebGL1 doesn't support multi-sampled render buffers. Turning off multi-sampling from render buffers.")), "Float" == e.type && i && (e.type = "HalfFloat")
            }
            for (var o = G.default.isPowerOfTwo(e.width) && G.default.isPowerOfTwo(e.height), a = d.default.getGLInternalFormat(r, e.format), s = d.default.getGLDataType(r, e.type), l = d.default.getGlFormatFromInternal(r, e.format), f = "2D" == e.variant ? 1 : 6, c = 0; c < f; c++) void 0 == t || null == t ? (e._glFrameBuffers.push(this.context.createFramebuffer()), d.default.checkFrameBufferStatus(r)) : (e._glFrameBuffers.push(t[c]), d.default.checkFrameBufferStatus(r)), e.multiSampledRenderBufffer && (n ? (e._glMSFrameBuffers.push(n[c]), d.default.checkFrameBufferStatus(r)) : (e._glMSFrameBuffers.push(this.context.createFramebuffer()), d.default.checkFrameBufferStatus(r)));
            if (null != e.glTexture)
                if (this.context.bindTexture("2D" == e.variant ? r.TEXTURE_2D : r.TEXTURE_CUBE_MAP, e.glTexture), this.updateTextureParameters(e, o), !0 === e.colorBuffer && !0 === e.readColorBuffer)
                    if ("2D" == e.variant) this.context.texImage2D(r.TEXTURE_2D, 0, a, e.width, e.height, 0, l, s, null);
                    else
                        for (var h = 0; h < b.default.CUBE_FACES.length; h++) {
                            var p = b.default.CUBE_FACES[h];
                            this.context.texImage2D(d.default.getGLCubeMapFace(r, p), 0, a, e.width, e.height, 0, l, s, null)
                        } else if (e.readDepthStencilBuffer)
                            if (e.depthBuffer && !e.stencilBuffer) {
                                var m = r.UNSIGNED_SHORT,
                                    y = r.DEPTH_COMPONENT16;
                                if (24 == e.depthBits ? u.default.Webgl2 ? (m = r.UNSIGNED_INT, y = r.DEPTH_COMPONENT24) : y = r.DEPTH_COMPONENT24 : 32 == e.depthBits && (u.default.Webgl2 ? (m = r.FLOAT, y = r.DEPTH_COMPONENT32F) : y = r.DEPTH_COMPONENT), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_MAG_FILTER, r.NEAREST), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_MIN_FILTER, r.NEAREST), "2D" == e.variant) this.context.texImage2D(r.TEXTURE_2D, 0, y, e.width, e.height, 0, r.DEPTH_COMPONENT, m, null);
                                else
                                    for (var v = 0; v < b.default.CUBE_FACES.length; v++) {
                                        var _ = b.default.CUBE_FACES[v];
                                        this.context.texImage2D(d.default.getGLCubeMapFace(r, _), 0, y, e.width, e.height, 0, r.DEPTH_COMPONENT, m, null)
                                    }
                            } else if (e.stencilBuffer) {
                var g = r.DEPTH24_STENCIL8,
                    x = r.UNSIGNED_INT_24_8;
                if (32 == e.depthBits && (g = r.DEPTH32F_STENCIL8, x = r.FLOAT_32_UNSIGNED_INT_24_8_REV), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_MAG_FILTER, r.NEAREST), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_MIN_FILTER, r.NEAREST), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_WRAP_S, r.CLAMP_TO_EDGE), this.context.texParameteri(r.TEXTURE_2D, r.TEXTURE_WRAP_T, r.CLAMP_TO_EDGE), "2D" == e.variant) this.context.texImage2D(r.TEXTURE_2D, 0, g, e.width, e.height, 0, r.DEPTH_STENCIL, x, null);
                else
                    for (var w = 0; w < b.default.CUBE_FACES.length; w++) {
                        var E = b.default.CUBE_FACES[w];
                        this.context.texImage2D(d.default.getGLCubeMapFace(r, E), 0, g, e.width, e.height, 0, r.DEPTH_STENCIL, x, null)
                    }
            }
        }
    }, o.prototype.setMultipleRenderTarget = function(e) {
        var t = this.context;
        if (Array.isArray(e)) {
            for (var n = 0; n < r; n++)
                if ("CUBE" == e[n].variant) return;
            for (var r = e.length, i = 0, n = 0; n < r; n++)
                if (e[n] && 0 == e[n]._glFrameBuffers.length) {
                    var o = 0 == n ? null : e[0]._glFrameBuffers,
                        a = 0 == n ? null : e[0]._glMSFrameBuffers;
                    this.initRenderTarget(e[n], o, a), this.setupFrameBuffer(e[n]._glFrameBuffers[0], e[n], t.TEXTURE_2D, i), this.setupRenderBuffer(e[n], i), 1 == e[n].colorBuffer && e[n].readColorBuffer && (i += 1);
                    var s = G.default.isPowerOfTwo(e[n].width) && G.default.isPowerOfTwo(e[n].height);
                    e[n].generateMipmaps && (s || u.default.Webgl2) && this.context.generateMipmap(t.TEXTURE_2D), this.context.bindTexture(t.TEXTURE_2D, null), this.context.bindRenderbuffer(t.RENDERBUFFER, null), this.context.bindFramebuffer(u.default.Webgl2 ? t.DRAW_FRAMEBUFFER : t.FRAMEBUFFER, null)
                }
            var l = void 0,
                f = void 0,
                c = void 0,
                d = void 0,
                h = void 0;
            if (e.length > 0 && void 0 != e[0] && null != e[0] ? (l = e[0].multiSampledRenderBufffer ? e[0]._glMSFrameBuffers[0] : e[0]._glFrameBuffers[0], d = 0, h = 0, f = e[0].width, c = e[0].height) : (l = null, d = this.viewportX, h = this.viewportY, f = this.viewportWidth, c = this.viewportHeight), l !== this.rendererRecord.currentFrameBuffer) {
                var p = new Array(i);
                this.context.bindFramebuffer(this.context.FRAMEBUFFER, l);
                for (var n = 0; n < i; n++) {
                    if (!(u.default.Webgl2 || u.default.DrawBuffersExtension)) {
                        p[n] = this.context.COLOR_ATTACHMENT0;
                        break
                    }
                    p[n] = (u.default.Webgl2 ? this.context.COLOR_ATTACHMENT0 : u.default.DrawBuffersExtension.COLOR_ATTACHMENT0_WEBGL) + n
                }
                i > 0 && (u.default.Webgl2 ? this.context.drawBuffers(p) : u.default.DrawBuffersExtension && u.default.DrawBuffersExtension.drawBuffersWEBGL(p)), this.context.viewport(d, h, f, c), this.rendererRecord.currentFrameBuffer = l, this.rendererRecord.textureRecord = []
            }
            this.currentWidth = f, this.currentHeight = c
        }
    }, o.prototype.updateRenderTargetMipmap = function(e) {
        var t = this.context;
        "2D" == e.variant ? (t.bindTexture(t.TEXTURE_2D, e.glTexture), t.generateMipmap(t.TEXTURE_2D), t.bindTexture(t.TEXTURE_2D, null)) : (t.bindTexture(t.TEXTURE_CUBE_MAP, e.glTexture), t.generateMipmap(t.TEXTURE_CUBE_MAP), t.bindTexture(t.TEXTURE_CUBE_MAP, null))
    }, o.prototype._deallocateMeshData = function(e) {
        e.destroy(this.context)
    }, o.prototype._deallocateTexture = function(e) {
        e.destroy(this.context)
    }, o.prototype._deallocateRenderTarget = function(e) {
        e.destroy(this.context)
    }, o.prototype._deallocateShader = function(e) {
        e.destroy()
    }, o.prototype._deallocateSampler = function(e) {
        for (var t = 0; t < this.samplerObjects.length; t++)
            if (e.glSampler === this.samplerObjects[t].glSampler) {
                this.samplerObjects[t].destroy(this.context), delete this.samplerObjects[t], this.samplerObjects.splice(t, 1);
                break
            }
        e.destroy(this.context)
    }, o.prototype._deallocateAllSamplers = function() {
        for (var e = 0; e < this.samplerObjects.length; e++) this.samplerObjects[e].destroy(this.context), delete samplerObjects[e], this.samplerObjects.splice(e, 1), e--
    }, t.default = o
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        this.world = e, this.getConfig = t, this.updateObject = n, this.loadObject = r, this._objects = new Map, this._loading = new Map
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(12),
        a = r(o),
        s = n(17),
        u = r(s);
    i.prototype._create = function(e, t, n) {
        return {}
    }, i.prototype._remove = function(e) {
        this._objects.delete(e)
    }, i.prototype._prepare = function() {}, i.prototype._load = function(e, t) {
        return this.loadObject(e, t)
    }, i.prototype.load = function(e, t) {
        var n = this,
            r = e.substr(e.lastIndexOf(".") + 1);
        if (r !== this.constructor._type) throw new Error("Trying to load type" + r + " with handler for " + this._type);
        return t || (t = {}), this._loading.has(e) ? this._loading.get(e) : this._objects.has(e) && !t.reload ? u.default.resolve(this._objects.get(e)) : this.getConfig(e, t).then(function(r) {
            return n.update(e, r, t)
        }).then(function(t) {
            return n._loading.delete(e), t
        }).then(null, function(t) {
            throw n._loading.delete(e), t
        })
    }, i.prototype.clear = function() {
        var e = this,
            t = [];
        return this._objects.forEach(function(n, r) {
            t.push(e.update(r, null, {}))
        }), this._objects.clear(), this._loading.clear(), a.default.all(t)
    }, i.prototype.update = function(e, t, n) {
        var r = this,
            i = this._update(e, t, n).then(function(t) {
                return r._loading.delete(e), t
            });
        return this._loading.set(e, i), i
    }, i.getTypeForRef = function(e) {
        return e.substr(e.lastIndexOf(".") + 1).toLowerCase()
    }, i.prototype._update = function(e, t, n) {
        return t ? (n || (n = {}), this._prepare(t), this._objects.has(e) || this._objects.set(e, this._create(e, t, n)), u.default.resolve(this._objects.get(e))) : (this._remove(e, n), u.default.resolve())
    }, i.handlerClasses = {}, i.getHandler = function(e) {
        return i.handlerClasses[e]
    }, i._registerClass = function(e, t) {
        return t._type = e, i.handlerClasses[e] = t
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
        return typeof e
    } : function(e) {
        return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
    };
    r.init = function(e, t) {
        r.CompressedTextureS3TC = e.getExtension("WEBGL_compressed_texture_s3tc") || e.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"), r.CompressedTexturePVRTC = e.getExtension("WEBGL_compressed_texture_pvrtc") || e.getExtension("MOZ_WEBGL_compressed_texture_pvrtc") || e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"), r.CompressedTextureETC = e.getExtension("WEBGL_compressed_texture_etc") || e.getExtension("MOZ_WEBGL_compressed_texture_etc") || e.getExtension("WEBKIT_WEBGL_compressed_texture_etc"), r.Webgl2 = "webgl2" === t, r.Webgl2 ? console.log("[Sumerian] Using WebGL2") : console.log("[Sumerian] Using WebGL1"), r.Webgl2 ? (r.TextureFloat = !0, r.TextureHalfFloat = !0, r.DrawBuffersExtension = void 0, r.ElementIndexUInt = !0, r.InstancedArrays = void 0, r.VertexArrayObject = void 0) : (r.TextureFloat = e.getExtension("OES_texture_float"), r.TextureHalfFloat = e.getExtension("OES_texture_half_float"), r.ElementIndexUInt = e.getExtension("OES_element_index_uint"), r.DrawBuffersExtension = e.getExtension("WEBGL_draw_buffers"), r.InstancedArrays = e.getExtension("ANGLE_instanced_arrays"), r.VertexArrayObject = e.getExtension("OES_vertex_array_object")), r.TextureFloatLinear = e.getExtension("OES_texture_float_linear"), r.TextureHalfFloatLinear = e.getExtension("OES_texture_half_float_linear"), r.StandardDerivatives = e.getExtension("OES_standard_derivatives"), r.TextureFilterAnisotropic = e.getExtension("EXT_texture_filter_anisotropic") || e.getExtension("MOZ_EXT_texture_filter_anisotropic") || e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"), r.DepthTexture = e.getExtension("WEBGL_depth_texture") || e.getExtension("WEBKIT_WEBGL_depth_texture") || e.getExtension("MOZ_WEBGL_depth_texture"), r.BlendMinmax = e.getExtension("EXT_blend_minmax"), r.FragDepth = e.getExtension("EXT_frag_depth"), r.ShaderTextureLod = e.getExtension("EXT_shader_texture_lod"), r.FloatColorBuffer = e.getExtension("EXT_color_buffer_float"), r.maxTexureSize = e.getParameter(e.MAX_TEXTURE_SIZE), r.maxCubemapSize = e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE), r.maxRenderbufferSize = e.getParameter(e.MAX_RENDERBUFFER_SIZE), r.maxViewPortDims = e.getParameter(e.MAX_VIEWPORT_DIMS), r.maxAnisotropy = r.TextureFilterAnisotropic ? e.getParameter(r.TextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0, r.maxVertexTextureUnits = e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS), r.maxFragmentTextureUnits = e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS), r.maxCombinedTextureUnits = e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS), r.maxVertexAttributes = e.getParameter(e.MAX_VERTEX_ATTRIBS), r.maxVertexUniformVectors = e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS), r.maxFragmentUniformVectors = e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS), r.maxVaryingVectors = e.getParameter(e.MAX_VARYING_VECTORS), r.aliasedPointSizeRange = e.getParameter(e.ALIASED_POINT_SIZE_RANGE), r.aliasedLineWidthRange = e.getParameter(e.ALIASED_LINE_WIDTH_RANGE), r.samples = e.getParameter(e.SAMPLES), r.sampleBuffers = e.getParameter(e.SAMPLE_BUFFERS), r.depthBits = e.getParameter(e.DEPTH_BITS), r.stencilBits = e.getParameter(e.STENCIL_BITS), r.subpixelBits = e.getParameter(e.SUBPIXEL_BITS), r.supportedExtensionsList = e.getSupportedExtensions(), r.renderer = e.getParameter(e.RENDERER), r.vendor = e.getParameter(e.VENDOR), r.version = e.getParameter(e.VERSION), r.shadingLanguageVersion = e.getParameter(e.SHADING_LANGUAGE_VERSION), r.vertexShaderHighpFloat = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.HIGH_FLOAT), r.vertexShaderMediumpFloat = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.MEDIUM_FLOAT), r.vertexShaderLowpFloat = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.LOW_FLOAT), r.fragmentShaderHighpFloat = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.HIGH_FLOAT), r.fragmentShaderMediumpFloat = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.MEDIUM_FLOAT), r.fragmentShaderLowpFloat = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.LOW_FLOAT), r.vertexShaderHighpInt = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.HIGH_INT), r.vertexShaderMediumpInt = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.MEDIUM_INT), r.vertexShaderLowpInt = e.getShaderPrecisionFormat(e.VERTEX_SHADER, e.LOW_INT), r.fragmentShaderHighpInt = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.HIGH_INT), r.fragmentShaderMediumpInt = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.MEDIUM_INT), r.fragmentShaderLowpInt = e.getShaderPrecisionFormat(e.FRAGMENT_SHADER, e.LOW_INT)
    }, r.getCapabilitiesString = function() {
        var e = [],
            t = function(e) {
                return e && e.buffer instanceof ArrayBuffer && void 0 !== e.byteLength
            };
        for (var n in r) {
            var o = r[n];
            if (!(o instanceof Function || "object" === (void 0 === o ? "undefined" : i(o)) && !(o instanceof Array || t(o)))) {
                var a = "";
                if (t(o)) {
                    a += "[";
                    for (var s = 0; s < o.length; s++) a += o[s], s < o.length - 1 && (a += ",");
                    a += "]"
                } else a = o;
                e.push(n + ": " + a)
            }
        }
        return e.join("\n")
    }, t.default = r
}, function(e, t, n) {
    e.exports = !n(14)(function() {
        return 7 != Object.defineProperty({}, "a", {
            get: function() {
                return 7
            }
        }).a
    })
}, function(e, t, n) {
    var r = n(11),
        i = n(234),
        o = n(60),
        a = Object.defineProperty;
    t.f = n(27) ? Object.defineProperty : function(e, t, n) {
        if (r(e), t = o(t, !0), r(n), i) try {
            return a(e, t, n)
        } catch (e) {}
        if ("get" in n || "set" in n) throw TypeError("Accessors not supported!");
        return "value" in n && (e[t] = n.value), e
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        var n = !1;
        if (!t || !t.vshader || !t.fshader) {
            if (!e && !t) throw new Error("Missing shader source AND name for shader creation:");
            if ("string" == typeof e && -1 !== e.indexOf(".glsl")) this.LoadShaderFromFileXHR(e), n = !0;
            else if (!t || !t.vshader || !t.fshader) return
        }
        n || this.InitializeFromObject(e, t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(276),
        s = r(a),
        u = n(277),
        l = r(u),
        f = n(31),
        c = r(f),
        d = n(38),
        h = r(d),
        p = n(80),
        m = r(p),
        y = n(150),
        v = r(y),
        _ = n(26),
        g = r(_),
        b = n(3),
        x = r(b),
        w = n(5),
        E = r(w),
        S = n(280);
    r(S);
    i.prototype.InitializeFromObject = function(e, t) {
        this.originalShaderDefinition = t, this.shaderDefinition = t, this.origVertexSource = t.vshader, this.origFragmentSource = t.fshader, this.bInstancedShader = t.bInstancedShader, this.instanceCount = t.instanceCount, this.instanceAttributeKeys = [], this.instanceAttributeBuffers = [], this.name = e || t.name, this.shaderProgram = null, this.vertexShader = null, this.fragmentShader = null, this.renderer = null, this.attributeMapping = {}, this.attributeIndexMapping = {}, this.uniformMapping = {}, this.uniformCallMapping = {}, this.uniformBufferDataBlocks = [], this.textureSlots = [], this.textureSlotsNaming = {}, this.textureIndex = 0, this.currentCallbacks = {}, this.glslversion = t.glslversion || null, this.overridePrecision = t.precision || null, this.processors = t.processors, this.builder = t.builder, this.defines = t.defines || {}, this.attributes = t.attributes || {}, this.uniforms = t.uniforms || {}, this.defineKey = t.defineKey || "", this.defineKeyDirty = !0, this.frameStart = !0, this.attributeKeys = null, this.matchedUniforms = [], this.gl1Extensions = t.gl1Extensions || {}, this.gl2Extensions = t.gl2Extensions || {}, this.renderQueue = v.default.OPAQUE, i.cache.has(t) ? this._id = i.cache.get(t) : (this._id = i.cache.size, i.cache.set(t, this._id)), this.errorOnce = !1, this.vertexSource = "function" == typeof this.origVertexSource ? this.origVertexSource() : this.origVertexSource, this.fragmentSource = "function" == typeof this.origFragmentSource ? this.origFragmentSource() : this.origFragmentSource, Object.seal(this)
    }, i.prototype.makeInstanced = function(e, t) {
        if (this.setDefine("INSTANCED_DRAW", !0), this.setDefine("INSTANCE_COUNT", e), this.instanceCount = e, this.bInstancedShader = !0, g.default.Webgl2)
            for (var n in this.uniforms) {
                var r = this.uniforms[n];
                r === i.WORLD_MATRIX && (this.uniforms[n] = t.uniforms[n] = i.WORLD_MATRIX_INSTANCED), r === i.NORMAL_MATRIX && (this.uniforms[n] = t.uniforms[n] = i.NORMAL_MATRIX_INSTANCED), r === i.INSTANCED_UNIFORM_DATA && (this.uniforms[n] = t.uniforms[n] = [])
            } else
                for (var o in this.uniforms) {
                    var a = this.uniforms[o];
                    a === i.WORLD_MATRIX && (this.uniforms[o] = t.uniforms[o] = i.WORLD_MATRIX_INSTANCED), a === i.NORMAL_MATRIX && (this.uniforms[o] = t.uniforms[o] = i.NORMAL_MATRIX_INSTANCED), a === i.INSTANCED_UNIFORM_DATA && (this.uniforms[o] = t.uniforms[o] = [])
                }
    }, i.prototype.LoadShaderFromFileXHR = function(e) {
        if ("string" != typeof e || 0 === e.length) throw new Error("No Provided shader filename to load");
        var t = e,
            n = e.split("\\").pop().split("/").pop();
        0 == n.length && (n = t);
        var r = function() {
            return function(e, r) {
                if (!e) throw new Error("Could not load following shader file:" + t);
                var i = {};
                try {
                    i = eval.call(null, "({" + r + "})")
                } catch (e) {
                    i = {}
                }
                this.InitializeFromObject(n, i)
            }.bind(this)
        }.bind(this);
        ! function(e, t) {
            var n = new XMLHttpRequest;
            n.open("GET", e, !1), n.onload = function() {
                t(200 == n.status, n.response)
            }, n.send(null)
        }(t, r())
    }, i.cache = new Map, i.prototype.clone = function() {
        return new i(this.name, x.default.deepClone({
            glslversion: this.glslversion,
            gl1Extensions: this.gl1Extensions,
            gl2Extensions: this.gl2Extensions,
            precision: this.precision,
            processors: this.processors,
            builder: this.builder,
            defines: this.defines,
            attributes: this.attributes,
            uniforms: this.uniforms,
            vshader: this.origVertexSource,
            fshader: this.origFragmentSource,
            defineKey: this.defineKey,
            bInstancedShader: this.bInstancedShader,
            instanceCount: this.instanceCount
        }))
    }, i.prototype.cloneOriginal = function() {
        return new i(this.name, this.originalShaderDefinition)
    }, i.prototype.precompile = function(e) {
        null === this.shaderProgram && (this._investigateShaders(), this.addDefines(this.defines), this.addPrecision(this.overridePrecision || e.shaderPrecision), 300 == this.glslversion ? this.addExtensions(this.gl2Extensions) : this.addExtensions(this.gl1Extensions), this.addGlslVersion(this.glslversion), this.compile(e))
    };
    var M = /\b(in|attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat2|mat3|mat4|sampler2D|usampler2D|sampler3D|samplerCube|sampler2DArray)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;
    i.prototype.compileProgram = function(e) {
        if (null === this.shaderProgram) {
            this._investigateShaders(), this.addDefines(this.defines), this.addPrecision(this.overridePrecision || e.shaderPrecision);
            var t = g.default.Webgl2 ? this.gl2Extensions : this.gl1Extensions;
            this.addExtensions(t), this.addGlslVersion(this.glslversion), this.compile(e)
        }
    }, i.prototype.activateProgram = function(e, t) {
        if (e.usedProgram !== this.shaderProgram) return t.useProgram(this.shaderProgram), e.usedProgram = this.shaderProgram, !0
    }, i.prototype.bindAttributeKey = function(e, t, n) {
        var r = t[this.attributes[n]];
        if (r) {
            var i = this.attributeIndexMapping[n];
            void 0 !== i && e.bindVertexAttribute(i, r)
        }
    }, i.prototype.bindAttributes = function(e, t) {
        if (this.attributes)
            for (var n = 0, r = this.attributeKeys.length; n < r; n++) this.bindAttributeKey(e, t, this.attributeKeys[n])
    }, i.prototype.bindFloatAttribArray = function(e, t, n) {
        for (var r = t.material, i = r.uniforms[n], o = new Float32Array(t.renderableIDs.length), a = 0; a < t.renderableIDs.length; ++a) {
            var s = t.renderableIDs[a];
            o[a] = i[s]
        }
        e.bufferData(e.ARRAY_BUFFER, o, e.STATIC_DRAW);
        var u = (this.attributeMapping[n], this.attributeIndexMapping[n]),
            l = RendererUtils.getGLDataType(e, "Float");
        e.enableVertexAttribArray(u + 0), e.vertexAttribPointer(u + 0, 1, l, !1, 4, 0), g.default.InstancedArrays.vertexAttribDivisorANGLE(u, 1)
    }, i.prototype.bindVecAttribArray = function(e, t, n) {
        for (var r = this.attributeMapping[n].format, i = t.material, o = i.uniforms[n], a = new Float32Array(16 * t.renderableIDs.length), s = 0; s < t.renderableIDs.length; ++s)
            for (var u = 4 * s, l = t.renderableIDs[s], f = 0; f < 16; f += 4) a[u + f + 0] = o[l][0], a[u + f + 1] = o[l][1], a[u + f + 2] = "vec3" == r ? o[l][2] : 0, a[u + f + 3] = "vec4" == r ? o[l][3] : 0;
        e.bufferData(e.ARRAY_BUFFER, a, e.STATIC_DRAW);
        var c = (this.attributeMapping[n], this.attributeIndexMapping[n]),
            d = RendererUtils.getGLDataType(e, "Float");
        e.enableVertexAttribArray(c + 0), e.vertexAttribPointer(c + 0, 4, d, !1, 16, 0), g.default.InstancedArrays.vertexAttribDivisorANGLE(c, 1)
    }, i.prototype.bindMat4AttribArray = function(e, t, n) {
        var r = new Float32Array(16 * t.transform.length);
        switch (this.uniforms[n]) {
            case "WORLD_MATRIX_INSTANCED":
                for (var i = 0; i < t.transform.length; ++i)
                    for (var o = 16 * i, a = 0; a < 16; ++a) r[o + a] = t.transform[i].matrix.data[a];
                break;
            case "NORMAL_MATRIX_INSTANCED":
                for (var s = 0; s < t.transform.length; ++s)
                    for (var u = 16 * s, l = (t.transform[s].normalMatrix.data.length, 0), f = 0; f < 16; ++f) {
                        var c = f / 4,
                            d = f % 4;
                        r[u + f] = 3 == d || 3 == c ? 0 : t.transform[s].normalMatrix.data[l++]
                    }
                break;
            case "INSTANCED_UNIFORM_DATA":
            default:
                return void console.warn("Shader.bindMat4AttribArr: unknown uniform.")
        }
        e.bufferData(e.ARRAY_BUFFER, r, e.STATIC_DRAW);
        var h = (this.attributeMapping[n], this.attributeIndexMapping[n]),
            p = RendererUtils.getGLDataType(e, "Float");
        e.enableVertexAttribArray(h + 0), e.vertexAttribPointer(h + 0, 4, p, !1, 64, 0), e.enableVertexAttribArray(h + 1), e.vertexAttribPointer(h + 1, 4, p, !1, 64, 16), e.enableVertexAttribArray(h + 2), e.vertexAttribPointer(h + 2, 4, p, !1, 64, 32), e.enableVertexAttribArray(h + 3), e.vertexAttribPointer(h + 3, 4, p, !1, 64, 48), g.default.InstancedArrays ? (g.default.InstancedArrays.vertexAttribDivisorANGLE(h + 0, 1), g.default.InstancedArrays.vertexAttribDivisorANGLE(h + 1, 1), g.default.InstancedArrays.vertexAttribDivisorANGLE(h + 2, 1), g.default.InstancedArrays.vertexAttribDivisorANGLE(h + 3, 1)) : (e.vertexAttribDivisor(h + 0, 1), e.vertexAttribDivisor(h + 1, 1), e.vertexAttribDivisor(h + 2, 1), e.vertexAttribDivisor(h + 3, 1))
    }, i.prototype.bindAttributeArrays = function(e, t) {
        for (var n = 0; n < this.instanceAttributeKeys.length; ++n) {
            var r = this.instanceAttributeKeys[n],
                i = this.instanceAttributeBuffers[n],
                o = this.attributeMapping[r].format;
            switch (e.bindBuffer(e.ARRAY_BUFFER, i), o) {
                case "mat4":
                case "mat3":
                    this.bindMat4AttribArray(e, t, r);
                    break;
                case "vec2":
                case "vec3":
                case "vec4":
                    this.bindVecAttribArray(e, t, r);
                    break;
                case "float":
                    this.bindFloatAttribArray(e, t, r);
                    break;
                default:
                    console.warn("Unhandled vertex attribute array case: " + o)
            }
        }
    }, i.prototype._getRenderableUniformData = function(e) {
        var t = e.renderable.uniformBlockDataPerRenderable[this._id];
        if (void 0 == t) {
            var n = e.renderer.context;
            t = [];
            var r = !0,
                i = !1,
                o = void 0;
            try {
                for (var a, s = this.uniformBufferDataBlocks[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                    var u = a.value,
                        f = {},
                        c = new ArrayBuffer(u.dataSize),
                        d = new DataView(c);
                    f.uniformArrayBufferView = d, f.callMappings = [];
                    for (var h = 0; h < u.numUniformIndices; h++) {
                        var p = u.formats[h],
                            m = u.offsetElems[h],
                            y = new l.default(e.renderer, n, c, m, p);
                        f.callMappings.push(y)
                    }
                    f.uniformBufferGL = n.createBuffer(), n.bindBuffer(n.UNIFORM_BUFFER, f.uniformBufferGL), n.bufferData(n.UNIFORM_BUFFER, u.dataSize, n.DYNAMIC_DRAW), t.push(f)
                }
            } catch (e) {
                i = !0, o = e
            } finally {
                try {
                    !r && s.return && s.return()
                } finally {
                    if (i) throw o
                }
            }
            e.renderable.uniformBlockDataPerRenderable[this._id] = t
        }
        return t
    }, i.prototype.matchUniforms = function(e) {
        var t = this.matchedUniforms;
        if (t) {
            this.textureIndex = 0, void 0 == e.renderable.uniformBlockDataPerRenderable && (e.renderable.uniformBlockDataPerRenderable = []);
            for (var n = this._getRenderableUniformData(e), r = this.uniformBufferDataBlocks.length, i = 0; i < r; i++) {
                var o = this.uniformBufferDataBlocks[i],
                    a = n[i];
                this._bindUniformBlock(o, e, a)
            }
            for (var s = 0, u = t.length; s < u; s++) this._bindUniform(t[s], e)
        }
    }, i.prototype.apply = function(e, t) {
        var n = t.context,
            r = t.rendererRecord;
        this.compileProgram(t), this.activateProgram(r, n), this.matchUniforms(e)
    }, i.prototype.defineValue = function(e, t) {
        null === e.material && console.error("material null?");
        var n = e.material.uniforms[t];
        return void 0 === n && (n = this.uniforms[t]), n
    }, i.prototype.mapSlot = function(e, t, n) {
        var r = e.material.getTexture(n.mapping);
        r instanceof Array ? this.arrayType(t, n, r) : (n.index = this.textureIndex, t.call(this.textureIndex++))
    }, i.prototype.arrayType = function(e, t, n) {
        var r = [];
        t.index = [];
        for (var i = 0; i < n.length; i++) t.index.push(this.textureIndex), r.push(this.textureIndex++);
        e.call(r)
    }, i.prototype.stringType = function(e, t, n) {
        var r = this.currentCallbacks[t];
        if (r) r(n, e);
        else {
            var i = this.textureSlotsNaming[t];
            void 0 !== i && this.mapSlot(e, n, i)
        }
    }, i.prototype.callMapping = function(e, t, n) {
        var r = this.defineValue(e, t),
            i = void 0 === r ? "undefined" : o(r);
        if ("string" === i) this.stringType(e, t, n, r);
        else {
            var a = "function" === i ? r(e) : r;
            void 0 !== a && n.call(a, e)
        }
    }, i.prototype._bindUniform = function(e, t) {
        var n = this.uniformCallMapping[e];
        void 0 !== n && this.callMapping(t, e, n)
    }, i.prototype._bindUniformBlock = function(e, t, n) {
        for (var r = t.renderer.context, i = !1, o = n.callMappings, a = 0; a < e.numUniformIndices; a++) {
            var s = e.names[a],
                u = o[a];
            u.dirty = !1, this.callMapping(t, s, u), 1 == u.dirty && (i = !0)
        }
        if (r.uniformBlockBinding(this.shaderProgram, e.blockIndex, e.blockIndex), r.bindBufferRange(r.UNIFORM_BUFFER, e.blockIndex, n.uniformBufferGL, 0, e.dataSize), 1 == i) {
            var l = n.uniformArrayBufferView;
            r.bufferSubData(r.UNIFORM_BUFFER, 0, l, 0, e.dataSize)
        }
    }, i.prototype.setDefine = function(e, t) {
        this.defineKeyDirty = this.defineKeyDirty || this.defines[e] !== t, this.defines[e] = t
    }, i.prototype.removeDefine = function(e) {
        this.defineKeyDirty = this.defineKeyDirty || void 0 !== this.defines[e], this.defines[e] = void 0
    }, i.prototype.hasDefine = function(e) {
        return !1 !== this.defines[e] && void 0 !== this.defines[e]
    }, i.prototype.startFrame = function() {
        this.frameStart = !0
    }, i.prototype.endFrame = function() {
        this.frameStart = !1
    }, i.prototype.updateProcessors = function(e) {
        if (this.processors)
            for (var t = 0; t < this.processors.length; t++) this.processors[t](this, e)
    }, i.prototype.getDefineKey = function(e) {
        if (this.defineKeyDirty) {
            for (var t = "Key:" + this.name, n = Object.keys(this.defines), r = 0; r < n.length; r++) {
                var i = n[r],
                    o = this.defines[i];
                void 0 !== o && !1 !== o && -1 === e.indexOf(i) && e.push(i)
            }
            for (var a = 0, s = e.length; a < s; a++) {
                var u = e[a],
                    l = this.defines[u];
                void 0 !== l && !1 !== l && (t += "_" + a + ":" + l)
            }
            this.defineKey = t, this.defineKeyDirty = !1
        }
        return this.defineKey
    }, i.prototype.rebuild = function() {
        this.shaderProgram = null, this.attributeMapping = {}, this.glslversion = null, this.attributeIndexMapping = {}, this.uniformMapping = {}, this.uniformBufferDataBlocks = [], this.uniformCallMapping = {}, this.currentCallbacks = {}, this.attributeKeys = null, this.vertexSource = "function" == typeof this.origVertexSource ? this.origVertexSource() : this.origVertexSource, this.fragmentSource = "function" == typeof this.origFragmentSource ? this.origFragmentSource() : this.origFragmentSource, this.defineKeyDirty = !0, this.gl1Extensions = {}, this.gl2Extensions = {}
    }, i.prototype._investigateShaders = function() {
        this.textureSlots = [], this.textureSlotsNaming = {}, i.investigateShader(this.vertexSource, this), i.investigateShader(this.fragmentSource, this)
    }, i.investigateShader = function(e, t) {
        M.lastIndex = 0;
        for (var n = M.exec(e); null !== n;) {
            var r = {
                    format: n[2]
                },
                i = n[1],
                o = n[3];
            if (n[4] && ("float" === r.format ? r.format = "floatarray" : "int" === r.format ? r.format = "intarray" : 0 === r.format.indexOf("sampler") && (r.format = "samplerArray")), "attribute" === i || "in" == i) t.attributeMapping[o] = r;
            else {
                if (0 === r.format.indexOf("sampler") || 0 === r.format.indexOf("usampler")) {
                    var a = {
                        format: r.format,
                        name: o,
                        mapping: t.uniforms[o],
                        index: t.textureSlots.length
                    };
                    t.textureSlots.push(a), t.textureSlotsNaming[a.name] = a
                }
                t.uniformMapping[o] = r
            }
            n = M.exec(e)
        }
    }, i.prototype.compile = function(e) {
        var t = e.context;
        if (this.renderer = e, this.vertexShader = this._getShader(t, void 0 !== t.VERTEX_SHADER ? t.VERTEX_SHADER : WebGLRenderingContext.VERTEX_SHADER, this.vertexSource), this.fragmentShader = this._getShader(t, void 0 !== t.FRAGMENT_SHADER ? t.FRAGMENT_SHADER : WebGLRenderingContext.FRAGMENT_SHADER, this.fragmentSource), null === this.vertexShader || null === this.fragmentShader) throw console.error("Shader error - no shaders"), new Error("Shader compilation failed");
        if (this.shaderProgram = t.createProgram(), null === this.shaderProgram) {
            var n = "Unable to create program for shader. [shader: " + this.name + "].";
            console.error(n), E.default.emit("sumerian.shader.error", n)
        }
        if (t.attachShader(this.shaderProgram, this.vertexShader), t.attachShader(this.shaderProgram, this.fragmentShader), t.linkProgram(this.shaderProgram), !t.getProgramParameter(this.shaderProgram, void 0 !== t.LINK_STATUS ? t.LINK_STATUS : WebGLRenderingContext.LINK_STATUS)) {
            var r = t.getProgramInfoLog(this.shaderProgram);
            console.error("Could not initialise shaders: " + r), E.default.emit("sumerian.shader.error", r)
        }
        var i = Object.keys(this.attributeMapping),
            o = !0,
            a = !1,
            u = void 0;
        try {
            for (var l, f = i[Symbol.iterator](); !(o = (l = f.next()).done); o = !0) {
                var c = l.value,
                    d = t.getAttribLocation(this.shaderProgram, c); - 1 !== d && (this.attributeIndexMapping[c] = d)
            }
        } catch (e) {
            a = !0, u = e
        } finally {
            try {
                !o && f.return && f.return()
            } finally {
                if (a) throw u
            }
        }
        var h = Object.keys(this.uniformMapping),
            p = !0,
            m = !1,
            y = void 0;
        try {
            for (var v, _ = h[Symbol.iterator](); !(p = (v = _.next()).done); p = !0) {
                var b = v.value,
                    x = t.getUniformLocation(this.shaderProgram, b);
                if (x) this.uniformCallMapping[b] = new s.default(e, t, x, this.uniformMapping[b].format);
                else
                    for (var w = this.textureSlots.length, S = 0; S < w; S++) {
                        var M = this.textureSlots[S];
                        if (M.name === b) {
                            for (this.textureSlots.splice(S, 1), delete this.textureSlotsNaming[M.name]; S < w - 1; S++) this.textureSlots[S].index--;
                            break
                        }
                    }
            }
        } catch (e) {
            m = !0, y = e
        } finally {
            try {
                !p && _.return && _.return()
            } finally {
                if (m) throw y
            }
        }
        if (this.attributes && (this.attributeKeys = Object.keys(this.attributes)), this.bInstancedShader) {
            var C = Object.keys(this.attributeIndexMapping),
                T = this.attributeKeys,
                R = this.instanceAttributeKeys,
                A = this.instanceAttributeBuffers,
                O = this.instanceCount,
                P = this;
            C.forEach(function(e) {
                if (!T.includes(e)) {
                    R.push(e);
                    var n = P.attributeMapping[e].format,
                        r = 0;
                    switch (n) {
                        case "mat4":
                        case "mat3":
                            r = 64;
                            break;
                        case "vec3":
                        case "vec2":
                        case "vec4":
                            r = 16
                    }
                    var i = t.createBuffer();
                    t.bindBuffer(t.ARRAY_BUFFER, i), t.bufferData(t.ARRAY_BUFFER, O * r, t.STATIC_DRAW), A.push(i)
                }
            })
        }
        if (this.uniforms) {
            this.matchedUniforms = [];
            var D = Object.keys(this.uniforms),
                I = !0,
                k = !1,
                N = void 0;
            try {
                for (var L, B = D[Symbol.iterator](); !(I = (L = B.next()).done); I = !0) {
                    var F = L.value;
                    void 0 !== this.uniformCallMapping[F] && this.matchedUniforms.push(F);
                    var j = this.uniforms[F];
                    this.defaultCallbacks[j] && (this.currentCallbacks[F] = this.defaultCallbacks[j])
                }
            } catch (e) {
                k = !0, N = e
            } finally {
                try {
                    !I && B.return && B.return()
                } finally {
                    if (k) throw N
                }
            }
        }
        if (g.default.Webgl2)
            for (var U = t.getProgramParameter(this.shaderProgram, t.ACTIVE_UNIFORM_BLOCKS), V = 0; V < U; V++) {
                var z = {},
                    G = t.getActiveUniformBlockName(this.shaderProgram, V);
                z.blockName = G, z.dataSize = t.getActiveUniformBlockParameter(this.shaderProgram, V, t.UNIFORM_BLOCK_DATA_SIZE), z.blockIndex = t.getUniformBlockIndex(this.shaderProgram, G), z.numUniformIndices = t.getActiveUniformBlockParameter(this.shaderProgram, z.blockIndex, t.UNIFORM_BLOCK_ACTIVE_UNIFORMS);
                var W = t.getActiveUniformBlockParameter(this.shaderProgram, z.blockIndex, t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),
                    H = t.getActiveUniforms(this.shaderProgram, W, t.UNIFORM_OFFSET);
                z.names = [], z.formats = [], z.offsetElems = [];
                for (var X = 0; X < z.numUniformIndices; X++) {
                    var Y = W[X],
                        q = t.getActiveUniform(this.shaderProgram, Y),
                        K = q.name,
                        Q = K.indexOf("["),
                        Z = Q > 0;
                    Z && (K = K.substring(0, Q));
                    var J = "";
                    switch (q.type) {
                        case 5126:
                            J = "float";
                            break;
                        case 35664:
                            J = "vec2";
                            break;
                        case 35665:
                            J = "vec3";
                            break;
                        case 35666:
                            J = "vec4";
                            break;
                        case 35670:
                            J = "bool";
                            break;
                        case 35675:
                            J = "mat3";
                            break;
                        case 35676:
                            J = "mat4";
                            break;
                        case 35667:
                            J = "ivec2";
                            break;
                        case 35668:
                            J = "ivec3";
                            break;
                        case 35669:
                            J = "ivec4";
                            break;
                        default:
                            throw new Error("Unknown uniform type: ".concat(q.type).concat(" | ").concat(K))
                    }
                    "float" == J && Z && (J = J.concat("array"));
                    var $ = H[X],
                        ee = $ / 4;
                    z.names.push(K), z.formats.push(J), z.offsetElems.push(ee)
                }
                this.uniformBufferDataBlocks.push(z)
            }
    };
    var C = /\b\d+:(\d+):\s(.+)\b/g,
        T = /\((\d+),\s*\d+\):\s(.+)/g;
    i.prototype._getShader = function(e, t, n) {
        var r = e.createShader(t);
        if (e.shaderSource(r, n), e.compileShader(r), !e.getShaderParameter(r, void 0 !== e.COMPILE_STATUS ? e.COMPILE_STATUS : WebGLRenderingContext.COMPILE_STATUS)) {
            var i = e.getShaderInfoLog(r),
                o = t === (void 0 !== e.VERTEX_SHADER ? e.VERTEX_SHADER : WebGLRenderingContext.VERTEX_SHADER) ? "VertexShader" : "FragmentShader";
            C.lastIndex = 0;
            var a = C.exec(i);
            if (null === a && (a = T.exec(i)), null !== a)
                for (; null !== a;) {
                    var s = n.split("\n"),
                        u = a[1],
                        l = a[2];
                    console.error("Error in " + o + " - [" + this.name + "][" + this._id + "] at line " + u + ":"), console.error("\tError: " + l), console.error("\tSource: " + s[u - 1]), a = C.exec(i)
                } else console.error("Error in " + o + " - [" + this.name + "][" + this._id + "] " + i);
            return null
        }
        return r
    };
    var R = /\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;
    i.prototype.addPrecision = function(e) {
        R.lastIndex = 0, null === R.exec(this.vertexSource) && (this.vertexSource = "precision " + e + " float;\n" + this.vertexSource), R.lastIndex = 0, null === R.exec(this.fragmentSource) && (this.fragmentSource = "precision " + e + " float;\n" + this.fragmentSource)
    }, i.IsExtensionSupported = function(e) {
        switch (e) {
            case "GL_EXT_draw_buffers":
                return !(!g.default.Webgl2 && !g.default.DrawBuffersExtension) || (console.warn("Shader extension '" + e + "' not supported."), !1)
        }
        return !0
    }, i.prototype.addExtensions = function(e) {
        if (e) {
            var t = "",
                n = Object.values(e),
                r = !0,
                o = !1,
                a = void 0;
            try {
                for (var s, u = n[Symbol.iterator](); !(r = (s = u.next()).done); r = !0) {
                    var l = s.value;
                    i.IsExtensionSupported(l) && (t += "#extension " + l + " : require\n")
                }
            } catch (e) {
                o = !0, a = e
            } finally {
                try {
                    !r && u.return && u.return()
                } finally {
                    if (o) throw a
                }
            }
            this.vertexSource = t + this.vertexSource, this.fragmentSource = t + this.fragmentSource
        }
    }, i.prototype.addGlslVersion = function(e) {
        var t = g.default.Webgl2;
        if (null != e && !isNaN(parseFloat(e)) && isFinite(e) && t) {
            var n = "";
            300 == e && (n = "#version 300 es\n"), "" != n && (this.vertexSource = n + this.vertexSource, this.fragmentSource = n + this.fragmentSource)
        }
    }, i.prototype.addDefines = function(e) {
        if (!g.default.Webgl2 && (this.vertexSource = "#define WEBGL_1\n" + this.vertexSource, this.fragmentSource = "#define WEBGL_1\n" + this.fragmentSource), e) {
            var t = this.generateDefines(e);
            this.vertexSource = t + "\n" + this.vertexSource, this.fragmentSource = t + "\n" + this.fragmentSource
        }
    }, i.prototype.generateDefines = function(e) {
        var t = [],
            n = Object.keys(e),
            r = !0,
            i = !1,
            o = void 0;
        try {
            for (var a, s = n[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                var u = a.value,
                    l = e[u];
                if (!1 !== l && void 0 !== l) {
                    var f = "#define " + u + " " + l;
                    t.push(f)
                }
            }
        } catch (e) {
            i = !0, o = e
        } finally {
            try {
                !r && s.return && s.return()
            } finally {
                if (i) throw o
            }
        }
        return t.join("\n")
    }, i.prototype.getShaderDefinition = function() {
        return {
            vshader: this.vertexSource,
            fshader: this.fragmentSource,
            defines: this.defines,
            attributes: this.attributes,
            uniforms: this.uniforms,
            glslversion: this.glslversion,
            gl1Extensions: this.gl1Extensions,
            gl2Extensions: this.gl2Extensions
        }
    }, i.prototype.destroy = function() {
        this.shaderProgram && (this.renderer.context.deleteProgram(this.shaderProgram), this.shaderProgram = null), this.vertexShader && (this.renderer.context.deleteShader(this.vertexShader), this.vertexShader = null), this.fragmentShader && (this.renderer.context.deleteShader(this.fragmentShader), this.fragmentShader = null), this.renderer = null
    }, i.prototype.toString = function() {
        return this.name
    }, i.PROJECTION_MATRIX = "PROJECTION_MATRIX", i.MAIN_PROJECTION_MATRIX = "MAIN_PROJECTION_MATRIX", i.MAIN_PROJECTION_MATRIX_INVERSE = "MAIN_PROJECTION_MATRIX_INVERSE", i.VIEW_MATRIX = "VIEW_MATRIX", i.VIEW_INVERSE_MATRIX = "VIEW_INVERSE_MATRIX", i.VIEW_PROJECTION_MATRIX = "VIEW_PROJECTION_MATRIX", i.VIEW_PROJECTION_INVERSE_MATRIX = "VIEW_PROJECTION_INVERSE_MATRIX", i.WORLD_MATRIX = "WORLD_MATRIX", i.VIEW_NORMAL_MATRIX = "VIEW_NORMAL_MATRIX", i.NORMAL_MATRIX = "NORMAL_MATRIX";
    for (var A = 0; A < 8; A++) i["LIGHT" + A] = "LIGHT" + A;
    i.CAMERA = "CAMERA", i.AMBIENT = "AMBIENT", i.EMISSIVE = "EMISSIVE", i.DIFFUSE = "DIFFUSE", i.ALBEDO = "ALBEDO", i.SPECULAR = "SPECULAR", i.SPECULAR_POWER = "SPECULAR_POWER", i.METALLIC = "METALLIC", i.ROUGHNESS = "ROUGHNESS", i.CAMERA_FRUSTUM_WIDTH = "CAMERA_FRUSTUM_WIDTH", i.CAMERA_FRUSTUM_HEIGHT = "CAMERA_FRUSTUM_HEIGTH", i.NEAR_PLANE = "NEAR_PLANE", i.FAR_PLANE = "FAR_PLANE", i.MAIN_NEAR_PLANE = "MAIN_NEAR_PLANE", i.MAIN_FAR_PLANE = "MAIN_FAR_PLANE", i.MAIN_DEPTH_SCALE = "DEPTH_SCALE", i.TIME = "TIME", i.TPF = "TPF", i.RESOLUTION = "RESOLUTION", i.DIFFUSE_MAP = "DIFFUSE_MAP", i.ALBEDO_MAP = "ALBEDO_MAP", i.NORMAL_MAP = "NORMAL_MAP", i.SPECULAR_MAP = "SPECULAR_MAP", i.METALLIC_MAP = "METALLIC_MAP", i.ROUGHNESS_MAP = "ROUGHNESS_MAP", i.LIGHT_MAP = "LIGHT_MAP", i.SHADOW_MAP = "SHADOW_MAP", i.AO_MAP = "AO_MAP", i.EMISSIVE_MAP = "EMISSIVE_MAP", i.TRANSPARENCY_MAP = "TRANSPARENCY_MAP", i.DEPTH_MAP = "DEPTH_MAP", i.IBL_IRRADIANCE_MAP = "IBL_IRRADIANCE_MAP", i.IBL_SPECULAR_MAP = "IBL_SPECULAR_MAP", i.BRDF_LUT = "BRDF_LUT", i.PRIMARY_REFLECTION_PROBE = "PRIMARY_REFLECTION_PROBE", i.SECONDARY_REFLECTION_PROBE = "SECONDARY_REFLECTION_PROBE", i.DEFAULT_AMBIENT = [.1, .1, .1, 1], i.DEFAULT_EMISSIVE = [0, 0, 0, 0], i.DEFAULT_DIFFUSE = [.8, .8, .8, 1], i.DEFAULT_SPECULAR = [.6, .6, .6, 64], i.DEFAULT_SHININESS = 64, i.WORLD_MATRIX_INSTANCED = "WORLD_MATRIX_INSTANCED", i.NORMAL_MATRIX_INSTANCED = "NORMAL_MATRIX_INSTANCED", i.INSTANCED_UNIFORM_DATA = "INSTANCED_UNIFORM_DATA", i.prototype.defaultCallbacks = {},
        function(e) {
            e[i.VIEW_NORMAL_MATRIX] = function(e, t) {
                var n = t.camera.getViewMatrix().clone(),
                    r = void 0 !== t.transform ? t.transform.matrix : h.default.IDENTITY;
                n.mul(r);
                var i = new c.default;
                i.data[0] = n[0], i.data[1] = n[1], i.data[2] = n[2], i.data[3] = n[4], i.data[4] = n[5], i.data[5] = n[6], i.data[6] = n[8], i.data[7] = n[9], i.data[8] = n[10], i.invert().transpose(), e.uniformMatrix3fv(i)
            }, e[i.PROJECTION_MATRIX] = function(e, t) {
                var n = t.camera.getProjectionMatrix();
                e.uniformMatrix4fv(n)
            }, e[i.MAIN_PROJECTION_MATRIX_INVERSE] = function(e, t) {
                var n = t.mainCamera.getProjectionMatrix().clone();
                n.invert(), e.uniformMatrix4fv(n)
            }, e[i.MAIN_PROJECTION_MATRIX] = function(e, t) {
                var n = t.mainCamera.getProjectionMatrix();
                e.uniformMatrix4fv(n)
            }, e[i.VIEW_MATRIX] = function(e, t) {
                var n = t.camera.getViewMatrix();
                e.uniformMatrix4fv(n)
            }, e[i.WORLD_MATRIX] = function(e, t) {
                //! AT: when is this condition ever true?
                var n = void 0 !== t.transform ? t.transform.matrix : h.default.IDENTITY;
                e.uniformMatrix4fv(n)
            }, e[i.WORLD_MATRIX_INSTANCED] = function(e, t) {
                for (var n = new Array(t.transform.length), r = 0; r < t.transform.length; ++r) n[r] = t.transform[r].matrix;
                e.uniformMatrix4fv(n, !1, t.transform.length)
            }, e[i.NORMAL_MATRIX] = function(e, t) {
                //! AT: when is this condition ever true?
                var n = void 0 !== t.transform ? t.transform.normalMatrix : c.default.IDENTITY;
                e.uniformMatrix3fv(n)
            }, e[i.NORMAL_MATRIX_INSTANCED] = function(e, t) {
                for (var n = new Array(t.transform.length), r = 0; r < t.transform.length; ++r) n[r] = t.transform[r].normalMatrix;
                e.uniformMatrix3fv(n, !1, t.transform.length)
            }, e[i.VIEW_INVERSE_MATRIX] = function(e, t) {
                var n = t.camera.getViewInverseMatrix();
                e.uniformMatrix4fv(n)
            }, e[i.VIEW_PROJECTION_MATRIX] = function(e, t) {
                var n = t.camera.getViewProjectionMatrix();
                e.uniformMatrix4fv(n)
            }, e[i.VIEW_PROJECTION_INVERSE_MATRIX] = function(e, t) {
                var n = t.camera.getViewProjectionInverseMatrix();
                e.uniformMatrix4fv(n)
            };
            for (var t = 0; t < 16; t++) e[i["TEXTURE" + t]] = function(e) {
                return function(t) {
                    t.uniform1i(e)
                }
            }(t);
            for (var n = 0; n < 8; n++) e[i["LIGHT" + n]] = function(e) {
                return function(t, n) {
                    var r = n.lights[e];
                    void 0 !== r ? t.uniform3f(r.translation.x, r.translation.y, r.translation.z) : t.uniform3f(-20, 20, 20)
                }
            }(n);
            e[i.LIGHTCOUNT] = function(e, t) {
                e.uniform1i(t.lights.length)
            }, e[i.CAMERA] = function(e, t) {
                var n = t.camera.translation;
                e.uniform3f(n.x, n.y, n.z)
            }, e[i.NEAR_PLANE] = function(e, t) {
                e.uniform1f(t.camera.near)
            }, e[i.FAR_PLANE] = function(e, t) {
                e.uniform1f(t.camera.far)
            }, e[i.MAIN_NEAR_PLANE] = function(e, t) {
                e.uniform1f(t.mainCamera.near)
            }, e[i.MAIN_FAR_PLANE] = function(e, t) {
                e.uniform1f(t.mainCamera.far)
            }, e[i.MAIN_DEPTH_SCALE] = function(e, t) {
                e.uniform1f(1 / (t.mainCamera.far - t.mainCamera.near))
            }, e[i.AMBIENT] = function(e, t) {
                var n = void 0 !== t.material.materialState ? t.material.materialState.ambient : i.DEFAULT_AMBIENT;
                e.uniform4f(n[0], n[1], n[2], n[3])
            }, e[i.EMISSIVE] = function(e, t) {
                var n = void 0 !== t.material.materialState ? t.material.materialState.emissive : i.DEFAULT_EMISSIVE;
                e.uniform4f(n[0], n[1], n[2], n[3])
            }, e[i.DIFFUSE] = function(e, t) {
                var n = void 0 !== t.material.materialState ? t.material.materialState.diffuse : i.DEFAULT_DIFFUSE;
                e.uniform4f(n[0], n[1], n[2], n[3])
            }, e[i.SPECULAR] = function(e, t) {
                var n = i.DEFAULT_SPECULAR;
                void 0 !== t.material.materialState && (n = t.material.materialState.specular, n[3] = Math.max(t.material.materialState.shininess, 1)), e.uniform4f(n[0], n[1], n[2], n[3])
            }, e[i.SPECULAR_POWER] = function(e, t) {
                var n = void 0 !== t.material.materialState ? t.material.materialState.shininess : i.DEFAULT_SHININESS;
                n = Math.max(n, 1), e.uniform1f(n)
            }, e[i.TIME] = function(e) {
                e.uniform1f(m.default.time)
            }, e[i.TPF] = function(e) {
                e.uniform1f(m.default.tpf)
            }, e[i.RESOLUTION] = function(e, t) {
                e.uniform2f(t.renderer.viewportWidth, t.renderer.viewportHeight)
            }
        }(i.prototype.defaultCallbacks), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        e = void 0 !== e ? e : 45, t = void 0 !== t ? t : 1, n = void 0 !== n ? n : 1, r = void 0 !== r ? r : 1e3, this.translation = new u.default(0, 0, 0), this._left = new u.default(-1, 0, 0), this._up = new u.default(0, 1, 0), this._direction = new u.default(0, 0, -1), this.size = .5, this._frustumNear = this.near = 1, this._frustumFar = this.far = 2, this._frustumLeft = this.left = -.5, this._frustumRight = this.right = .5, this._frustumTop = this.top = .5, this._frustumBottom = this.bottom = -.5, this._coeffLeft = new a.default, this._coeffRight = new a.default, this._coeffBottom = new a.default, this._coeffTop = new a.default, this._viewPortLeft = 0, this._viewPortRight = 1, this._viewPortTop = 1, this._viewPortBottom = 0, this._worldPlane = [];
        for (var o = 0; o < i.FRUSTUM_PLANES; o++) this._worldPlane[o] = new p.default;
        this.projectionMode = i.Perspective, this.lockedRatio = !1, this.aspect = t, this._updateMVMatrix = !0, this._updateInverseMVMatrix = !0, this._updatePMatrix = !0, this._updateMVPMatrix = !0, this._updateInverseMVPMatrix = !0, this.modelView = new d.default, this.modelViewInverse = new d.default, this.projection = new d.default, this.modelViewProjection = new d.default, this.modelViewProjectionInverse = new d.default,
            //! AT: unused?
            this._planeState = 0, this._clipPlane = new f.default, this._qCalc = new f.default, this._corners = [];
        for (var s = 0; s < 8; s++) this._corners.push(new u.default);
        this._extents = new u.default, this.vNearPlaneCenter = new u.default, this.vFarPlaneCenter = new u.default, this.calcLeft = new u.default, this.calcUp = new u.default, this.changedProperties = !0, this.setFrustumPerspective(e, t, n, r), this.onFrameChange()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(37),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(36),
        f = r(l),
        c = n(38),
        d = r(c),
        h = n(107),
        p = r(h),
        m = n(4),
        y = r(m),
        v = n(66),
        _ = r(v),
        g = n(46),
        b = r(g),
        x = n(65),
        w = r(x),
        E = n(118),
        S = r(E),
        M = new u.default;
    i.LEFT_PLANE = 0, i.RIGHT_PLANE = 1, i.BOTTOM_PLANE = 2, i.TOP_PLANE = 3, i.FAR_PLANE = 4, i.NEAR_PLANE = 5, i.FRUSTUM_PLANES = 6,
        //! schteppe: Why not capital letters for the following?
        i.Perspective = 0, i.Parallel = 1, i.Custom = 2, i.Outside = 0, i.Inside = 1, i.Intersects = 2, i.prototype.normalize = function() {
            this._left.normalize(), this._up.normalize(), this._direction.normalize(), this.onFrameChange()
        }, i.prototype.setProjectionMode = function(e) {
            this.projectionMode = e, this.update()
        }, i.prototype.setFrustumPerspective = function(e, t, n, r) {
            if (void 0 !== e && null !== e && (this.fov = e), void 0 !== t && null !== t && (this.aspect = t), void 0 !== n && null !== n && (this.near = n), void 0 !== r && null !== r && (this.far = r), void 0 !== this.fov) {
                var i = Math.tan(this.fov * y.default.DEG_TO_RAD * .5) * this.near,
                    o = i * this.aspect;
                this._frustumLeft = -o, this._frustumRight = o, this._frustumBottom = -i, this._frustumTop = i, this._frustumNear = this.near, this._frustumFar = this.far, this._frustumFar - this._frustumNear < y.default.EPSILON && (this._frustumFar = this._frustumNear + y.default.EPSILON), this.onFrustumChange()
            }
        }, i.prototype.setFrustum = function(e, t, n, r, i, o, a) {
            void 0 !== e && null !== e && (this.near = e), void 0 !== t && null !== t && (this.far = t), void 0 !== n && null !== n && (this.left = n), void 0 !== r && null !== r && (this.right = r), void 0 !== i && null !== i && (this.top = i), void 0 !== o && null !== o && (this.bottom = o), void 0 !== a && null !== a && (this.aspect = a), this._frustumNear = this.near, this._frustumFar = this.far, this._frustumLeft = this.left * this.aspect, this._frustumRight = this.right * this.aspect, this._frustumTop = this.top, this._frustumBottom = this.bottom, this._frustumFar - this._frustumNear < y.default.EPSILON && (this._frustumFar = this._frustumNear + y.default.EPSILON), this.onFrustumChange()
        }, i.prototype.setProjectionMatrixPerspective = function(e) {
            if (this.projectionMode === i.Perspective) {
                var t = e.data;
                this._frustumNear = t[10] - 1 != 0 ? t[14] / (t[10] - 1) : this._frustumNear, this._frustumFar = t[10] + 1 != 0 ? t[14] / (t[10] + 1) : this._frustumFar, this._frustumLeft = 0 != t[0] ? this._frustumNear * (t[8] - 1) / t[0] : this._frustumLeft, this._frustumRight = 0 != t[0] ? this._frustumNear * (t[8] + 1) / t[0] : this._frustumRight, this._frustumBottom = 0 != t[5] ? this._frustumNear * (t[9] - 1) / t[5] : this._frustumBottom, this._frustumTop = 0 != t[5] ? this._frustumNear * (t[9] + 1) / t[5] : this._frustumTop, this.aspect = (this._frustumRight - this._frustumLeft) / (this._frustumTop - this._frustumBottom), this.lockedRatio = !0, this.onFrustumChange()
            }
        }, i.prototype.copy = function(e) {
            return this.translation.set(e.translation), this._left.set(e._left), this._up.set(e._up), this._direction.set(e._direction), this.fov = e.fov, this.aspect = e.aspect, this.near = e.near, this.far = e.far, this.left = e.left, this.right = e.right, this.top = e.top, this.bottom = e.bottom, this._frustumLeft = e._frustumLeft, this._frustumRight = e._frustumRight, this._frustumBottom = e._frustumBottom, this._frustumTop = e._frustumTop, this._frustumNear = e._frustumNear, this._frustumFar = e._frustumFar, this.projectionMode = e.projectionMode, this.onFrustumChange(), this.onFrameChange(), this
        }, i.prototype.setFrame = function(e, t, n, r) {
            this._left.set(t), this._up.set(n), this._direction.set(r), this.translation.set(e), this.onFrameChange()
        }, i.prototype.lookAt = function(e, t) {
            M.set(e).sub(this.translation).normalize(), M.equals(this._direction) || (this._direction.set(M), this._up.set(t).normalize(), this._up.equals(u.default.ZERO) && this._up.set(u.default.UNIT_Y), this._left.set(this._up).cross(this._direction).normalize(), this._left.equals(u.default.ZERO) && (0 !== this._direction.x ? this._left.setDirect(this._direction.y, -this._direction.x, 0) : this._left.setDirect(0, this._direction.z, -this._direction.y)), this._up.set(this._direction).cross(this._left).normalize(), this.onFrameChange())
        }, i.prototype.setViewMatrix = function(e) {
            var t = d.default.invert(e),
                n = new u.default;
            t.getTranslation(n);
            var r = e.data,
                i = new u.default(-r[0], -r[4], -r[8]),
                o = new u.default(r[1], r[5], r[9]),
                a = new u.default(-r[2], -r[6], -r[10]);
            this.setFrame(n, i, o, a)
        }, i.prototype.update = function() {
            this.onFrustumChange(), this.onFrameChange()
        }, i.prototype.contains = function(e) {
            if (!e) return i.Inside;
            for (var t = i.Inside, n = i.FRUSTUM_PLANES - 1; n >= 0; n--) switch (e.whichSide(this._worldPlane[n])) {
                case S.default.Inside:
                    return i.Outside;
                case S.default.Outside:
                    break;
                case S.default.Intersects:
                    t = i.Intersects
            }
            return t
        }, i.prototype.onFrustumChange = function() {
            this.projectionMode === i.Perspective ? (this._coeffLeft.setDirect(-this._frustumNear, -this._frustumLeft).normalize(), this._coeffRight.setDirect(this._frustumNear, this._frustumRight).normalize(), this._coeffBottom.setDirect(this._frustumNear, -this._frustumBottom).normalize(), this._coeffTop.setDirect(-this._frustumNear, this._frustumTop).normalize()) : this.projectionMode === i.Parallel && (this._frustumRight > this._frustumLeft ? (this._coeffLeft.setDirect(-1, 0), this._coeffRight.setDirect(1, 0)) : (this._coeffLeft.setDirect(1, 0), this._coeffRight.setDirect(-1, 0)), this._frustumTop > this._frustumBottom ? (this._coeffBottom.setDirect(-1, 0), this._coeffTop.setDirect(1, 0)) : (this._coeffBottom.setDirect(1, 0), this._coeffTop.setDirect(-1, 0))), this._updatePMatrix = !0, this._updateMVPMatrix = !0, this._updateInverseMVMatrix = !0, this._updateInverseMVPMatrix = !0, this.changedProperties = !0
        }, i.prototype.onFrameChange = function() {
            var e = void 0;
            e = this._worldPlane[i.LEFT_PLANE], e.normal.x = this._left.x * this._coeffLeft.x + this._direction.x * this._coeffLeft.y, e.normal.y = this._left.y * this._coeffLeft.x + this._direction.y * this._coeffLeft.y, e.normal.z = this._left.z * this._coeffLeft.x + this._direction.z * this._coeffLeft.y, e.constant = this.translation.dot(e.normal), e = this._worldPlane[i.RIGHT_PLANE], e.normal.x = this._left.x * this._coeffRight.x + this._direction.x * this._coeffRight.y, e.normal.y = this._left.y * this._coeffRight.x + this._direction.y * this._coeffRight.y, e.normal.z = this._left.z * this._coeffRight.x + this._direction.z * this._coeffRight.y, e.constant = this.translation.dot(e.normal), e = this._worldPlane[i.BOTTOM_PLANE], e.normal.x = this._up.x * this._coeffBottom.x + this._direction.x * this._coeffBottom.y, e.normal.y = this._up.y * this._coeffBottom.x + this._direction.y * this._coeffBottom.y, e.normal.z = this._up.z * this._coeffBottom.x + this._direction.z * this._coeffBottom.y, e.constant = this.translation.dot(e.normal), e = this._worldPlane[i.TOP_PLANE], e.normal.x = this._up.x * this._coeffTop.x + this._direction.x * this._coeffTop.y, e.normal.y = this._up.y * this._coeffTop.x + this._direction.y * this._coeffTop.y, e.normal.z = this._up.z * this._coeffTop.x + this._direction.z * this._coeffTop.y, e.constant = this.translation.dot(e.normal), this.projectionMode === i.Parallel && (this._frustumRight > this._frustumLeft ? (this._worldPlane[i.LEFT_PLANE].constant += this._frustumLeft, this._worldPlane[i.RIGHT_PLANE].constant -= this._frustumRight) : (this._worldPlane[i.LEFT_PLANE].constant -= this._frustumLeft, this._worldPlane[i.RIGHT_PLANE].constant += this._frustumRight), this._frustumBottom > this._frustumTop ? (this._worldPlane[i.TOP_PLANE].constant += this._frustumTop, this._worldPlane[i.BOTTOM_PLANE].constant -= this._frustumBottom) : (this._worldPlane[i.TOP_PLANE].constant -= this._frustumTop, this._worldPlane[i.BOTTOM_PLANE].constant += this._frustumBottom));
            var t = this._direction.dot(this.translation);
            e = this._worldPlane[i.FAR_PLANE], e.normal.x = -this._direction.x, e.normal.y = -this._direction.y, e.normal.z = -this._direction.z, e.constant = -(t + this._frustumFar), e = this._worldPlane[i.NEAR_PLANE], e.normal.x = this._direction.x, e.normal.y = this._direction.y, e.normal.z = this._direction.z, e.constant = t + this._frustumNear, this._updateMVMatrix = !0, this._updateMVPMatrix = !0, this._updateInverseMVMatrix = !0, this._updateInverseMVPMatrix = !0
        }, i.prototype.updateProjectionMatrix = function() {
            var e = this.projection.data,
                t = this._frustumRight,
                n = this._frustumLeft,
                r = this._frustumTop,
                o = this._frustumBottom,
                a = this._frustumFar,
                s = this._frustumNear;
            this.projectionMode === i.Parallel ? (e[0] = 2 / (t - n), e[1] = 0, e[2] = 0, e[3] = 0, e[4] = 0, e[5] = 2 / (r - o), e[6] = 0, e[7] = 0, e[8] = 0, e[9] = 0, e[10] = -2 / (a - s), e[11] = 0, e[12] = -(t + n) / (t - n), e[13] = -(r + o) / (r - o), e[14] = -(a + s) / (a - s), e[15] = 1) : this.projectionMode === i.Perspective && (e[0] = 2 * s / (t - n), e[1] = 0, e[2] = 0, e[3] = 0, e[4] = 0, e[5] = 2 * s / (r - o), e[6] = 0, e[7] = 0, e[8] = (t + n) / (t - n), e[9] = (r + o) / (r - o), e[10] = -(a + s) / (a - s), e[11] = -1, e[12] = 0, e[13] = 0, e[14] = -2 * a * s / (a - s), e[15] = 0)
        }, i.prototype.updateModelViewMatrix = function() {
            this.modelView.setIdentity();
            var e = this.modelView.data;
            e[0] = -this._left.x, e[4] = -this._left.y, e[8] = -this._left.z, e[1] = this._up.x, e[5] = this._up.y, e[9] = this._up.z, e[2] = -this._direction.x, e[6] = -this._direction.y, e[10] = -this._direction.z, e[12] = this._left.dot(this.translation), e[13] = -this._up.dot(this.translation), e[14] = this._direction.dot(this.translation)
        }, i.prototype.getPickRay = function(e, t, n, r, i) {
            return i || (i = new _.default), this.getWorldCoordinates(e, t, n, r, 0, i.origin), this.getWorldCoordinates(e, t, n, r, .3, i.direction).sub(i.origin).normalize(), i
        }, i.prototype.getWorldPosition = function(e, t, n, r, o, a) {
            return this.projectionMode === i.Parallel ? o = (o - this.near) / (this.far - this.near) : (o = y.default.clamp(o, this.near, this.far), o = this.far / (this.far - this.near) + this.far * this.near / (this.near - this.far) / o), this.getWorldCoordinates(e, t, n, r, o, a)
        }, i.prototype.getWorldCoordinates = function(e, t, n, r, i, o) {
            o || (o = new u.default), this.checkInverseModelViewProjection();
            var a = new f.default,
                s = (e / n - this._viewPortLeft) / (this._viewPortRight - this._viewPortLeft) * 2 - 1,
                l = ((r - t) / r - this._viewPortBottom) / (this._viewPortTop - this._viewPortBottom) * 2 - 1;
            return a.setDirect(s, l, 2 * i - 1, 1), a.applyPost(this.modelViewProjectionInverse), 0 !== a.w && a.scale(1 / a.w), o.x = a.x, o.y = a.y, o.z = a.z, o
        }, i.prototype.getScreenCoordinates = function(e, t, n, r) {
            return r = this.getNormalizedDeviceCoordinates(e, r), r.x = (r.x + 1) * (this._viewPortRight - this._viewPortLeft) / 2 * t, r.y = (1 - r.y) * (this._viewPortTop - this._viewPortBottom) / 2 * n, r.z = (r.z + 1) / 2, r
        }, i.prototype.getFrustumCoordinates = function(e, t) {
            return t = this.getNormalizedDeviceCoordinates(e, t), t.x = (t.x + 1) * (this._frustumRight - this._frustumLeft) / 2 + this._frustumLeft, t.y = (t.y + 1) * (this._frustumTop - this._frustumBottom) / 2 + this._frustumBottom, t.z = (t.z + 1) * (this._frustumFar - this._frustumNear) / 2 + this._frustumNear, t
        }, i.prototype.getNormalizedDeviceCoordinates = function(e, t) {
            t || (t = new u.default), this.checkModelViewProjection();
            var n = new f.default;
            return n.setDirect(e.x, e.y, e.z, 1), n.applyPost(this.modelViewProjection), 0 !== n.w && n.scale(1 / n.w), t.x = n.x, t.y = n.y, t.z = n.z, t
        }, i.prototype.checkModelView = function() {
            this._updateMVMatrix && (this.updateModelViewMatrix(), this._updateMVMatrix = !1)
        }, i.prototype.checkProjection = function() {
            this._updatePMatrix && (this.updateProjectionMatrix(), this._updatePMatrix = !1)
        }, i.prototype.checkModelViewProjection = function() {
            this._updateMVPMatrix && (this.checkModelView(), this.checkProjection(), this.modelViewProjection.mul2(this.getProjectionMatrix(), this.getViewMatrix()), this._updateMVPMatrix = !1)
        }, i.prototype.checkInverseModelView = function() {
            this._updateInverseMVMatrix && (this.checkModelView(), this.modelViewInverse.copy(this.modelView).invert(), this._updateInverseMVMatrix = !1)
        }, i.prototype.checkInverseModelViewProjection = function() {
            this._updateInverseMVPMatrix && (this.checkModelViewProjection(), this.modelViewProjectionInverse.copy(this.modelViewProjection).invert(), this._updateInverseMVPMatrix = !1)
        }, i.prototype.getViewMatrix = function() {
            return this.checkModelView(), this.modelView
        }, i.prototype.getProjectionMatrix = function() {
            return this.checkProjection(), this.projection
        }, i.prototype.getViewProjectionMatrix = function() {
            return this.checkModelViewProjection(), this.modelViewProjection
        }, i.prototype.getViewInverseMatrix = function() {
            return this.checkInverseModelView(), this.modelViewInverse
        }, i.prototype.getViewProjectionInverseMatrix = function() {
            return this.checkInverseModelViewProjection(), this.modelViewProjectionInverse
        }, i.prototype.pack = function(e) {
            for (var t = e.center, n = this._corners, r = this._extents, i = 0; i < n.length; i++) n[i].set(t);
            e instanceof b.default ? r.setDirect(e.xExtent, e.yExtent, e.zExtent) : e instanceof w.default && r.setDirect(e.radius, e.radius, e.radius), n[0].addDirect(r.x, r.y, r.z), n[1].addDirect(r.x, -r.y, r.z), n[2].addDirect(r.x, r.y, -r.z), n[3].addDirect(r.x, -r.y, -r.z), n[4].addDirect(-r.x, r.y, r.z), n[5].addDirect(-r.x, -r.y, r.z), n[6].addDirect(-r.x, r.y, -r.z), n[7].addDirect(-r.x, -r.y, -r.z);
            for (var o = this.getViewMatrix(), a = Number.MAX_VALUE, s = -Number.MAX_VALUE, u = new f.default, l = 0; l < n.length; l++) u.setDirect(n[l].x, n[l].y, n[l].z, 1), u.applyPre(o), a = Math.min(-u.z, a), s = Math.max(-u.z, s);
            a = Math.min(Math.max(this._frustumNear, a), this._frustumFar), s = Math.max(a, Math.min(this._frustumFar, s));
            var c = a / this._frustumNear;
            this._frustumLeft = this._frustumLeft * c, this._frustumRight = this._frustumRight * c, this._frustumTop = this._frustumTop * c, this._frustumBottom = this._frustumBottom * c, this._frustumNear = a, this._frustumFar = s
        }, i.prototype.calculateFrustumCorners = function(e, t) {
            e = void 0 !== e ? e : this._frustumNear, t = void 0 !== t ? t : this._frustumFar;
            var n = (this._frustumTop - this._frustumBottom) * e * .5 / this._frustumNear,
                r = (this._frustumRight - this._frustumLeft) * e * .5 / this._frustumNear,
                o = (this._frustumTop - this._frustumBottom) * t * .5 / this._frustumNear,
                a = (this._frustumRight - this._frustumLeft) * t * .5 / this._frustumNear;
            this.projectionMode === i.Parallel && (n = .5 * (this._frustumTop - this._frustumBottom), r = .5 * (this._frustumRight - this._frustumLeft), o = .5 * (this._frustumTop - this._frustumBottom), a = .5 * (this._frustumRight - this._frustumLeft));
            var s = this.vNearPlaneCenter,
                u = this.vFarPlaneCenter,
                l = this.calcLeft;
            l.set(this._direction).scale(e), s.set(this.translation).add(l), l.set(this._direction).scale(t), u.set(this.translation).add(l);
            var f = this.calcLeft,
                c = this.calcUp;
            return f.set(this._left).scale(r), c.set(this._up).scale(n), this._corners[0].set(s).sub(f).sub(c), this._corners[1].set(s).add(f).sub(c), this._corners[2].set(s).add(f).add(c), this._corners[3].set(s).sub(f).add(c), f.set(this._left).scale(a), c.set(this._up).scale(o), this._corners[4].set(u).sub(f).sub(c), this._corners[5].set(u).add(f).sub(c), this._corners[6].set(u).add(f).add(c), this._corners[7].set(u).sub(f).add(c), this._corners
        }, i.prototype.setToObliqueMatrix = function(e) {
            var t = this._clipPlane.set(e);
            t.w = 0, t.applyPost(this.getViewMatrix()), t.w = this.translation.y * e.y - e.w, this._updatePMatrix = !0;
            var n = this.getProjectionMatrix();
            this._qCalc.setDirect((y.default.sign(t.x) + n[8]) / n[0], (y.default.sign(t.y) + n[9]) / n[5], -1, (1 + n[10]) / n[14]), t.scale(2 / t.dot(this._qCalc)), n[2] = t.x, n[6] = t.y, n[10] = t.z + 1, n[14] = t.w, this._updateMVPMatrix = !0, this._updateInverseMVPMatrix = !0
        }, i.prototype.clone = function() {
            var e = new i(this.fov, this.aspect, this.near, this.far);
            return e.copy(this), e
        }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        if (l.default.call(this, 3, 3), 0 === arguments.length) this.data[0] = 1, this.data[4] = 1, this.data[8] = 1;
        else if (1 === arguments.length && "object" === o(arguments[0])) arguments[0] instanceof i ? this.copy(arguments[0]) : this.setArray(arguments[0]);
        else
            for (var e = 0; e < arguments.length; e++) this.data[e] = arguments[e];
        Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(4),
        s = r(a),
        u = n(145),
        l = r(u),
        f = n(0),
        c = r(f),
        d = n(3),
        h = r(d);
    i._tempX = new c.default, i._tempY = new c.default, i._tempZ = new c.default, i.prototype = Object.create(l.default.prototype), i.prototype.constructor = i, l.default.setupAliases(i.prototype, [
        ["e00"],
        ["e10"],
        ["e20"],
        ["e01"],
        ["e11"],
        ["e21"],
        ["e02"],
        ["e12"],
        ["e22"]
    ]), i.IDENTITY = new i(1, 0, 0, 0, 1, 0, 0, 0, 1), i.prototype.add = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] += n[0], t[1] += n[1], t[2] += n[2], t[3] += n[3], t[4] += n[4], t[5] += n[5], t[6] += n[6], t[7] += n[7], t[8] += n[8], this
    }, i.prototype.sub = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] -= n[0], t[1] -= n[1], t[2] -= n[2], t[3] -= n[3], t[4] -= n[4], t[5] -= n[5], t[6] -= n[6], t[7] -= n[7], t[8] -= n[8], this
    }, i.prototype.scale = function(e) {
        var t = this.data;
        return t[0] *= e, t[1] *= e, t[2] *= e, t[3] *= e, t[4] *= e, t[5] *= e, t[6] *= e, t[7] *= e, t[8] *= e, this
    }, i.prototype.mul = function(e) {
        var t = e.data,
            n = t[0],
            r = t[3],
            i = t[6],
            o = t[1],
            a = t[4],
            s = t[7],
            u = t[2],
            l = t[5],
            f = t[8],
            c = this.data,
            d = c[0],
            h = c[3],
            p = c[6],
            m = c[1],
            y = c[4],
            v = c[7],
            _ = c[2],
            g = c[5],
            b = c[8],
            x = this.data;
        return x[0] = n * d + r * m + i * _, x[3] = n * h + r * y + i * g, x[6] = n * p + r * v + i * b, x[1] = o * d + a * m + s * _, x[4] = o * h + a * y + s * g, x[7] = o * p + a * v + s * b, x[2] = u * d + l * m + f * _, x[5] = u * h + l * y + f * g, x[8] = u * p + l * v + f * b, this
    }, i.prototype.mul2 = function(e, t) {
        var n = e.data,
            r = n[0],
            i = n[3],
            o = n[6],
            a = n[1],
            s = n[4],
            u = n[7],
            l = n[2],
            f = n[5],
            c = n[8],
            d = t.data,
            h = d[0],
            p = d[3],
            m = d[6],
            y = d[1],
            v = d[4],
            _ = d[7],
            g = d[2],
            b = d[5],
            x = d[8],
            w = this.data;
        return w[0] = r * h + i * y + o * g, w[3] = r * p + i * v + o * b, w[6] = r * m + i * _ + o * x, w[1] = a * h + s * y + u * g, w[4] = a * p + s * v + u * b, w[7] = a * m + s * _ + u * x, w[2] = l * h + f * y + c * g, w[5] = l * p + f * v + c * b, w[8] = l * m + f * _ + c * x, this
    }, i.prototype.transpose = function() {
        var e = this.data,
            t = e[3],
            n = e[6],
            r = e[7];
        return e[3] = e[1], e[6] = e[2], e[7] = e[5], e[1] = t, e[2] = n, e[5] = r, this
    }, i.invert = function(e, t) {
        if (t || (t = new i), t === e) return t.copy(i.invert(e));
        var n = e.determinant();
        if (Math.abs(n) < s.default.EPSILON) return t;
        n = 1 / n;
        var r = t.data,
            o = e.data;
        return r[0] = (o[4] * o[8] - o[7] * o[5]) * n, r[1] = (o[7] * o[2] - o[1] * o[8]) * n, r[2] = (o[1] * o[5] - o[4] * o[2]) * n, r[3] = (o[6] * o[5] - o[3] * o[8]) * n, r[4] = (o[0] * o[8] - o[6] * o[2]) * n, r[5] = (o[3] * o[2] - o[0] * o[5]) * n, r[6] = (o[3] * o[7] - o[6] * o[4]) * n, r[7] = (o[6] * o[1] - o[0] * o[7]) * n, r[8] = (o[0] * o[4] - o[3] * o[1]) * n, t
    }, i.prototype.invert = function() {
        return i.invert(this, this)
    }, i.prototype.isOrthogonal = function() {
        var e = this.data,
            t = e[0] * e[3] + e[1] * e[4] + e[2] * e[5];
        return !(Math.abs(t) > s.default.EPSILON) && (t = e[0] * e[6] + e[1] * e[7] + e[2] * e[8], !(Math.abs(t) > s.default.EPSILON) && (t = e[3] * e[6] + e[4] * e[7] + e[5] * e[8], !(Math.abs(t) > s.default.EPSILON)))
    }, i.prototype.isNormal = function() {
        var e = this.data,
            t = e[0] * e[0] + e[1] * e[1] + e[2] * e[2];
        return !(Math.abs(t - 1) > s.default.EPSILON) && (t = e[3] * e[3] + e[4] * e[4] + e[5] * e[5], !(Math.abs(t - 1) > s.default.EPSILON) && (t = e[6] * e[6] + e[7] * e[7] + e[8] * e[8], !(Math.abs(t - 1) > s.default.EPSILON)))
    }, i.prototype.isOrthonormal = function() {
        return this.isOrthogonal() && this.isNormal()
    }, i.prototype.determinant = function() {
        var e = this.data;
        return e[0] * (e[4] * e[8] - e[7] * e[5]) - e[3] * (e[1] * e[8] - e[7] * e[2]) + e[6] * (e[1] * e[5] - e[4] * e[2])
    }, i.prototype.setIdentity = function() {
        var e = this.data;
        return e[0] = 1, e[1] = 0, e[2] = 0, e[3] = 0, e[4] = 1, e[5] = 0, e[6] = 0, e[7] = 0, e[8] = 1, this
    }, i.prototype.multiplyDiagonalPost = function(e, t) {
        var n = e.x,
            r = e.y,
            i = e.z,
            o = this.data,
            a = t.data;
        return a[0] = n * o[0], a[1] = n * o[1], a[2] = n * o[2], a[3] = r * o[3], a[4] = r * o[4], a[5] = r * o[5], a[6] = i * o[6], a[7] = i * o[7], a[8] = i * o[8], t
    }, i.prototype.fromAngles = function(e, t, n) {
        var r = Math.cos(e),
            i = Math.sin(e),
            o = Math.cos(t),
            a = Math.sin(t),
            s = Math.cos(n),
            u = Math.sin(n),
            l = this.data;
        return l[0] = o * s, l[3] = a * i - o * u * r, l[6] = o * u * i + a * r, l[1] = u, l[4] = s * r, l[7] = -s * i, l[2] = -a * s, l[5] = a * u * r + o * i, l[8] = -a * u * i + o * r, this
    }, i.prototype.rotateX = function(e, t) {
        t = t || this;
        var n = this.data,
            r = t.data,
            i = Math.sin(e),
            o = Math.cos(e),
            a = n[3],
            s = n[4],
            u = n[5],
            l = n[6],
            f = n[7],
            c = n[8];
        return n !== r && (r[0] = n[0], r[1] = n[1], r[2] = n[2]), r[3] = a * o + l * i, r[4] = s * o + f * i, r[5] = u * o + c * i, r[6] = l * o - a * i, r[7] = f * o - s * i, r[8] = c * o - u * i, t
    }, i.prototype.rotateY = function(e, t) {
        t = t || this;
        var n = this.data,
            r = t.data,
            i = Math.sin(e),
            o = Math.cos(e),
            a = n[0],
            s = n[1],
            u = n[2],
            l = n[6],
            f = n[7],
            c = n[8];
        return n !== r && (r[3] = n[3], r[4] = n[4], r[5] = n[5]), r[0] = a * o - l * i, r[1] = s * o - f * i, r[2] = u * o - c * i, r[6] = a * i + l * o, r[7] = s * i + f * o, r[8] = u * i + c * o, t
    }, i.prototype.rotateZ = function(e, t) {
        t = t || this;
        var n = this.data,
            r = t.data,
            i = Math.sin(e),
            o = Math.cos(e),
            a = n[0],
            s = n[1],
            u = n[2],
            l = n[3],
            f = n[4],
            c = n[5];
        return n !== r && (r[6] = n[6], r[7] = n[7], r[8] = n[8]), r[0] = a * o + l * i, r[1] = s * o + f * i, r[2] = u * o + c * i, r[3] = l * o - a * i, r[4] = f * o - s * i, r[5] = c * o - u * i, t
    }, i.prototype.toAngles = function(e) {
        var t = e;
        t || (t = new c.default);
        var n = this.data;
        return n[3] > 1 - s.default.EPSILON ? (t.y = Math.atan2(n[2], n[8]), t.z = Math.PI / 2, t.x = 0) : n[3] < -1 + s.default.EPSILON ? (t.y = Math.atan2(n[2], n[8]), t.z = -Math.PI / 2, t.x = 0) : (t.y = Math.atan2(-n[2], n[0]), t.x = Math.atan2(-n[7], n[4]), t.z = Math.asin(n[1])), t
    }, i.prototype.fromAngleNormalAxis = function(e, t, n, r) {
        var i = Math.cos(e),
            o = Math.sin(e),
            a = 1 - i,
            s = t * t,
            u = n * n,
            l = r * r,
            f = t * n * a,
            c = t * r * a,
            d = n * r * a,
            h = t * o,
            p = n * o,
            m = r * o,
            y = this.data;
        return y[0] = s * a + i, y[3] = f - m, y[6] = c + p, y[1] = f + m, y[4] = u * a + i, y[7] = d - h, y[2] = c - p, y[5] = d + h, y[8] = l * a + i, this
    }, i.prototype.lookAt = function(e, t) {
        var n = i._tempX,
            r = i._tempY,
            o = i._tempZ;
        o.set(e).normalize().scale(-1), n.set(t).cross(o).normalize(), n.equals(c.default.ZERO) && (0 !== o.x ? n.setDirect(o.y, -o.x, 0) : n.setDirect(0, o.z, -o.y)), r.set(o).cross(n);
        var a = this.data;
        return a[0] = n.x, a[1] = n.y, a[2] = n.z, a[3] = r.x, a[4] = r.y, a[5] = r.z, a[6] = o.x, a[7] = o.y, a[8] = o.z, this
    }, i.prototype.copyQuaternion = function(e) {
        return e.toRotationMatrix(this)
    }, i.prototype.equals = function(e) {
        var t = this.data,
            n = e.data;
        return Math.abs(t[0] - n[0]) <= s.default.EPSILON && Math.abs(t[1] - n[1]) <= s.default.EPSILON && Math.abs(t[2] - n[2]) <= s.default.EPSILON && Math.abs(t[3] - n[3]) <= s.default.EPSILON && Math.abs(t[4] - n[4]) <= s.default.EPSILON && Math.abs(t[5] - n[5]) <= s.default.EPSILON && Math.abs(t[6] - n[6]) <= s.default.EPSILON && Math.abs(t[7] - n[7]) <= s.default.EPSILON && Math.abs(t[8] - n[8]) <= s.default.EPSILON
    }, i.prototype.copy = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] = n[0], t[1] = n[1], t[2] = n[2], t[3] = n[3], t[4] = n[4], t[5] = n[5], t[6] = n[6], t[7] = n[7], t[8] = n[8], this
    }, i.prototype.copyMatrix4 = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] = n[0], t[1] = n[1], t[2] = n[2], t[3] = n[4], t[4] = n[5], t[5] = n[6], t[6] = n[8], t[7] = n[9], t[8] = n[10], this
    }, i.prototype.setArray = function(e) {
        var t = this.data;
        return t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[3], t[4] = e[4], t[5] = e[5], t[6] = e[6], t[7] = e[7], t[8] = e[8], this
    }, i.prototype.set = i.prototype.copy, i.prototype.clone = function() {
        return (new i).copy(this)
    }, i.add = h.default.warnOnce("Matrix3.add is deprecated - use Matrix3.prototype.add instead.", function(e, t, n) {
        n || (n = new i);
        var r = n.data,
            o = e.data;
        if (t instanceof i) {
            var a = t.data;
            r[0] = o[0] + a[0], r[1] = o[1] + a[1], r[2] = o[2] + a[2], r[3] = o[3] + a[3], r[4] = o[4] + a[4], r[5] = o[5] + a[5], r[6] = o[6] + a[6], r[7] = o[7] + a[7], r[8] = o[8] + a[8]
        } else r[0] = o[0] + t, r[1] = o[1] + t, r[2] = o[2] + t, r[3] = o[3] + t, r[4] = o[4] + t, r[5] = o[5] + t, r[6] = o[6] + t, r[7] = o[7] + t, r[8] = o[8] + t;
        return n
    }), i.sub = h.default.warnOnce("Matrix3.sub is deprecated - use Matrix3.prototype.sub instead.", function(e, t, n) {
        n || (n = new i);
        var r = n.data,
            o = e.data;
        if (t instanceof i) {
            var a = t.data;
            r[0] = o[0] - a[0], r[1] = o[1] - a[1], r[2] = o[2] - a[2], r[3] = o[3] - a[3], r[4] = o[4] - a[4], r[5] = o[5] - a[5], r[6] = o[6] - a[6], r[7] = o[7] - a[7], r[8] = o[8] - a[8]
        } else r[0] = o[0] - t, r[1] = o[1] - t, r[2] = o[2] - t, r[3] = o[3] - t, r[4] = o[4] - t, r[5] = o[5] - t, r[6] = o[6] - t, r[7] = o[7] - t, r[8] = o[8] - t;
        return n
    }), i.mul = h.default.warnOnce("Matrix3.mul is deprecated - use Matrix3.prototype.mul instead.", function(e, t, n) {
        n || (n = new i);
        var r = n.data,
            o = e.data;
        if (t instanceof i) {
            var a = t.data;
            r[0] = o[0] * a[0], r[1] = o[1] * a[1], r[2] = o[2] * a[2], r[3] = o[3] * a[3], r[4] = o[4] * a[4], r[5] = o[5] * a[5], r[6] = o[6] * a[6], r[7] = o[7] * a[7], r[8] = o[8] * a[8]
        } else r[0] = o[0] * t, r[1] = o[1] * t, r[2] = o[2] * t, r[3] = o[3] * t, r[4] = o[4] * t, r[5] = o[5] * t, r[6] = o[6] * t, r[7] = o[7] * t, r[8] = o[8] * t;
        return n
    }), i.div = h.default.warnOnce("Matrix3.div is deprecated - use Matrix3.prototype.div instead.", function(e, t, n) {
        n || (n = new i);
        var r = n.data,
            o = e.data;
        if (t instanceof i) {
            var a = t.data;
            r[0] = o[0] / a[0], r[1] = o[1] / a[1], r[2] = o[2] / a[2], r[3] = o[3] / a[3], r[4] = o[4] / a[4], r[5] = o[5] / a[5], r[6] = o[6] / a[6], r[7] = o[7] / a[7], r[8] = o[8] / a[8]
        } else r[0] = o[0] / t, r[1] = o[1] / t, r[2] = o[2] / t, r[3] = o[3] / t, r[4] = o[4] / t, r[5] = o[5] / t, r[6] = o[6] / t, r[7] = o[7] / t, r[8] = o[8] / t;
        return n
    }), i.prototype.div = h.default.warnOnce("Matrix3.prototype.div is deprecated.", function(e) {
        return i.div(this, e, this)
    }), i.combine = h.default.warnOnce("Matrix3.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.", function(e, t, n) {
        n || (n = new i);
        var r = e.data,
            o = r[0],
            a = r[3],
            s = r[6],
            u = r[1],
            l = r[4],
            f = r[7],
            c = r[2],
            d = r[5],
            h = r[8],
            p = t.data,
            m = p[0],
            y = p[3],
            v = p[6],
            _ = p[1],
            g = p[4],
            b = p[7],
            x = p[2],
            w = p[5],
            E = p[8],
            S = n.data;
        return S[0] = o * m + a * _ + s * x, S[3] = o * y + a * g + s * w, S[6] = o * v + a * b + s * E, S[1] = u * m + l * _ + f * x, S[4] = u * y + l * g + f * w, S[7] = u * v + l * b + f * E, S[2] = c * m + d * _ + h * x, S[5] = c * y + d * g + h * w, S[8] = c * v + d * b + h * E, n
    }), i.prototype.combine = h.default.warnOnce("Matrix3.prototype.combine is deprecated - use Matrix3.prototype.mul or .mul2 instead.", function(e) {
        return i.combine(this, e, this)
    }), i.transpose = h.default.warnOnce("Matrix3.transpose is deprecated - use Matrix3.prototype.transpose instead.", function(e, t) {
        t || (t = new i);
        var n = e.data,
            r = t.data;
        if (t === e) {
            var o = n[3],
                a = n[6],
                s = n[7];
            return r[3] = n[1], r[6] = n[2], r[7] = n[5], r[1] = o, r[2] = a, r[5] = s, t
        }
        return r[0] = n[0], r[1] = n[3], r[2] = n[6], r[3] = n[1], r[4] = n[4], r[5] = n[7], r[6] = n[2], r[7] = n[5], r[8] = n[8], t
    }), i.prototype.applyPost = h.default.warnOnce("Matrix3.prototype.applyPost is deprecated - use Vector3.prototype.applyPost instead.", function(e) {
        var t = this.data,
            n = e.x,
            r = e.y,
            i = e.z;
        return e.x = t[0] * n + t[3] * r + t[6] * i, e.y = t[1] * n + t[4] * r + t[7] * i, e.z = t[2] * n + t[5] * r + t[8] * i, e
    }), i.prototype.applyPre = h.default.warnOnce("Matrix3.prototype.applyPre is deprecated - use Vector3.prototype.applyPre instead.", function(e) {
        var t = this.data,
            n = e.x,
            r = e.y,
            i = e.z;
        return e.x = t[0] * n + t[1] * r + t[2] * i, e.y = t[3] * n + t[4] * r + t[5] * i, e.z = t[6] * n + t[7] * r + t[8] * i, e
    }), l.default.addPostChecks(i.prototype, ["add", "sub", "scale", "transpose", "invert", "isOrthogonal", "determinant", "fromAngles", "rotateX", "rotateY", "rotateZ", "fromAngleNormalAxis", "lookAt", "copyQuaternion", "copy"]), t.default = i
}, function(e, t, n) {
    var r = n(79),
        i = Math.min;
    e.exports = function(e) {
        return e > 0 ? i(r(e), 9007199254740991) : 0
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        this.glTexture = null, this._glFrameBuffers = [], this._glMSFrameBuffers = [], this._glRenderBuffers = [], this.width = Math.max(Math.floor(e), 1), this.height = Math.max(Math.floor(t), 1), u.default.copyOptions(this, n, {
            wrapS: "EdgeClamp",
            wrapT: "EdgeClamp",
            wrapR: "EdgeClamp",
            magFilter: "Bilinear",
            minFilter: "BilinearNoMipMaps",
            anisotropy: 1,
            format: "RGBA",
            type: "UnsignedByte",
            generateMipmaps: !1,
            premultiplyAlpha: !1,
            unpackAlignment: 1,
            flipY: !0,
            depthBuffer: !0,
            stencilBuffer: !0,
            colorBuffer: !0,
            readDepthStencilBuffer: !1,
            readColorBuffer: !0,
            depthBits: 16,
            multiSampledRenderBufffer: !1,
            multisamplingSamples: 4,
            variant: "2D"
        }), !f.default.Webgl2 || "Float" !== this.type && "HalfFloat" !== this.type || -1 !== this.format.indexOf("F") || "RGBA" == this.format && ("Float" == this.type ? this.format = "RGBA32F" : this.format = "RGBA16F"), this.colorBuffer || this.depthBuffer || (console.log("Need at least one buffer for RT to be valid. Enabling Color buffer"), this.colorBuffer = !0), !f.default.Webgl2 && this.multiSampledRenderBufffer && (console.warn("Multi-sampled render targets are WebGL2.0 only and are not supported on this platform which uses WebGL1.0. Turning off multi-sampling from the render target."), this.multiSampledRenderBufffer = !1), 1 == this.multiSampledRenderBufffer && (this.magFilter = "NearestNeighbor", this.minFilter = "NearestNeighborNoMipMaps", this.depthBuffer && this.colorBuffer ? (console.log("Can only have one buffer with mulstisampled RenderTarget. Disabling depth buffer"), this.depthBuffer = !1, this.readDepthStencilBuffer = !1, this.readColorBuffer = !0) : this.depthBuffer ? (this.readDepthStencilBuffer = !0, this.readColorBuffer = !1) : this.colorBuffer && (this.readColorBuffer = !0, this.readDepthStencilBuffer = !1)), 16 !== this.depthBits && 24 !== this.depthBits && 32 !== this.depthBits && (console.log("DepthBits needs to be one of 3 values (16,24,32)"), this.depthBits = 16), (this.depthBuffer || this.stencilBuffer) && this.colorBuffer && (this.readDepthStencilBuffer && this.readColorBuffer ? (console.log("RenderTarget cannot have both depth and color buffer as read (max 1 texture)"), this.readDepthStencilBuffer = !1) : this.readDepthStencilBuffer || this.readColorBuffer || (console.log("Only one buffer without read can be enabled (max 1 renderbuffer)"), this.readColorBuffer = !0)), this.readDepthStencilBuffer && (this.depthBuffer || this.stencilBuffer) && (this.magFilter = "NearestNeighbor", this.minFilter = "NearestNeighborNoMipMaps"), this.offset = new a.default(0, 0), this.repeat = new a.default(1, 1), this.textureRecord = {}
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(37),
        a = r(o),
        s = n(92),
        u = r(s),
        l = n(26),
        f = r(l);
    i.prototype.clone = function() {
        var e = new i(this.width, this.height);
        return e.wrapS = this.wrapS, e.wrapT = this.wrapT, e.wrapR = this.wrapR, e.magFilter = this.magFilter, e.minFilter = this.minFilter, e.anisotropy = this.anisotropy, e.format = this.format, e.type = this.type, e.variant = this.variant, e.offset.copy(this.offset), e.repeat.copy(this.repeat), e.generateMipmaps = this.generateMipmaps, e.premultiplyAlpha = this.premultiplyAlpha, e.unpackAlignment = this.unpackAlignment, e.flipY = this.flipY, e.depthBuffer = this.depthBuffer, e.stencilBuffer = this.stencilBuffer, e.colorBuffer = this.colorBuffer, e.readDepthStencilBuffer = this.readDepthStencilBuffer, e.readColorBuffer = this.readColorBuffer, e.depthBits = this.depthBits, e.multiSampledRenderBufffer = this.multiSampledRenderBufffer, e.multisamplingSamples = this.multisamplingSamples, e.glTexture = this.glTexture, e
    }, i.prototype.getSizeInMemory = function() {
        var e = this.width * this.height * 4;
        return "CUBE" == this.variant && (e *= 6), this.generateMipmaps && (e = Math.ceil(4 * e / 3)), e
    }, i.prototype.destroy = function(e) {
        if (this.glTexture && (e.deleteTexture(this.glTexture), this.glTexture = null), this._glFrameBuffers) {
            for (var t = 0; t < this._glFrameBuffers.length; t++) e.deleteFramebuffer(this._glFrameBuffers[t]);
            this._glFrameBuffers = []
        }
        if (this._glMSFrameBuffers) {
            for (var n = 0; n < this._glMSFrameBuffers.length; n++) e.deleteFramebuffer(this._glMSFrameBuffers[n]);
            this._glMSFrameBuffers = []
        }
        if (this._glRenderBuffers) {
            for (var r = 0; r < this._glRenderBuffers.length; r++) e.deleteRenderbuffer(this._glRenderBuffers[r]);
            this._glRenderBuffers = []
        }
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        this._x = 0, this._y = 0, this._z = 0, this._w = 1, 0 === arguments.length ? (this.x = 0, this.y = 0, this.z = 0, this.w = 1) : 1 === arguments.length && "object" === o(arguments[0]) ? arguments[0] instanceof i ? this.copy(arguments[0]) : (this.x = arguments[0][0], this.y = arguments[0][1], this.z = arguments[0][2], this.w = arguments[0][3]) : (this.x = e, this.y = t, this.z = n, this.w = r), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(117),
        s = r(a),
        u = n(0),
        l = r(u),
        f = n(36),
        c = r(f),
        d = n(31),
        h = r(d),
        p = n(4),
        m = r(p),
        y = n(3),
        v = r(y);
    s.default.setupAliases(i.prototype, [
            ["x"],
            ["y"],
            ["z"],
            ["w"]
        ]), i.prototype.setDirect = c.default.prototype.setDirect, i.prototype.dot = c.default.prototype.dot, i.prototype.length = c.default.prototype.length, i.prototype.lengthSquared = c.default.prototype.lengthSquared, i.prototype.normalize = c.default.prototype.normalize, i.prototype.equals = c.default.prototype.equals, i.IDENTITY = new i(0, 0, 0, 1), i.prototype.copy = function(e) {
            return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this
        }, i.prototype.set = function(e) {
            return e instanceof i ? (this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w) : (this.x = arguments[0], this.y = arguments[1], this.z = arguments[2], this.w = arguments[3]), this
        }, i.slerp = function(e, t, n, r) {
            if (0 === n) return r.set(e);
            if (1 === n) return r.set(t);
            if (e.equals(t)) return r.set(e);
            var i = e.dot(t);
            r.set(t), i < 0 && (r.negate(), i = -i);
            var o = 1 - n,
                a = n;
            if (1 - i > .1) {
                var s = Math.acos(i),
                    u = 1 / Math.sin(s);
                o = Math.sin((1 - n) * s) * u, a = Math.sin(n * s) * u
            }
            var l = o * e.x + a * r.x,
                f = o * e.y + a * r.y,
                c = o * e.z + a * r.z,
                d = o * e.w + a * r.w;
            return r.setDirect(l, f, c, d), r
        }, i.prototype.negate = function() {
            return this.x *= -1, this.y *= -1, this.z *= -1, this.w *= -1, this
        }, i.prototype.conjugate = function() {
            return this.x *= -1, this.y *= -1, this.z *= -1, this
        }, i.prototype.invert = function() {
            return this.conjugate().normalize()
        }, i.prototype.mul = function(e) {
            var t = this.x,
                n = this.y,
                r = this.z,
                i = this.w,
                o = e.x,
                a = e.y,
                s = e.z,
                u = e.w;
            return this.x = t * u + i * o + n * s - r * a, this.y = n * u + i * a + r * o - t * s, this.z = r * u + i * s + t * a - n * o, this.w = i * u - t * o - n * a - r * s, this
        },
        function() {
            var e = new i;
            i.prototype.slerp = function(t, n) {
                return e.copy(t), i.slerp(this, t, n, e), this.copy(e), this
            }
        }(), i.prototype.fromRotationMatrix = function(e) {
            var t = e.e00 + e.e11 + e.e22,
                n = void 0,
                r = void 0,
                i = void 0,
                o = void 0;
            if (t >= 0) {
                var a = Math.sqrt(t + 1);
                o = .5 * a, a = .5 / a, n = (e.e21 - e.e12) * a, r = (e.e02 - e.e20) * a, i = (e.e10 - e.e01) * a
            } else if (e.e00 > e.e11 && e.e00 > e.e22) {
                var s = Math.sqrt(1 + e.e00 - e.e11 - e.e22);
                n = .5 * s, s = .5 / s, r = (e.e10 + e.e01) * s, i = (e.e02 + e.e20) * s, o = (e.e21 - e.e12) * s
            } else if (e.e11 > e.e22) {
                var u = Math.sqrt(1 + e.e11 - e.e00 - e.e22);
                r = .5 * u, u = .5 / u, n = (e.e10 + e.e01) * u, i = (e.e21 + e.e12) * u, o = (e.e02 - e.e20) * u
            } else {
                var l = Math.sqrt(1 + e.e22 - e.e00 - e.e11);
                i = .5 * l, l = .5 / l, n = (e.e02 + e.e20) * l, r = (e.e21 + e.e12) * l, o = (e.e10 - e.e01) * l
            }
            return this.setDirect(n, r, i, o)
        }, i.prototype.toRotationMatrix = function(e) {
            var t = e || new h.default,
                n = this.lengthSquared(),
                r = n > 0 ? 2 / n : 0,
                i = this.x * r,
                o = this.y * r,
                a = this.z * r,
                s = this.x * i,
                u = this.x * o,
                l = this.x * a,
                f = this.w * i,
                c = this.y * o,
                d = this.y * a,
                p = this.w * o,
                m = this.z * a,
                y = this.w * a,
                v = t.data;
            return v[0] = 1 - (c + m), v[1] = u + y, v[2] = l - p, v[3] = u - y, v[4] = 1 - (s + m), v[5] = d + f, v[6] = l + p, v[7] = d - f, v[8] = 1 - (s + c), t
        },
        function() {
            var e = new l.default;
            i.prototype.fromVectorToVector = function(t, n) {
                var r = t,
                    o = n,
                    a = r.length() * o.length();
                if (Math.abs(a) > m.default.EPSILON) {
                    var s = r.dot(o) / a,
                        u = Math.acos(Math.max(-1, Math.min(s, 1)));
                    if (e.copy(r).cross(o), s < 0 && e.length() < m.default.EPSILON) {
                        var l = void 0;
                        l = Math.abs(r.x) > Math.abs(r.y) ? Math.abs(r.x) > Math.abs(r.z) ? 0 : 2 : Math.abs(r.y) > Math.abs(r.z) ? 1 : 2, e.setComponent(l, -r.getComponent((l + 1) % 3)), e.setComponent((l + 1) % 3, r.getComponent(l)), e.setComponent((l + 2) % 3, 0)
                    }
                    return this.fromAngleAxis(u, e)
                }
                return this.set(i.IDENTITY)
            }
        }(),
        function() {
            var e = new l.default;
            i.prototype.fromAngleAxis = function(t, n) {
                return e.copy(n).normalize(), this.fromAngleNormalAxis(t, e)
            }
        }(), i.prototype.fromAngleNormalAxis = function(e, t) {
            if (t.equals(l.default.ZERO)) return this.set(i.IDENTITY);
            var n = .5 * e,
                r = Math.sin(n),
                o = Math.cos(n),
                a = r * t.x,
                s = r * t.y,
                u = r * t.z;
            return this.setDirect(a, s, u, o)
        }, i.prototype.toAngleAxis = function(e) {
            var t = this.x * this.x + this.y * this.y + this.z * this.z,
                n = void 0;
            if (Math.abs(t) <= m.default.EPSILON) n = 0, null !== e && (e.x = 1, e.y = 0, e.z = 0);
            else if (n = 2 * Math.acos(m.default.clamp(this.w, -1, 1)), null !== e) {
                var r = 1 / Math.sqrt(t);
                e.x = this.x * r, e.y = this.y * r, e.z = this.z * r
            }
            return n
        }, i.prototype.clone = function() {
            return new i(this.x, this.y, this.z, this.w)
        }, i.prototype.dot = function(e) {
            return this.x * e.x + this.y * e.y + this.z * e.z + this.w * e.w
        }, s.default.addReturnChecks(i.prototype, ["dot", "dotDirect", "length", "lengthSquared", "distance", "distanceSquared"]), i.prototype.setDirect = function(e, t, n, r) {
            return this.x = e, this.y = t, this.z = n, this.w = r, this
        }, i.prototype.setArray = function(e) {
            return this.x = e[0], this.y = e[1], this.z = e[2], this.w = e[3], this
        }, Object.defineProperty(i.prototype, "data", {
            get: v.default.warnOnce("The .data property of Quaternion was removed. Please use the .x, .y, .z and .w properties instead.", function() {
                var e = [],
                    t = this;
                return Object.defineProperties(e, {
                    0: {
                        get: function() {
                            return t.x
                        },
                        set: function(e) {
                            t.x = e
                        }
                    },
                    1: {
                        get: function() {
                            return t.y
                        },
                        set: function(e) {
                            t.y = e
                        }
                    },
                    2: {
                        get: function() {
                            return t.z
                        },
                        set: function(e) {
                            t.z = e
                        }
                    },
                    3: {
                        get: function() {
                            return t.w
                        },
                        set: function(e) {
                            t.w = e
                        }
                    }
                }), e
            })
        }), i.add = v.default.warnOnce("Quaternion.add is deprecated.", function(e, t, n) {
            return n || (n = new i), n.x = e.x + t.x, n.y = e.y + t.y, n.z = e.z + t.z, n.w = e.w + t.w, n
        }), i.div = v.default.warnOnce("Quaternion.div is deprecated", function(e, t, n) {
            n || (n = new i);
            var r = !0;
            return n.x = (r &= t.x < 0 || t.x > 0) ? e.x / t.x : 0, n.y = (r &= t.y < 0 || t.y > 0) ? e.y / t.y : 0, n.z = (r &= t.z < 0 || t.z > 0) ? e.z / t.z : 0, n.w = (r &= t.w < 0 || t.w > 0) ? e.w / t.w : 0, n
        }), i.mul = i.mul2 = v.default.warnOnce("Quaternion.mul is deprecated.", function(e, t, n) {
            var r = e.x,
                i = e.y,
                o = e.z,
                a = e.w,
                s = t.x,
                u = t.y,
                l = t.z,
                f = t.w;
            return n.x = r * f + a * s + i * l - o * u, n.y = i * f + a * u + o * s - r * l, n.z = o * f + a * l + r * u - i * s, n.w = a * f - r * s - i * u - o * l, n
        }), i.sub = v.default.warnOnce("Quaternion.sub is deprecated.", function(e, t, n) {
            return n || (n = new i), n.x = e.x - t.x, n.y = e.y - t.y, n.z = e.z - t.z, n.w = e.w - t.w, n
        }), i.prototype.add = v.default.warnOnce("Quaternion.prototype.add is deprecated.", function(e) {
            return i.add(this, e, this)
        }), i.prototype.div = v.default.warnOnce("Quaternion.prototype.div is deprecated.", function(e) {
            return i.div(this, e, this)
        }), i.prototype.magnitude = v.default.warnOnce("Quaternion.prototype.magnitude is deprecated.", function() {
            var e = this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;
            return 1 === e ? 1 : Math.sqrt(e)
        }), i.prototype.magnitudeSquared = v.default.warnOnce("Quaternion.prototype.magnitudeSquared is deprecated.", function() {
            return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
        }), i.scalarAdd = v.default.warnOnce("Quaternion.prototype.scalarAdd is deprecated.", function(e, t, n) {
            return n || (n = new i), n.x = e.x + t, n.y = e.y + t, n.z = e.z + t, n.w = e.w + t, n
        }), i.scalarDiv = v.default.warnOnce("Quaternion.scalarDiv is deprecated.", function(e, t, n) {
            n || (n = new i);
            var r = !0;
            return t = (r &= t < 0 || t > 0) ? 1 / t : 0, n.x = e.x * t, n.y = e.y * t, n.z = e.z * t, n.w = e.w * t, n
        }), i.scalarMul = v.default.warnOnce("Quaternion.scalarMul is deprecated.", function(e, t, n) {
            return n || (n = new i), n.x = e.x * t, n.y = e.y * t, n.z = e.z * t, n.w = e.w * t, n
        }), i.scalarSub = v.default.warnOnce("Quaternion.scalarSub is deprecated.", function(e, t, n) {
            return n || (n = new i), n.x = e.x - t, n.y = e.y - t, n.z = e.z - t, n.w = e.w - t, n
        }), i.prototype.setVector = v.default.warnOnce("Quaternion.prototype.setVector is deprecated.", function(e) {
            return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this
        }), i.prototype.sub = v.default.warnOnce("Quaternion.prototype.sub is deprecated.", function(e) {
            return i.sub(this, e, this)
        }), i.prototype.scalarAdd = v.default.warnOnce("Quaternion.prototype.scalarAdd is deprecated.", function(e) {
            return i.scalarAdd(this, e, this)
        }), i.prototype.scalarSub = v.default.warnOnce("Quaternion.prototype.scalarSub is deprecated.", function(e) {
            return i.scalarSub(this, e, this)
        }), i.prototype.scalarMul = v.default.warnOnce("Quaternion.prototype.scalarMul is deprecated.", function(e) {
            return i.scalarMul(this, e, this)
        }), i.prototype.scalarDiv = v.default.warnOnce("Quaternion.prototype.scalarDiv is deprecated.", function(e) {
            return i.scalarDiv(this, e, this)
        }), t.default = i
}, function(e, t, n) {
    var r = n(54);
    e.exports = function(e) {
        return Object(r(e))
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        this._x = 0, this._y = 0, this._z = 0, this._w = 0, 0 === arguments.length ? (this.x = 0, this.y = 0, this.z = 0, this.w = 0) : 1 === arguments.length && "object" === o(arguments[0]) ? arguments[0] instanceof i ? this.copy(arguments[0]) : (this.x = arguments[0][0], this.y = arguments[0][1], this.z = arguments[0][2], this.w = arguments[0][3]) : (this.x = e, this.y = t, this.z = n, this.w = r), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(3),
        s = r(a),
        u = n(4),
        l = r(u),
        f = n(117),
        c = r(f);
    i.prototype = Object.create(c.default.prototype), i.prototype.constructor = i, c.default.setupAliases(i.prototype, [
            ["x"],
            ["y"],
            ["z"],
            ["w"]
        ]), c.default.setupIndices(i.prototype, 4), c.default.setupAliases(i.prototype, [
            ["r"],
            ["g"],
            ["b"],
            ["a"]
        ]), i.ZERO = new i(0, 0, 0, 0), i.ONE = new i(1, 1, 1, 1), i.UNIT_X = new i(1, 0, 0, 0), i.UNIT_Y = new i(0, 1, 0, 0), i.UNIT_Z = new i(0, 0, 1, 0), i.UNIT_W = new i(0, 0, 0, 1), i.prototype.getComponent = function(e) {
            switch (e) {
                case 0:
                    return this.x;
                case 1:
                    return this.y;
                case 2:
                    return this.z;
                case 3:
                    return this.w
            }
        }, i.prototype.setComponent = function(e, t) {
            switch (e) {
                case 0:
                    this.x = t;
                    break;
                case 1:
                    this.y = t;
                    break;
                case 2:
                    this.z = t;
                    break;
                case 3:
                    this.w = t
            }
            return this
        }, i.prototype.add = function(e) {
            return this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this
        }, i.prototype.addDirect = function(e, t, n, r) {
            return this.x += e, this.y += t, this.z += n, this.w += r, this
        }, i.prototype.sub = function(e) {
            return this.x -= e.x, this.y -= e.y, this.z -= e.z, this.w -= e.w, this
        }, i.prototype.subDirect = function(e, t, n, r) {
            return this.x -= e, this.y -= t, this.z -= n, this.w -= r, this
        }, i.prototype.negate = function() {
            return this.x = -this.x, this.y = -this.y, this.z = -this.z, this.w = -this.w, this
        }, i.prototype.mul = function(e) {
            return this.x *= e.x, this.y *= e.y, this.z *= e.z, this.w *= e.w, this
        }, i.prototype.mulDirect = function(e, t, n, r) {
            return this.x *= e, this.y *= t, this.z *= n, this.w *= r, this
        }, i.prototype.scale = function(e) {
            return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this
        }, i.prototype.div = function(e) {
            return this.x /= e.x, this.y /= e.y, this.z /= e.z, this.w /= e.w, this
        }, i.prototype.divDirect = function(e, t, n, r) {
            return this.x /= e, this.y /= t, this.z /= n, this.w /= r, this
        }, i.prototype.dot = function(e) {
            return this.x * e.x + this.y * e.y + this.z * e.z + this.w * e.w
        }, i.prototype.dotDirect = function(e, t, n, r) {
            return this.x * e + this.y * t + this.z * n + this.w * r
        }, i.prototype.equals = function(e) {
            return Math.abs(this.x - e.x) <= l.default.EPSILON && Math.abs(this.y - e.y) <= l.default.EPSILON && Math.abs(this.z - e.z) <= l.default.EPSILON && Math.abs(this.w - e.w) <= l.default.EPSILON
        }, i.prototype.equalsDirect = function(e, t, n, r) {
            return Math.abs(this.x - e) <= l.default.EPSILON && Math.abs(this.y - t) <= l.default.EPSILON && Math.abs(this.z - n) <= l.default.EPSILON && Math.abs(this.w - r) <= l.default.EPSILON
        }, i.prototype.lerp = function(e, t) {
            return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this.z += (e.z - this.z) * t, this.w += (e.w - this.w) * t, this
        },
        function() {
            var e = new i;
            i.prototype.reflect = function(t) {
                return e.copy(t), e.scale(2 * this.dot(t)), this.sub(e), this
            }
        }(), i.prototype.set = function(e) {
            return e instanceof i ? (this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w) : (this.x = arguments[0], this.y = arguments[1], this.z = arguments[2], this.w = arguments[3]), this
        }, i.prototype.setDirect = function(e, t, n, r) {
            return this.x = e, this.y = t, this.z = n, this.w = r, this
        }, i.prototype.lengthSquared = function() {
            return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
        }, i.prototype.length = function() {
            return Math.sqrt(this.lengthSquared())
        }, i.prototype.normalize = function() {
            var e = this.length();
            return e < l.default.EPSILON ? (this.x = 0, this.y = 0, this.z = 0, this.w = 0) : (this.x /= e, this.y /= e, this.z /= e, this.w /= e), this
        }, i.prototype.unsafeNormalize = function() {
            var e = this.length();
            return this.x /= e, this.y /= e, this.z /= e, this.w /= e, this
        }, i.prototype.distanceSquared = function(e) {
            var t = this.x - e.x,
                n = this.y - e.y,
                r = this.z - e.z,
                i = this.w - e.w;
            return t * t + n * n + r * r + i * i
        }, i.prototype.distance = function(e) {
            return Math.sqrt(this.distanceSquared(e))
        }, i.prototype.applyPre = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z,
                o = this.w;
            return this.x = t[0] * n + t[1] * r + t[2] * i + t[3] * o, this.y = t[4] * n + t[5] * r + t[6] * i + t[7] * o, this.z = t[8] * n + t[9] * r + t[10] * i + t[11] * o, this.w = t[12] * n + t[13] * r + t[14] * i + t[15] * o, this
        }, i.prototype.applyPost = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y,
                i = this.z,
                o = this.w;
            return this.x = t[0] * n + t[4] * r + t[8] * i + t[12] * o, this.y = t[1] * n + t[5] * r + t[9] * i + t[13] * o, this.z = t[2] * n + t[6] * r + t[10] * i + t[14] * o, this.w = t[3] * n + t[7] * r + t[11] * i + t[15] * o, this
        }, i.prototype.clone = function() {
            return new i(this.x, this.y, this.z, this.w)
        }, i.prototype.copy = i.prototype.set, i.prototype.copyTo = function(e) {
            return e.x = this.x, e.y = this.y, e.z = this.z, e.w = this.w, this
        }, i.fromArray = function(e) {
            return new i(e[0], e[1], e[2], e[3])
        }, i.fromAny = function() {
            if (4 === arguments.length) return i.fromArray(arguments);
            if (arguments[0] instanceof Array) return i.fromArray(arguments[0]);
            var e = arguments[0];
            return new i(e.x, e.y, e.z, e.w)
        }, i.prototype.setArray = function(e) {
            return this.x = e[0], this.y = e[1], this.z = e[2], this.w = e[3], this
        }, i.prototype.toArray = function() {
            return [this.x, this.y, this.z, this.w]
        }, c.default.addReturnChecks(i.prototype, ["dot", "dotDirect", "length", "lengthSquared", "distance", "distanceSquared"]), Object.defineProperty(i.prototype, "data", {
            get: s.default.warnOnce("The .data property of Vector4 was removed. Please use the .x, .y, .z and .w properties instead.", function() {
                var e = [],
                    t = this;
                return Object.defineProperties(e, {
                    0: {
                        get: function() {
                            return t.x
                        },
                        set: function(e) {
                            t.x = e
                        }
                    },
                    1: {
                        get: function() {
                            return t.y
                        },
                        set: function(e) {
                            t.y = e
                        }
                    },
                    2: {
                        get: function() {
                            return t.z
                        },
                        set: function(e) {
                            t.z = e
                        }
                    },
                    3: {
                        get: function() {
                            return t.w
                        },
                        set: function(e) {
                            t.w = e
                        }
                    }
                }), e
            })
        }), i.prototype.setVector = s.default.warnOnce("The setVector method of Vector4 is deprecated. Please use the set method instead.", function(e) {
            return this.set(e)
        }), i.add = s.default.warnOnce("Vector4.add is deprecated. Use Vector4.prototype.add instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e, e]), "number" == typeof t && (t = [t, t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] + o[0], n.data[1] = r[1] + o[1], n.data[2] = r[2] + o[2], n.data[3] = r[3] + o[3], n
        }), i.sub = s.default.warnOnce("Vector4.sub is deprecated. Use Vector4.prototype.sub instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e, e]), "number" == typeof t && (t = [t, t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] - o[0], n.data[1] = r[1] - o[1], n.data[2] = r[2] - o[2], n.data[3] = r[3] - o[3], n
        }), i.mul = s.default.warnOnce("Vector4.mul is deprecated. Use Vector4.prototype.mul instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e, e]), "number" == typeof t && (t = [t, t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] * o[0], n.data[1] = r[1] * o[1], n.data[2] = r[2] * o[2], n.data[3] = r[3] * o[3], n
        }), i.div = s.default.warnOnce("Vector4.div is deprecated. Use Vector4.prototype.div instead.", function(e, t, n) {
            "number" == typeof e && (e = [e, e, e, e]), "number" == typeof t && (t = [t, t, t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] / o[0], n.data[1] = r[1] / o[1], n.data[2] = r[2] / o[2], n.data[3] = r[3] / o[3], n
        }), i.dot = s.default.warnOnce("Vector4.dot is deprecated. Use Vector4.prototype.dot instead.", function(e, t) {
            "number" == typeof e && (e = [e, e, e, e]), "number" == typeof t && (t = [t, t, t, t]);
            var n = e.data || e,
                r = t.data || t;
            return n[0] * r[0] + n[1] * r[1] + n[2] * r[2] + n[3] * r[3]
        }), i.prototype.addVector = s.default.warnOnce("Vector4.prototype.addVector is deprecated. Use .add instead.", function(e) {
            return this.data[0] += e.data[0], this.data[1] += e.data[1], this.data[2] += e.data[2], this.data[3] += e.data[3], this
        }), i.prototype.dotVector = s.default.warnOnce("Vector4.prototype.dotVector is deprecated. Use .dot instead.", function(e) {
            var t = this.data,
                n = e.data;
            return t[0] * n[0] + t[1] * n[1] + t[2] * n[2] + t[3] * n[3]
        }), i.prototype.mulVector = s.default.warnOnce("Vector4.prototype.mulVector is deprecated. Use .mul instead.", function(e) {
            return this.data[0] *= e.data[0], this.data[1] *= e.data[1], this.data[2] *= e.data[2], this.data[3] *= e.data[3], this
        }), i.prototype.setVector = s.default.warnOnce("Vector4.prototype.setVector is deprecated. Use .set instead.", function(e) {
            return this.data[0] = e.data[0], this.data[1] = e.data[1], this.data[2] = e.data[2], this.data[3] = e.data[3], this
        }), i.prototype.subVector = s.default.warnOnce("Vector4.prototype.subVector is deprecated. Use .sub instead.", function(e) {
            return this.data[0] -= e.data[0], this.data[1] -= e.data[1], this.data[2] -= e.data[2], this.data[3] -= e.data[3], this
        }), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this._x = 0, this._y = 0, 0 === arguments.length ? (this.x = 0, this.y = 0) : 1 === arguments.length && "object" === o(arguments[0]) ? arguments[0] instanceof i ? this.copy(arguments[0]) : (this.x = arguments[0][0], this.y = arguments[0][1]) : (this.x = e, this.y = t), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(3),
        s = r(a),
        u = n(4),
        l = r(u),
        f = n(117),
        c = r(f),
        d = n(0),
        h = r(d),
        p = n(36),
        m = r(p);
    i.prototype = Object.create(c.default.prototype), i.prototype.constructor = i, c.default.setupAliases(i.prototype, [
            ["x"],
            ["y"]
        ]), c.default.setupIndices(i.prototype, 2), c.default.setupAliases(i.prototype, [
            ["u"],
            ["v"]
        ]), i.ZERO = new i(0, 0), i.ONE = new i(1, 1), i.UNIT_X = new i(1, 0), i.UNIT_Y = new i(0, 1), i.prototype.getComponent = function(e) {
            switch (e) {
                case 0:
                    return this.x;
                case 1:
                    return this.y
            }
        }, i.prototype.setComponent = function(e, t) {
            switch (e) {
                case 0:
                    this.x = t;
                    break;
                case 1:
                    this.y = t
            }
            return this
        }, i.prototype.add = function(e) {
            return this.x += e.x, this.y += e.y, this
        }, i.prototype.addDirect = function(e, t) {
            return this.x += e, this.y += t, this
        }, i.prototype.sub = function(e) {
            return this.x -= e.x, this.y -= e.y, this
        }, i.prototype.subDirect = function(e, t) {
            return this.x -= e, this.y -= t, this
        }, i.prototype.negate = function() {
            return this.x = -this.x, this.y = -this.y, this
        }, i.prototype.mul = function(e) {
            return this.x *= e.x, this.y *= e.y, this
        }, i.prototype.mulDirect = function(e, t) {
            return this.x *= e, this.y *= t, this
        }, i.prototype.scale = function(e) {
            return this.x *= e, this.y *= e, this
        }, i.prototype.div = function(e) {
            return this.x /= e.x, this.y /= e.y, this
        }, i.prototype.divDirect = function(e, t) {
            return this.x /= e, this.y /= t, this
        }, i.prototype.dot = function(e) {
            return this.x * e.x + this.y * e.y
        }, i.prototype.dotDirect = function(e, t) {
            return this.x * e + this.y * t
        }, i.prototype.equals = function(e) {
            return Math.abs(this.x - e.x) <= l.default.EPSILON && Math.abs(this.y - e.y) <= l.default.EPSILON
        }, i.prototype.equalsDirect = function(e, t) {
            return Math.abs(this.x - e) <= l.default.EPSILON && Math.abs(this.y - t) <= l.default.EPSILON
        }, i.prototype.lerp = function(e, t) {
            return this.x += (e.x - this.x) * t, this.y += (e.y - this.y) * t, this
        },
        function() {
            var e = new i;
            i.prototype.reflect = function(t) {
                return e.copy(t), e.scale(2 * this.dot(t)), this.sub(e), this
            }
        }(), i.prototype.set = function(e) {
            return e instanceof i || e instanceof h.default || e instanceof m.default ? (this.x = e.x, this.y = e.y) : (this.x = arguments[0], this.y = arguments[1]), this
        }, i.prototype.setDirect = function(e, t) {
            return this.x = e, this.y = t, this
        }, i.prototype.lengthSquared = function() {
            return this.x * this.x + this.y * this.y
        }, i.prototype.length = function() {
            return Math.sqrt(this.lengthSquared())
        }, i.prototype.normalize = function() {
            var e = this.length();
            return e < l.default.EPSILON ? (this.x = 0, this.y = 0) : (this.x /= e, this.y /= e), this
        }, i.prototype.unsafeNormalize = function() {
            var e = this.length();
            return this.x /= e, this.y /= e, this
        }, i.prototype.distanceSquared = function(e) {
            var t = this.x - e.x,
                n = this.y - e.y;
            return t * t + n * n
        }, i.prototype.distance = function(e) {
            return Math.sqrt(this.distanceSquared(e))
        }, i.prototype.applyPre = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y;
            return this.x = t[0] * n + t[1] * r, this.y = t[2] * n + t[3] * r, this
        }, i.prototype.applyPost = function(e) {
            var t = e.data,
                n = this.x,
                r = this.y;
            return this.x = t[0] * n + t[2] * r, this.y = t[1] * n + t[3] * r, this
        }, i.prototype.clone = function() {
            return new i(this.x, this.y)
        }, i.prototype.copy = i.prototype.set, i.prototype.copyTo = function(e) {
            return e.x = this.x, e.y = this.y, this
        }, i.fromArray = function(e) {
            return new i(e[0], e[1])
        }, i.fromAny = function() {
            if (2 === arguments.length) return i.fromArray(arguments);
            if (arguments[0] instanceof Array) return i.fromArray(arguments[0]);
            var e = arguments[0];
            return new i(e.x, e.y)
        }, i.prototype.setArray = function(e) {
            return this.x = e[0], this.y = e[1], this
        }, i.prototype.toArray = function() {
            return [this.x, this.y]
        }, c.default.addReturnChecks(i.prototype, ["dot", "dotDirect", "length", "lengthSquared", "distance", "distanceSquared"]), Object.defineProperty(i.prototype, "data", {
            get: s.default.warnOnce("The .data property of Vector2 was removed. Please use the .x and .y properties instead.", function() {
                var e = [],
                    t = this;
                return Object.defineProperties(e, {
                    0: {
                        get: function() {
                            return t.x
                        },
                        set: function(e) {
                            t.x = e
                        }
                    },
                    1: {
                        get: function() {
                            return t.y
                        },
                        set: function(e) {
                            t.y = e
                        }
                    }
                }), e
            })
        }), i.prototype.setVector = s.default.warnOnce("The setVector method of Vector2 was removed. Please use the set method instead.", function(e) {
            return this.set(e)
        }), i.add = s.default.warnOnce("Vector2.add is deprecated.", function(e, t, n) {
            "number" == typeof e && (e = [e, e]), "number" == typeof t && (t = [t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] + o[0], n.data[1] = r[1] + o[1], n
        }), i.sub = s.default.warnOnce("Vector2.sub is deprecated.", function(e, t, n) {
            "number" == typeof e && (e = [e, e]), "number" == typeof t && (t = [t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] - o[0], n.data[1] = r[1] - o[1], n
        }), i.mul = s.default.warnOnce("Vector2.mul is deprecated.", function(e, t, n) {
            "number" == typeof e && (e = [e, e]), "number" == typeof t && (t = [t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] * o[0], n.data[1] = r[1] * o[1], n
        }), i.div = s.default.warnOnce("Vector2.div is deprecated.", function(e, t, n) {
            "number" == typeof e && (e = [e, e]), "number" == typeof t && (t = [t, t]), n || (n = new i);
            var r = e.data || e,
                o = t.data || t;
            return n.data[0] = r[0] / o[0], n.data[1] = r[1] / o[1], n
        }), i.dot = s.default.warnOnce("Vector2.dot is deprecated.", function(e, t) {
            "number" == typeof e && (e = [e, e]), "number" == typeof t && (t = [t, t]);
            var n = e.data || e,
                r = t.data || t;
            return n[0] * r[0] + n[1] * r[1]
        }), i.prototype.dotVector = s.default.warnOnce("Vector2.prototype.dotVector is deprecated.", function(e) {
            var t = this.data,
                n = e.data;
            return t[0] * n[0] + t[1] * n[1]
        }), i.prototype.addVector = s.default.warnOnce("Vector2.prototype.addVector is deprecated.", function(e) {
            return this.data[0] += e.data[0], this.data[1] += e.data[1], this
        }), i.prototype.mulVector = s.default.warnOnce("Vector2.prototype.mulVector is deprecated.", function(e) {
            return this.data[0] *= e.data[0], this.data[1] *= e.data[1], this
        }), i.prototype.subVector = s.default.warnOnce("Vector2.prototype.subVector is deprecated.", function(e) {
            return this.data[0] -= e.data[0], this.data[1] -= e.data[1], this
        }), i.prototype.smoothDamp = function() {
            var e = new i;
            return function(t, n, r, i, o) {
                e.y = n.x, this.x = l.default.smoothDamp(this.x, t.x, e, r, i, o), n.x = e.y, e.y = n.y, this.y = l.default.smoothDamp(this.y, t.y, e, r, i, o), n.y = e.y
            }
        }(),
        //! schteppe: not shimming Vector2.prototype.seta, it's been warned about forever
        //! schteppe: not shimming Vector2.prototype.setd, it's been warned about forever
        //! schteppe: not shimming Vector2.prototype.setv, it's been warned about forever
        t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        if (l.default.call(this, 4, 4), 0 === arguments.length) this.data[0] = 1, this.data[5] = 1, this.data[10] = 1, this.data[15] = 1;
        else if (1 === arguments.length && "object" === o(arguments[0])) arguments[0] instanceof i ? this.copy(arguments[0]) : this.setArray(arguments[0]);
        else
            for (var e = 0; e < arguments.length; e++) this.data[e] = arguments[e];
        Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(4),
        s = r(a),
        u = n(145),
        l = r(u),
        f = n(3),
        c = r(f);
    i.prototype = Object.create(l.default.prototype), i.prototype.constructor = i, l.default.setupAliases(i.prototype, [
            ["e00"],
            ["e10"],
            ["e20"],
            ["e30"],
            ["e01"],
            ["e11"],
            ["e21"],
            ["e31"],
            ["e02"],
            ["e12"],
            ["e22"],
            ["e32"],
            ["e03"],
            ["e13"],
            ["e23"],
            ["e33"]
        ]), i.IDENTITY = new i(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), i.prototype.add = function(e) {
            var t = this.data,
                n = e.data;
            return t[0] += n[0], t[1] += n[1], t[2] += n[2], t[3] += n[3], t[4] += n[4], t[5] += n[5], t[6] += n[6], t[7] += n[7], t[8] += n[8], t[9] += n[9], t[10] += n[10], t[11] += n[11], t[12] += n[12], t[13] += n[13], t[14] += n[14], t[15] += n[15], this
        }, i.prototype.sub = function(e) {
            var t = this.data,
                n = e.data;
            return t[0] -= n[0], t[1] -= n[1], t[2] -= n[2], t[3] -= n[3], t[4] -= n[4], t[5] -= n[5], t[6] -= n[6], t[7] -= n[7], t[8] -= n[8], t[9] -= n[9], t[10] -= n[10], t[11] -= n[11], t[12] -= n[12], t[13] -= n[13], t[14] -= n[14], t[15] -= n[15], this
        }, i.prototype.scale = function(e) {
            var t = this.data;
            return t[0] *= e, t[1] *= e, t[2] *= e, t[3] *= e, t[4] *= e, t[5] *= e, t[6] *= e, t[7] *= e, t[8] *= e, t[9] *= e, t[10] *= e, t[11] *= e, t[12] *= e, t[13] *= e, t[14] *= e, t[15] *= e, this
        }, i.prototype.mul = function(e) {
            var t = this.data,
                n = t[0],
                r = t[4],
                i = t[8],
                o = t[12],
                a = t[1],
                s = t[5],
                u = t[9],
                l = t[13],
                f = t[2],
                c = t[6],
                d = t[10],
                h = t[14],
                p = t[3],
                m = t[7],
                y = t[11],
                v = t[15],
                _ = e.data,
                g = _[0],
                b = _[4],
                x = _[8],
                w = _[12],
                E = _[1],
                S = _[5],
                M = _[9],
                C = _[13],
                T = _[2],
                R = _[6],
                A = _[10],
                O = _[14],
                P = _[3],
                D = _[7],
                I = _[11],
                k = _[15],
                N = this.data;
            return N[0] = n * g + r * E + i * T + o * P, N[4] = n * b + r * S + i * R + o * D, N[8] = n * x + r * M + i * A + o * I, N[12] = n * w + r * C + i * O + o * k, N[1] = a * g + s * E + u * T + l * P, N[5] = a * b + s * S + u * R + l * D, N[9] = a * x + s * M + u * A + l * I, N[13] = a * w + s * C + u * O + l * k, N[2] = f * g + c * E + d * T + h * P, N[6] = f * b + c * S + d * R + h * D, N[10] = f * x + c * M + d * A + h * I, N[14] = f * w + c * C + d * O + h * k, N[3] = p * g + m * E + y * T + v * P, N[7] = p * b + m * S + y * R + v * D, N[11] = p * x + m * M + y * A + v * I, N[15] = p * w + m * C + y * O + v * k, this
        }, i.prototype.mul2 = function(e, t) {
            var n = e.data,
                r = n[0],
                i = n[4],
                o = n[8],
                a = n[12],
                s = n[1],
                u = n[5],
                l = n[9],
                f = n[13],
                c = n[2],
                d = n[6],
                h = n[10],
                p = n[14],
                m = n[3],
                y = n[7],
                v = n[11],
                _ = n[15],
                g = t.data,
                b = g[0],
                x = g[4],
                w = g[8],
                E = g[12],
                S = g[1],
                M = g[5],
                C = g[9],
                T = g[13],
                R = g[2],
                A = g[6],
                O = g[10],
                P = g[14],
                D = g[3],
                I = g[7],
                k = g[11],
                N = g[15],
                L = this.data;
            return L[0] = r * b + i * S + o * R + a * D, L[4] = r * x + i * M + o * A + a * I, L[8] = r * w + i * C + o * O + a * k, L[12] = r * E + i * T + o * P + a * N, L[1] = s * b + u * S + l * R + f * D, L[5] = s * x + u * M + l * A + f * I, L[9] = s * w + u * C + l * O + f * k, L[13] = s * E + u * T + l * P + f * N, L[2] = c * b + d * S + h * R + p * D, L[6] = c * x + d * M + h * A + p * I, L[10] = c * w + d * C + h * O + p * k, L[14] = c * E + d * T + h * P + p * N, L[3] = m * b + y * S + v * R + _ * D, L[7] = m * x + y * M + v * A + _ * I, L[11] = m * w + y * C + v * O + _ * k, L[15] = m * E + y * T + v * P + _ * N, this
        }, i.prototype.transpose = function() {
            var e = this.data,
                t = e[4],
                n = e[8],
                r = e[12],
                i = e[9],
                o = e[13],
                a = e[14];
            return e[4] = e[1], e[8] = e[2], e[12] = e[3], e[9] = e[6], e[13] = e[7], e[14] = e[11], e[1] = t, e[2] = n, e[3] = r, e[6] = i, e[7] = o, e[11] = a, this
        }, i.invert = function(e, t) {
            if (t || (t = new i), t === e) return t.copy(i.invert(e));
            var n = e.determinant();
            if (!n)
                //! AT: why not Math.abs(det) < MathUtils.EPSILON ? (I don't dare change it)
                return t;
            var r = e.data,
                o = t.data;
            return n = 1 / n, o[0] = (r[5] * (r[10] * r[15] - r[14] * r[11]) - r[9] * (r[6] * r[15] - r[14] * r[7]) + r[13] * (r[6] * r[11] - r[10] * r[7])) * n, o[1] = (r[1] * (r[14] * r[11] - r[10] * r[15]) - r[9] * (r[14] * r[3] - r[2] * r[15]) + r[13] * (r[10] * r[3] - r[2] * r[11])) * n, o[2] = (r[1] * (r[6] * r[15] - r[14] * r[7]) - r[5] * (r[2] * r[15] - r[14] * r[3]) + r[13] * (r[2] * r[7] - r[6] * r[3])) * n, o[3] = (r[1] * (r[10] * r[7] - r[6] * r[11]) - r[5] * (r[10] * r[3] - r[2] * r[11]) + r[9] * (r[6] * r[3] - r[2] * r[7])) * n, o[4] = (r[4] * (r[14] * r[11] - r[10] * r[15]) - r[8] * (r[14] * r[7] - r[6] * r[15]) + r[12] * (r[10] * r[7] - r[6] * r[11])) * n, o[5] = (r[0] * (r[10] * r[15] - r[14] * r[11]) - r[8] * (r[2] * r[15] - r[14] * r[3]) + r[12] * (r[2] * r[11] - r[10] * r[3])) * n, o[6] = (r[0] * (r[14] * r[7] - r[6] * r[15]) - r[4] * (r[14] * r[3] - r[2] * r[15]) + r[12] * (r[6] * r[3] - r[2] * r[7])) * n, o[7] = (r[0] * (r[6] * r[11] - r[10] * r[7]) - r[4] * (r[2] * r[11] - r[10] * r[3]) + r[8] * (r[2] * r[7] - r[6] * r[3])) * n, o[8] = (r[4] * (r[9] * r[15] - r[13] * r[11]) - r[8] * (r[5] * r[15] - r[13] * r[7]) + r[12] * (r[5] * r[11] - r[9] * r[7])) * n, o[9] = (r[0] * (r[13] * r[11] - r[9] * r[15]) - r[8] * (r[13] * r[3] - r[1] * r[15]) + r[12] * (r[9] * r[3] - r[1] * r[11])) * n, o[10] = (r[0] * (r[5] * r[15] - r[13] * r[7]) - r[4] * (r[1] * r[15] - r[13] * r[3]) + r[12] * (r[1] * r[7] - r[5] * r[3])) * n, o[11] = (r[0] * (r[9] * r[7] - r[5] * r[11]) - r[4] * (r[9] * r[3] - r[1] * r[11]) + r[8] * (r[5] * r[3] - r[1] * r[7])) * n, o[12] = (r[4] * (r[13] * r[10] - r[9] * r[14]) - r[8] * (r[13] * r[6] - r[5] * r[14]) + r[12] * (r[9] * r[6] - r[5] * r[10])) * n, o[13] = (r[0] * (r[9] * r[14] - r[13] * r[10]) - r[8] * (r[1] * r[14] - r[13] * r[2]) + r[12] * (r[1] * r[10] - r[9] * r[2])) * n, o[14] = (r[0] * (r[13] * r[6] - r[5] * r[14]) - r[4] * (r[13] * r[2] - r[1] * r[14]) + r[12] * (r[5] * r[2] - r[1] * r[6])) * n, o[15] = (r[0] * (r[5] * r[10] - r[9] * r[6]) - r[4] * (r[1] * r[10] - r[9] * r[2]) + r[8] * (r[1] * r[6] - r[5] * r[2])) * n, t
        }, i.prototype.invert = function() {
            return i.invert(this, this)
        }, i.prototype.isOrthogonal = function() {
            var e = void 0;
            return e = this.e00 * this.e01 + this.e10 * this.e11 + this.e20 * this.e21 + this.e30 * this.e31, !(Math.abs(e) > s.default.EPSILON) && (e = this.e00 * this.e02 + this.e10 * this.e12 + this.e20 * this.e22 + this.e30 * this.e32, !(Math.abs(e) > s.default.EPSILON) && (e = this.e00 * this.e03 + this.e10 * this.e13 + this.e20 * this.e23 + this.e30 * this.e33, !(Math.abs(e) > s.default.EPSILON) && (e = this.e01 * this.e02 + this.e11 * this.e12 + this.e21 * this.e22 + this.e31 * this.e32, !(Math.abs(e) > s.default.EPSILON) && (e = this.e01 * this.e03 + this.e11 * this.e13 + this.e21 * this.e23 + this.e31 * this.e33, !(Math.abs(e) > s.default.EPSILON) && (e = this.e02 * this.e03 + this.e12 * this.e13 + this.e22 * this.e23 + this.e32 * this.e33, !(Math.abs(e) > s.default.EPSILON))))))
        }, i.prototype.isNormal = function() {
            var e = void 0;
            return e = this.e00 * this.e00 + this.e10 * this.e10 + this.e20 * this.e20 + this.e30 * this.e30, !(Math.abs(e - 1) > s.default.EPSILON) && (e = this.e01 * this.e01 + this.e11 * this.e11 + this.e21 * this.e21 + this.e31 * this.e31, !(Math.abs(e - 1) > s.default.EPSILON) && (e = this.e02 * this.e02 + this.e12 * this.e12 + this.e22 * this.e22 + this.e32 * this.e32, !(Math.abs(e - 1) > s.default.EPSILON) && (e = this.e03 * this.e03 + this.e13 * this.e13 + this.e23 * this.e23 + this.e33 * this.e33, !(Math.abs(e - 1) > s.default.EPSILON))))
        }, i.prototype.isOrthonormal = function() {
            return this.isOrthogonal() && this.isNormal()
        }, i.prototype.determinant = function() {
            var e = this.data,
                t = e[5] * e[10] * e[15] + e[9] * e[14] * e[7] + e[13] * e[6] * e[11] - e[13] * e[10] * e[7] - e[9] * e[6] * e[15] - e[5] * e[14] * e[11],
                n = e[1] * e[10] * e[15] + e[9] * e[14] * e[3] + e[13] * e[2] * e[11] - e[13] * e[10] * e[3] - e[9] * e[2] * e[15] - e[1] * e[14] * e[11],
                r = e[1] * e[6] * e[15] + e[5] * e[14] * e[3] + e[13] * e[2] * e[7] - e[13] * e[6] * e[3] - e[5] * e[2] * e[15] - e[1] * e[14] * e[7],
                i = e[1] * e[6] * e[11] + e[5] * e[10] * e[3] + e[9] * e[2] * e[7] - e[9] * e[6] * e[3] - e[5] * e[2] * e[11] - e[1] * e[10] * e[7];
            return e[0] * t - e[4] * n + e[8] * r - e[12] * i
        },
        //! AT: matrix.set(Matrix3.IDENTITY);
        i.prototype.setIdentity = function() {
            var e = this.data;
            return e[0] = 1, e[1] = 0, e[2] = 0, e[3] = 0, e[4] = 0, e[5] = 1, e[6] = 0, e[7] = 0, e[8] = 0, e[9] = 0, e[10] = 1, e[11] = 0, e[12] = 0, e[13] = 0, e[14] = 0, e[15] = 1, this
        }, i.prototype.setRotationFromVector = function(e) {
            var t = Math.sin(e.x),
                n = Math.cos(e.x),
                r = Math.sin(e.y),
                i = Math.cos(e.y),
                o = Math.sin(e.z),
                a = Math.cos(e.z),
                s = this.data;
            return s[0] = a * i, s[1] = o * i, s[2] = 0 - r, s[4] = a * r * t - o * n, s[5] = o * r * t + a * n, s[6] = i * t, s[8] = a * r * n + o * t, s[9] = o * r * n - a * t, s[10] = i * n, this
        }, i.prototype.setRotationFromQuaternion = function(e) {
            var t = e.lengthSquared();
            t = t > 0 ? 2 / t : 0; //! AT: epsilon?
            var n = e.x * t,
                r = e.y * t,
                i = e.z * t,
                o = e.w * n,
                a = e.w * r,
                s = e.w * i,
                u = e.x * n,
                l = e.x * r,
                f = e.x * i,
                c = e.y * r,
                d = e.y * i,
                h = e.z * i,
                p = this.data;
            return p[0] = 1 - c - h, p[1] = l + s, p[2] = f - a, p[4] = l - s, p[5] = 1 - u - h, p[6] = d + o, p[8] = f + a, p[9] = d - o, p[10] = 1 - u - c, this
        }, i.prototype.setTranslation = function(e) {
            return this.data[12] = e.x, this.data[13] = e.y, this.data[14] = e.z, this
        }, i.prototype.getTranslation = function(e) {
            return e.x = this.data[12], e.y = this.data[13], e.z = this.data[14], this
        }, i.prototype.getRotation = function(e) {
            var t = this.data,
                n = e.data;
            return n[0] = t[0], n[1] = t[1], n[2] = t[2], n[3] = t[4], n[4] = t[5], n[5] = t[6], n[6] = t[8], n[7] = t[9], n[8] = t[10], this
        }, i.prototype.getScale = function(e) {
            //! AT: length?
            var t = Math.sqrt(e.setDirect(this.data[0], this.data[4], this.data[8]).lengthSquared()),
                n = Math.sqrt(e.setDirect(this.data[1], this.data[5], this.data[9]).lengthSquared()),
                r = Math.sqrt(e.setDirect(this.data[2], this.data[6], this.data[10]).lengthSquared());
            return e.x = t, e.y = n, e.z = r, this
        }, i.prototype.setScale = function(e) {
            var t = this.data,
                n = e.x,
                r = e.y,
                i = e.z;
            return t[0] = n, t[5] = r, t[10] = i, this
        }, i.prototype.scale = function(e) {
            var t = this.data,
                n = e.x,
                r = e.y,
                i = e.z;
            return t[0] *= n, t[1] *= r, t[2] *= i, t[4] *= n, t[5] *= r, t[6] *= i, t[8] *= n, t[9] *= r, t[10] *= i, this
        }, i.prototype.decompose = function(e, t, n) {
            var r = this.data,
                i = e.set(r[0], r[1], r[2]).length(),
                o = e.set(r[4], r[5], r[6]).length(),
                a = e.set(r[8], r[9], r[10]).length();
            this.determinant() < 0 && (i = -i), e.x = r[12], e.y = r[13], e.z = r[14], t.copyMatrix4(this);
            var s = 1 / i,
                u = 1 / o,
                l = 1 / a,
                f = t.data;
            return f[0] *= s, f[1] *= s, f[2] *= s, f[3] *= u, f[4] *= u, f[5] *= u, f[6] *= l, f[7] *= l, f[8] *= l, n.x = i, n.y = o, n.z = a, this
        }, i.prototype.equals = function(e, t) {
            var n = this.data,
                r = e.data,
                i = void 0 === t ? s.default.EPSILON : t;
            return 0 === i ? n[0] === r[0] && n[1] === r[1] && n[2] === r[2] && n[3] === r[3] && n[4] === r[4] && n[5] === r[5] && n[6] === r[6] && n[7] === r[7] && n[8] === r[8] && n[9] === r[9] && n[10] === r[10] && n[11] === r[11] && n[12] === r[12] && n[13] === r[13] && n[14] === r[14] && n[15] === r[15] : Math.abs(n[0] - r[0]) <= i && Math.abs(n[1] - r[1]) <= i && Math.abs(n[2] - r[2]) <= i && Math.abs(n[3] - r[3]) <= i && Math.abs(n[4] - r[4]) <= i && Math.abs(n[5] - r[5]) <= i && Math.abs(n[6] - r[6]) <= i && Math.abs(n[7] - r[7]) <= i && Math.abs(n[8] - r[8]) <= i && Math.abs(n[9] - r[9]) <= i && Math.abs(n[10] - r[10]) <= i && Math.abs(n[11] - r[11]) <= i && Math.abs(n[12] - r[12]) <= i && Math.abs(n[13] - r[13]) <= i && Math.abs(n[14] - r[14]) <= i && Math.abs(n[15] - r[15]) <= i
        }, i.prototype.copy = function(e) {
            var t = this.data,
                n = e.data;
            return t[0] = n[0], t[1] = n[1], t[2] = n[2], t[3] = n[3], t[4] = n[4], t[5] = n[5], t[6] = n[6], t[7] = n[7], t[8] = n[8], t[9] = n[9], t[10] = n[10], t[11] = n[11], t[12] = n[12], t[13] = n[13], t[14] = n[14], t[15] = n[15], this
        }, i.prototype.setArray = function(e) {
            var t = this.data;
            return t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[3], t[4] = e[4], t[5] = e[5], t[6] = e[6], t[7] = e[7], t[8] = e[8], t[9] = e[9], t[10] = e[10], t[11] = e[11], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15], this
        }, i.prototype.set = i.prototype.copy, i.prototype.clone = function() {
            return (new i).copy(this)
        }, i.add = c.default.warnOnce("Matrix4.add is deprecated, use Matrix4.prototype.add instead", function(e, t, n) {
            return n || (n = new i), t instanceof i ? (n.e00 = e.e00 + t.e00, n.e10 = e.e10 + t.e10, n.e20 = e.e20 + t.e20, n.e30 = e.e30 + t.e30, n.e01 = e.e01 + t.e01, n.e11 = e.e11 + t.e11, n.e21 = e.e21 + t.e21, n.e31 = e.e31 + t.e31, n.e02 = e.e02 + t.e02, n.e12 = e.e12 + t.e12, n.e22 = e.e22 + t.e22, n.e32 = e.e32 + t.e32, n.e03 = e.e03 + t.e03, n.e13 = e.e13 + t.e13, n.e23 = e.e23 + t.e23, n.e33 = e.e33 + t.e33) : (n.e00 = e.e00 + t, n.e10 = e.e10 + t, n.e20 = e.e20 + t, n.e30 = e.e30 + t, n.e01 = e.e01 + t, n.e11 = e.e11 + t, n.e21 = e.e21 + t, n.e31 = e.e31 + t, n.e02 = e.e02 + t, n.e12 = e.e12 + t, n.e22 = e.e22 + t, n.e32 = e.e32 + t, n.e03 = e.e03 + t, n.e13 = e.e13 + t, n.e23 = e.e23 + t, n.e33 = e.e33 + t), n
        }), i.sub = c.default.warnOnce("Matrix4.sub is deprecated", function(e, t, n) {
            return n || (n = new i), t instanceof i ? (n.e00 = e.e00 - t.e00, n.e10 = e.e10 - t.e10, n.e20 = e.e20 - t.e20, n.e30 = e.e30 - t.e30, n.e01 = e.e01 - t.e01, n.e11 = e.e11 - t.e11, n.e21 = e.e21 - t.e21, n.e31 = e.e31 - t.e31, n.e02 = e.e02 - t.e02, n.e12 = e.e12 - t.e12, n.e22 = e.e22 - t.e22, n.e32 = e.e32 - t.e32, n.e03 = e.e03 - t.e03, n.e13 = e.e13 - t.e13, n.e23 = e.e23 - t.e23, n.e33 = e.e33 - t.e33) : (n.e00 = e.e00 - t, n.e10 = e.e10 - t, n.e20 = e.e20 - t, n.e30 = e.e30 - t, n.e01 = e.e01 - t, n.e11 = e.e11 - t, n.e21 = e.e21 - t, n.e31 = e.e31 - t, n.e02 = e.e02 - t, n.e12 = e.e12 - t, n.e22 = e.e22 - t, n.e32 = e.e32 - t, n.e03 = e.e03 - t, n.e13 = e.e13 - t, n.e23 = e.e23 - t, n.e33 = e.e33 - t), n
        }), i.mul = c.default.warnOnce("Matrix4.mul is deprecated, use Matrix4.prototype.mul instead", function(e, t, n) {
            return n || (n = new i), t instanceof i ? (n.e00 = e.e00 * t.e00, n.e10 = e.e10 * t.e10, n.e20 = e.e20 * t.e20, n.e30 = e.e30 * t.e30, n.e01 = e.e01 * t.e01, n.e11 = e.e11 * t.e11, n.e21 = e.e21 * t.e21, n.e31 = e.e31 * t.e31, n.e02 = e.e02 * t.e02, n.e12 = e.e12 * t.e12, n.e22 = e.e22 * t.e22, n.e32 = e.e32 * t.e32, n.e03 = e.e03 * t.e03, n.e13 = e.e13 * t.e13, n.e23 = e.e23 * t.e23, n.e33 = e.e33 * t.e33) : (n.e00 = e.e00 * t, n.e10 = e.e10 * t, n.e20 = e.e20 * t, n.e30 = e.e30 * t, n.e01 = e.e01 * t, n.e11 = e.e11 * t, n.e21 = e.e21 * t, n.e31 = e.e31 * t, n.e02 = e.e02 * t, n.e12 = e.e12 * t, n.e22 = e.e22 * t, n.e32 = e.e32 * t, n.e03 = e.e03 * t, n.e13 = e.e13 * t, n.e23 = e.e23 * t, n.e33 = e.e33 * t), n
        }), i.div = c.default.warnOnce("Matrix4.div is deprecated", function(e, t, n) {
            return n || (n = new i), t instanceof i ? (n.e00 = e.e00 / t.e00, n.e10 = e.e10 / t.e10, n.e20 = e.e20 / t.e20, n.e30 = e.e30 / t.e30, n.e01 = e.e01 / t.e01, n.e11 = e.e11 / t.e11, n.e21 = e.e21 / t.e21, n.e31 = e.e31 / t.e31, n.e02 = e.e02 / t.e02, n.e12 = e.e12 / t.e12, n.e22 = e.e22 / t.e22, n.e32 = e.e32 / t.e32, n.e03 = e.e03 / t.e03, n.e13 = e.e13 / t.e13, n.e23 = e.e23 / t.e23, n.e33 = e.e33 / t.e33) : (t = 1 / t, n.e00 = e.e00 * t, n.e10 = e.e10 * t, n.e20 = e.e20 * t, n.e30 = e.e30 * t, n.e01 = e.e01 * t, n.e11 = e.e11 * t, n.e21 = e.e21 * t, n.e31 = e.e31 * t, n.e02 = e.e02 * t, n.e12 = e.e12 * t, n.e22 = e.e22 * t, n.e32 = e.e32 * t, n.e03 = e.e03 * t, n.e13 = e.e13 * t, n.e23 = e.e23 * t, n.e33 = e.e33 * t), n
        }), i.prototype.div = c.default.warnOnce("Matrix4.prototype.div is deprecated", function(e) {
            return i.div(this, e, this)
        }), i.combine = c.default.warnOnce("Matrix4.combine is deprecated, use Matrix4.prototype.mul instead", function(e, t, n) {
            n || (n = new i);
            var r = e.data,
                o = r[0],
                a = r[4],
                s = r[8],
                u = r[12],
                l = r[1],
                f = r[5],
                c = r[9],
                d = r[13],
                h = r[2],
                p = r[6],
                m = r[10],
                y = r[14],
                v = r[3],
                _ = r[7],
                g = r[11],
                b = r[15],
                x = t.data,
                w = x[0],
                E = x[4],
                S = x[8],
                M = x[12],
                C = x[1],
                T = x[5],
                R = x[9],
                A = x[13],
                O = x[2],
                P = x[6],
                D = x[10],
                I = x[14],
                k = x[3],
                N = x[7],
                L = x[11],
                B = x[15],
                F = n.data;
            return F[0] = o * w + a * C + s * O + u * k, F[4] = o * E + a * T + s * P + u * N, F[8] = o * S + a * R + s * D + u * L, F[12] = o * M + a * A + s * I + u * B, F[1] = l * w + f * C + c * O + d * k, F[5] = l * E + f * T + c * P + d * N, F[9] = l * S + f * R + c * D + d * L, F[13] = l * M + f * A + c * I + d * B, F[2] = h * w + p * C + m * O + y * k, F[6] = h * E + p * T + m * P + y * N, F[10] = h * S + p * R + m * D + y * L, F[14] = h * M + p * A + m * I + y * B, F[3] = v * w + _ * C + g * O + b * k, F[7] = v * E + _ * T + g * P + b * N, F[11] = v * S + _ * R + g * D + b * L, F[15] = v * M + _ * A + g * I + b * B, n
        }), i.prototype.combine = c.default.warnOnce("Matrix4.prototype.combine is deprecated, use Matrix4.prototype.mul instead", function(e) {
            return i.combine(this, e, this)
        }), i.transpose = c.default.warnOnce("Matrix4.transpose is deprecated, use Matrix4.prototype.transpose instead", function(e, t) {
            t || (t = new i);
            var n = e.data,
                r = t.data;
            if (t === e) {
                var o = n[4],
                    a = n[8],
                    s = n[12],
                    u = n[9],
                    l = n[13],
                    f = n[14];
                return r[4] = n[1], r[8] = n[2], r[12] = n[3], r[9] = n[6], r[13] = n[7], r[14] = n[11], r[1] = o, r[2] = a, r[3] = s, r[6] = u, r[7] = l, r[11] = f, t
            }
            return r[0] = n[0], r[1] = n[4], r[2] = n[8], r[3] = n[12], r[4] = n[1], r[5] = n[5], r[6] = n[9], r[7] = n[13], r[8] = n[2], r[9] = n[6], r[10] = n[10], r[11] = n[14], r[12] = n[3], r[13] = n[7], r[14] = n[11], r[15] = n[15], t
        }), i.prototype.applyPre = c.default.warnOnce("Matrix4.prototype.applyPre is deprecated, use Vector4.prototype.applyPre instead", function(e) {
            var t = e.x,
                n = e.y,
                r = e.z,
                i = e.w,
                o = this.data;
            return e.x = o[0] * t + o[1] * n + o[2] * r + o[3] * i, e.y = o[4] * t + o[5] * n + o[6] * r + o[7] * i, e.z = o[8] * t + o[9] * n + o[10] * r + o[11] * i, e.w = o[12] * t + o[13] * n + o[14] * r + o[15] * i, e
        }), i.prototype.applyPost = c.default.warnOnce("Matrix4.prototype.applyPost is deprecated, use Vector4.prototype.applyPost instead", function(e) {
            var t = e.x,
                n = e.y,
                r = e.z,
                i = e.w,
                o = this.data;
            return e.x = o[0] * t + o[4] * n + o[8] * r + o[12] * i, e.y = o[1] * t + o[5] * n + o[9] * r + o[13] * i, e.z = o[2] * t + o[6] * n + o[10] * r + o[14] * i, e.w = o[3] * t + o[7] * n + o[11] * r + o[15] * i, e
        }), i.prototype.applyPostPoint = c.default.warnOnce("Matrix4.prototype.applyPostPoint is deprecated, use Vector4.prototype.applyPostPoint instead", function(e) {
            return e.applyPostPoint(this)
        }), i.prototype.applyPostVector = c.default.warnOnce("Matrix4.prototype.applyPostVector is deprecated, use Vector4.prototype.applyPostVector instead", function(e) {
            var t = e.x,
                n = e.y,
                r = e.z,
                i = this.data;
            return e.x = i[0] * t + i[4] * n + i[8] * r, e.y = i[1] * t + i[5] * n + i[9] * r, e.z = i[2] * t + i[6] * n + i[10] * r, e
        }), l.default.addPostChecks(i.prototype, ["add", "sub", "scale", "transpose", "invert", "isOrthogonal", "determinant", "copy"]), t.default = i
}, function(e, t) {
    var n = {}.hasOwnProperty;
    e.exports = function(e, t) {
        return n.call(e, t)
    }
}, function(e, t, n) {
    var r = n(28),
        i = n(77);
    e.exports = n(27) ? function(e, t, n) {
        return r.f(e, t, i(1, n))
    } : function(e, t, n) {
        return e[t] = n, e
    }
}, function(e, t, n) {
    var r = n(13),
        i = n(40),
        o = n(39),
        a = n(83)("src"),
        s = Function.toString,
        u = ("" + s).split("toString");
    n(71).inspectSource = function(e) {
        return s.call(e)
    }, (e.exports = function(e, t, n, s) {
        var l = "function" == typeof n;
        l && (o(n, "name") || i(n, "name", t)), e[t] !== n && (l && (o(n, a) || i(n, a, e[t] ? "" + e[t] : u.join(String(t)))), e === r ? e[t] = n : s ? e[t] ? e[t] = n : i(e, t, n) : (delete e[t], i(e, t, n)))
    })(Function.prototype, "toString", function() {
        return "function" == typeof this && this[a] || s.call(this)
    })
}, function(e, t) {
    e.exports = function(e) {
        if ("function" != typeof e) throw TypeError(e + " is not a function!");
        return e
    }
}, function(e, t, n) {
    var r = n(113),
        i = n(54);
    e.exports = function(e) {
        return r(i(e))
    }
}, function(e, t, n) {
    var r = n(1),
        i = n(14),
        o = n(54),
        a = /"/g,
        s = function(e, t, n, r) {
            var i = String(o(e)),
                s = "<" + t;
            return "" !== n && (s += " " + n + '="' + String(r).replace(a, "&quot;") + '"'), s + ">" + i + "</" + t + ">"
        };
    e.exports = function(e, t) {
        var n = {};
        n[e] = t(s), r(r.P + r.F * i(function() {
            var t = "" [e]('"');
            return t !== t.toLowerCase() || t.split('"').length > 3
        }), "String", n)
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        this.glTexture = null, t = t || {}, f.default.copyOptions(this, t, {
            wrapS: "Repeat",
            wrapT: "Repeat",
            wrapR: "Repeat",
            magFilter: "Bilinear",
            minFilter: "Trilinear",
            format: "RGBA",
            type: "UnsignedByte",
            generateMipmaps: !0,
            premultiplyAlpha: !1,
            unpackAlignment: 1,
            flipY: !0,
            sampler: !0
        }), this.anisotropy = void 0 !== t.anisotropy ? t.anisotropy : 1, this.variant = "2D", this.nSlices = 1, this.offset = t.offset ? a.default.fromAny(t.offset) : new a.default(0, 0), this.repeat = t.repeat ? a.default.fromAny(t.repeat) : new a.default(1, 1), this.lodBias = 0, this.hasBorder = !1, this.needsUpdate = !1, this.updateCallback = null, this.readyCallback = null, this._originalImage = null, this._originalWidth = 0, this._originalHeight = 0, this.image = null, e && this.setImage(e, n, r, t), this.loadImage = u.default.resolve.bind(null, this), this.textureRecord = {}, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(37),
        a = r(o),
        s = n(17),
        u = r(s),
        l = n(3),
        f = r(l),
        c = n(26),
        d = r(c);
    i.prototype.checkDataReady = function() {
            return this.image && (this.image.dataReady || this.image instanceof HTMLImageElement) || null !== this.readyCallback && this.readyCallback()
        }, i.prototype.checkNeedsUpdate = function() {
            //! AT: what's the precedence here? || first and then && or the other way around?
            return this.needsUpdate || null !== this.updateCallback && this.updateCallback()
        }, i.prototype.setNeedsUpdate = function() {
            this.needsUpdate = !0
        },
        //! AT: this takes the same parameters as the Texture function but in a different order!
        i.prototype.setImage = function(e, t, n, r) {
            //! AT: this is not a general pattern; it is applied here only because of the complexity of this function
            this._originalImage = e, this.image = e; //! AT: is this always overriden? if so then why set it?
            var i = e instanceof Array ? e[0] : e;
            if (i instanceof Uint8Array || i instanceof Uint8ClampedArray || i instanceof Uint16Array || i instanceof Float32Array) {
                if (t = t || e.width, n = n || e.height, void 0 === t || void 0 === n) throw new Error("Data textures need width and height");
                this.image = {
                    data: e,
                    width: t,
                    height: n,
                    isData: !0,
                    dataReady: !0
                }, i instanceof Uint8Array || i instanceof Uint8ClampedArray ? this.type = r.type || "UnsignedByte" : i instanceof Uint16Array ? (this.type = r.type || "UnsignedShort565", this.format = r.format || "RGB") : i instanceof Float32Array && (this.type = r.type || "Float", this.format = r.format || (d.default.Webgl2 ? "RGBA16F" : "RGBA"))
            } else e instanceof Array && (this.image = {
                data: e
            }), i instanceof HTMLCanvasElement && (this.image.dataReady = !0);
            this.setNeedsUpdate(),
                //! AT: this is not a general pattern; it is applied here only because of the complexity of this function
                this._originalWidth = t, this._originalHeight = n
        }, i.prototype.destroy = function(e) {
            e.deleteTexture(this.glTexture), this.glTexture = null
        }, i.prototype.getSizeInMemory = function() {
            var e = void 0;
            return this.image ? (e = (this.image.width || this.image.length) * (this.image.height || 1), "Luminance" === this.format || "Alpha" === this.format ? e *= 1 : "LuminanceAlpha" === this.format ? e *= 2 : "RGB" === this.format ? e *= 3 : "RGBA" === this.format ? e *= 4 : "PrecompressedDXT1" === this.format ? e *= .5 : "PrecompressedDXT1A" === this.format ? e *= 4 / 6 : "PrecompressedDXT3" !== this.format && "PrecompressedDXT5" !== this.format || (e *= 1), this.generateMipmaps && (e = Math.ceil(4 * e / 3)), e) : 0
        }, i.prototype.clone = function() {
            var e = {
                    wrapS: this.wrapS,
                    wrapT: this.wrapT,
                    wrapR: this.wrapR,
                    magFilter: this.magFilter,
                    minFilter: this.minFilter,
                    anisotropy: this.anisotropy,
                    format: this.format,
                    type: this.type,
                    offset: this.offset,
                    repeat: this.repeat,
                    generateMipmaps: this.generateMipmaps,
                    premultiplyAlpha: this.premultiplyAlpha,
                    unpackAlignment: this.unpackAlignment,
                    flipY: this.flipY,
                    sampler: this.sampler
                },
                t = new i(this._originalImage, e, this._originalWidth, this._originalHeight);
            return t.variant = this.variant, t.lodBias = this.lodBias, t.hasBorder = this.hasBorder, t
        }, i.CUBE_FACES = ["PositiveX", "NegativeX", "PositiveY", "NegativeY", "PositiveZ", "NegativeZ"], t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        u.default.call(this, e), this.xExtent = void 0 !== t ? t : 1, this.yExtent = void 0 !== n ? n : 1, this.zExtent = void 0 !== r ? r : 1, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    for (var o = n(0), a = r(o), s = n(118), u = r(s), l = n(65), f = r(l), c = n(4), d = r(c), h = new a.default, p = new a.default, m = new a.default, y = [], v = 0; v < 8; v++) y.push(new a.default);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, i.prototype.reset = function() {
        this.xExtent = 1, this.yExtent = 1, this.zExtent = 1, u.default.prototype.reset.call(this)
    }, i.prototype.computeFromPoints = function(e) {
        var t = e.length;
        if (!(t < 3)) {
            var n = this.min,
                r = this.max,
                i = m;
            n.setDirect(e[0], e[1], e[2]), r.setDirect(e[0], e[1], e[2]);
            for (var o = void 0, a = void 0, s = void 0, u = 3; u < t; u += 3) o = e[u + 0], a = e[u + 1], s = e[u + 2], n.x = o < n.x ? o : n.x, n.y = a < n.y ? a : n.y, n.z = s < n.z ? s : n.z, r.x = o > r.x ? o : r.x, r.y = a > r.y ? a : r.y, r.z = s > r.z ? s : r.z;
            i.set(r).sub(n).scale(.5), this.xExtent = i.x, this.yExtent = i.y, this.zExtent = i.z, this.center.set(r).add(n).scale(.5)
        }
    }, i.prototype.containsPoint = function(e) {
        var t = this.center,
            n = e.x - t.x,
            r = e.y - t.y,
            i = e.z - t.z;
        return n >= -this.xExtent && n <= this.xExtent && r >= -this.yExtent && r <= this.yExtent && i >= -this.zExtent && i <= this.zExtent
    }, i.prototype.containsBox = function(e) {
        var t = y;
        e.getCorners(t);
        for (var n = !0, r = 0; r < 8; r++) n = n && this.containsPoint(t[r]);
        return n
    };
    var _ = [];
    i.prototype.computeFromPrimitives = function(e, t, n, r, o) {
        if (!(o - r <= 0)) {
            var a = h.setDirect(1 / 0, 1 / 0, 1 / 0),
                s = p.setDirect(-1 / 0, -1 / 0, -1 / 0),
                u = _;
            u.length = 0;
            for (var l = r; l < o; l++) {
                u = e.getPrimitiveVertices(n[l], t, u);
                for (var f = 0; f < u.length; f++) i.checkMinMax(a, s, u[f])
            }
            this.center.copy(a.add(s)), this.center.scale(.5), this.xExtent = s.x - this.center.x, this.yExtent = s.y - this.center.y, this.zExtent = s.z - this.center.z
        }
    }, i.checkMinMax = function(e, t, n) {
        n.x < e.x && (e.x = n.x), n.x > t.x && (t.x = n.x), n.y < e.y && (e.y = n.y), n.y > t.y && (t.y = n.y), n.z < e.z && (e.z = n.z), n.z > t.z && (t.z = n.z)
    }, i.prototype.transform = function(e, t) {
        null === t && (t = new i);
        var n = y;
        this.getCorners(n);
        for (var r = 0; r < 8; r++) n[r].applyPostPoint(e.matrix);
        for (var o = n[0].x, a = n[0].y, s = n[0].z, u = o, l = a, f = s, c = 1; c < 8; c++) {
            var d = n[c].x,
                h = n[c].y,
                p = n[c].z;
            o = Math.min(o, d), a = Math.min(a, h), s = Math.min(s, p), u = Math.max(u, d), l = Math.max(l, h), f = Math.max(f, p)
        }
        var m = .5 * (u + o),
            v = .5 * (l + a),
            _ = .5 * (f + s);
        return t.center.setDirect(m, v, _), t.xExtent = u - m, t.yExtent = l - v, t.zExtent = f - _, t
    }, i.prototype.getCorners = function(e) {
        var t = this.xExtent,
            n = this.yExtent,
            r = this.zExtent,
            i = this.center;
        return e[0].setDirect(i.x + t, i.y + n, i.z + r), e[1].setDirect(i.x + t, i.y + n, i.z - r), e[2].setDirect(i.x + t, i.y - n, i.z + r), e[3].setDirect(i.x + t, i.y - n, i.z - r), e[4].setDirect(i.x - t, i.y + n, i.z + r), e[5].setDirect(i.x - t, i.y + n, i.z - r), e[6].setDirect(i.x - t, i.y - n, i.z + r), e[7].setDirect(i.x - t, i.y - n, i.z - r), e
    }, i.prototype.whichSide = function(e) {
        var t = e.normal,
            n = this.center,
            r = Math.abs(this.xExtent * t.x) + Math.abs(this.yExtent * t.y) + Math.abs(this.zExtent * t.z),
            i = t.x * n.x + t.y * n.y + t.z * n.z - e.constant;
        return i < -r ? u.default.Inside : i > r ? u.default.Outside : u.default.Intersects
    }, i.prototype._pseudoDistance = function(e, t) {
        var n = e.normal,
            r = t;
        return n.x * r.x + n.y * r.y + n.z * r.z - e.constant
    }, i.prototype._maxAxis = function(e) {
        return Math.max(Math.abs(e.x), Math.max(Math.abs(e.y), Math.abs(e.z)))
    }, i.prototype.toString = function() {
        return "[" + Math.round(10 * this.center.x) / 10 + "," + Math.round(10 * this.center.y) / 10 + "," + Math.round(10 * this.center.z) / 10 + "] - [" + this.xExtent + "," + this.yExtent + "," + this.zExtent + "]"
    }, i.prototype.intersects = function(e) {
        return e.intersectsBoundingBox(this)
    }, i.prototype.intersectsBoundingBox = function(e) {
        return !(this.center.x + this.xExtent < e.center.x - e.xExtent || this.center.x - this.xExtent > e.center.x + e.xExtent) && (!(this.center.y + this.yExtent < e.center.y - e.yExtent || this.center.y - this.yExtent > e.center.y + e.yExtent) && !(this.center.z + this.zExtent < e.center.z - e.zExtent || this.center.z - this.zExtent > e.center.z + e.zExtent))
    }, i.prototype.intersectsSphere = function(e) {
        this.min.x = this.center.x - this.xExtent, this.min.y = this.center.y - this.yExtent, this.min.z = this.center.z - this.zExtent, this.max.x = this.center.x + this.xExtent, this.max.y = this.center.y + this.yExtent, this.max.z = this.center.z + this.zExtent;
        var t = Math.pow(e.radius, 2),
            n = 0;
        return e.center.x < this.min.x ? n += Math.pow(e.center.x - this.min.x, 2) : e.center.x > this.max.x && (n += Math.pow(e.center.x - this.max.x, 2)), e.center.y < this.min.y ? n += Math.pow(e.center.y - this.min.y, 2) : e.center.y > this.max.y && (n += Math.pow(e.center.y - this.max.y, 2)), e.center.z < this.min.z ? n += Math.pow(e.center.z - this.min.z, 2) : e.center.z > this.max.z && (n += Math.pow(e.center.z - this.max.z, 2)), n <= t
    }, i.prototype.testStaticAABBAABB = function(e, t) {
        var n = this,
            r = e,
            i = {
                mtvDistance: 1e10,
                mtvAxis: new a.default
            };
        return !!this.testAxisStatic(a.default.UNIT_X, n.center.x - n.xExtent, n.center.x + n.xExtent, r.center.x - r.xExtent, r.center.x + r.xExtent, i) && (!!this.testAxisStatic(a.default.UNIT_Y, n.center.y - n.yExtent, n.center.y + n.yExtent, r.center.y - r.yExtent, r.center.y + r.yExtent, i) && (!!this.testAxisStatic(a.default.UNIT_Z, n.center.z - n.zExtent, n.center.z + n.zExtent, r.center.z - r.zExtent, r.center.z + r.zExtent, i) && (t && (t.isIntersecting = !0, t.normal = i.mtvAxis, t.penetration = 1.001 * Math.sqrt(i.mtvDistance)), !0)))
    }, i.prototype.testAxisStatic = function(e, t, n, r, i, o) {
        var s = e.dot(e);
        if (s < 1e-6) return !0;
        var u = i - t,
            l = n - r;
        if (u <= 0 || l <= 0) return !1;
        var f = u < l ? u : -l,
            c = (new a.default).copy(e).scale(f / s),
            d = c.dot(c);
        return d < o.mtvDistance && (o.mtvDistance = d, o.mtvAxis = e), !0
    }, i.prototype.intersectsRay = function(e) {
        var t = h.set(e.origin).sub(this.center),
            n = e.direction,
            r = [0, 1 / 0],
            o = this.xExtent;
        o < d.default.ZERO_TOLERANCE && o >= 0 && (o = d.default.ZERO_TOLERANCE);
        var a = this.yExtent;
        a < d.default.ZERO_TOLERANCE && a >= 0 && (a = d.default.ZERO_TOLERANCE);
        var s = this.zExtent;
        return s < d.default.ZERO_TOLERANCE && s >= 0 && (s = d.default.ZERO_TOLERANCE), !(!(i.clip(n.x, -t.x - o, r) && i.clip(-n.x, t.x - o, r) && i.clip(n.y, -t.y - a, r) && i.clip(-n.y, t.y - a, r) && i.clip(n.z, -t.z - s, r) && i.clip(-n.z, t.z - s, r)) || 0 === r[0] && r[1] === 1 / 0)
    }, i.prototype.intersectsRayWhere = function(e) {
        var t = h.copy(e.origin).sub(this.center),
            n = e.direction,
            r = [0, 1 / 0],
            o = this.xExtent;
        o < d.default.ZERO_TOLERANCE && o >= 0 && (o = d.default.ZERO_TOLERANCE);
        var s = this.yExtent;
        s < d.default.ZERO_TOLERANCE && s >= 0 && (s = d.default.ZERO_TOLERANCE);
        var u = this.zExtent;
        if (u < d.default.ZERO_TOLERANCE && u >= 0 && (u = d.default.ZERO_TOLERANCE), i.clip(n.x, -t.x - o, r) && i.clip(-n.x, t.x - o, r) && i.clip(n.y, -t.y - s, r) && i.clip(-n.y, t.y - s, r) && i.clip(n.z, -t.z - u, r) && i.clip(-n.z, t.z - u, r) && (0 !== r[0] || r[1] !== 1 / 0)) {
            if (r[1] > r[0]) {
                var l = r;
                return {
                    distances: l,
                    points: [new a.default(e.direction).scale(l[0]).add(e.origin), new a.default(e.direction).scale(l[1]).add(e.origin)]
                }
            }
            var f = [r[0]];
            return {
                distances: f,
                points: [new a.default(e.direction).scale(f[0]).add(e.origin)]
            }
        }
        return null
    }, i.clip = function(e, t, n) {
        return e > 0 ? !(t > e * n[1]) && (t > e * n[0] && (n[0] = t / e), !0) : e < 0 ? !(t > e * n[0]) && (t > e * n[1] && (n[1] = t / e), !0) : t <= 0
    }, i.prototype.merge = function(e) {
        return e instanceof i ? this.mergeBox(e.center, e.xExtent, e.yExtent, e.zExtent, this) : e instanceof f.default ? this.mergeBox(e.center, e.radius, e.radius, e.radius, this) : this
    }, i.prototype.mergeBox = function(e, t, n, r, o) {
        o || (o = new i);
        var a = h,
            s = p;
        return a.x = this.center.x - this.xExtent, a.x > e.x - t && (a.x = e.x - t), a.y = this.center.y - this.yExtent, a.y > e.y - n && (a.y = e.y - n), a.z = this.center.z - this.zExtent, a.z > e.z - r && (a.z = e.z - r), s.x = this.center.x + this.xExtent, s.x < e.x + t && (s.x = e.x + t), s.y = this.center.y + this.yExtent, s.y < e.y + n && (s.y = e.y + n), s.z = this.center.z + this.zExtent, s.z < e.z + r && (s.z = e.z + r), o.center.set(s).add(a).scale(.5), o.xExtent = s.x - o.center.x, o.yExtent = s.y - o.center.y, o.zExtent = s.z - o.center.z, o
    }, i.prototype.copy = function(e) {
        return u.default.prototype.copy.call(this, e), this.xExtent = e.xExtent, this.yExtent = e.yExtent, this.zExtent = e.zExtent, this
    };
    var g = !1;
    i.prototype.clone = function() {
        return arguments.length > 0 && !g && (g = !0, console.warn('BoundingBox::clone no longer takes an optional "store" parameter; please use BoundingBox::copy instead')), new i(this.center, this.xExtent, this.yExtent, this.zExtent)
    }, t.default = i
}, , function(e, t, n) {
    var r = n(114),
        i = n(77),
        o = n(43),
        a = n(60),
        s = n(39),
        u = n(234),
        l = Object.getOwnPropertyDescriptor;
    t.f = n(27) ? l : function(e, t) {
        if (e = o(e), t = a(t, !0), u) try {
            return l(e, t)
        } catch (e) {}
        if (s(e, t)) return i(!r.f.call(e, t), e[t])
    }
}, function(e, t, n) {
    var r = n(39),
        i = n(35),
        o = n(169)("IE_PROTO"),
        a = Object.prototype;
    e.exports = Object.getPrototypeOf || function(e) {
        return e = i(e), r(e, o) ? e[o] : "function" == typeof e.constructor && e instanceof e.constructor ? e.constructor.prototype : e instanceof Object ? a : null
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.material = new a.default(e || f.default.simple), this.useReadBuffer = !0, this.renderToScreen = !1, this.renderable = {
            meshData: u.default.quad,
            materials: [this.material]
        }, this.enabled = !0, this.clear = !1, this.needsSwap = !0, this.viewportSize = void 0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(9),
        a = r(o),
        s = n(94),
        u = r(s),
        l = n(15),
        f = r(l),
        c = n(68),
        d = r(c);
    i.prototype = Object.create(d.default.prototype), i.prototype.constructor = i, i.prototype.render = function(e, t, n) {
        this.useReadBuffer && this.material.setTexture("DIFFUSE_MAP", n), this.renderToScreen ? e.render(this.renderable, null, u.default.camera, [], null, this.clear) : e.render(this.renderable, null, u.default.camera, [], t, this.clear)
    }, i.prototype.destroy = function() {
        this.material.shader.destroy()
    }, i.prototype.invalidateHandles = function(e) {
        e.invalidateMaterial(this.renderable.materials[0]), e.invalidateMeshData(this.renderable.meshData)
    }, t.default = i
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = {
        Linear: {
            None: function(e) {
                return e
            },
            In: function(e) {
                return e
            },
            Out: function(e) {
                return e
            },
            InOut: function(e) {
                return e
            }
        },
        Quadratic: {
            In: function(e) {
                return e * e
            },
            Out: function(e) {
                return e * (2 - e)
            },
            InOut: function(e) {
                return (e *= 2) < 1 ? .5 * e * e : -.5 * (--e * (e - 2) - 1)
            }
        },
        Cubic: {
            In: function(e) {
                return e * e * e
            },
            Out: function(e) {
                return --e * e * e + 1
            },
            InOut: function(e) {
                return (e *= 2) < 1 ? .5 * e * e * e : .5 * ((e -= 2) * e * e + 2)
            }
        },
        Quartic: {
            In: function(e) {
                return e * e * e * e
            },
            Out: function(e) {
                return 1 - --e * e * e * e
            },
            InOut: function(e) {
                return (e *= 2) < 1 ? .5 * e * e * e * e : -.5 * ((e -= 2) * e * e * e - 2)
            }
        },
        Quintic: {
            In: function(e) {
                return e * e * e * e * e
            },
            Out: function(e) {
                return --e * e * e * e * e + 1
            },
            InOut: function(e) {
                return (e *= 2) < 1 ? .5 * e * e * e * e * e : .5 * ((e -= 2) * e * e * e * e + 2)
            }
        },
        Sinusoidal: {
            In: function(e) {
                return 1 - Math.cos(e * Math.PI / 2)
            },
            Out: function(e) {
                return Math.sin(e * Math.PI / 2)
            },
            InOut: function(e) {
                return .5 * (1 - Math.cos(Math.PI * e))
            }
        },
        Exponential: {
            In: function(e) {
                return 0 === e ? 0 : Math.pow(1024, e - 1)
            },
            Out: function(e) {
                return 1 === e ? 1 : 1 - Math.pow(2, -10 * e)
            },
            InOut: function(e) {
                return 0 === e ? 0 : 1 === e ? 1 : (e *= 2) < 1 ? .5 * Math.pow(1024, e - 1) : .5 * (2 - Math.pow(2, -10 * (e - 1)))
            }
        },
        Circular: {
            In: function(e) {
                return 1 - Math.sqrt(1 - e * e)
            },
            Out: function(e) {
                return Math.sqrt(1 - --e * e)
            },
            InOut: function(e) {
                return (e *= 2) < 1 ? -.5 * (Math.sqrt(1 - e * e) - 1) : .5 * (Math.sqrt(1 - (e -= 2) * e) + 1)
            }
        },
        Elastic: {
            In: function(e) {
                var t = void 0,
                    n = .1;
                return 0 === e ? 0 : 1 === e ? 1 : (!n || n < 1 ? (n = 1, t = .1) : t = .4 * Math.asin(1 / n) / (2 * Math.PI), -n * Math.pow(2, 10 * (e -= 1)) * Math.sin((e - t) * (2 * Math.PI) / .4))
            },
            Out: function(e) {
                var t = void 0,
                    n = .1;
                return 0 === e ? 0 : 1 === e ? 1 : (!n || n < 1 ? (n = 1, t = .1) : t = .4 * Math.asin(1 / n) / (2 * Math.PI), n * Math.pow(2, -10 * e) * Math.sin((e - t) * (2 * Math.PI) / .4) + 1)
            },
            InOut: function(e) {
                var t = void 0,
                    n = .1;
                return 0 === e ? 0 : 1 === e ? 1 : (!n || n < 1 ? (n = 1, t = .1) : t = .4 * Math.asin(1 / n) / (2 * Math.PI), (e *= 2) < 1 ? n * Math.pow(2, 10 * (e -= 1)) * Math.sin((e - t) * (2 * Math.PI) / .4) * -.5 : n * Math.pow(2, -10 * (e -= 1)) * Math.sin((e - t) * (2 * Math.PI) / .4) * .5 + 1)
            }
        },
        Back: {
            In: function(e) {
                var t = 1.70158;
                return e * e * ((t + 1) * e - t)
            },
            Out: function(e) {
                var t = 1.70158;
                return --e * e * ((t + 1) * e + t) + 1
            },
            InOut: function(e) {
                var t = 2.5949095;
                return (e *= 2) < 1 ? e * e * ((t + 1) * e - t) * .5 : .5 * ((e -= 2) * e * ((t + 1) * e + t) + 2)
            }
        },
        Bounce: {
            In: function(e) {
                return 1 - r.Bounce.Out(1 - e)
            },
            Out: function(e) {
                return e < 1 / 2.75 ? 7.5625 * e * e : e < 2 / 2.75 ? 7.5625 * (e -= 1.5 / 2.75) * e + .75 : e < 2.5 / 2.75 ? 7.5625 * (e -= 2.25 / 2.75) * e + .9375 : 7.5625 * (e -= 2.625 / 2.75) * e + .984375
            },
            InOut: function(e) {
                return e < .5 ? .5 * r.Bounce.In(2 * e) : .5 * r.Bounce.Out(2 * e - 1) + .5
            }
        }
    };
    t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.meshDatas = [], this.vertexData = {}, this.indexData = [], this.vertexCounter = 0, this.indexCounter = 0, this.indexLengths = [], this.indexModes = []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(26),
        u = r(s),
        l = n(0),
        f = r(l);
    i.prototype.addEntity = function(e) {
        var t = this;
        e.traverse(function(e) {
            e.meshDataComponent && t.addMeshData(e.meshDataComponent.meshData, e.transformComponent.sync().worldTransform)
        })
    };
    var c = new f.default;
    i.prototype.addMeshData = function(e, t) {
        if (!u.default.ElementIndexUInt) {
            if (e.vertexCount >= 65536) throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: " + e.vertexCount);
            this.vertexCounter + e.vertexCount >= 65536 && this._generateMesh()
        }
        for (var n = t.matrix, r = t.rotation, i = e.attributeMap, o = Object.keys(i), s = 0, l = o.length; s < l; s += 1) {
            var f = o[s],
                d = i[f],
                h = this.vertexData[f];
            h || (this.vertexData[f] = {}, h = this.vertexData[f], h.array = [], h.map = {
                count: d.count,
                type: d.type,
                stride: d.stride,
                offset: d.offset,
                normalized: d.normalized
            });
            var p = e.getAttributeBuffer(f),
                m = p.length,
                y = h.array,
                v = d.count,
                _ = this.vertexCounter * v;
            if (f === a.default.POSITION)
                for (var g = 0; g < m; g += v) c.setDirect(p[g + 0], p[g + 1], p[g + 2]), c.applyPostPoint(n), y[_ + g + 0] = c.x, y[_ + g + 1] = c.y, y[_ + g + 2] = c.z;
            else if (f === a.default.NORMAL)
                for (var b = 0; b < m; b += v) c.setDirect(p[b + 0], p[b + 1], p[b + 2]), c.applyPost(r), y[_ + b + 0] = c.x, y[_ + b + 1] = c.y, y[_ + b + 2] = c.z;
            else if (f === a.default.TANGENT)
                for (var x = 0; x < m; x += v) c.setDirect(p[x + 0], p[x + 1], p[x + 2]), c.applyPost(r), y[_ + x + 0] = c.x, y[_ + x + 1] = c.y, y[_ + x + 2] = c.z, y[_ + x + 3] = p[x + 3];
            else
                for (var w = 0; w < m; w += 1) y[_ + w] = p[w]
        }
        for (var E = e.getIndexBuffer(), S = 0, M = e.indexCount; S < M; S += 1) this.indexData[this.indexCounter + S] = E[S] + this.vertexCounter;
        this.vertexCounter += e.vertexCount, this.indexCounter += e.indexCount, e.indexLengths ? this.indexLengths = this.indexLengths.concat(e.indexLengths) : this.indexLengths = this.indexLengths.concat(e.getIndexBuffer().length), this.indexModes = this.indexModes.concat(e.indexModes)
    }, i.prototype._generateMesh = function() {
        var e = {},
            t = Object.keys(this.vertexData),
            n = !0,
            r = !1,
            i = void 0;
        try {
            for (var o, s = t[Symbol.iterator](); !(n = (o = s.next()).done); n = !0) {
                var u = o.value,
                    l = this.vertexData[u];
                e[u] = l.map
            }
        } catch (e) {
            r = !0, i = e
        } finally {
            try {
                !n && s.return && s.return()
            } finally {
                if (r) throw i
            }
        }
        var f = new a.default(e, this.vertexCounter, this.indexCounter),
            c = !0,
            d = !1,
            h = void 0;
        try {
            for (var p, m = t[Symbol.iterator](); !(c = (p = m.next()).done); c = !0) {
                var y = p.value,
                    l = this.vertexData[y].array;
                f.getAttributeBuffer(y).set(l)
            }
        } catch (e) {
            d = !0, h = e
        } finally {
            try {
                !c && m.return && m.return()
            } finally {
                if (d) throw h
            }
        }
        f.getIndexBuffer().set(this.indexData), f.indexLengths = this.indexLengths, f.indexModes = this.indexModes;
        for (var v = f.indexModes[0], _ = 0, g = [], b = [], x = 0; x < f.indexModes.length; x += 1) {
            var w = f.indexModes[x];
            v !== w && (g.push(v), b.push(_), v = w, _ = 0), _ += f.indexLengths[x], x === f.indexModes.length - 1 && (g.push(w), b.push(_), v = w, _ = 0)
        }
        f.indexLengths = b, f.indexModes = g, this.meshDatas.push(f), this.vertexData = {}, this.indexData = [], this.vertexCounter = 0, this.indexCounter = 0, this.indexLengths = [], this.indexModes = []
    }, i.prototype.build = function() {
        return this.vertexCounter > 0 && this._generateMesh(), this.meshDatas
    }, i.prototype.reset = function() {
        this.meshDatas = [], this.vertexData = {}, this.indexData = [], this.vertexCounter = 0, this.indexCounter = 0, this.indexLengths = [], this.indexModes = []
    }, t.default = i
}, function(e, t) {
    var n = {}.toString;
    e.exports = function(e) {
        return n.call(e).slice(8, -1)
    }
}, function(e, t) {
    e.exports = function(e) {
        if (void 0 == e) throw TypeError("Can't call method on  " + e);
        return e
    }
}, function(e, t, n) {
    var r = n(14);
    e.exports = function(e, t) {
        return !!e && r(function() {
            t ? e.call(null, function() {}, 1) : e.call(null)
        })
    }
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
            value: !0
        }), r.endsWith = function(e, t) {
            return -1 !== e.indexOf(t, e.length - t.length)
        }, r.startsWith = function(e, t) {
            return 0 === e.indexOf(t)
        }, r.capitalize = function(e) {
            return e.charAt(0).toUpperCase() + e.substring(1)
        }, r.uncapitalize = function(e) {
            return e.charAt(0).toLowerCase() + e.substring(1)
        }, r.createUniqueId = function(e) {
            var t = Date.now(),
                n = "xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g, function(e) {
                    var n = (t + 16 * Math.random()) % 16 | 0;
                    return "x" === e ? n.toString(16) : (3 & n | 8).toString(16)
                });
            return void 0 === e ? n : n + "." + e
        }, r.getUntil = function(e, t) {
            var n = e.indexOf(t);
            return -1 === n ? e : e.slice(0, n)
        }, r.getAfterLast = function(e, t) {
            var n = e.lastIndexOf(t);
            return -1 === n ? e : e.slice(n + t.length, e.length)
        }, r.getFrom = function(e, t) {
            var n = e.indexOf(t);
            return -1 === n ? "" : e.slice(n + t.length, e.length)
        }, r.getIndexedName = function(e, t, n) {
            n || (n = "_");
            var r = new RegExp(e + "(" + n + "\\d+)?"),
                i = 0,
                o = !0,
                a = !1,
                s = void 0;
            try {
                for (var u, l = t[Symbol.iterator](); !(o = (u = l.next()).done); o = !0) {
                    var f = u.value,
                        c = r.exec(f);
                    if (c)
                        if (c.length > 1 && c[1]) {
                            var d = parseInt(c[1].substring(n.length), 10);
                            d >= i && (i = d + 1)
                        } else i = 1
                }
            } catch (e) {
                a = !0, s = e
            } finally {
                try {
                    !o && l.return && l.return()
                } finally {
                    if (a) throw s
                }
            }
            return e + n + i
        }, r.getUniqueName = function(e, t, n) {
            return -1 === t.indexOf(e) ? e : r.getIndexedName(e, t, n)
        },
        //! AT: toASCII, in JS everything is caps (JSON, innerHTML, etc)
        r.toAscii = function(e) {
            return e.replace(/([^\x00-\x7F])/g, "x")
        }, r.hashCode = function(e) {
            var t = 0;
            if (0 === e.length) return t;
            for (var n = 0; n < e.length; n += 1) {
                t = (t << 5) - t + e.charCodeAt(n), t &= t
            }
            return btoa(t).replace("/", "_").replace("+", "-")
        };
    var i = Date.now();
    r.getUniqueId = function() {
        i += 1;
        var e = Array.prototype.slice.call(arguments, 0).join("");
        return r.hashCode("" + i + e)
    }, r.escapeHtmlEntities = function(e) {
        var t = document.createElement("div");
        t.appendChild(document.createTextNode(e));
        var n = {
            34: "quot"
        };
        return t.innerHTML.replace(/[\u00A0-\u2666"']/g, function(e) {
            return "&" + (n[e.charCodeAt(0)] || "#" + e.charCodeAt(0)) + ";"
        })
    };
    //! AT: this does far too much and is used only to get the extension of whatever the uri is
    var o = new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
    r.parseURL = function(e) {
        var t = e.match(o);
        return {
            scheme: t[1],
            user_info: t[2],
            domain: t[3],
            port: t[4],
            path: t[5],
            query_data: t[6],
            fragment: t[7]
        }
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r, o, s) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var u = arguments[0];
            e = u.width, t = u.height, n = u.length, r = u.tileX, o = u.tileY, s = u.textureMode
        }
        this.xExtent = void 0 !== e ? .5 * e : .5, this.yExtent = void 0 !== t ? .5 * t : .5, this.zExtent = void 0 !== n ? .5 * n : .5, this.tileX = r || 1, this.tileY = o || 1, this.textureMode = void 0 !== s ? s : i.TextureModes.Uniform;
        var l = a.default.defaultMap([a.default.POSITION, a.default.NORMAL, a.default.TEXCOORD0]);
        a.default.call(this, l, 24, 36), this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(3),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        var e = this.xExtent,
            t = this.yExtent,
            n = this.zExtent,
            r = this.tileX,
            o = this.tileY,
            s = [-e, -t, -n, e, -t, -n, e, t, -n, -e, t, -n, e, -t, n, -e, -t, n, e, t, n, -e, t, n],
            u = [];
        ! function(e) {
            for (var t = 0; t < e.length; t++) {
                var n = 3 * e[t];
                u.push(s[n]), u.push(s[n + 1]), u.push(s[n + 2])
            }
        }([0, 1, 2, 3, 1, 4, 6, 2, 4, 5, 7, 6, 5, 0, 3, 7, 2, 6, 7, 3, 0, 5, 4, 1]), this.getAttributeBuffer(a.default.POSITION).set(u);
        var l = [0, 0, -1, 1, 0, 0, 0, 0, 1, -1, 0, 0, 0, 1, 0, 0, -1, 0],
            f = [];
        ! function() {
            for (var e = 0; e < l.length / 3; e++)
                for (var t = 0; t < 4; t++) {
                    var n = 3 * e;
                    f.push(l[n]), f.push(l[n + 1]), f.push(l[n + 2])
                }
        }(), this.getAttributeBuffer(a.default.NORMAL).set(f);
        var c = [];
        if (this.textureMode === i.TextureModes.Uniform)
            for (var d = 0; d < 6; d++) c.push(r), c.push(0), c.push(0), c.push(0), c.push(0), c.push(o), c.push(r), c.push(o);
        else c.push(1, 1 / 3, .75, 1 / 3, .75, 2 / 3, 1, 2 / 3), c.push(.75, 1 / 3, .5, 1 / 3, .5, 2 / 3, .75, 2 / 3), c.push(.5, 1 / 3, .25, 1 / 3, .25, 2 / 3, .5, 2 / 3), c.push(.25, 1 / 3, 0, 1 / 3, 0, 2 / 3, .25, 2 / 3), c.push(.5, 1, .5, 2 / 3, .25, 2 / 3, .25, 1), c.push(.25, 0, .25, 1 / 3, .5, 1 / 3, .5, 0);
        return this.getAttributeBuffer(a.default.TEXCOORD0).set(c), this.getIndexBuffer().set([2, 1, 0, 3, 2, 0, 6, 5, 4, 7, 6, 4, 10, 9, 8, 11, 10, 8, 14, 13, 12, 15, 14, 12, 18, 17, 16, 19, 18, 16, 22, 21, 20, 23, 22, 20]), this
    }, i.prototype.clone = function() {
        var e = u.default.shallowSelectiveClone(this, ["tileX", "tileY", "textureMode"]);
        return e.width = 2 * this.xExtent, e.height = 2 * this.yExtent, e.length = 2 * this.zExtent, new i(e)
    }, i.TextureModes = {
        Uniform: "Uniform",
        Unfolded: "Unfolded"
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.noisecommon = ["vec4 mod289(vec4 x) {", "return x - floor(x * (1.0 / 289.0)) * 289.0;", "}", "vec3 mod289(vec3 x) {", "return x - floor(x * (1.0 / 289.0)) * 289.0;", "}", "vec2 mod289(vec2 x) {", "return x - floor(x * (1.0 / 289.0)) * 289.0;", "}", "vec3 permute(vec3 x) {", "return mod289(((x*34.0)+1.0)*x);", "}", "vec4 permute(vec4 x) {", "return mod289(((x*34.0)+1.0)*x);", "}"].join("\n"), r.noise2d = [r.noisecommon, "float snoise(vec2 v) {", "const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0", "0.366025403784439, // 0.5*(sqrt(3.0)-1.0)", "-0.577350269189626, // -1.0 + 2.0 * C.x", "0.024390243902439); // 1.0 / 41.0", "vec2 i  = floor(v + dot(v, C.yy) );", "vec2 x0 = v - i + dot(i, C.xx);", "vec2 i1;", "//i1.x = step( x0.y, x0.x ); x0.x > x0.y ? 1.0 : 0.0", "//i1.y = 1.0 - i1.x;", "i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);", "// x0 = x0 - 0.0 + 0.0 * C.xx ;", "// x1 = x0 - i1 + 1.0 * C.xx ;", "// x2 = x0 - 1.0 + 2.0 * C.xx ;", "vec4 x12 = x0.xyxy + C.xxzz;", "x12.xy -= i1;", "i = mod289(i); // Avoid truncation effects in permutation", "vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))", "+ i.x + vec3(0.0, i1.x, 1.0 ));", "vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);", "m = m*m ;", "m = m*m ;", "vec3 x = 2.0 * fract(p * C.www) - 1.0;", "vec3 h = abs(x) - 0.5;", "vec3 ox = floor(x + 0.5);", "vec3 a0 = x - ox;", "m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );", "vec3 g;", "g.x  = a0.x  * x0.x  + h.x  * x0.y;", "g.yz = a0.yz * x12.xz + h.yz * x12.yw;", "return 130.0 * dot(m, g);", "}"].join("\n"), r.noise3d = [r.noisecommon, "vec4 taylorInvSqrt(vec4 r) {", "return 1.79284291400159 - 0.85373472095314 * r;", "}", "float snoise(vec3 v) {", "const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;", "const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);", "vec3 i  = floor(v + dot(v, C.yyy) );", "vec3 x0 = v - i + dot(i, C.xxx);", "vec3 g = step(x0.yzx, x0.xyz);", "vec3 l = 1.0 - g;", "vec3 i1 = min( g.xyz, l.zxy );", "vec3 i2 = max( g.xyz, l.zxy );", "vec3 x1 = x0 - i1 + C.xxx;", "vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y", "vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y", "i = mod289(i); ", "vec4 p = permute( permute( permute( ", "i.z + vec4(0.0, i1.z, i2.z, 1.0 ))", "+ i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ", "+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));", "float n_ = 0.142857142857; // 1.0/7.0", "vec3 ns = n_ * D.wyz - D.xzx;", "vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)", "vec4 x_ = floor(j * ns.z);", "vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)", "vec4 x = x_ *ns.x + ns.yyyy;", "vec4 y = y_ *ns.x + ns.yyyy;", "vec4 h = 1.0 - abs(x) - abs(y);", "vec4 b0 = vec4( x.xy, y.xy );", "vec4 b1 = vec4( x.zw, y.zw );", "vec4 s0 = floor(b0)*2.0 + 1.0;", "vec4 s1 = floor(b1)*2.0 + 1.0;", "vec4 sh = -step(h, vec4(0.0));", "vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;", "vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;", "vec3 p0 = vec3(a0.xy,h.x);", "vec3 p1 = vec3(a0.zw,h.y);", "vec3 p2 = vec3(a1.xy,h.z);", "vec3 p3 = vec3(a1.zw,h.w);", "vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));", "p0 *= norm.x;", "p1 *= norm.y;", "p2 *= norm.z;", "p3 *= norm.w;", "vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);", "m = m * m;", "return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );", "}"].join("\n");
    var i = ["float shift_right (float v, float amt) {", "v = floor(v) + 0.5;", "return floor(v / exp2(amt));", "}", "float shift_left (float v, float amt) {", "return floor(v * exp2(amt) + 0.5);", "}", "float mask_last (float v, float bits) {", "return mod(v, shift_left(1.0, bits));", "}", "float extract_bits (float num, float from, float to) {", "from = floor(from + 0.5); to = floor(to + 0.5);", "return mask_last(shift_right(num, from), to - from);", "}"].join("\n");
    r.methods = {
        packDepth: ["vec4 packDepth(const in float depth) {", "const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);", "const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);", "vec4 res = fract(depth * bit_shift);", "res -= res.xxyz * bit_mask;", "return res;", "}"].join("\n"),
        unpackDepth: ["float unpackDepth(const in vec4 rgba_depth) {", "const vec4 bit_shift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);", "return dot(rgba_depth, bit_shift);", "}"].join("\n"),
        packFloat: [i, "vec4 packFloat(float val) {", "if (val == 0.0) return vec4(0, 0, 0, 0);", "float sign = val > 0.0 ? 0.0 : 1.0;", "val = abs(val);", "float exponent = floor(log2(val));", "float biased_exponent = exponent + 127.0;", "float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;", "float t = biased_exponent / 2.0;", "float last_bit_of_biased_exponent = fract(t) * 2.0;", "float remaining_bits_of_biased_exponent = floor(t);", "float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;", "float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;", "float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;", "float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;", "return vec4(byte4, byte3, byte2, byte1);", "}"].join("\n"),
        unpackFloat: [i, "float unpackFloat(vec4 val) {", "val = val * vec4(255.0);", "float sign = - shift_right(val.w, 7.0) * 2.0 + 1.0;", "float mantissa = ", "val.x +", "shift_left(val.y, 8.0) +", "shift_left(extract_bits(val.z, 0.0, 7.0), 16.0);", " mantissa = mantissa / 8388608.0 + 1.0;", "float exponent = ", "shift_left(extract_bits(val.w, 0.0, 7.0), 1.0) +", "shift_right(val.z, 7.0) - 127.0;", "return sign * mantissa * exp2(exponent);", "}"].join("\n"),
        packDepth16: ["vec2 packDepth16(const in float depth) {", "const vec2 bias = vec2(1.0 / 255.0, 0.0);", "vec2 res = vec2(depth, fract(depth * 255.0));", "return res - (res.yy * bias);", "}"].join("\n"),
        unpackDepth16: ["float unpackDepth16(const in vec2 rg_depth) {", "return rg_depth.x + (rg_depth.y / 255.0);", "}"].join("\n"),
        hsv: ["vec3 rgb2hsv(vec3 c) {", "vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);", "vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));", "vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));", "float d = q.x - min(q.w, q.y);", "float e = 1.0e-10;", "return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);", "}", "vec3 hsv2rgb(vec3 c) {", "vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);", "vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);", "return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);", "}"].join("\n")
    }, r.blendmodes = ["#define BlendLinearDodgef        BlendAddf", "#define BlendLinearBurnf        BlendSubstractf", "#define BlendAddf(base, blend)      min(base + blend, 1.0)", "#define BlendSubstractf(base, blend)  max(base + blend - 1.0, 0.0)", "#define BlendLightenf(base, blend)    max(blend, base)", "#define BlendDarkenf(base, blend)    min(blend, base)", "#define BlendLinearLightf(base, blend)  (blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))", "#define BlendScreenf(base, blend)    (1.0 - ((1.0 - base) * (1.0 - blend)))", "#define BlendOverlayf(base, blend)    (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))", "#define BlendSoftLightf(base, blend)  ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))", "#define BlendColorDodgef(base, blend)  ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))", "#define BlendColorBurnf(base, blend)  ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))", "#define BlendVividLightf(base, blend)  ((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))", "#define BlendPinLightf(base, blend)  ((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))", "#define BlendHardMixf(base, blend)    ((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)", "#define BlendReflectf(base, blend)    ((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))", "#define Blend(base, blend, funcf)    vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))", "#define BlendNormal(base, blend)    (blend)", "#define BlendLighten          BlendLightenf", "#define BlendDarken          BlendDarkenf", "#define BlendMultiply(base, blend)    (base * blend)", "#define BlendAverage(base, blend)    ((base + blend) / 2.0)", "#define BlendAdd(base, blend)      min(base + blend, vec3(1.0))", "#define BlendSubstract(base, blend)  max(base + blend - vec3(1.0), vec3(0.0))", "#define BlendDifference(base, blend)  abs(base - blend)", "#define BlendNegation(base, blend)    (vec3(1.0) - abs(vec3(1.0) - base - blend))", "#define BlendExclusion(base, blend)  (base + blend - 2.0 * base * blend)", "#define BlendScreen(base, blend)    Blend(base, blend, BlendScreenf)", "#define BlendOverlay(base, blend)    Blend(base, blend, BlendOverlayf)", "#define BlendSoftLight(base, blend)  Blend(base, blend, BlendSoftLightf)", "#define BlendHardLight(base, blend)  BlendOverlay(blend, base)", "#define BlendColorDodge(base, blend)  Blend(base, blend, BlendColorDodgef)", "#define BlendColorBurn(base, blend)  Blend(base, blend, BlendColorBurnf)", "#define BlendLinearDodge        BlendAdd", "#define BlendLinearBurn        BlendSubstract", "#define BlendLinearLight(base, blend)  Blend(base, blend, BlendLinearLightf)", "#define BlendVividLight(base, blend)  Blend(base, blend, BlendVividLightf)", "#define BlendPinLight(base, blend)    Blend(base, blend, BlendPinLightf)", "#define BlendHardMix(base, blend)    Blend(base, blend, BlendHardMixf)", "#define BlendReflect(base, blend)    Blend(base, blend, BlendReflectf)", "#define BlendGlow(base, blend)      BlendReflect(blend, base)", "#define BlendPhoenix(base, blend)    (min(base, blend) - max(base, blend) + vec3(1.0))", "#define GammaCorrection(color, gamma)                      pow(color, vec3(1.0 / gamma))", "#define LevelsControlInputRange(color, minInput, maxInput)            min(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0))", "#define LevelsControlInput(color, minInput, gamma, maxInput)          GammaCorrection(LevelsControlInputRange(color, minInput, maxInput), gamma)", "#define LevelsControlOutputRange(color, minOutput, maxOutput)          mix(vec3(minOutput), vec3(maxOutput), color)", "#define LevelsControl(color, minInput, gamma, maxInput, minOutput, maxOutput)  LevelsControlOutputRange(LevelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput)"].join("\n"), t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r, i) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var o = arguments[0];
            e = o.width, t = o.height, n = o.tileX, r = o.tileY, i = o.tesselation
        }
        this.xExtent = void 0 !== e ? .5 * e : .5, this.yExtent = void 0 !== t ? .5 * t : .5, this.tileX = n || 1, this.tileY = r || 1, this.tesselation = i || 1;
        var s = a.default.defaultMap([a.default.POSITION, a.default.NORMAL, a.default.TEXCOORD0]),
            u = 4 * this.tesselation * this.tesselation,
            l = 6 * this.tesselation * this.tesselation;
        a.default.call(this, s, u, l), this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(3),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        for (var e = this.xExtent, t = this.yExtent, n = this.tileX, r = this.tileY, i = [], o = [], s = [], u = [], l = 2 * t / this.tesselation, f = 2 * e / this.tesselation, c = r / this.tesselation, d = n / this.tesselation, h = 0, p = 0; p < this.tesselation; p++)
            for (var m = .5 * l - t + p * l, y = .5 * c + p * c, v = 0; v < this.tesselation; v++) {
                var _ = .5 * f - e + v * f,
                    g = .5 * d + v * d;
                i.push(_ - f / 2, m - l / 2, 0, _ - f / 2, m + l / 2, 0, _ + f / 2, m + l / 2, 0, _ + f / 2, m - l / 2, 0), o.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1), s.push(g - d / 2, y - c / 2, g - d / 2, y + c / 2, g + d / 2, y + c / 2, g + d / 2, y - c / 2);
                var b = 4 * h++;
                u.push(b + 0, b + 3, b + 1, b + 1, b + 3, b + 2)
            }
        return this.getIndexBuffer().set(u), this.getAttributeBuffer(a.default.POSITION).set(i), this.getAttributeBuffer(a.default.NORMAL).set(o), this.getAttributeBuffer(a.default.TEXCOORD0).set(s), this
    }, i.prototype.clone = function() {
        return new i(u.default.shallowSelectiveClone(this, ["xExtent", "yExtent", "tileX", "tileY", "tesselation"]))
    }, t.default = i
}, function(e, t, n) {
    var r = n(19);
    e.exports = function(e, t) {
        if (!r(e)) return e;
        var n, i;
        if (t && "function" == typeof(n = e.toString) && !r(i = n.call(e))) return i;
        if ("function" == typeof(n = e.valueOf) && !r(i = n.call(e))) return i;
        if (!t && "function" == typeof(n = e.toString) && !r(i = n.call(e))) return i;
        throw TypeError("Can't convert object to primitive value")
    }
}, function(e, t, n) {
    var r = n(1),
        i = n(71),
        o = n(14);
    e.exports = function(e, t) {
        var n = (i.Object || {})[e] || Object[e],
            a = {};
        a[e] = t(n), r(r.S + r.F * o(function() {
            n(1)
        }), "Object", a)
    }
}, function(e, t, n) {
    var r = n(72),
        i = n(113),
        o = n(35),
        a = n(32),
        s = n(610);
    e.exports = function(e, t) {
        var n = 1 == e,
            u = 2 == e,
            l = 3 == e,
            f = 4 == e,
            c = 6 == e,
            d = 5 == e || c,
            h = t || s;
        return function(t, s, p) {
            for (var m, y, v = o(t), _ = i(v), g = r(s, p, 3), b = a(_.length), x = 0, w = n ? h(t, b) : u ? h(t, 0) : void 0; b > x; x++)
                if ((d || x in _) && (m = _[x], y = g(m, x, v), e))
                    if (n) w[x] = y;
                    else if (y) switch (e) {
                case 3:
                    return !0;
                case 5:
                    return m;
                case 6:
                    return x;
                case 2:
                    w.push(m)
            } else if (f) return !1;
            return c ? -1 : l || f ? f : w
        }
    }
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }

    function a() {
        if (1 === arguments.length) {
            var e = arguments[0];
            return e instanceof f ? e.top ? e.top : [] : Array.isArray(e) ? e : [e]
        }
        return arguments.length > 1 ? Array.prototype.slice.call(arguments, 0) : []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(269),
        l = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(u),
        f = function(e) {
            function t() {
                return r(this, t), i(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments))
            }
            return o(t, e), s(t, [{
                key: "and",
                value: function() {
                    if (null === this.top) return this;
                    var e = void 0,
                        t = a.apply(void 0, arguments),
                        n = void 0,
                        r = void 0;
                    t.length > this.top.length ? (n = this.top, r = t) : (n = t, r = this.top);
                    for (var i = [], o = 0; o < r.length; o++) {
                        i[r[o].id] = !0
                    }
                    e = r.concat([]);
                    for (var o = 0; o < n.length; o++) i[n[o].id] || e.push(n[o]);
                    return this.stack.push(e), this.top = e, this
                }
            }, {
                key: "intersects",
                value: function() {
                    if (null === this.top) return this;
                    var e = void 0,
                        t = a.apply(void 0, arguments),
                        n = void 0,
                        r = void 0;
                    t.length > this.top.length ? (n = this.top, r = t) : (n = t, r = this.top);
                    for (var i = [], o = 0; o < r.length; o++) {
                        i[r[o].id] = !0
                    }
                    e = [];
                    for (var o = 0; o < n.length; o++) i[n[o].id] && e.push(n[o]);
                    return this.stack.push(e), this.top = e, this
                }
            }, {
                key: "without",
                value: function() {
                    if (null === this.top) return this;
                    for (var e = void 0, t = a.apply(void 0, arguments), n = [], r = 0; r < t.length; r++) {
                        n[t[r].id] = !0
                    }
                    e = [];
                    for (var r = 0; r < this.top.length; r++) n[this.top[r].id] || e.push(this.top[r]);
                    return this.stack.push(e), this.top = e, this
                }
            }, {
                key: "andSelf",
                value: function() {
                    if (null === this.top) return this;
                    if (this.stack.length <= 1) return this;
                    var e = this.stack[this.stack.length - 2];
                    return this.and.apply(this, e)
                }
            }, {
                key: "parent",
                value: function() {
                    if (null === this.top) return this;
                    var e = [],
                        t = this.top.filter(function(t) {
                            return !!t.transformComponent.parent && (!e[t.transformComponent.parent.entity.id] && (e[t.transformComponent.parent.entity.id] = !0, !0))
                        }).map(function(e) {
                            return e.transformComponent.parent.entity
                        });
                    return this.stack.push(t), this.top = t, this
                }
            }, {
                key: "children",
                value: function() {
                    if (null === this.top) return this;
                    var e = this.top.map(function(e) {
                            return e.transformComponent.children.map(function(e) {
                                return e.entity
                            })
                        }),
                        t = e.reduce(function(e, t) {
                            return e.concat(t)
                        }, []);
                    return this.stack.push(t), this.top = t, this
                }
            }], [{
                key: "installMethod",
                value: function(e, n, r) {
                    t.prototype[n] = function() {
                        if (null === this.top) return this;
                        for (var t = 0; t < this.top.length; t++) {
                            var n = this.top[t];
                            n.hasComponent(r) && e.apply(n, arguments)
                        }
                        return this
                    }
                }
            }]), t
        }(l.default);
    t.default = f
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.getTypedArray = function(e, t) {
        var n = t[0],
            r = t[1],
            i = t[2];
        if ("float32" === i) return new Float32Array(e, n, r);
        if ("uint8" === i) return new Uint8Array(e, n, r);
        if ("uint16" === i) return new Uint16Array(e, n, r);
        if ("uint32" === i) return new Uint32Array(e, n, r);
        throw new Error("Binary format " + i + " is not supported")
    }, r.remove = function(e, t, n) {
        var r = -1;
        if ("function" == typeof n) {
            for (var i = 0; i < e.length; i++)
                if (n(e[i], t)) {
                    r = i;
                    break
                }
        } else r = e.indexOf(t);
        r > -1 && e.splice(r, 1)
    }, r.find = function(e, t) {
        for (var n = 0; n < e.length; n++)
            if (t(e[n])) return e[n];
        return null
    }, r.fromKeys = function(e) {
        var t = [];
        return e.forEach(function(e, n) {
            t.push(n)
        }), t
    }, r.fromValues = function(e) {
        var t = [];
        return e.forEach(function(e) {
            t.push(e)
        }), t
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        f.default.call(this, e), this.radius = void 0 !== t ? t : 1, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(4),
        u = r(s),
        l = n(118),
        f = r(l),
        c = n(6),
        d = r(c),
        h = new a.default;
    i.prototype = Object.create(f.default.prototype), i.prototype.constructor = i, i.prototype.reset = function() {
            this.radius = 1, f.default.prototype.reset.call(this)
        }, i.prototype.computeFromPoints = function(e) {
            var t = e.length;
            if (!(t < 3)) {
                var n = this.min,
                    r = this.max,
                    i = h;
                n.setDirect(e[0], e[1], e[2]), r.setDirect(e[0], e[1], e[2]);
                for (var o = void 0, a = void 0, s = void 0, u = 3; u < t; u += 3) o = e[u + 0], a = e[u + 1], s = e[u + 2], n.x = o < n.x ? o : n.x, n.y = a < n.y ? a : n.y, n.z = s < n.z ? s : n.z, r.x = o > r.x ? o : r.x, r.y = a > r.y ? a : r.y, r.z = s > r.z ? s : r.z;
                for (var l = r.add(n).scale(.5), f = 0, c = void 0, d = 0; d < t; d += 3) i.setDirect(e[d], e[d + 1], e[d + 2]), (c = i.sub(l).lengthSquared()) > f && (f = c);
                this.radius = Math.sqrt(f), this.center.set(l)
            }
        },
        function() {
            var e = new a.default;
            i.prototype.containsPoint = function(t) {
                return e.set(t).sub(this.center).lengthSquared() <= Math.pow(this.radius, 2)
            }
        }(), i.prototype.computeFromPrimitives = function(e, t, n, r, i) {
            if (!(i - r <= 0)) {
                for (var o = [], s = [], u = d.default.getVertexCount(e.indexModes[t]), l = 0, f = r; f < i; f++) {
                    s = e.getPrimitiveVertices(n[f], t, s);
                    for (var c = 0; c < u; c++) o[l++] = (new a.default).set(s[c])
                }
                this.averagePoints(o)
            }
        }, i.prototype.averagePoints = function(e) {
            this.center.set(e[0]);
            for (var t = 1; t < e.length; t++) this.center.add(e[t]);
            var n = 1 / e.length;
            this.center.scale(n);
            for (var r = 0, i = 0; i < e.length; i++) {
                var o = h.copy(e[i]).sub(this.center),
                    a = o.lengthSquared();
                a > r && (r = a)
            }
            this.radius = Math.sqrt(r) + 1e-5
        }, i.prototype.transform = function(e, t) {
            null === t && (t = new i), e.applyForward(this.center, t.center);
            var n = e.scale;
            return t.radius = Math.abs(this._maxAxis(n) * this.radius), t
        }, i.prototype.whichSide = function(e) {
            var t = e.normal,
                n = this.center,
                r = t.x * n.x + t.y * n.y + t.z * n.z - e.constant;
            return r < -this.radius ? f.default.Inside : r > this.radius ? f.default.Outside : f.default.Intersects
        }, i.prototype._pseudoDistance = function(e, t) {
            return e.normal.x * t.x + e.normal.y * t.y + e.normal.z * t.z - e.constant
        }, i.prototype._maxAxis = function(e) {
            return Math.max(Math.abs(e.x), Math.max(Math.abs(e.y), Math.abs(e.z)))
        }, i.prototype.toString = function() {
            return "[" + Math.round(10 * this.center.x) / 10 + "," + Math.round(10 * this.center.y) / 10 + "," + Math.round(10 * this.center.z) / 10 + "] - " + Math.round(10 * this.radius) / 10
        }, i.prototype.intersects = function(e) {
            return e.intersectsSphere(this)
        }, i.prototype.intersectsBoundingBox = function(e) {
            e.min.x = e.center.x - e.xExtent, e.min.y = e.center.y - e.yExtent, e.min.z = e.center.z - e.zExtent, e.max.x = e.center.x + e.xExtent, e.max.y = e.center.y + e.yExtent, e.max.z = e.center.z + e.zExtent;
            var t = Math.pow(this.radius, 2),
                n = 0;
            return this.center.x < e.min.x ? n += Math.pow(this.center.x - e.min.x, 2) : this.center.x > e.max.x && (n += Math.pow(this.center.x - e.max.x, 2)), this.center.y < e.min.y ? n += Math.pow(this.center.y - e.min.y, 2) : this.center.y > e.max.y && (n += Math.pow(this.center.y - e.max.y, 2)), this.center.z < e.min.z ? n += Math.pow(this.center.z - e.min.z, 2) : this.center.z > e.max.z && (n += Math.pow(this.center.z - e.max.z, 2)), n <= t
        }, i.prototype.intersectsSphere = function(e) {
            var t = h.set(this.center).sub(e.center),
                n = this.radius + e.radius;
            return t.dot(t) <= n * n
        }, i.prototype.intersectsRay = function(e) {
            if (!this.center) return !1;
            var t = e.origin.clone().sub(this.center),
                n = t.dot(t) - this.radius * this.radius;
            if (n <= 0) return !0;
            var r = e.direction.dot(t);
            return !(r >= 0) && r * r >= n
        }, i.prototype.intersectsRayWhere = function(e) {
            var t = (new a.default).copy(e.origin).sub(this.center),
                n = t.dot(t) - this.radius * this.radius,
                r = void 0,
                i = void 0,
                o = void 0;
            if (n <= 0) {
                r = e.direction.dot(t), i = r * r - n, o = Math.sqrt(i);
                var s = [o - r];
                return {
                    distances: s,
                    points: [(new a.default).copy(e.direction).scale(s[0]).add(e.origin)]
                }
            }
            if ((r = e.direction.dot(t)) >= 0) return null;
            if ((i = r * r - n) < 0) return null;
            if (i >= 1e-5) {
                o = Math.sqrt(i);
                var u = [-r - o, -r + o];
                return {
                    distances: u,
                    points: [(new a.default).copy(e.direction).scale(u[0]).add(e.origin), (new a.default).copy(e.direction).scale(u[1]).add(e.origin)]
                }
            }
            var l = [-r];
            return {
                distances: l,
                points: [(new a.default).copy(e.direction).scale(l[0]).add(e.origin)]
            }
        }, i.prototype.merge = function(e) {
            if (e instanceof i) return this.mergeSphere(e.center, e.radius, this);
            var t = h.setDirect(e.xExtent, e.yExtent, e.zExtent).length();
            return this.mergeSphere(e.center, t, this)
        }, i.prototype.mergeSphere = function(e, t, n) {
            n || (n = new i);
            var r = h.set(e).sub(this.center),
                o = r.lengthSquared(),
                a = t - this.radius;
            if (a * a >= o) return a <= 0 ? (n.center.set(this.center), n.radius = this.radius, n) : (n.center.set(e), n.radius = t, n);
            var s = Math.sqrt(o),
                l = n.center;
            if (s > u.default.EPSILON) {
                var f = (s + a) / (2 * s);
                l.add(r.scale(f))
            }
            return n.radius = .5 * (s + this.radius + t), n
        }, i.prototype.copy = function(e) {
            return f.default.prototype.copy.call(this, e), this.radius = e.radius, this
        };
    var p = !1;
    i.prototype.clone = function() {
        return arguments.length > 0 && !p && (p = !0, console.warn('BoundingSphere::clone no longer takes an optional "store" parameter; please use BoundingSphere::copy instead')), new i(this.center, this.radius)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.origin = e ? e.clone() : new a.default, this.direction = t ? t.clone() : a.default.UNIT_Z.clone(), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(4),
        u = r(s),
        l = new a.default,
        f = new a.default,
        c = new a.default,
        d = new a.default,
        h = new a.default;
    i.prototype.intersects = function(e, t, n, r) {
        return 3 === e.length ? this.intersectsTriangle(e[0], e[1], e[2], t, n, r) : 4 === e.length && (this.intersectsTriangle(e[0], e[1], e[2], t, n, r) || this.intersectsTriangle(e[0], e[2], e[3], t, n, r))
    }, i.prototype.intersectsTriangle = function(e, t, n, r, i, o) {
        var a = f.set(t).sub(e),
            s = c.set(n).sub(e),
            p = d.set(a).cross(s),
            m = this.direction.dot(p),
            y = void 0;
        if (m > u.default.EPSILON) y = 1;
        else {
            if (!(m < -u.default.EPSILON)) return !1;
            if (o) return !1;
            y = -1, m = -m
        }
        var v = l.set(this.origin).sub(e),
            _ = y * this.direction.dot(h.copy(v).cross(s)),
            g = !1;
        if (_ >= 0) {
            var b = y * this.direction.dot(a.cross(v));
            if (b >= 0 && _ + b <= m) {
                var x = -y * v.dot(p);
                if (x >= 0) {
                    if (!i) return !0;
                    var w = 1 / m,
                        E = x * w;
                    if (r) {
                        var S = _ * w,
                            M = b * w;
                        i.setDirect(E, S, M)
                    } else i.set(this.origin).addDirect(this.direction.x * E, this.direction.y * E, this.direction.z * E);
                    g = !0
                }
            }
        }
        return g
    }, i.prototype.getDistanceToPrimitive = function(e) {
        var t = l;
        return this.intersects(e, !1, t) ? this.origin.distance(t.x, t.y, t.z) : 1 / 0
    }, i.prototype.intersectsPlane = function(e, t) {
        var n = e.normal,
            r = n.dot(this.direction);
        if (Math.abs(r) < 1e-5) return !1;
        var i = -n.dot(this.origin) + e.constant,
            o = i / r;
        return !(o < 1e-5) && (t && t.set(this.direction).scale(o).add(this.origin), !0)
    }, i.prototype.distanceSquared = function(e, t) {
        var n = l;
        n.set(e).sub(this.origin);
        var r = this.direction.dot(n);
        return r > 0 ? (n.set(this.direction).scale(r), n.add(this.origin)) : n.set(this.origin), t && t.set(n), n.sub(e), n.lengthSquared()
    }, i.prototype.copy = function(e) {
        this.origin.copy(e.origin), this.direction.copy(e.direction)
    }, i.prototype.clone = function() {
        return new i(this.origin.clone(), this.direction.clone())
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(26),
        a = r(o),
        s = n(6),
        u = r(s),
        l = n(110),
        f = r(l),
        c = n(81),
        d = r(c),
        h = n(93),
        p = r(h),
        m = n(45),
        y = r(m),
        v = n(4),
        _ = r(v),
        g = n(281),
        b = r(g),
        x = n(58),
        w = r(x),
        E = new d.default;
    E.translation.setDirect(10, 10, 10), E.direction.setDirect(1, 1, 1).normalize(), i.defaultLight = E, i.SKYBOX = null, i.SKYSPHERE = null, i.ENVIRONMENT_TYPE = 0, i.GLOBAL_AMBIENT = [0, 0, 0], i.CLEAR_COLOR = [.3, .3, .3, 1], i.USE_FOG = !1, i.FOG_SETTINGS = [0, 1e4], i.FOG_COLOR = [1, 1, 1], i.uber = {
        defines: function(e, t) {
            for (var n = Object.keys(t), r = 0, i = n.length; r < i; r++) e.setDefine(n[r], !0)
        },
        txMaps: function(e, t) {
            for (var n = Object.keys(t), r = 0, i = n.length; r < i; r++) {
                var o = n[r];
                void 0 !== t[o] && null !== t[o] && "SHADOW_MAP" !== o && e.setDefine(o, !0)
            }
        },
        reflectivity: function(e, t) {
            t.uniforms.reflectivity || t.uniforms.refractivity ? e.setDefine("REFLECTIVE", !0) : e.removeDefine("REFLECTIVE"), e.setDefine("REFLECTION_TYPE", void 0 !== t.uniforms.reflectionType ? t.uniforms.reflectionType : 0)
        },
        sky: function(e, t) {
            t.getTexture("LOCAL_ENVIRONMENT") ? (t.setTexture("ENVIRONMENT_SPHERE", t.getTexture("LOCAL_ENVIRONMENT")), e.setDefine("ENVIRONMENT_TYPE", 0), t.getTexture("ENVIRONMENT_CUBE") && t.removeTexture("ENVIRONMENT_CUBE")) : (i.SKYBOX && (t.uniforms.reflectivity || t.uniforms.refractivity) ? t.setTexture("ENVIRONMENT_CUBE", i.SKYBOX) : t.getTexture("ENVIRONMENT_CUBE") && t.removeTexture("ENVIRONMENT_CUBE"), i.SKYSPHERE && (t.uniforms.reflectivity || t.uniforms.refractivity) ? (t.setTexture("ENVIRONMENT_SPHERE", i.SKYSPHERE), e.setDefine("ENVIRONMENT_TYPE", i.ENVIRONMENT_TYPE)) : t.getTexture("ENVIRONMENT_SPHERE") && t.removeTexture("ENVIRONMENT_SPHERE"))
        },
        uniforms: function(e, t) {
            if (t.DIFFUSE_MAP) {
                var n = t.DIFFUSE_MAP.offset,
                    r = t.DIFFUSE_MAP.repeat;
                e.uniforms.offsetRepeat[0] = n.x, e.uniforms.offsetRepeat[1] = n.y, e.uniforms.offsetRepeat[2] = r.x, e.uniforms.offsetRepeat[3] = r.y, e.uniforms.lodBias = t.DIFFUSE_MAP.lodBias
            } else e.uniforms.offsetRepeat[0] = 0, e.uniforms.offsetRepeat[1] = 0, e.uniforms.offsetRepeat[2] = 1, e.uniforms.offsetRepeat[3] = 1, e.uniforms.lodBias = 0
        },
        attributes: function(e, t, n) {
            for (var r = Object.keys(e.defines), i = 0, o = r.length; i < o; i++) {
                var a = r[i];
                "SHADOW_TYPE" !== a && "JOINT_COUNT" !== a && "WEIGHTS" !== a && "PHYSICALLY_BASED_SHADING" !== a && "ENVIRONMENT_TYPE" !== a && "REFLECTIVE" !== a && "DISCARD" !== a && "OPACITY" !== a && "FOG" !== a && "REFLECTION_TYPE" !== a && "SKIP_SPECULAR" !== a && "LIGHT" !== a && "COOKIE" !== a && "TRANSPARENCY_BW" !== a && "WRAP_AROUND" !== a && "INSTANCED_DRAW" !== a && "INSTANCE_COUNT" !== a && (t[a] || n[a] || e.removeDefine(a))
            }
        },
        discard: function(e, t) {
            t.uniforms.discardThreshold >= 0 ? e.setDefine("DISCARD", !0) : e.removeDefine("DISCARD")
        },
        opacity: function(e, t) {
            var n = t.uniforms.opacity;
            void 0 !== n && n < 1 ? e.setDefine("OPACITY", !0) : e.removeDefine("OPACITY"), !0 === t.uniforms.useBWTransparency ? e.setDefine("TRANSPARENCY_BW", !0) : e.removeDefine("TRANSPARENCY_BW")
        },
        fog: function(e) {
            i.USE_FOG ? (e.setDefine("FOG", !0), e.uniforms.fogSettings = i.FOG_SETTINGS, e.uniforms.fogColor = i.FOG_COLOR) : e.removeDefine("FOG")
        },
        normalTangents: function(e, t) {
            e.hasDefine("NORMAL") && e.hasDefine("NORMAL_MAP") && !t.meshData.getAttributeBuffer(u.default.TANGENT) && b.default.addTangentBuffer(t.meshData)
        },
        processor: function(e, t) {
            if (t.meshData) {
                var n = t.meshData.attributeMap,
                    r = t.material,
                    o = r._textureMaps;
                e.uniforms.clearColor = i.CLEAR_COLOR, i.uber.reflectivity(e, r), i.uber.sky(e, r), i.uber.defines(e, n), i.uber.txMaps(e, o), i.uber.uniforms(e, o), i.uber.attributes(e, n, o), i.uber.discard(e, r), i.uber.opacity(e, r), i.uber.fog(e), e.setDefine("SKIP_SPECULAR", !0), i.uber.normalTangents(e, t)
            }
        }
    }, i.pbr = {
        defines: function(e, t) {
            for (var n = Object.keys(t), r = 0, i = n.length; r < i; r++) e.setDefine(n[r], !0)
        },
        txMaps: function(e, t) {
            for (var n = Object.keys(t), r = 0, i = n.length; r < i; r++) {
                var o = n[r];
                void 0 !== t[o] && null !== t[o] && "SHADOW_MAP" !== o && "DIFFUSE_IRRADIANCE_MAP" !== o && "SPECULAR_IRRADIANCE_MAP" !== o && "BRDF_LUT" !== o && e.setDefine(o, !0)
            }
        },
        uniforms: function(e, t) {
            if (t.DIFFUSE_MAP) {
                var n = t.DIFFUSE_MAP.offset,
                    r = t.DIFFUSE_MAP.repeat;
                e.uniforms.offsetRepeat[0] = n.x, e.uniforms.offsetRepeat[1] = n.y, e.uniforms.offsetRepeat[2] = r.x, e.uniforms.offsetRepeat[3] = r.y, e.uniforms.lodBias = t.DIFFUSE_MAP.lodBias
            } else e.uniforms.offsetRepeat[0] = 0, e.uniforms.offsetRepeat[1] = 0, e.uniforms.offsetRepeat[2] = 1, e.uniforms.offsetRepeat[3] = 1, e.uniforms.lodBias = 0
        },
        attributes: function(e, t, n) {
            for (var r = Object.keys(e.defines), i = 0, o = r.length; i < o; i++) {
                var a = r[i];
                "SHADOW_TYPE" !== a && "JOINT_COUNT" !== a && "WEIGHTS" !== a && "DISCARD" !== a && "OPACITY" !== a && "FOG" !== a && "LIGHT" !== a && "COOKIE" !== a && "TRANSPARENCY_BW" !== a && "INSTANCED_DRAW" !== a && "INSTANCE_COUNT" !== a && "PBR_MODEL" !== a && (t[a] || n[a] || e.removeDefine(a))
            }
        },
        discard: function(e, t) {
            t.uniforms.discardThreshold >= 0 ? e.setDefine("DISCARD", !0) : e.removeDefine("DISCARD")
        },
        opacity: function(e, t) {
            var n = t.uniforms.opacity;
            void 0 !== n && n < 1 ? e.setDefine("OPACITY", !0) : e.removeDefine("OPACITY"), !0 === t.uniforms.useBWTransparency ? e.setDefine("TRANSPARENCY_BW", !0) : e.removeDefine("TRANSPARENCY_BW")
        },
        fog: function(e) {
            i.USE_FOG ? (e.setDefine("FOG", !0), e.uniforms.fogSettings = i.FOG_SETTINGS, e.uniforms.fogColor = i.FOG_COLOR) : e.removeDefine("FOG")
        },
        normalTangents: function(e, t) {
            e.hasDefine("NORMAL") && e.hasDefine("NORMAL_MAP") && !t.meshData.getAttributeBuffer(u.default.TANGENT) && b.default.addTangentBuffer(t.meshData)
        },
        processor: function(e, t) {
            if (t.meshData) {
                var n = t.meshData.attributeMap,
                    r = t.material,
                    o = r._textureMaps;
                e.uniforms.clearColor = i.CLEAR_COLOR, i.pbr.defines(e, n), i.pbr.txMaps(e, o), i.pbr.uniforms(e, o), i.pbr.attributes(e, n, o), i.pbr.discard(e, r), i.pbr.opacity(e, r), i.pbr.fog(e), i.pbr.normalTangents(e, t)
            }
        }
    };
    var S = [];
    i.light = {
        pointLight: function(e, t, n) {
            var r = t.pointLights = t.pointLights || [],
                i = 8 * n,
                o = e.translation;
            r[i + 0] = o.x, r[i + 1] = o.y, r[i + 2] = o.z, r[i + 3] = e.range;
            var a = e.color;
            r[i + 4] = a.x * e.intensity, r[i + 5] = a.y * e.intensity, r[i + 6] = a.z * e.intensity, r[i + 7] = e.specularIntensity, S.push("P")
        },
        directionalLight: function(e, t, n) {
            var r = t.directionalLights = t.directionalLights || [],
                i = 8 * n,
                o = e.direction;
            r[i + 0] = o.x, r[i + 1] = o.y, r[i + 2] = o.z, r[i + 3] = 0;
            var a = e.color;
            r[i + 4] = a.x * e.intensity, r[i + 5] = a.y * e.intensity, r[i + 6] = a.z * e.intensity, r[i + 7] = e.specularIntensity, S.push("D")
        },
        spotLight: function(e, t, n) {
            var r = t.spotLights = t.spotLights || [],
                i = 16 * n;
            r[i + 0] = e.translation.x, r[i + 1] = e.translation.y, r[i + 2] = e.translation.z, r[i + 3] = e.range, r[i + 4] = e.color.x * e.intensity, r[i + 5] = e.color.y * e.intensity, r[i + 6] = e.color.z * e.intensity, r[i + 7] = e.specularIntensity, r[i + 8] = e.direction.x, r[i + 9] = e.direction.y, r[i + 10] = e.direction.z, r[i + 11] = 0, r[i + 12] = Math.cos(e.angle * _.default.DEG_TO_RAD / 2), r[i + 13] = void 0 !== e.penumbra ? Math.sin(e.penumbra * _.default.DEG_TO_RAD / 4) : 0, r[i + 14] = 0, r[i + 15] = 0, S.push("S")
        },
        shadows: function(e, t, n, r, i, o) {
            var a = e.lightCookie instanceof y.default;
            if ((a || e.shadowCaster) && e.shadowSettings.shadowData) {
                var s = e.shadowSettings.shadowData;
                if (e.shadowCaster) {
                    t["shadowMaps" + n] = "SHADOW_MAP" + n, i.material.setTexture("SHADOW_MAP" + n, s.shadowResult);
                    var u = t.shadowData = t.shadowData || [],
                        l = 8 * o,
                        f = s.lightCamera.translation;
                    u[l + 0] = f.x, u[l + 1] = f.y, u[l + 2] = f.z, u[l + 3] = e.shadowSettings.shadowOffset, u[l + 4] = s.cameraScale, u[l + 5] = e.shadowSettings.darkness, "PCF" === e.shadowSettings.shadowType ? (u[l + 6] = e.shadowSettings.resolution[0], u[l + 7] = e.shadowSettings.resolution[1]) : (u[l + 6] = 0, u[l + 7] = 0), o++, S.push("H", "PCF" === e.shadowSettings.shadowType ? 1 : "VSM" === e.shadowSettings.shadowType ? 2 : 0)
                }
                a ? (t["lightCookie" + n] = "LIGHT_COOKIE" + n, i.material.setTexture("LIGHT_COOKIE" + n, e.lightCookie), S.push("C"), r.setDefine("COOKIE", !0)) : r.removeDefine("COOKIE"), t["shadowLightMatrices" + n] = s.vpm
            }
            return o
        },
        processor: function(e, t) {
            var n = e.uniforms;
            n.totalAmbient = n.totalAmbient || [.1, .1, .1], t.material.uniforms.totalAmbient = t.material.uniforms.totalAmbient || [.1, .1, .1];
            var r = t.material.uniforms.materialAmbient || n.materialAmbient || [.1, .1, .1, 1],
                o = t.material.uniforms.totalAmbient;
            if (t.material.multiplyAmbient ? (o[0] = r[0] * i.GLOBAL_AMBIENT[0], o[1] = r[1] * i.GLOBAL_AMBIENT[1], o[2] = r[2] * i.GLOBAL_AMBIENT[2]) : (o[0] = r[0] + i.GLOBAL_AMBIENT[0], o[1] = r[1] + i.GLOBAL_AMBIENT[1], o[2] = r[2] + i.GLOBAL_AMBIENT[2]), t.renderable && t.renderable.meshRendererComponent && t.renderable.meshRendererComponent.receiveShadows ? e.setDefine("RECEIVE_SHADOW", !0) : e.removeDefine("RECEIVE_SHADOW"), e.frameStart) {
                n.materialEmissive = n.materialEmissive || "EMISSIVE", n.materialDiffuse = n.materialDiffuse || "DIFFUSE", n.materialSpecular = n.materialSpecular || "SPECULAR";
                var a = 0,
                    s = 0,
                    u = 0,
                    l = 0,
                    c = t.lights;
                if (c.length > 0) {
                    for (var h = 0; h < c.length; h++) {
                        var m = c[h];
                        m instanceof f.default ? (i.light.pointLight(m, n, a), a++) : m instanceof d.default ? (i.light.directionalLight(m, n, s), s++) : m instanceof p.default && (i.light.spotLight(m, n, u), u++), l = i.light.shadows(m, n, h, e, t, l)
                    }
                    var v = S.join("");
                    e.setDefine("LIGHT", v), S.length = 0
                } else e.removeDefine("LIGHT")
            } else
                for (var _ = t.lights, g = 0; g < _.length; g++) {
                    var b = _[g],
                        x = b.lightCookie instanceof y.default;
                    if ((x || b.shadowCaster) && b.shadowSettings.shadowData) {
                        var w = b.shadowSettings.shadowData;
                        b.shadowCaster && t.material.setTexture("SHADOW_MAP" + g, w.shadowResult), x && t.material.setTexture("LIGHT_COOKIE" + g, b.lightCookie)
                    } else t.material.removeTexture("SHADOW_MAP" + g), t.material.removeTexture("LIGHT_COOKIE" + g)
                }
        },
        builder: function(e, t) {
            var n = [],
                r = [],
                o = [],
                a = [];
            n.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"), o.push("#ifdef WEBGL_1", "  uniform vec3 totalAmbient;", "  uniform vec4 materialEmissive;", "  uniform vec4 materialDiffuse;", "  uniform vec4 materialSpecular;", "  uniform vec2 wrapSettings;", "#else", "uniform uniformBlockMatSettings {", "  vec3 totalAmbient;", "  vec4 materialEmissive;", "  vec4 materialDiffuse;", "  vec4 materialSpecular;", "  vec2 wrapSettings;", "};", "#endif", "float ChebychevInequality(in vec2 moments, in float t) {", "if ( t <= moments.x ) return 1.0;", "float variance = moments.y - (moments.x * moments.x);", "variance = max(variance, 0.02);", "float d = t - moments.x;", "return variance / (variance + d * d);", "}"), a.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)", "float specularStrength = texture(specularMap, texCoord0).x;", "#else", "float specularStrength = 1.0;", "#endif", "vec3 totalDiffuse = vec3(0.0);", "vec3 totalSpecular = vec3(0.0);");
            var s = t.lights;
            if (s.length > 0) {
                a.push("vec3 normalizedViewPosition = normalize(viewPosition);");
                for (var u = 0, l = 0, c = 0, h = 0, m = 0; m < s.length; m++) {
                    var v = s[m];
                    v instanceof f.default ? u++ : v instanceof d.default ? l++ : v instanceof p.default && c++, (v.lightCookie instanceof y.default || v.shadowCaster) && h++
                }
                u > 0 && o.push("#ifdef WEBGL_1", "uniform vec4 pointLights[" + 2 * u + "];", "#else", "uniform uniformBlockPointLights {", "  vec4 pointLights[" + 2 * u + "];", "};", "#endif"), l > 0 && o.push("#ifdef WEBGL_1", "uniform vec4 directionalLights[" + 2 * l + "];", "#else", "uniform uniformBlockDirLights {", "  vec4 directionalLights[" + 2 * l + "];", "};", "#endif"), c > 0 && o.push("#ifdef WEBGL_1", "uniform vec4 spotLights[" + 4 * c + "];", "#else", "uniform uniformBlockSpotLights {", "  vec4 spotLights[" + 4 * c + "];", "};", "#endif"), h > 0 && o.push(w.default.methods.unpackDepth, "#ifdef WEBGL_1", "uniform vec4 shadowData[" + 2 * h + "];", "#else", "uniform uniformBlockShadowData {", "  vec4 shadowData[" + 2 * h + "];", "};", "#endif", "float texture2DCompare(sampler2D depths, vec2 uv, float compare) {", "return step(unpackDepth(texture(depths, uv)), compare - 0.001);", "}"), u = 0, l = 0, c = 0, h = 0;
                for (var _ = 0; _ < s.length; _++) {
                    var g = s[_];
                    a.push("{", "float shadow = 1.0;");
                    var b = g.lightCookie instanceof y.default;
                    (g.shadowCaster || b) && (n.push("uniform mat4 shadowLightMatrices" + _ + ";", "out vec4 shadowLightDepths" + _ + ";"), r.push("shadowLightDepths" + _ + " = ScaleMatrix * shadowLightMatrices" + _ + " * worldPos;"), g.shadowCaster && (o.push("uniform sampler2D shadowMaps" + _ + ";"), a.push("float shadowOffset" + _ + " = shadowData[" + (2 * h + 0) + "].w;", "float shadowDarkness" + _ + " = shadowData[" + (2 * h + 1) + "].y;"), "PCF" === g.shadowSettings.shadowType ? a.push("vec2 shadowMapSizes" + _ + " = shadowData[" + (2 * h + 1) + "].zw;") : "VSM" === g.shadowSettings.shadowType && a.push("vec3 shadowLightPositions" + _ + " = shadowData[" + (2 * h + 0) + "].xyz;", "float cameraScales" + _ + " = shadowData[" + (2 * h + 1) + "].x;")), b && o.push("uniform sampler2D lightCookie" + _ + ";"), o.push("#ifdef WEBGL_1", "varying vec4 shadowLightDepths" + _ + ";", "#else", "in vec4 shadowLightDepths" + _ + ";", "#endif"), a.push("vec3 depth = shadowLightDepths" + _ + ".xyz / shadowLightDepths" + _ + ".w;"), g.shadowCaster && (h++, a.push("#ifdef RECEIVE_SHADOW", "depth.z += shadowOffset" + _ + ";", "if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths" + _ + ".z >= 0.0 && depth.z <= 1.0) {"), "PCF" === g.shadowSettings.shadowType ? a.push("float xPixelOffset = 1.0 / shadowMapSizes" + _ + ".x;", "float yPixelOffset = 1.0 / shadowMapSizes" + _ + ".y;", "float shadowRadius = 1.25;", "float dx0 = -shadowRadius * xPixelOffset;", "float dy0 = -shadowRadius * yPixelOffset;", "float dx1 = shadowRadius * xPixelOffset;", "float dy1 = shadowRadius * yPixelOffset;", "shadow = 1.0 - (", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx0, dy0), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(0.0, dy0), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx1, dy0), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx0, 0.0), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy, depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx1, 0.0), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx0, dy1), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(0.0, dy1), depth.z) +", "texture2DCompare(shadowMaps" + _ + ", depth.xy + vec2(dx1, dy1), depth.z)", ") * (shadowDarkness" + _ + " / 9.0);") : "VSM" === g.shadowSettings.shadowType ? a.push("depth.z = length(vWorldPos.xyz - shadowLightPositions" + _ + ") * cameraScales" + _ + ";", "vec4 texel = texture(shadowMaps" + _ + ", depth.xy);", "vec2 moments = vec2(texel.x, texel.y);", "shadow = ChebychevInequality(moments, depth.z);", "shadow = pow(shadow, shadowDarkness" + _ + " * 8.0);") : a.push("shadow = 1.0 - texture2DCompare(shadowMaps" + _ + ", depth.xy, depth.z) * shadowDarkness" + _ + ";"), a.push("} else {", "shadow = 1.0;", "}", "shadow = clamp(shadow, 0.0, 1.0);", "#endif"))), g instanceof f.default ? (a.push("vec4 pointLight" + _ + " = pointLights[" + (2 * u + 0) + "];", "vec4 pointLightColor" + _ + " = pointLights[" + (2 * u + 1) + "];"), a.push("vec3 lVector = normalize(pointLight" + _ + ".xyz - vWorldPos.xyz);", "float lDistance = 1.0 - min((length(pointLight" + _ + ".xyz - vWorldPos.xyz) / pointLight" + _ + ".w), 1.0);", "float dotProduct = dot(N, lVector);", "float pointDiffuseWeightFull = max(dotProduct, 0.0);", "float pointDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);", "vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapSettings.y);", "totalDiffuse += materialDiffuse.rgb * pointLightColor" + _ + ".rgb * pointDiffuseWeight * lDistance * shadow;", "vec3 pointHalfVector = normalize(lVector + normalizedViewPosition);", "float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);", "float pointSpecularWeight = pointLightColor" + _ + ".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecular.a), 0.0);", "#ifdef PHYSICALLY_BASED_SHADING", "float specularNormalization = (materialSpecular.a + 2.0001 ) / 8.0;", "vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);", "totalSpecular += schlick * pointLightColor" + _ + ".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;", "#else", "totalSpecular += materialSpecular.rgb * pointLightColor" + _ + ".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;", "#endif"), u++) : g instanceof d.default ? (a.push("vec3 directionalLightDirection" + _ + " = directionalLights[" + (2 * l + 0) + "].xyz;", "vec4 directionalLightColor" + _ + " = directionalLights[" + (2 * l + 1) + "];"), a.push("vec3 dirVector = normalize(-directionalLightDirection" + _ + ");", "float dotProduct = dot(N, dirVector);", "float dirDiffuseWeightFull = max(dotProduct, 0.0);", "float dirDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);", "vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapSettings.y);", "vec3 cookie = vec3(1.0);"), b && a.push("vec4 cookieTex = texture(lightCookie" + _ + ", depth.xy);", "cookie = cookieTex.rgb * cookieTex.a;"), a.push("totalDiffuse += materialDiffuse.rgb * directionalLightColor" + _ + ".rgb * dirDiffuseWeight * shadow * cookie;", "vec3 dirHalfVector = normalize(dirVector + normalizedViewPosition);", "float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);", "float dirSpecularWeight = directionalLightColor" + _ + ".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecular.a), 0.0);", "#ifdef PHYSICALLY_BASED_SHADING", "float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;", "vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);", "totalSpecular += schlick * directionalLightColor" + _ + ".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow * cookie;", "#else", "totalSpecular += materialSpecular.rgb * directionalLightColor" + _ + ".rgb * dirSpecularWeight * dirDiffuseWeight * shadow * cookie;", "#endif"), l++) : g instanceof p.default && (a.push("vec4 spotLight" + _ + " = spotLights[" + (4 * c + 0) + "];", "vec4 spotLightColor" + _ + " = spotLights[" + (4 * c + 1) + "];", "vec3 spotLightDirection" + _ + " = spotLights[" + (4 * c + 2) + "].xyz;", "float spotLightAngle" + _ + " = spotLights[" + (4 * c + 3) + "].x;", "float spotLightPenumbra" + _ + " = spotLights[" + (4 * c + 3) + "].y;"), a.push("vec3 lVector = normalize(spotLight" + _ + ".xyz - vWorldPos.xyz);", "float lDistance = 1.0 - min((length(spotLight" + _ + ".xyz - vWorldPos.xyz) / spotLight" + _ + ".w), 1.0);", "float spotEffect = dot(normalize(-spotLightDirection" + _ + "), lVector);", "if (spotEffect > spotLightAngle" + _ + ") {", "if (spotLightPenumbra" + _ + " > 0.0) {", "spotEffect = (spotEffect - spotLightAngle" + _ + ") / spotLightPenumbra" + _ + ";", "spotEffect = clamp(spotEffect, 0.0, 1.0);", "} else {", "spotEffect = 1.0;", "}", "float dotProduct = dot(N, lVector);", "float spotDiffuseWeightFull = max(dotProduct, 0.0);", "float spotDiffuseWeightHalf = max(mix(dotProduct, 1.0, wrapSettings.x), 0.0);", "vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapSettings.y);", "vec3 cookie = vec3(1.0);"), b && a.push("vec4 cookieTex = texture(lightCookie" + _ + ", depth.xy);", "cookie = cookieTex.rgb * cookieTex.a;"), a.push("totalDiffuse += materialDiffuse.rgb * spotLightColor" + _ + ".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;", "vec3 spotHalfVector = normalize(lVector + normalizedViewPosition);", "float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);", "float spotSpecularWeight = spotLightColor" + _ + ".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecular.a), 0.0);", "#ifdef PHYSICALLY_BASED_SHADING", "float specularNormalization = (materialSpecular.a + 2.0001) / 8.0;", "vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);", "totalSpecular += schlick * spotLightColor" + _ + ".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow * cookie;", "#else", "totalSpecular += materialSpecular.rgb * spotLightColor" + _ + ".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;", "#endif", "}"), c++), a.push("}")
                }
            }
            a.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)", "vec3 emissive = vec3(0.0);", "#else", "vec3 emissive = materialEmissive.rgb;", "#endif", "#ifdef SKIP_SPECULAR", "final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient);", "#else", "final_color.xyz = final_color.xyz * (emissive + totalDiffuse + totalAmbient) + totalSpecular;", "#endif", "#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)", "final_color.rgb += texture(emissiveMap, texCoord0).rgb * materialEmissive.rgb;", "#endif"), i.light.prevertex = n.join("\n"), i.light.vertex = r.join("\n"), i.light.prefragment = o.join("\n"), i.light.fragment = a.join("\n")
        }
    };
    var M = [];
    i.pbrLight = {
        pointLight: function(e, t, n) {
            var r = t.pointLights = t.pointLights || [],
                i = 8 * n,
                o = e.translation;
            r[i + 0] = o.x, r[i + 1] = o.y, r[i + 2] = o.z, r[i + 3] = e.range;
            var a = e.color;
            r[i + 4] = a.x * e.intensity, r[i + 5] = a.y * e.intensity, r[i + 6] = a.z * e.intensity, r[i + 7] = 0, M.push("P")
        },
        directionalLight: function(e, t, n) {
            var r = t.directionalLights = t.directionalLights || [],
                i = 8 * n,
                o = e.direction;
            r[i + 0] = o.x, r[i + 1] = o.y, r[i + 2] = o.z, r[i + 3] = 0;
            var a = e.color;
            r[i + 4] = a.x * e.intensity, r[i + 5] = a.y * e.intensity, r[i + 6] = a.z * e.intensity, r[i + 7] = 0, M.push("D")
        },
        spotLight: function(e, t, n) {
            var r = t.spotLights = t.spotLights || [],
                i = 16 * n;
            r[i + 0] = e.translation.x, r[i + 1] = e.translation.y, r[i + 2] = e.translation.z, r[i + 3] = e.range, r[i + 4] = e.color.x * e.intensity, r[i + 5] = e.color.y * e.intensity, r[i + 6] = e.color.z * e.intensity, r[i + 7] = 0, r[i + 8] = e.direction.x, r[i + 9] = e.direction.y, r[i + 10] = e.direction.z, r[i + 11] = 0, r[i + 12] = Math.cos(e.angle * _.default.DEG_TO_RAD / 2), r[i + 13] = void 0 !== e.penumbra ? Math.sin(e.penumbra * _.default.DEG_TO_RAD / 4) : 0, r[i + 14] = 0, r[i + 15] = 0, M.push("S")
        },
        shadows: function(e, t, n, r, i, o) {
            var a = e.lightCookie instanceof y.default;
            if ((a || e.shadowCaster) && e.shadowSettings.shadowData) {
                var s = e.shadowSettings.shadowData;
                if (e.shadowCaster) {
                    t["shadowMaps" + n] = "SHADOW_MAP" + n, i.material.setTexture("SHADOW_MAP" + n, s.shadowResult);
                    var u = t.shadowData = t.shadowData || [],
                        l = 8 * o,
                        f = s.lightCamera.translation;
                    u[l + 0] = f.x, u[l + 1] = f.y, u[l + 2] = f.z, u[l + 3] = e.shadowSettings.shadowOffset, u[l + 4] = s.cameraScale, u[l + 5] = e.shadowSettings.darkness, "PCF" === e.shadowSettings.shadowType ? (u[l + 6] = e.shadowSettings.resolution[0], u[l + 7] = e.shadowSettings.resolution[1]) : (u[l + 6] = 0, u[l + 7] = 0), o++, M.push("H", "PCF" === e.shadowSettings.shadowType ? 1 : "VSM" === e.shadowSettings.shadowType ? 2 : 0)
                }
                a ? (t["lightCookie" + n] = "LIGHT_COOKIE" + n, i.material.setTexture("LIGHT_COOKIE" + n, e.lightCookie), M.push("C"), r.setDefine("COOKIE", !0)) : r.removeDefine("COOKIE"), t["shadowLightMatrices" + n] = s.vpm
            }
            return o
        },
        processor: function(e, t) {
            var n = e.uniforms;
            t.renderable && t.renderable.meshRendererComponent && t.renderable.meshRendererComponent.receiveShadows ? e.setDefine("RECEIVE_SHADOW", !0) : e.removeDefine("RECEIVE_SHADOW");
            var r = a.default.maxFragmentTextureUnits > 8 ? 4 : 1,
                o = a.default.maxFragmentTextureUnits > 8 ? 4 : 1,
                s = 0,
                u = 0;
            if (e.frameStart) {
                var l = 0,
                    c = 0,
                    h = 0,
                    m = 0,
                    v = t.lights;
                if (v.length > 0) {
                    for (var _ = 0; _ < v.length; _++) {
                        var g = v[_];
                        g instanceof f.default ? (i.pbrLight.pointLight(g, n, l), l++) : g instanceof d.default ? (i.pbrLight.directionalLight(g, n, c), c++) : g instanceof p.default && (i.pbrLight.spotLight(g, n, h), h++);
                        var b = g.lightCookie instanceof y.default;
                        (g.shadowCaster && s < r || b && u < o) && (g.shadowCaster && s++, b && u++, m = i.pbrLight.shadows(g, n, _, e, t, m))
                    }
                    var x = M.join("");
                    e.setDefine("LIGHT", x), M.length = 0
                } else e.removeDefine("LIGHT")
            } else
                for (var w = t.lights, E = 0; E < w.length; E++) {
                    var S = w[E],
                        C = S.lightCookie instanceof y.default;
                    if ((C || S.shadowCaster) && S.shadowSettings.shadowData) {
                        var T = S.shadowSettings.shadowData;
                        S.shadowCaster && s < r && (s++, t.material.setTexture("SHADOW_MAP" + E, T.shadowResult)), C && u < o && (u++, t.material.setTexture("LIGHT_COOKIE" + E, S.lightCookie))
                    } else t.material.removeTexture("SHADOW_MAP" + E), t.material.removeTexture("LIGHT_COOKIE" + E)
                }
        },
        builder: function(e, t) {
            var n = [],
                r = [],
                o = [],
                s = [],
                u = a.default.Webgl2 ? "texture" : "texture2D",
                l = (a.default.Webgl2, a.default.Webgl2 ? "out" : "varying"),
                c = a.default.Webgl2 ? "in" : "varying",
                h = a.default.maxFragmentTextureUnits > 8 ? 4 : 1,
                m = a.default.maxFragmentTextureUnits > 8 ? 4 : 1,
                v = 0,
                _ = 0;
            n.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"), o.push("float DistributionGGX(vec3 N, vec3 H, float a) {\n          float a2     = a*a*a*a;\n          float NdotH  = max(dot(N, H), 0.0);\n          float NdotH2 = NdotH*NdotH;\n          float nom    = a2;\n          float denom  = (NdotH2 * (a2 - 1.0) + 1.0);\n          denom        = PI * denom * denom;\n          return nom / denom;\n      }\n      float DistributionBeckmann(vec3 N, vec3 H, float a)\n      {\n        float a2 = a*a*a*a;\n        float NdotH =max(dot(N, H), 0.0); //if max with 0 then divide by 0 (we dont want that)\n        float NdotH2 = NdotH*NdotH;\n        float denom = max(PI * a2 * NdotH2 * NdotH2,0.00001);\n        return exp((NdotH2 - 1.0) / (a2 * NdotH2)) / (denom);\n      }      \n      float DistributionBlinn(vec3 N, vec3 H, float a)\n      {\n        float a2 = a*a*a*a;\n        float n = 2.0 / a2 - 2.0 + 0.001;\n        float NdotH = max(dot(N, H), 0.000000);\n        float clampedPow = pow(NdotH,n);\n        clampedPow = max(clampedPow,0.00);\n        \n        return ((n + 2.0) / (2.0*PI)) * clampedPow;\n      }\n\n\n      float GeometrySchlickGGX(float NdotV, float k) {\n          float nom   = NdotV;\n          float denom = NdotV * (1.0 - k) + k;\n          return nom / denom;\n      }\n      float GeometrySmith(vec3 N, vec3 V, vec3 L, float k) {\n          float NdotV = max(dot(N, V), 0.0);\n          float NdotL = max(dot(N, L), 0.0);\n          float ggx1 = GeometrySchlickGGX(NdotV, k);\n          float ggx2 = GeometrySchlickGGX(NdotL, k);\n          return ggx1 * ggx2;\n      }\n      vec3 FresnelSchlick(float cosTheta, vec3 F0) {\n          return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n      }\n      vec2 BRDFApprox(float Roughness, float NoV)\n      {\n        const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n        const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n        vec4 r = Roughness * c0 + c1;\n        float a004 = min(r.x * r.x, pow(2.0, -9.28 * NoV)) * r.x + r.y;\n        return vec2(-1.04, 1.04) * a004 + r.zw;\n      }\n      float ChebychevInequality(in vec2 moments, in float t) {\n        if ( t <= moments.x ) return 1.0;\n        float variance = moments.y - (moments.x * moments.x);\n        variance = max(variance, 0.02);\n        float d = t - moments.x;\n        return variance / (variance + d * d);\n      }");
            var g = t.lights;
            if (g.length > 0) {
                s.push("vec3 normalizedViewPosition = normalize(viewPosition);");
                for (var b = 0, x = 0, E = 0, S = 0, M = 0; M < g.length; M++) {
                    var C = g[M];
                    C instanceof f.default ? b++ : C instanceof d.default ? x++ : C instanceof p.default && E++, C.shadowCaster && v < h && (v++, S++), C.lightCookie instanceof y.default && _ < m && (_++, S++)
                }
                b > 0 && o.push("uniform vec4 pointLights[" + 2 * b + "];"), x > 0 && o.push("uniform vec4 directionalLights[" + 2 * x + "];"), E > 0 && o.push("uniform vec4 spotLights[" + 4 * E + "];"), S > 0 && o.push(w.default.methods.unpackDepth, "uniform vec4 shadowData[" + 2 * S + "];", "float texture2DCompare(sampler2D depths, vec2 uv, float compare) {", "return step(unpackDepth(" + u + "(depths, uv)), compare - 0.001);", "}"), b = 0, x = 0, E = 0, S = 0, v = 0, _ = 0;
                for (var T = 0; T < g.length; T++) {
                    var R = g[T];
                    s.push("{", "float shadow = 1.0;");
                    var A = R.lightCookie instanceof y.default;
                    (R.shadowCaster && v < h || A && _ < m) && (n.push("uniform mat4 shadowLightMatrices" + T + ";", l + " vec4 shadowLightDepths" + T + ";"), r.push("shadowLightDepths" + T + " = ScaleMatrix * shadowLightMatrices" + T + " * worldPos;"), R.shadowCaster && v < h && (o.push("uniform sampler2D shadowMaps" + T + ";"), s.push("float shadowOffset" + T + " = shadowData[" + (2 * S + 0) + "].w;", "float shadowDarkness" + T + " = shadowData[" + (2 * S + 1) + "].y;"), "PCF" === R.shadowSettings.shadowType ? s.push("vec2 shadowMapSizes" + T + " = shadowData[" + (2 * S + 1) + "].zw;") : "VSM" === R.shadowSettings.shadowType && s.push("vec3 shadowLightPositions" + T + " = shadowData[" + (2 * S + 0) + "].xyz;", "float cameraScales" + T + " = shadowData[" + (2 * S + 1) + "].x;")), A && _ < m && o.push("uniform sampler2D lightCookie" + T + ";"), o.push(c + " vec4 shadowLightDepths" + T + ";"), s.push("vec3 depth = shadowLightDepths" + T + ".xyz / shadowLightDepths" + T + ".w;"), R.shadowCaster && v < h && (S++, s.push("#ifdef RECEIVE_SHADOW", "depth.z += shadowOffset" + T + ";", "if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths" + T + ".z >= 0.0 && depth.z <= 1.0) {"), "PCF" === R.shadowSettings.shadowType ? s.push("float xPixelOffset = 1.0 / shadowMapSizes" + T + ".x;", "float yPixelOffset = 1.0 / shadowMapSizes" + T + ".y;", "float shadowRadius = 1.25;", "float dx0 = -shadowRadius * xPixelOffset;", "float dy0 = -shadowRadius * yPixelOffset;", "float dx1 = shadowRadius * xPixelOffset;", "float dy1 = shadowRadius * yPixelOffset;", "shadow = 1.0 - (", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx0, dy0), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(0.0, dy0), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx1, dy0), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx0, 0.0), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy, depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx1, 0.0), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx0, dy1), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(0.0, dy1), depth.z) +", "texture2DCompare(shadowMaps" + T + ", depth.xy + vec2(dx1, dy1), depth.z)", ") * (shadowDarkness" + T + " / 9.0);") : "VSM" === R.shadowSettings.shadowType ? s.push("depth.z = length(vWorldPos - shadowLightPositions" + T + ") * cameraScales" + T + ";", "vec4 texel = " + u + "(shadowMaps" + T + ", depth.xy);", "vec2 moments = vec2(texel.x, texel.y);", "shadow = ChebychevInequality(moments, depth.z);", "shadow = pow(shadow, shadowDarkness" + T + " * 8.0);") : s.push("shadow = 1.0 - texture2DCompare(shadowMaps" + T + ", depth.xy, depth.z) * shadowDarkness" + T + ";"), s.push("} else {", "shadow = 1.0;", "}", "shadow = clamp(shadow, 0.0, 1.0);", "#endif"))), R instanceof f.default ? (s.push("vec4 pointLight" + T + " = pointLights[" + (2 * b + 0) + "];", "vec4 pointLightColor" + T + " = pointLights[" + (2 * b + 1) + "];"), s.push("vec3 L = normalize(pointLight" + T + ".xyz - vWorldPos);\n            vec3 H = normalize(V + L);\n            float NdotL = max(dot(N, L), 0.0);\n            float distance    = length(pointLight" + T + ".xyz - vWorldPos.xyz);\n            float attenuation    = 1.0 - min((distance * distance) / (pointLight" + T + ".w * pointLight" + T + ".w), 1.0);\n            vec3 radiance     = pointLightColor" + T + ".rgb * attenuation * shadow;\n\n            #ifndef PBR_MODEL\n            #def PBR_MODEL 0\n            #endif\n\n            #if (PBR_MODEL == 0)\n              float NDF = DistributionGGX(N, H, roughness);\n            #elif (PBR_MODEL == 1)\n              float NDF = DistributionBeckmann(N, H, roughness);\n            #else\n              float NDF = DistributionBlinn(N,H,roughness);\n            #endif\n            \n            float G   = GeometrySmith(N, V, L, roughness);\n            vec3 F    = FresnelSchlick(max(dot(H, V), 0.0), F0);\n            vec3 specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\n\n            vec3 kS = F;\n            vec3 kD = vec3(1.0) - kS;\n            kD *= 1.0 - metallicFactor;\n            Lo +=(kD * albedo / PI + specular) * radiance * NdotL;"), b++) : R instanceof d.default ? (s.push("vec3 directionalLightDirection" + T + " = directionalLights[" + (2 * x + 0) + "].xyz;", "vec4 directionalLightColor" + T + " = directionalLights[" + (2 * x + 1) + "];"), s.push("vec3 L = normalize(-directionalLightDirection" + T + ");", "vec3 H = normalize(V + L);", "float NdotL = max(dot(N, L), 0.0);", "vec3 cookie = vec3(1.0);"), A && _ < m && s.push("vec4 cookieTex = " + u + "(lightCookie" + T + ", depth.xy);", "cookie = cookieTex.rgb * cookieTex.a;"), s.push("vec3 radiance     = directionalLightColor" + T + ".rgb * cookie * shadow;\n            #ifndef PBR_MODEL\n            #def PBR_MODEL 0\n            #endif\n\n            #if (PBR_MODEL == 0)\n              float NDF = DistributionGGX(N, H, roughness);\n            #elif (PBR_MODEL == 1)\n              float NDF = DistributionBeckmann(N, H, roughness);\n            #else\n              float NDF = DistributionBlinn(N,H,roughness);\n            #endif\n\n            float G   = GeometrySmith(N, V, L, roughness);\n            vec3 F    = FresnelSchlick(max(dot(H, V), 0.0), F0);\n            vec3 specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\n\n            vec3 kS = F;\n            vec3 kD = vec3(1.0) - kS;\n            kD *= 1.0 - metallicFactor;\n            Lo += (kD * albedo / PI + specular) * radiance * NdotL;"), x++) : R instanceof p.default && (s.push("vec4 spotLight" + T + " = spotLights[" + (4 * E + 0) + "];", "vec4 spotLightColor" + T + " = spotLights[" + (4 * E + 1) + "];", "vec3 spotLightDirection" + T + " = spotLights[" + (4 * E + 2) + "].xyz;", "float spotLightAngle" + T + " = spotLights[" + (4 * E + 3) + "].x;", "float spotLightPenumbra" + T + " = spotLights[" + (4 * E + 3) + "].y;"), s.push("vec3 L = normalize(spotLight" + T + ".xyz - vWorldPos.xyz);\n            vec3 H = normalize(V + L);\n            float NdotL = max(dot(N, L), 0.0);\n            float distance    = length(spotLight" + T + ".xyz - vWorldPos.xyz);\n            float attenuation = 1.0 - min((distance * distance) / (spotLight" + T + ".w * spotLight" + T + ".w), 1.0);\n\n            float spotEffect = dot(normalize(-spotLightDirection" + T + "), L); \n\n            if (spotEffect > spotLightAngle" + T + ") {\n              if (spotLightPenumbra" + T + " > 0.0) {\n                spotEffect = (spotEffect - spotLightAngle" + T + ") / spotLightPenumbra" + T + ";\n                spotEffect = clamp(spotEffect, 0.0, 1.0);\n              } else {\n                spotEffect = 1.0;\n              }\n              vec3 cookie = vec3(1.0);"), A && _ < m && s.push("vec4 cookieTex = " + u + "(lightCookie" + T + ", depth.xy);", "cookie = cookieTex.rgb * cookieTex.a;"), s.push("vec3 radiance     = spotLightColor" + T + ".rgb * spotEffect * attenuation * cookie * shadow;\n            \n            #ifndef PBR_MODEL\n            #def PBR_MODEL 0\n            #endif\n\n            #if PBR_MODEL == 0\n              float NDF = DistributionGGX(N, H, roughness);\n            #elif PBR_MODEL == 1\n              float NDF = DistributionBeckmann(N, H, roughness);\n            #else\n              float NDF = DistributionBlinn(N,H,roughness);\n            #endif\n\n            float G   = GeometrySmith(N, V, L, roughness);\n            vec3 F    = FresnelSchlick(max(dot(H, V), 0.0), F0);\n            vec3 specular = (NDF * G * F) / (4.0 * max(dot(N, V), 0.0) * NdotL + 0.001);\n\n            vec3 kS = F;\n            vec3 kD = vec3(1.0) - kS;\n            kD *= 1.0 - metallicFactor;\n            Lo += (kD * albedo / PI + specular) * radiance * NdotL;\n            }"), E++), R.shadowCaster && v < h && v++, A && _ < m && _++, s.push("}")
                }
            }
            i.pbrLight.prevertex = n.join("\n"), i.pbrLight.vertex = r.join("\n"), i.pbrLight.prefragment = o.join("\n"), i.pbrLight.fragment = s.join("\n")
        }
    }, i.animation = {
        processor: function(e, t) {
            (Array.isArray(t.currentPose) ? t.currentPose[0] : t.currentPose) ? (e.uniforms.jointPalette || (e.uniforms.jointPalette = i.animation.jointPalette), e.setDefine("JOINT_COUNT", 3 * t.meshData.paletteMap.length)) : e.removeDefine("JOINT_COUNT")
        },
        jointPalette: function(e) {
            var t = e.meshData,
                n = e.currentPose;
            if (n) {
                var r = n._matrixPalette,
                    o = t.store;
                o || (o = new Float32Array(12 * t.paletteMap.length), t.store = o);
                for (var a = void 0, s = 0; s < t.paletteMap.length; s++)
                    if (a = r[t.paletteMap[s]])
                        for (var u = 0; u < 12; u++) o[12 * s + u] = a.data[i.animation.order[u]];
                return o
            }
        },
        order: [0, 4, 8, 12, 1, 5, 9, 13, 2, 6, 10, 14],
        prevertex: ["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)", "in vec4 vertexJointIDs;", "in vec4 vertexWeights;", "#ifdef WEBGL_1", "uniform vec4 jointPalette[JOINT_COUNT];", "#else", "uniform uniformBlockJointPalette {", "  vec4 jointPalette[JOINT_COUNT];", "};", "#endif // WEBGL_1", "#endif"].join("\n"),
        vertex: ["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)", "int x = 3*int(vertexJointIDs.x);", "int y = 3*int(vertexJointIDs.y);", "int z = 3*int(vertexJointIDs.z);", "int w = 3*int(vertexJointIDs.w);", "mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);", "mat += mat4(", "  jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,", "  jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,", "  jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,", "  jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1", ") * vertexWeights.x;", "mat += mat4(", "  jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,", "  jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,", "  jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,", "  jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1", ") * vertexWeights.y;", "mat += mat4(", "  jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,", "  jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,", "  jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,", "  jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1", ") * vertexWeights.z;", "mat += mat4(", "  jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,", "  jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,", "  jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,", "  jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1", ") * vertexWeights.w;", "wMatrix = wMatrix * mat / mat[3][3];", "#ifdef NORMAL", "nMatrix = nMatrix * mat3(mat) / mat[3][3];", "#endif", "#endif"].join("\n")
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.destroy = function() {}, r.prototype.render = function() {}, r.prototype.updateSize = function() {}, r.prototype.invalidateHandles = function() {}, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        o = function() {
            function e() {
                r(this, e)
            }
            return i(e, null, [{
                key: "SET_CURRENT_VR",
                get: function() {
                    return "sumerian.setCurrentVRCameraRig"
                }
            }, {
                key: "RELEASE_CURRENT_VR",
                get: function() {
                    return "sumerian.releaseCurrentVRCameraRig"
                }
            }, {
                key: "VR_PRESENTATION_START",
                get: function() {
                    return "sumerian.VRPresentationStarted"
                }
            }, {
                key: "VR_PRESENTATION_STOP",
                get: function() {
                    return "sumerian.VRPresentationStopped"
                }
            }, {
                key: "START_VRCAMERAS",
                get: function() {
                    return "sumerian.startVRCameras"
                }
            }, {
                key: "STOP_VRCAMERAS",
                get: function() {
                    return "sumerian.stopVRCameras"
                }
            }]), e
        }();
    t.default = o
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(46),
        l = r(u),
        f = n(8),
        c = r(f),
        d = n(6),
        h = r(d),
        p = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n.type = "MeshDataComponent", n.meshData = e, n.modelBound = new l.default, n.modelBoundDirty = !0, n.currentPose = null, Object.seal(n), n
            }
            return a(t, e), s(t, [{
                key: "setModelBound",
                value: function(e, t) {
                    this.modelBound = e, this.modelBoundDirty = void 0 === t || t
                }
            }, {
                key: "computeBoundFromPoints",
                value: function() {
                    if (this.modelBoundDirty)
                        if (null !== this.modelBound && this.meshData) {
                            var e = this.meshData.getAttributeBuffer("POSITION");
                            void 0 !== e && (this.modelBound.computeFromPoints(e), this.modelBoundDirty = !1)
                        } else this.modelBound.reset()
                }
            }, {
                key: "clone",
                value: function(e) {
                    e = e || {};
                    var n = new t;
                    return e.shareMeshData ? (n.meshData = this.meshData, n.modelBound = this.modelBound) : (n.meshData = this.meshData.clone(), n.modelBound = this.modelBound.clone()), n.modelBoundDirty = this.modelBoundDirty, n
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    if (e instanceof h.default) {
                        var r = new t(e);
                        return n.setComponent(r), !0
                    }
                }
            }]), t
        }(c.default);
    p.type = "MeshDataComponent", t.default = p
}, function(e, t) {
    var n = e.exports = {
        version: "2.4.0"
    };
    "number" == typeof __e && (__e = n)
}, function(e, t, n) {
    var r = n(42);
    e.exports = function(e, t, n) {
        if (r(e), void 0 === t) return e;
        switch (n) {
            case 1:
                return function(n) {
                    return e.call(t, n)
                };
            case 2:
                return function(n, r) {
                    return e.call(t, n, r)
                };
            case 3:
                return function(n, r, i) {
                    return e.call(t, n, r, i)
                }
        }
        return function() {
            return e.apply(t, arguments)
        }
    }
}, function(e, t, n) {
    "use strict";
    if (n(27)) {
        var r = n(84),
            i = n(13),
            o = n(14),
            a = n(1),
            s = n(141),
            u = n(192),
            l = n(72),
            f = n(90),
            c = n(77),
            d = n(40),
            h = n(91),
            p = n(79),
            m = n(32),
            y = n(86),
            v = n(60),
            _ = n(39),
            g = n(240),
            b = n(115),
            x = n(19),
            w = n(35),
            E = n(184),
            S = n(87),
            M = n(49),
            C = n(88).f,
            T = n(186),
            R = n(83),
            A = n(23),
            O = n(62),
            P = n(133),
            D = n(189),
            I = n(188),
            k = n(104),
            N = n(137),
            L = n(89),
            B = n(187),
            F = n(249),
            j = n(28),
            U = n(48),
            V = j.f,
            z = U.f,
            G = i.RangeError,
            W = i.TypeError,
            H = i.Uint8Array,
            X = Array.prototype,
            Y = u.ArrayBuffer,
            q = u.DataView,
            K = O(0),
            Q = O(2),
            Z = O(3),
            J = O(4),
            $ = O(5),
            ee = O(6),
            te = P(!0),
            ne = P(!1),
            re = I.values,
            ie = I.keys,
            oe = I.entries,
            ae = X.lastIndexOf,
            se = X.reduce,
            ue = X.reduceRight,
            le = X.join,
            fe = X.sort,
            ce = X.slice,
            de = X.toString,
            he = X.toLocaleString,
            pe = A("iterator"),
            me = A("toStringTag"),
            ye = R("typed_constructor"),
            ve = R("def_constructor"),
            _e = s.CONSTR,
            ge = s.TYPED,
            be = s.VIEW,
            xe = O(1, function(e, t) {
                return Te(D(e, e[ve]), t)
            }),
            we = o(function() {
                return 1 === new H(new Uint16Array([1]).buffer)[0]
            }),
            Ee = !!H && !!H.prototype.set && o(function() {
                new H(1).set({})
            }),
            Se = function(e, t) {
                if (void 0 === e) throw W("Wrong length!");
                var n = +e,
                    r = m(e);
                if (t && !g(n, r)) throw G("Wrong length!");
                return r
            },
            Me = function(e, t) {
                var n = p(e);
                if (n < 0 || n % t) throw G("Wrong offset!");
                return n
            },
            Ce = function(e) {
                if (x(e) && ge in e) return e;
                throw W(e + " is not a typed array!")
            },
            Te = function(e, t) {
                if (!(x(e) && ye in e)) throw W("It is not a typed array constructor!");
                return new e(t)
            },
            Re = function(e, t) {
                return Ae(D(e, e[ve]), t)
            },
            Ae = function(e, t) {
                for (var n = 0, r = t.length, i = Te(e, r); r > n;) i[n] = t[n++];
                return i
            },
            Oe = function(e, t, n) {
                V(e, t, {
                    get: function() {
                        return this._d[n]
                    }
                })
            },
            Pe = function(e) {
                var t, n, r, i, o, a, s = w(e),
                    u = arguments.length,
                    f = u > 1 ? arguments[1] : void 0,
                    c = void 0 !== f,
                    d = T(s);
                if (void 0 != d && !E(d)) {
                    for (a = d.call(s), r = [], t = 0; !(o = a.next()).done; t++) r.push(o.value);
                    s = r
                }
                for (c && u > 2 && (f = l(f, arguments[2], 2)), t = 0, n = m(s.length), i = Te(this, n); n > t; t++) i[t] = c ? f(s[t], t) : s[t];
                return i
            },
            De = function() {
                for (var e = 0, t = arguments.length, n = Te(this, t); t > e;) n[e] = arguments[e++];
                return n
            },
            Ie = !!H && o(function() {
                he.call(new H(1))
            }),
            ke = function() {
                return he.apply(Ie ? ce.call(Ce(this)) : Ce(this), arguments)
            },
            Ne = {
                copyWithin: function(e, t) {
                    return F.call(Ce(this), e, t, arguments.length > 2 ? arguments[2] : void 0)
                },
                every: function(e) {
                    return J(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                fill: function(e) {
                    return B.apply(Ce(this), arguments)
                },
                filter: function(e) {
                    return Re(this, Q(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0))
                },
                find: function(e) {
                    return $(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                findIndex: function(e) {
                    return ee(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                forEach: function(e) {
                    K(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                indexOf: function(e) {
                    return ne(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                includes: function(e) {
                    return te(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                join: function(e) {
                    return le.apply(Ce(this), arguments)
                },
                lastIndexOf: function(e) {
                    return ae.apply(Ce(this), arguments)
                },
                map: function(e) {
                    return xe(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                reduce: function(e) {
                    return se.apply(Ce(this), arguments)
                },
                reduceRight: function(e) {
                    return ue.apply(Ce(this), arguments)
                },
                reverse: function() {
                    for (var e, t = this, n = Ce(t).length, r = Math.floor(n / 2), i = 0; i < r;) e = t[i], t[i++] = t[--n], t[n] = e;
                    return t
                },
                some: function(e) {
                    return Z(Ce(this), e, arguments.length > 1 ? arguments[1] : void 0)
                },
                sort: function(e) {
                    return fe.call(Ce(this), e)
                },
                subarray: function(e, t) {
                    var n = Ce(this),
                        r = n.length,
                        i = y(e, r);
                    return new(D(n, n[ve]))(n.buffer, n.byteOffset + i * n.BYTES_PER_ELEMENT, m((void 0 === t ? r : y(t, r)) - i))
                }
            },
            Le = function(e, t) {
                return Re(this, ce.call(Ce(this), e, t))
            },
            Be = function(e) {
                Ce(this);
                var t = Me(arguments[1], 1),
                    n = this.length,
                    r = w(e),
                    i = m(r.length),
                    o = 0;
                if (i + t > n) throw G("Wrong length!");
                for (; o < i;) this[t + o] = r[o++]
            },
            Fe = {
                entries: function() {
                    return oe.call(Ce(this))
                },
                keys: function() {
                    return ie.call(Ce(this))
                },
                values: function() {
                    return re.call(Ce(this))
                }
            },
            je = function(e, t) {
                return x(e) && e[ge] && "symbol" != typeof t && t in e && String(+t) == String(t)
            },
            Ue = function(e, t) {
                return je(e, t = v(t, !0)) ? c(2, e[t]) : z(e, t)
            },
            Ve = function(e, t, n) {
                return !(je(e, t = v(t, !0)) && x(n) && _(n, "value")) || _(n, "get") || _(n, "set") || n.configurable || _(n, "writable") && !n.writable || _(n, "enumerable") && !n.enumerable ? V(e, t, n) : (e[t] = n.value, e)
            };
        _e || (U.f = Ue, j.f = Ve), a(a.S + a.F * !_e, "Object", {
            getOwnPropertyDescriptor: Ue,
            defineProperty: Ve
        }), o(function() {
            de.call({})
        }) && (de = he = function() {
            return le.call(this)
        });
        var ze = h({}, Ne);
        h(ze, Fe), d(ze, pe, Fe.values), h(ze, {
            slice: Le,
            set: Be,
            constructor: function() {},
            toString: de,
            toLocaleString: ke
        }), Oe(ze, "buffer", "b"), Oe(ze, "byteOffset", "o"), Oe(ze, "byteLength", "l"), Oe(ze, "length", "e"), V(ze, me, {
            get: function() {
                return this[ge]
            }
        }), e.exports = function(e, t, n, u) {
            u = !!u;
            var l = e + (u ? "Clamped" : "") + "Array",
                c = "Uint8Array" != l,
                h = "get" + e,
                p = "set" + e,
                y = i[l],
                v = y || {},
                _ = y && M(y),
                g = !y || !s.ABV,
                w = {},
                E = y && y.prototype,
                T = function(e, n) {
                    var r = e._d;
                    return r.v[h](n * t + r.o, we)
                },
                R = function(e, n, r) {
                    var i = e._d;
                    u && (r = (r = Math.round(r)) < 0 ? 0 : r > 255 ? 255 : 255 & r), i.v[p](n * t + i.o, r, we)
                },
                A = function(e, t) {
                    V(e, t, {
                        get: function() {
                            return T(this, t)
                        },
                        set: function(e) {
                            return R(this, t, e)
                        },
                        enumerable: !0
                    })
                };
            g ? (y = n(function(e, n, r, i) {
                f(e, y, l, "_d");
                var o, a, s, u, c = 0,
                    h = 0;
                if (x(n)) {
                    if (!(n instanceof Y || "ArrayBuffer" == (u = b(n)) || "SharedArrayBuffer" == u)) return ge in n ? Ae(y, n) : Pe.call(y, n);
                    o = n, h = Me(r, t);
                    var p = n.byteLength;
                    if (void 0 === i) {
                        if (p % t) throw G("Wrong length!");
                        if ((a = p - h) < 0) throw G("Wrong length!")
                    } else if ((a = m(i) * t) + h > p) throw G("Wrong length!");
                    s = a / t
                } else s = Se(n, !0), a = s * t, o = new Y(a);
                for (d(e, "_d", {
                        b: o,
                        o: h,
                        l: a,
                        e: s,
                        v: new q(o)
                    }); c < s;) A(e, c++)
            }), E = y.prototype = S(ze), d(E, "constructor", y)) : N(function(e) {
                new y(null), new y(e)
            }, !0) || (y = n(function(e, n, r, i) {
                f(e, y, l);
                var o;
                return x(n) ? n instanceof Y || "ArrayBuffer" == (o = b(n)) || "SharedArrayBuffer" == o ? void 0 !== i ? new v(n, Me(r, t), i) : void 0 !== r ? new v(n, Me(r, t)) : new v(n) : ge in n ? Ae(y, n) : Pe.call(y, n) : new v(Se(n, c))
            }), K(_ !== Function.prototype ? C(v).concat(C(_)) : C(v), function(e) {
                e in y || d(y, e, v[e])
            }), y.prototype = E, r || (E.constructor = y));
            var O = E[pe],
                P = !!O && ("values" == O.name || void 0 == O.name),
                D = Fe.values;
            d(y, ye, !0), d(E, ge, l), d(E, be, !0), d(E, ve, y), (u ? new y(1)[me] == l : me in E) || V(E, me, {
                get: function() {
                    return l
                }
            }), w[l] = y, a(a.G + a.W + a.F * (y != v), w), a(a.S, l, {
                BYTES_PER_ELEMENT: t,
                from: Pe,
                of: De
            }), "BYTES_PER_ELEMENT" in E || d(E, "BYTES_PER_ELEMENT", t), a(a.P, l, Ne), L(l), a(a.P + a.F * Ee, l, {
                set: Be
            }), a(a.P + a.F * !P, l, Fe), a(a.P + a.F * (E.toString != de), l, {
                toString: de
            }), a(a.P + a.F * o(function() {
                new y(1).slice()
            }), l, {
                slice: Le
            }), a(a.P + a.F * (o(function() {
                return [1, 2].toLocaleString() != new y([1, 2]).toLocaleString()
            }) || !o(function() {
                E.toLocaleString.call([1, 2])
            })), l, {
                toLocaleString: ke
            }), k[l] = P ? O : D, r || P || d(E, pe, D)
        }
    } else e.exports = function() {}
}, function(e, t, n) {
    var r = n(252),
        i = n(1),
        o = n(132)("metadata"),
        a = o.store || (o.store = new(n(255))),
        s = function(e, t, n) {
            var i = a.get(e);
            if (!i) {
                if (!n) return;
                a.set(e, i = new r)
            }
            var o = i.get(t);
            if (!o) {
                if (!n) return;
                i.set(t, o = new r)
            }
            return o
        },
        u = function(e, t, n) {
            var r = s(t, n, !1);
            return void 0 !== r && r.has(e)
        },
        l = function(e, t, n) {
            var r = s(t, n, !1);
            return void 0 === r ? void 0 : r.get(e)
        },
        f = function(e, t, n, r) {
            s(n, r, !0).set(e, t)
        },
        c = function(e, t) {
            var n = s(e, t, !1),
                r = [];
            return n && n.forEach(function(e, t) {
                r.push(t)
            }), r
        },
        d = function(e) {
            return void 0 === e || "symbol" == typeof e ? e : String(e)
        },
        h = function(e) {
            i(i.S, "Reflect", e)
        };
    e.exports = {
        store: a,
        map: s,
        has: u,
        get: l,
        set: f,
        keys: c,
        key: d,
        exp: h
    }
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = !0,
        i = "undefined" != typeof window && (window.AudioContext || window.webkitAudioContext);
    i || (console.warn("WebAudio not supported"), r = !1);
    var o = void 0;
    t.default = {
        getContext: function() {
            if (!o && r) try {
                o = new i
            } catch (e) {
                console.warn(e.message), r = !1
            }
            return o
        },
        isSupported: function() {
            return r
        }
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(3),
        u = r(s),
        l = n(126),
        f = r(l),
        c = n(325),
        d = r(c),
        h = n(5),
        p = r(h),
        m = function() {
            function e() {
                i(this, e), this.externals = {
                    name: null,
                    description: null,
                    parameters: [],
                    transitions: []
                }, this.setup = null, this.fixedUpdate = null, this.lateUpdate = null, this.update = null, this.run = null, this.cleanup = null, this.argsUpdated = null, this.enabled = !1, this.context = null, this.parameters = {}
            }
            return a(e, null, [{
                key: "create",
                value: function(t, n) {
                    var r = e._getFactoryFunction(t),
                        i = r();
                    return i.context = null, i.externals || (i.externals = r.externals || {}), i.name = i.externals.name || "(anonymous)", i.parameters || (i.parameters = {}, i.externals.parameters && f.default.fillDefaultParameterValues(i.parameters, i.externals.parameters), n && u.default.extend(i.parameters, n)), i
                }
            }, {
                key: "_getFactoryFunction",
                value: function(e) {
                    var t = void 0;
                    if ("string" == typeof e ? t = d.default.getScript(e) : "function" == typeof e ? t = e : "object" === (void 0 === e ? "undefined" : o(e)) && (t = function() {
                            return e
                        }), !t) throw new Error('Script "' + e + '" is not registered');
                    return t
                }
            }, {
                key: "load",
                value: function(t, n, r) {
                    return e._loadScript(t.scriptRef, n, r).then(function(e) {
                        return e.instanceId = t.id, p.default.emit("sumerian.scriptExternals", {
                            id: t.scriptRef,
                            externals: e.externals
                        }), e
                    })
                }
            }, {
                key: "_loadScript",
                value: function(t, n, r) {
                    return e.isEngineScriptId(t) ? e._loadEngineScript(t) : e._loadCustomScript(t, n, r)
                }
            }, {
                key: "_loadEngineScript",
                value: function(t) {
                    var n = e.create(e.getEngineScriptNameFromId(t));
                    return n.id = t, n.enabled = !1, Promise.resolve(n)
                }
            }, {
                key: "_loadCustomScript",
                value: function(e, t, n) {
                    return t(e, n).then(function(e) {
                        var t = Object.create(e);
                        return t.enabled = !1, t.context = null, t.parameters = {}, t
                    })
                }
            }, {
                key: "update",
                value: function(t, n, r, i) {
                    var o = n.options || {};
                    return t.parameters && u.default.defaults(o, t.parameters), t.externals && t.externals.parameters && f.default.fillDefaultParameterValues(o, t.externals.parameters), e._setParameters(t.parameters, o, t.externals, r, i).then(function() {
                        t.argsUpdated && t.context && t.argsUpdated(t.parameters, t.context, window.sumerian)
                    })
                }
            }, {
                key: "_setParameters",
                value: function(t, n, r, i, o) {
                    if (!r || !r.parameters) return Promise.resolve();
                    var a = r.parameters.map(function(r) {
                        return e._setParameter(t, n[r.key], r, i, o)
                    });
                    return t.enabled = !1 !== n.enabled, Promise.all(a)
                }
            }, {
                key: "_setParameter",
                value: function(e, t, n, r, i) {
                    function o(t) {
                        return e[s] = t, Promise.resolve()
                    }

                    function a() {
                        if (!t || !1 === t.enabled) return o(null);
                        var e = t[l + "Ref"] || t;
                        return r(e, i).then(o)
                    }
                    var s = n.key,
                        l = n.type;
                    return f.default.TYPE_VALIDATORS[l](t) ? "entity" === l ? (a(), Promise.resolve()) : f.default.isRefType(l) ? a() : o(u.default.clone(t)) : o(function() {
                        return void 0 === n.default ? u.default.deepClone(f.default.DEFAULTS_BY_TYPE[l]) : u.default.deepClone(n.default)
                    }())
                }
            }, {
                key: "getEngineScriptNameFromId",
                value: function(t) {
                    return e.isEngineScriptId(t) ? t.slice(e._ENGINE_SCRIPT_PREFIX.length) : e.isGooScriptId(t) ? t.slice(e._GOO_SCRIPT_PREFIX.length) : void 0
                }
            }, {
                key: "isEngineScriptId",
                value: function(t) {
                    return t.startsWith(e._ENGINE_SCRIPT_PREFIX)
                }
            }, {
                key: "isGooScriptId",
                value: function(t) {
                    return t.startsWith(e._GOO_SCRIPT_PREFIX)
                }
            }, {
                key: "getEngineScriptIdForName",
                value: function(t) {
                    return e._ENGINE_SCRIPT_PREFIX + t
                }
            }, {
                key: "makeScriptError",
                value: function(e, t) {
                    var n = t.message ? t.message : t.toString();
                    n = n.replace(/^Uncaught /, "");
                    var r = void 0;
                    if (e.errorLineNumberOffset)
                        if (t.lineno) r = t.lineno - e.errorLineNumberOffset;
                        else if (t.stack) {
                        var i = t.stack.split("\n")[1].match(/(\d+):\d+\)$/);
                        i && (r = parseInt(i[1], 10) - e.errorLineNumberOffset)
                    }
                    return {
                        message: n,
                        line: r
                    }
                }
            }, {
                key: "clone",
                value: function(e) {
                    var t = Object.create(e);
                    return t.enabled = e.enabled, t.parameters = u.default.deepClone(e.parameters), t.context = null, t
                }
            }]), e
        }();
    m._GOO_SCRIPT_PREFIX = "GOO_ENGINE_SCRIPTS/", m._ENGINE_SCRIPT_PREFIX = "SUMERIAN_ENGINE_SCRIPTS/", t.default = m
}, function(e, t) {
    e.exports = function(e, t) {
        return {
            enumerable: !(1 & e),
            configurable: !(2 & e),
            writable: !(4 & e),
            value: t
        }
    }
}, function(e, t, n) {
    var r = n(83)("meta"),
        i = n(19),
        o = n(39),
        a = n(28).f,
        s = 0,
        u = Object.isExtensible || function() {
            return !0
        },
        l = !n(14)(function() {
            return u(Object.preventExtensions({}))
        }),
        f = function(e) {
            a(e, r, {
                value: {
                    i: "O" + ++s,
                    w: {}
                }
            })
        },
        c = function(e, t) {
            if (!i(e)) return "symbol" == typeof e ? e : ("string" == typeof e ? "S" : "P") + e;
            if (!o(e, r)) {
                if (!u(e)) return "F";
                if (!t) return "E";
                f(e)
            }
            return e[r].i
        },
        d = function(e, t) {
            if (!o(e, r)) {
                if (!u(e)) return !0;
                if (!t) return !1;
                f(e)
            }
            return e[r].w
        },
        h = function(e) {
            return l && p.NEED && u(e) && !o(e, r) && f(e), e
        },
        p = e.exports = {
            KEY: r,
            NEED: !1,
            fastKey: c,
            getWeak: d,
            onFreeze: h
        }
}, function(e, t) {
    var n = Math.ceil,
        r = Math.floor;
    e.exports = function(e) {
        return isNaN(e = +e) ? 0 : (e > 0 ? r : n)(e)
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        a = n(109),
        s = r(a),
        u = n(279),
        l = r(u),
        f = n(149),
        c = r(f),
        d = n(198),
        h = r(d),
        p = n(7),
        m = r(p),
        y = n(8),
        v = r(y),
        _ = n(63),
        g = r(_),
        b = n(3),
        x = r(b),
        w = n(0),
        E = (r(w), void 0),
        S = function() {
            function e(t) {
                if (i(this, e), t && t._registerBaseComponents) {
                    console.warn("World constructor changed! Please use it like this instead: new World({ sumerianRunner: sumerianRunner })");
                    var n = t;
                    t = {}, t.sumerianRunner = n, t.gooRunner = t.sumerianRunner
                }
                t = t || {}, this.sumerianRunner = void 0 !== t.sumerianRunner ? t.sumerianRunner : null, this.gooRunner = this.sumerianRunner, this.time = 0, this.fixedTpfTime = 0, this.fixedTpf = void 0 !== t.fixedTpf ? t.fixedTpf : 1 / 60, this.maxSubSteps = void 0 !== t.maxSubSteps ? t.maxSubSteps : 10, this.tpf = 0, this.smoothedTpf = this.tpf, this.interpolationTime = 0, this.tpfSmoothingCount = void 0 !== t.tpfSmoothingCount ? t.tpfSmoothingCount : 10, this._managers = [], this._systems = [], this._addedEntities = [], this._changedEntities = [], this._removedEntities = [], this.by = {}, this._installDefaultSelectors(), this.entityManager = new l.default, this.setManager(this.entityManager), this._components = [], this._tpfIndex = 0, this._tpfSmoothingArray = [], this._accumulator = 0, E = this
            }
            return o(e, [{
                key: "_installDefaultSelectors",
                value: function() {
                    this.by.system = function(e) {
                            var t = this.getSystem(e);
                            return new g.default(t._activeEntities)
                        }.bind(this), this.by.component = function(e) {
                            var t = this.entityManager.getEntities();
                            return new g.default(t.filter(function(t) {
                                return t.hasComponent(e)
                            }))
                        }.bind(this),
                        //! AT: this will be relocated into the Tag Manager once it gets implemented
                        this.by.tag = function(e) {
                            var t = this.entityManager.getEntities();
                            return new g.default(t.filter(function(t) {
                                return t.hasTag(e)
                            }))
                        }.bind(this),
                        //! AT: this will be relocated into the Attribute Manager once it gets implemented
                        this.by.attribute = function(e) {
                            var t = this.entityManager.getEntities();
                            return new g.default(t.filter(function(t) {
                                return t.hasAttribute(e)
                            }))
                        }.bind(this)
                }
            }, {
                key: "add",
                value: function() {
                    for (var e = 0; e < arguments.length; e++) {
                        var t = arguments[e];
                        t instanceof s.default ? this.addEntity(t) : t instanceof h.default ? this.setManager(t) : t instanceof m.default ? this.setSystem(t) : t instanceof v.default &&
                            //! AT: TransformComponent and co and NOT instances of Component
                            this.registerComponent(t)
                    }
                    return this
                }
            }, {
                key: "registerComponent",
                value: function(e) {
                    return -1 === this._components.indexOf(e) && (this._components.push(e), v.default.applyEntitySelectionAPI(e.entitySelectionAPI, e.type)), this
                }
            }, {
                key: "setManager",
                value: function(e) {
                    return this._managers.push(e), e.applyAPI(this.by), this
                }
            }, {
                key: "getManager",
                value: function(e) {
                    for (var t = 0; t < this._managers.length; t++) {
                        var n = this._managers[t];
                        if (n.type === e) return n
                    }
                }
            }, {
                key: "setSystem",
                value: function(e) {
                    if (-1 !== this._systems.indexOf(e)) return this;
                    for (var t = e.priority, n = 0; n < this._systems.length && !(this._systems[n].priority > t); n++);
                    return this._systems.splice(n, 0, e), e.world = this, e.setup(this), this
                }
            }, {
                key: "getSystem",
                value: function(e) {
                    for (var t = 0; t < this._systems.length; t++) {
                        var n = this._systems[t];
                        if (n.type === e) return n
                    }
                }
            }, {
                key: "clearSystem",
                value: function(e) {
                    for (var t = 0; t < this._systems.length; t++) {
                        var n = this._systems[t];
                        n.type === e && (n.cleanup(), n.world = null, this._systems.splice(t, 1))
                    }
                    return this
                }
            }, {
                key: "createEntity",
                value: function() {
                    for (var e = new s.default(this), t = 0; t < arguments.length; t++) "string" == typeof arguments[t] ? e.name = arguments[t] : e.set(arguments[t]);
                    return e.transformComponent || e.setComponent(new c.default), e
                }
            }, {
                key: "getEntities",
                value: function() {
                    return this.entityManager.getEntities()
                }
            }, {
                key: "addEntity",
                value: function(e, t) {
                    if (-1 === this._addedEntities.indexOf(e) && this._addedEntities.push(e), e.transformComponent && (void 0 === t || !0 === t))
                        for (var n = e.transformComponent.children, r = 0; r < n.length; r++) this.addEntity(n[r].entity, t);
                    for (var r = 0; r < this._managers.length; r++) {
                        this._managers[r].added(e)
                    }
                    return this
                }
            }, {
                key: "removeEntity",
                value: function(e, t) {
                    -1 === this._removedEntities.indexOf(e) && this._removedEntities.push(e);
                    var n = e.transformComponent;
                    if (n.parent && (n.parent.detachChild(n), n.parent = null), !1 === t) {
                        for (var r = n.children, i = 0; i < r.length; i++) r[i].parent = null;
                        n.children = []
                    } else
                        for (var r = n.children, i = 0; i < r.length; i++) this._recursiveRemoval(r[i].entity, t);
                    for (var i = 0; i < this._managers.length; i++) {
                        this._managers[i].removed(e)
                    }
                    return this
                }
            }, {
                key: "_recursiveRemoval",
                value: function(e, t) {
                    -1 === this._removedEntities.indexOf(e) && this._removedEntities.push(e);
                    for (var n = 0; n < this._managers.length; n++) {
                        this._managers[n].removed(e)
                    }
                    if (e.transformComponent && (void 0 === t || !0 === t))
                        for (var r = e.transformComponent.children, n = 0; n < r.length; n++) this._recursiveRemoval(r[n].entity, t)
                }
            }, {
                key: "changedEntity",
                value: function(e, t, n) {
                    var r = {
                        entity: e
                    };
                    void 0 !== t && (r.component = t), void 0 !== n && (r.eventType = n), this._changedEntities.push(r)
                }
            }, {
                key: "processEntityChanges",
                value: function() {
                    this._check(this._addedEntities, function(e, t) {
                        if (e.added(t), e.addedComponent)
                            for (var n = 0; n < t._components.length; n++) e.addedComponent(t, t._components[n])
                    }), this._check(this._changedEntities, function(e, t) {
                        e.changed(t.entity), void 0 !== t.eventType && e[t.eventType] && e[t.eventType](t.entity, t.component)
                    }), this._check(this._removedEntities, function(e, t) {
                        if (e.removed(t), e.removedComponent)
                            for (var n = 0; n < t._components.length; n++) e.removedComponent(t, t._components[n])
                    })
                }
            }, {
                key: "update",
                value: function(e) {
                    var t = this.time;
                    t += e, this.time = t, this.tpf = e;
                    var n = this._tpfSmoothingArray;
                    this._tpfSmoothingArray[this._tpfIndex] = e, this._tpfIndex = (this._tpfIndex + 1) % this.tpfSmoothingCount;
                    for (var r = 0, i = 0; i < n.length; i++) r += n[i];
                    r /= this.tpfSmoothingCount, this.smoothedTpf = r;
                    var o = 0,
                        a = this.fixedTpf,
                        s = this.fixedTpfTime,
                        u = this.maxSubSteps,
                        l = this._accumulator;
                    for (l += e; l >= a && o < u;) s += a, o++, this.fixedUpdate(), l -= a;
                    return this.fixedTpfTime = s, this.interpolationTime = l % a / a, this._accumulator = l, this.process(), this
                }
            }, {
                key: "fixedUpdate",
                value: function() {
                    this.processEntityChanges();
                    for (var e = 0; e < this._systems.length; e++) {
                        var t = this._systems[e];
                        t.passive || t._fixedUpdate(this.fixedTpf)
                    }
                }
            }, {
                key: "process",
                value: function() {
                    this.processEntityChanges();
                    for (var e = 0; e < this._systems.length; e++) {
                        var t = this._systems[e];
                        t.passive || t._process(this.tpf)
                    }
                }
            }, {
                key: "createOcclussionTree",
                value: function(e) {
                    this.getSystem("OcclusionGraphSystem").setupWorldBounds(e)
                }
            }, {
                key: "getOcclusionTree",
                value: function() {
                    for (var e = [], t = [this.getSystem("OcclusionGraphSystem")._octree]; t.length > 0;) {
                        var n = t.shift();
                        e.push(n.bounds);
                        for (var r = 0; r < 8; r++) n.activeChildren & 1 << r && t.push(n.children[r]);
                        for (var i = 0; i < n.leafNodes.length; i++) t.push(n.leafNodes[i])
                    }
                    return e
                }
            }, {
                key: "onPreRender",
                value: function() {
                    for (var e = 0; e < this._systems.length; e++) {
                        this._systems[e].onPreRender()
                    }
                }
            }, {
                key: "onPostRender",
                value: function() {
                    for (var e = 0; e < this._systems.length; e++) {
                        this._systems[e].onPostRender()
                    }
                }
            }, {
                key: "_check",
                value: function(e, t) {
                    for (var n = 0; n < e.length; n++)
                        for (var r = e[n], i = 0; i < this._systems.length; i++) {
                            var o = this._systems[i];
                            t(o, r)
                        }
                    e.length = 0
                }
            }, {
                key: "clear",
                value: function() {
                    for (var e = 0; e < this._systems.length; e++) {
                        var t = this._systems[e];
                        t.clear && t.clear()
                    }
                    this._systems = [];
                    for (var n = this.entityManager.getEntities(), e = 0; e < n.length; e++) {
                        n[e]._world = null
                    }
                    this.entityManager.clear(), this._addedEntities = [], this._changedEntities = [], this._removedEntities = [], this.sumerianRunner = null, this.gooRunner = null, E === this && (E = void 0)
                }
            }]), e
        }();
    Object.defineProperties(S, {
        time: {
            get: x.default.warnOnce("World.time is deprecated, use world.time instead.", function() {
                return E && E.time || 0
            }),
            set: function() {
                throw new Error("Don't set World.time!")
            }
        },
        tpf: {
            get: x.default.warnOnce("World.tpf is deprecated, use world.tpf instead.", function() {
                return E && E.tpf || 1
            }),
            set: function() {
                throw new Error("Don't set World.time!")
            }
        }
    }), t.default = S
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        u.default.call(this, e), this.direction = new a.default, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(119),
        u = r(s);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, i.prototype.update = function(e) {
        e.matrix.getTranslation(this.translation), this.direction.setDirect(0, 0, -1), this.direction.applyPostVector(e.matrix)
    }, i.prototype.copy = function(e) {
        return u.default.prototype.copy.call(this, e), this.direction.copy(e.direction), this
    }, i.prototype.clone = function() {
        var e = new i(this.color.clone());
        return e.copy(this), e
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.clone = function() {
        return new r
    }, r.prototype.transform = function() {}, t.default = r
}, function(e, t) {
    var n = 0,
        r = Math.random();
    e.exports = function(e) {
        return "Symbol(".concat(void 0 === e ? "" : e, ")_", (++n + r).toString(36))
    }
}, function(e, t) {
    e.exports = !1
}, function(e, t, n) {
    var r = n(236),
        i = n(170);
    e.exports = Object.keys || function(e) {
        return r(e, i)
    }
}, function(e, t, n) {
    var r = n(79),
        i = Math.max,
        o = Math.min;
    e.exports = function(e, t) {
        return e = r(e), e < 0 ? i(e + t, 0) : o(e, t)
    }
}, function(e, t, n) {
    var r = n(11),
        i = n(237),
        o = n(170),
        a = n(169)("IE_PROTO"),
        s = function() {},
        u = function() {
            var e, t = n(167)("iframe"),
                r = o.length;
            for (t.style.display = "none", n(172).appendChild(t), t.src = "javascript:", e = t.contentWindow.document, e.open(), e.write("<script>document.F=Object<\/script>"), e.close(), u = e.F; r--;) delete u.prototype[o[r]];
            return u()
        };
    e.exports = Object.create || function(e, t) {
        var n;
        return null !== e ? (s.prototype = r(e), n = new s, s.prototype = null, n[a] = e) : n = u(), void 0 === t ? n : i(n, t)
    }
}, function(e, t, n) {
    var r = n(236),
        i = n(170).concat("length", "prototype");
    t.f = Object.getOwnPropertyNames || function(e) {
        return r(e, i)
    }
}, function(e, t, n) {
    "use strict";
    var r = n(13),
        i = n(28),
        o = n(27),
        a = n(23)("species");
    e.exports = function(e) {
        var t = r[e];
        o && t && !t[a] && i.f(t, a, {
            configurable: !0,
            get: function() {
                return this
            }
        })
    }
}, function(e, t) {
    e.exports = function(e, t, n, r) {
        if (!(e instanceof t) || void 0 !== r && r in e) throw TypeError(n + ": incorrect invocation!");
        return e
    }
}, function(e, t, n) {
    var r = n(41);
    e.exports = function(e, t, n) {
        for (var i in t) r(e, i, t[i], n);
        return e
    }
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = n(3),
        i = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(r);
    t.default = i.default
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        u.default.call(this, e), this.direction = new a.default, this.range = 1e3, this.angle = 45, this.penumbra = null, this.exponent = 16, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(119),
        u = r(s);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, i.prototype.update = function(e) {
        e.matrix.getTranslation(this.translation), this.direction.setDirect(0, 0, -1), this.direction.applyPostVector(e.matrix)
    }, i.prototype.copy = function(e) {
        return u.default.prototype.copy.call(this, e), e.direction.copy(this.direction), this.range = e.range, this.angle = e.angle, this.penumbra = e.penumbra, this.exponent = e.exponent, this
    }, i.prototype.clone = function() {
        var e = new i(this.color.clone());
        return e.copy(this), e
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(59),
        a = r(o),
        s = n(30),
        u = r(s),
        l = n(0),
        f = r(l),
        c = new u.default;
    c.setProjectionMode(u.default.Parallel), c.setFrustum(0, 1, -1, 1, 1, -1), c.setFrame(c.translation, f.default.UNIT_X.negate(), f.default.UNIT_Y, f.default.UNIT_Z), i.camera = c, i.quad = new a.default(2, 2), i.denseQuad = new a.default(2, 2, 1, 1, 128), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(5),
        f = r(l),
        c = n(69),
        d = r(c),
        h = n(7),
        p = r(h),
        m = n(151),
        y = (r(m), n(286)),
        v = r(y),
        _ = n(287),
        g = r(_),
        b = n(288),
        x = r(b),
        w = !1,
        E = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "VRCameraRigSystem", ["VRCameraRigComponent", "TransformComponent"]));
                return n._currentVRCameraRig = null, n._currentDisplay = null, n._heightOffSet = 0, n._tracker = null, n._resolutionMultiplier = 1, n._canvasDom = e, n._cameraEntity, f.default.addListener(d.default.SET_CURRENT_VR, function(e) {
                    n._currentVRCameraRig !== e.entity && (n._currentVRCameraRig = e.entity)
                }), f.default.addListener(d.default.RELEASE_CURRENT_VR, function(e) {
                    n._currentVRCameraRig === e.entity && (n._currentVRCameraRig = null)
                }), f.default.addListener("sumerian.setCurrentCamera", function(e) {
                    n._cameraEntity = e.entity
                }), window.addEventListener("vrdisplaypresentchange", function(e) {
                    e.display.isPresenting || w && n.stopVR()
                }), window.addEventListener("vrdisplayconnect", function(e) {
                    n._setupVR()
                }), window.addEventListener("vrdisplaydisconnect", function(e) {
                    w && n.stopVR(), n._setupVR()
                }), document.addEventListener("fullscreenchange", function(e) {
                    document.fullscreenElement || n.stopVR()
                }), n
            }
            return a(t, e), s(t, [{
                key: "hasExternalDisplay",
                value: function() {
                    return this._currentDisplay && this._currentDisplay.capabilities.hasExternalDisplay
                }
            }, {
                key: "setup",
                value: function(e) {
                    u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "setup", this).call(this, e), this._setupVR()
                }
            }, {
                key: "onPreRender",
                value: function() {
                    this._update()
                }
            }, {
                key: "submitFrame",
                value: function() {
                    w && this._currentDisplay.submitFrame()
                }
            }, {
                key: "inserted",
                value: function(e) {
                    !this._currentVRCameraRig && e.vRCameraRigComponent.isCurrentVR && (this._currentVRCameraRig = vr.entity)
                }
            }, {
                key: "deleted",
                value: function(e) {
                    this._currentVRCameraRig === e && (this._currentVRCameraRig = null)
                }
            }, {
                key: "_dispatchOnPresentation",
                value: function(e) {
                    this._update(), f.default.emit(e, {
                        entity: this._currentVRCameraRig
                    })
                }
            }, {
                key: "_setupVR",
                value: function() {
                    this._setupDisplay()
                }
            }, {
                key: "startVR",
                value: function() {
                    var e = this;
                    if (!w) {
                        if (!this._currentDisplay) {
                            if (!t.canPresent()) throw new x.default;
                            throw new g.default
                        }
                        if (!this._currentVRCameraRig) throw new v.default;
                        var n = this._setupLayer(this._canvasDom, this._resolutionMultiplier);
                        this._currentDisplay.requestPresent(n).then(function() {
                            console.log('[Sumerian] WebVR starting presentation to the "' + e._currentDisplay.displayName + '" display.');
                            var t = e._currentVRCameraRig.transformComponent.children.find(function(e) {
                                return "Tracker" === e.entity.name
                            });
                            if (e._tracker = t ? t.entity : void 0, !e._tracker) throw new Error("[Sumerian] There is no Tracker defined under current VRCameraRig!");
                            if (!e._tracker.transformComponent.children.find(function(e) {
                                    return e.entity.hMDCameraComponent
                                })) throw new Error("[Sumerian] There is no VRCamera defined!");
                            e._currentVRCameraRig.vRCameraRigComponent.isStartAtCurrentCamera && (e._currentVRCameraRig.setTranslation(e._cameraEntity.getTranslation().x, 0, e._cameraEntity.getTranslation().z), e._currentVRCameraRig.setRotation(0, e._cameraEntity.getRotation().y, 0), e._currentVRCameraRig.transformComponent.sync()), "eye" === e._currentVRCameraRig.vRCameraRigComponent.trackingLevel && e._tracker.setTranslation(0, e._heightOffSet, 0), e._tracker.transformComponent.sync(), w = !0, e._dispatchOnPresentation(d.default.VR_PRESENTATION_START)
                        }).catch(function(t) {
                            throw console.error('[Sumerian] WebVR could not start presenting "' + e._currentDisplay.displayName + '" display: ' + t), t
                        })
                    }
                }
            }, {
                key: "stopVR",
                value: function() {
                    var e = this;
                    if (!this._currentVRCameraRig) throw new v.default;
                    if (!this._currentDisplay || !this._currentDisplay.isPresenting) return w = !1, void this._dispatchOnPresentation(d.default.VR_PRESENTATION_STOP);
                    this._currentDisplay.exitPresent().then(function() {
                        console.log("[Sumerian] WebVR stopping presentation to the " + e._currentDisplay.displayName + " display."), w = !1, e._dispatchOnPresentation(d.default.VR_PRESENTATION_STOP)
                    })
                }
            }, {
                key: "_update",
                value: function() {
                    for (var e = 0; e < this._activeEntities.length; e++) {
                        this._activeEntities[e].vRCameraRigComponent.updateVRCameraRig(this._currentDisplay, this._resolutionMultiplier)
                    }
                }
            }, {
                key: "_setupDisplay",
                value: function() {
                    var e = this;
                    window.navigator.getVRDisplays && window.navigator.getVRDisplays().then(function(t) {
                        t = t.filter(function(e) {
                            return e.capabilities.canPresent
                        }), 0 === t.length ? (console.warn("[Sumerian] WebVR found no displays that are ready to present. WebVR is disabled."), e._currentDisplay = null) : (e._currentDisplay = t[0], e._getHeightFromDisplay(), console.log('[Sumerian] WebVR found the "' + e._currentDisplay.displayName + '" display, which is ready to present.', e._currentDisplay))
                    })
                }
            }, {
                key: "_setupLayer",
                value: function(e, t) {
                    return [{
                        source: e,
                        leftBounds: [0, 0, .5 * t, 1 * t],
                        rightBounds: [.5 * t, 0, .5 * t, 1 * t]
                    }]
                }
            }, {
                key: "_getHeightFromDisplay",
                value: function() {
                    this._currentDisplay && this._currentDisplay.stageParameters ? this._heightOffSet = this._currentDisplay.stageParameters.sittingToStandingTransform[13] : this._heightOffSet = 1.5
                }
            }, {
                key: "resolutionMultiplier",
                set: function(e) {
                    this._resolutionMultiplier = Math.min(1, Math.max(0, e))
                }
            }, {
                key: "currentDisplay",
                get: function() {
                    return this._currentDisplay
                }
            }], [{
                key: "canPresent",
                value: function() {
                    return window.navigator.getVRDisplays && window.navigator.getVRDisplays().then(function(e) {
                        e.filter(function(e) {
                            return e.capabilities.canPresent
                        }).length
                    })
                }
            }, {
                key: "isPresenting",
                get: function() {
                    return w
                }
            }]), t
        }(p.default);
    t.default = E
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        u = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        l = n(8),
        f = r(l),
        c = n(9),
        d = r(c),
        h = n(57),
        p = (r(h), n(15)),
        m = (r(p), function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                //! schteppe: Don't chain or nest ternary operators as it hard to read and confusing
                return n.type = "MeshRendererComponent", n.materials = Array.isArray(e) ? e : e ? [e] : [], n.worldBound = null, n._worldBoundDirty = !0, n._occluderBoundDirty = !0, n._transformUpdatedListener = null, n.cullMode = "Dynamic", n.castShadows = !0, n.receiveShadows = !0, n.isPickable = !0, n.isReflectable = !0, n.receivesReflections = !1, n.hidden = !1, n._renderDistance = 0, Object.seal(n), n
            }
            return a(t, e), u(t, [{
                key: "attached",
                value: function() {
                    var e = this;
                    this.entity.on("transformUpdated", this._transformUpdatedListener = function() {
                        e._worldBoundDirty = !0, e._occluderBoundDirty = !0
                    })
                }
            }, {
                key: "detached",
                value: function() {
                    this.entity.off("transformUpdated", this._transformUpdatedListener)
                }
            }, {
                key: "updateBounds",
                value: function(e, t) {
                    this.worldBound = e.transform(t, this.worldBound), this._worldBoundDirty = !1
                }
            }, {
                key: "clone",
                value: function(e) {
                    e = e || {};
                    var n = void 0;
                    n = e.shareMaterials ? this.materials : this.materials.map(function(t) {
                        return t.clone(e)
                    });
                    var r = new t(n);
                    return r.cullMode = this.cullMode, r.castShadows = this.castShadows, r.receiveShadows = this.receiveShadows, r.isPickable = this.isPickable, r.isReflectable = this.isReflectable, r
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    var r = n.meshRendererComponent;
                    r || (r = new t);
                    var i = !1;
                    if (e instanceof d.default && (r.materials.push(e), i = !0), i) return n.setComponent(r), !0
                }
            }]), t
        }(f.default));
    m.type = "MeshRendererComponent", m.prototype.api = {
        setDiffuse: function() {
            var e = this.meshRendererComponent.materials[0];
            e.uniforms.materialDiffuse || (e.uniforms.materialDiffuse = [0, 0, 0, 1]);
            var t = e.uniforms.materialDiffuse;
            //! AT: need to search for a pattern matching library; this is just ugly and unmaintainable
            if (arguments.length >= 3) t[0] = arguments[0], t[1] = arguments[1], t[2] = arguments[2], t[3] = 3 === arguments.length ? 1 : arguments[3];
            else {
                var n = arguments[0];
                n instanceof Array ? (t[0] = n[0], t[1] = n[1], t[2] = n[2], t[3] = 3 === n.length ? 1 : n[3]) : void 0 !== n.r && void 0 !== n.g && void 0 !== s(n.b) && (t[0] = n.r, t[1] = n.g, t[2] = n.b, t[3] = void 0 === n.a ? 1 : n.a)
            }
        },
        getDiffuse: function() {
            return this.meshRendererComponent.materials[0].uniforms.materialDiffuse
        }
    }, m.entitySelectionAPI = {
        setDiffuse: m.prototype.api.setDiffuse
    }, t.default = m
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    //! AT: there's a method for doing this exact thing on typed arrays, copyWithin()
    function i(e, t, n) {
        e[3 * n + 0] = e[3 * t + 0], e[3 * n + 1] = e[3 * t + 1], e[3 * n + 2] = e[3 * t + 2]
    }

    function o(e, t, n, r) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var i = arguments[0];
            e = i.zSamples, t = i.radialSamples, n = i.radius, r = i.textureMode
        }
        this.zSamples = (void 0 !== e ? e : 8) + 1, this.radialSamples = void 0 !== t ? t : 8, this.radius = void 0 !== n ? n : .5, "string" == typeof r && (r = o.TextureModes[r]), this.textureMode = void 0 !== r ? r : o.TextureModes.Polar, this.viewInside = !1;
        var a = s.default.defaultMap([s.default.POSITION, s.default.NORMAL, s.default.TEXCOORD0]),
            u = this.textureMode === o.TextureModes.Chromeball ? this.zSamples + 1 : this.zSamples;
        this._useSharedPoleVertices = this.textureMode !== o.TextureModes.Projected && this.textureMode !== o.TextureModes.Linear;
        var l = this._useSharedPoleVertices ? 2 : 0,
            f = (u - l) * (this.radialSamples + 1) + l,
            c = 6 * (u - 2) * this.radialSamples;
        s.default.call(this, a, f, c), this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(6),
        s = r(a),
        u = n(0),
        l = r(u),
        f = n(4),
        c = r(f),
        d = n(3),
        h = r(d);
    o.prototype = Object.create(s.default.prototype), o.prototype.constructor = o, o.prototype.rebuild = function() {
        for (var e = this.getAttributeBuffer(s.default.POSITION), t = this.getAttributeBuffer(s.default.NORMAL), n = this.getAttributeBuffer(s.default.TEXCOORD0), r = this.getIndexBuffer(), a = 1 / this.radialSamples, u = 2 / (this.zSamples - 1), f = [], d = [], h = 0; h < this.radialSamples; h++) {
            var p = c.default.TWO_PI * a * h;
            d[h] = Math.cos(p), f[h] = Math.sin(p)
        }
        f[this.radialSamples] = f[0], d[this.radialSamples] = d[0];
        var m = 0,
            y = this.zSamples;
        this._useSharedPoleVertices && (m = 1, y = this.zSamples - 1);
        for (var v = 0, _ = new l.default, g = new l.default, b = new l.default, x = m; x < y; x++) {
            var w = c.default.HALF_PI * (u * x - 1),
                E = Math.sin(w),
                S = this.radius * E,
                M = g.setDirect(0, 0, 0);
            M.z += S;
            for (var C = Math.sqrt(Math.abs(this.radius * this.radius - S * S)), T = void 0, R = v, A = 0; A < this.radialSamples; A++) {
                var O = A * a,
                    P = b.setDirect(d[A], f[A], 0);
                _.copy(P).scale(C), e[3 * v + 0] = M.x + _.x, e[3 * v + 1] = M.y + _.y, e[3 * v + 2] = M.z + _.z, T = _.setDirect(e[3 * v + 0], e[3 * v + 1], e[3 * v + 2]), T.normalize(), this.viewInside ? (t[3 * v + 0] = -T.x, t[3 * v + 1] = -T.y, t[3 * v + 2] = -T.z) : (t[3 * v + 0] = T.x, t[3 * v + 1] = T.y, t[3 * v + 2] = T.z);
                var D = 0;
                if (this._useSharedPoleVertices || x !== m && x !== y - 1 || (D = .5 * a), this.textureMode === o.TextureModes.Linear) n[2 * v + 0] = O + D, n[2 * v + 1] = .5 * (E + 1);
                else if (this.textureMode === o.TextureModes.Projected) n[2 * v + 0] = O + D, n[2 * v + 1] = (c.default.HALF_PI + Math.asin(E)) / Math.PI;
                else if (this.textureMode === o.TextureModes.Polar) {
                    var I = (c.default.HALF_PI - Math.abs(w)) / Math.PI,
                        k = I * d[A] + .5,
                        N = I * f[A] + .5;
                    n[2 * v + 0] = k, n[2 * v + 1] = N
                } else if (this.textureMode === o.TextureModes.Chromeball) {
                    var L = Math.sin((c.default.HALF_PI + w) / 2);
                    L /= 2;
                    var B = L * d[A] + .5,
                        F = L * f[A] + .5;
                    n[2 * v + 0] = B, n[2 * v + 1] = F
                }
                v++
            }
            if (i(e, R, v), i(t, R, v), this.textureMode === o.TextureModes.Linear) n[2 * v + 0] = 1, n[2 * v + 1] = .5 * (E + 1);
            else if (this.textureMode === o.TextureModes.Projected) n[2 * v + 0] = 1, n[2 * v + 1] = (c.default.HALF_PI + Math.asin(E)) / Math.PI;
            else if (this.textureMode === o.TextureModes.Polar) {
                var j = (c.default.HALF_PI - Math.abs(w)) / Math.PI;
                n[2 * v + 0] = j + .5, n[2 * v + 1] = .5
            } else if (this.textureMode === o.TextureModes.Chromeball) {
                var U = Math.sin((c.default.HALF_PI + w) / 2);
                U /= 2, n[2 * v + 0] = U + .5, n[2 * v + 1] = .5
            }
            v++
        }
        if (this.textureMode === o.TextureModes.Chromeball) {
            for (var V = c.default.HALF_PI - .001, z = this.radius * Math.sin(V), G = Math.sqrt(Math.abs(this.radius * this.radius - z * z)), W = v, H = 0; H < this.radialSamples; H++) {
                e[3 * v + 0] = G * d[H], e[3 * v + 1] = G * f[H], e[3 * v + 2] = z;
                var X = _.setDirect(e[3 * v + 0], e[3 * v + 1], e[3 * v + 2]);
                X.normalize(), this.viewInside ? (t[3 * v + 0] = -X.x, t[3 * v + 1] = -X.y, t[3 * v + 2] = -X.z) : (t[3 * v + 0] = X.x, t[3 * v + 1] = X.y, t[3 * v + 2] = X.z);
                var Y = Math.sin((c.default.HALF_PI + V) / 2);
                Y /= 2;
                var q = Y * d[H] + .5,
                    K = Y * f[H] + .5;
                n[2 * v + 0] = q, n[2 * v + 1] = K, v++
            }
            i(e, W, v), i(t, W, v);
            var Q = Math.sin((c.default.HALF_PI + V) / 2);
            Q /= 2, n[2 * v + 0] = Q + .5, n[2 * v + 1] = .5, v++
        }
        this._useSharedPoleVertices && (e[3 * v + 0] = 0, e[3 * v + 1] = 0, e[3 * v + 2] = -this.radius, this.viewInside ? (t[3 * v + 0] = 0, t[3 * v + 1] = 0, t[3 * v + 2] = 1) : (t[3 * v + 0] = 0, t[3 * v + 1] = 0, t[3 * v + 2] = -1), this.textureMode === o.TextureModes.Polar || this.textureMode === o.TextureModes.Chromeball ? (n[2 * v + 0] = .5, n[2 * v + 1] = .5) : (n[2 * v + 0] = .5, n[2 * v + 1] = 0), v++, e[3 * v + 0] = 0, e[3 * v + 1] = 0, e[3 * v + 2] = this.radius, this.viewInside ? (t[3 * v + 0] = 0, t[3 * v + 1] = 0, t[3 * v + 2] = -1) : (t[3 * v + 0] = 0, t[3 * v + 1] = 0, t[3 * v + 2] = 1), this.textureMode === o.TextureModes.Polar ? (n[2 * v + 0] = .5, n[2 * v + 1] = .5) : this.textureMode === o.TextureModes.Chromeball ? (n[2 * v + 0] = 1, n[2 * v + 1] = -.5) : (n[2 * v + 0] = .5, n[2 * v + 1] = 1));
        var Z = 0,
            J = this.textureMode === o.TextureModes.Chromeball ? this.zSamples + 1 : this.zSamples,
            $ = 0;
        this._useSharedPoleVertices || ($ = this.radialSamples + 1);
        for (var ee = 0; ee < J - 3; ee++) {
            var te = $,
                ne = te + 1;
            $ += this.radialSamples + 1;
            for (var re = $, ie = re + 1, oe = 0; oe < this.radialSamples; oe++) this.viewInside ? (r[Z++] = te++, r[Z++] = re, r[Z++] = ne, r[Z++] = ne++, r[Z++] = re++, r[Z++] = ie++) : (r[Z++] = te++, r[Z++] = ne, r[Z++] = re, r[Z++] = ne++, r[Z++] = ie++, r[Z++] = re++)
        }
        for (var ae = 0; ae < this.radialSamples; ae++) {
            var se = void 0,
                ue = void 0,
                le = void 0;
            this._useSharedPoleVertices ? (se = ae, ue = this.vertexCount - 2, le = ae + 1) : (se = ae, ue = ae + this.radialSamples + 2, le = ae + this.radialSamples + 1), this.viewInside ? (r[Z++] = se, r[Z++] = le, r[Z++] = ue) : (r[Z++] = se, r[Z++] = ue, r[Z++] = le)
        }
        for (var fe = (y - m - 1) * (this.radialSamples + 1), ce = 0; ce < this.radialSamples; ce++) {
            var de = void 0,
                he = void 0,
                pe = void 0;
            this._useSharedPoleVertices ? (de = ce + fe, he = ce + 1 + fe, pe = this.vertexCount - 1) : (de = ce + fe - this.radialSamples - 1, he = ce + fe - this.radialSamples, pe = ce + fe), this.viewInside ? (r[Z++] = de, r[Z++] = pe, r[Z++] = he) : (r[Z++] = de, r[Z++] = he, r[Z++] = pe)
        }
        return this
    }, o.prototype.clone = function() {
        return new o(h.default.shallowSelectiveClone(this, ["zSamples", "radialSamples", "radius", "textureMode"]))
    }, o.TextureModes = {
        Linear: "Linear",
        Projected: "Projected",
        Polar: "Polar",
        Chromeball: "Chromeball"
    }, t.default = o
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = function e(t) {
        r(this, e), this.message = t;
        var n = new Error;
        this.stack = n.stack
    };
    t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        this._name = e, this._index = 0, this._parentIndex = r.NO_PARENT, this._inverseBindPose = new o.default
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(10),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.NO_PARENT = -32768, t.default = r
}, , , function(e, t, n) {
    var r = n(28).f,
        i = n(39),
        o = n(23)("toStringTag");
    e.exports = function(e, t, n) {
        e && !i(e = n ? e : e.prototype, o) && r(e, o, {
            configurable: !0,
            value: t
        })
    }
}, function(e, t, n) {
    var r = n(1),
        i = n(54),
        o = n(14),
        a = n(174),
        s = "[" + a + "]",
        u = "",
        l = RegExp("^" + s + s + "*"),
        f = RegExp(s + s + "*$"),
        c = function(e, t, n) {
            var i = {},
                s = o(function() {
                    return !!a[e]() || u[e]() != u
                }),
                l = i[e] = s ? t(d) : a[e];
            n && (i[n] = l), r(r.P + r.F * s, "String", i)
        },
        d = c.trim = function(e, t) {
            return e = String(i(e)), 1 & t && (e = e.replace(l, "")), 2 & t && (e = e.replace(f, "")), e
        };
    e.exports = c
}, function(e, t) {
    e.exports = {}
}, function(e, t, n) {
    var r = n(23)("unscopables"),
        i = Array.prototype;
    void 0 == i[r] && n(40)(i, r, {}), e.exports = function(e) {
        i[r][e] = !0
    }
}, function(e, t, n) {
    var r = n(72),
        i = n(247),
        o = n(184),
        a = n(11),
        s = n(32),
        u = n(186),
        l = {},
        f = {},
        t = e.exports = function(e, t, n, c, d) {
            var h, p, m, y, v = d ? function() {
                    return e
                } : u(e),
                _ = r(n, c, t ? 2 : 1),
                g = 0;
            if ("function" != typeof v) throw TypeError(e + " is not iterable!");
            if (o(v)) {
                for (h = s(e.length); h > g; g++)
                    if ((y = t ? _(a(p = e[g])[0], p[1]) : _(e[g])) === l || y === f) return y
            } else
                for (m = v.call(e); !(p = m.next()).done;)
                    if ((y = i(m, _, p.value, t)) === l || y === f) return y
        };
    t.BREAK = l, t.RETURN = f
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        this.normal = e ? e.clone() : o.default.UNIT_Y.clone(), this.constant = isNaN(t) ? 0 : t, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.XZ = new r(o.default.UNIT_Y, 0), r.XY = new r(o.default.UNIT_Z, 0), r.YZ = new r(o.default.UNIT_X, 0), r.prototype.pseudoDistance = function(e) {
        return this.normal.dot(e) - this.constant
    }, r.prototype.setPlanePoints = function(e, t, n) {
        return this.normal.set(t).sub(e), this.normal.cross(new o.default(n.x - e.x, n.y - e.y, n.z - e.z)).normalize(), this.constant = this.normal.dot(e), this
    }, r.prototype.reflectVector = function(e, t) {
        var n = t;
        void 0 === n && (n = new o.default);
        var r = 2 * this.normal.dot(e);
        return n.set(e).sub(new o.default(this.normal.x * r, this.normal.y * r, this.normal.z * r)), n
    };
    var a = new o.default;
    r.prototype.rayIntersect = function(e, t, n, r) {
        //! AT: the only function with a suppressWarnings
        r = void 0 === r ? 1e-7 : r, t = t || new o.default;
        var i = e.direction.dot(this.normal);
        if (Math.abs(i) < r)
            //! AT: this is the only function where we have this suppressWarnings mechanism
            return n || console.warn("Ray parallel with plane"), null;
        var s = a.set(this.normal).scale(this.constant).sub(e.origin).dot(this.normal);
        return t.set(e.direction).scale(s / i).add(e.origin)
    }, r.prototype.copy = function(e) {
        return this.normal.copy(e.normal), this.constant = e.constant, this
    }, r.prototype.clone = function() {
        return new r(this.normal.clone(), this.constant)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    //! AT: shouldn't this stay in util?
    function i() {
        var e = this.ajax = new h.default;
        this.textureHandler = new c.default({}, function(t, n) {
            return e.load(t, !!n && n.noCache)
        }, function() {}, function(t, n) {
            return e.load(t, !!n && n.noCache)
        })
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(45),
        a = r(o),
        s = n(26),
        u = r(s),
        l = n(4),
        f = (r(l), n(143)),
        c = r(f),
        d = n(116),
        h = r(d),
        p = n(56),
        m = r(p),
        y = n(17),
        v = r(y),
        _ = n(12),
        g = r(_);
    //! AT: unused?
    i.UNSUPPORTED_FALLBACK = ".png", i.clearCache = function() {}, i.prototype.clear = function() {
            this.ajax.clear(), this.textureHandler.clear()
        }, i.prototype.loadTexture2D = function(e, t) {
            var n = m.default.createUniqueId("texture");
            t = t || {}, t.imageRef = e;
            var r = this.textureHandler._create();
            return this.textureHandler._objects.set(n, r), this.textureHandler.update(n, t)
        }, i.prototype.loadTextures2D = function(e, t) {
            for (var n = this, r = [], i = 0; i < e.length; i++) r.push(new a.default(null, t || {}));
            var o = e.map(function(e) {
                return v.default.createPromise(function(t, r) {
                    "string" == typeof e ? n.ajax._loadImage(e).then(t, r) : t(e)
                })
            });
            return g.default.all(o).then(function(e) {
                return v.default.createPromise(function(t, n) {
                    for (var i = 0; i < e.length; i++) r[i].setImage(e[i]), r[i].image.dataReady = !0;
                    t(r)
                })
            })
        }, i.prototype.loadTextureVideo = function(e, t) {
            var n = m.default.createUniqueId("texture");
            t = t || {}, t.imageRef = e, t.loop = void 0 === t.loop || t.loop, t.wrapS = void 0 !== t.wrapS ? t.wrapS : "EdgeClamp", t.wrapT = void 0 !== t.wrapT ? t.wrapT : "EdgeClamp", t.autoPlay = void 0 === t.autoPlay || t.autoPlay, t.texture = void 0 !== t.texture ? t.texture : {
                dontwait: !0
            };
            var r = this.textureHandler._create();
            return this.textureHandler._objects.set(n, r), this.textureHandler.update(n, t, t)
        }, i.prototype.loadTextureWebCam = function() {
            return v.default.createPromise(function(e, t) {
                var n = document.createElement("video");
                n.autoplay = !0, n.loop = !0;
                var r = new a.default(n, {
                    wrapS: "EdgeClamp",
                    wrapT: "EdgeClamp",
                    wrapR: "EdgeClamp",
                    minFilter: "BilinearNoMipMaps",
                    magFilter: "Bilinear",
                    sampler: !0,
                    generateMipMaps: !1
                });
                u.default.Webgl2 || (r.sampler = !1), r.readyCallback = function() {
                    return n.readyState >= 3 && (n.width = n.videoWidth, n.height = n.videoHeight, n.dataReady = !0, !0)
                }, r.updateCallback = function() {
                    return !n.paused
                }, window.URL = window.URL || window.webkitURL, navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia, navigator.getUserMedia ? navigator.getUserMedia({
                    video: !0
                }, function(t) {
                    n.src = window.URL.createObjectURL(t), e({
                        texture: r,
                        stream: t
                    })
                }, t) : t(new Error("No support for WebCam getUserMedia found!"))
            })
        }, i.prototype.loadTextureCube = function(e, t) {
            var n = this,
                r = new a.default(null, t);
            r.variant = "CUBE";
            var i = e.map(function(e) {
                return v.default.createPromise(function(t, r) {
                    "string" == typeof e ? n.ajax._loadImage(e).then(t, r) : t(e)
                })
            });
            return g.default.all(i).then(function(e) {
                return v.default.createPromise(function(t, n) {
                    for (var i = e[0].width, o = e[0].height, a = 0; a < 6; a++) {
                        var s = e[a];
                        if (i !== s.width || o !== s.height) return r.generateMipmaps = !1, r.minFilter = "BilinearNoMipMaps", void n(new Error("The images passed to loadTextureCube() must be of the same size!"))
                    }
                    r.setImage(e), r.image.dataReady = !0, r.image.width = i, r.image.height = o, t(r)
                })
            })
        }, i.prototype.loadTextureArray = function(e, t) {
            var n = this,
                r = new a.default(null, t);
            r.variant = "2DArray", r.nSlices = e.length;
            var i = e.map(function(e) {
                return v.default.createPromise(function(t, r) {
                    "string" == typeof e ? n.ajax._loadImage(e).then(t, r) : t(e)
                })
            });
            return g.default.all(i).then(function(n) {
                return v.default.createPromise(function(i, o) {
                    for (var a = n[0].width, s = n[0].height, u = [], l = document.createElement("canvas"), f = l.width = a, c = l.height = s, d = l.getContext("2d"), h = 0; h < e.length; h++) {
                        var p = n[h];
                        if (a !== p.width || s !== p.height) return r.generateMipmaps = !1, r.minFilter = "BilinearNoMipMaps", console.error("The images passed to loadTextureArray() must be of the same size!"), void o(new Error("The images passed to loadTextureArray() must be of the same size!"));
                        d.drawImage(p, 0, 0, f, c);
                        for (var m = d.getImageData(0, 0, f, c).data, y = 0; y < m.length; y++) u.push(m[y])
                    }
                    var v = new Uint8Array(u);
                    r.setImage(v, a, s, t), r.image.dataReady = !0, r.image.width = a, r.image.height = s, i(r)
                })
            })
        }, i.prototype.loadTexture3D = function(e, t) {
            var n = this,
                r = new a.default(null, t);
            r.variant = "3D", r.nSlices = e.length;
            var i = e.map(function(e) {
                return v.default.createPromise(function(t, r) {
                    "string" == typeof e ? n.ajax._loadImage(e).then(t, r) : t(e)
                })
            });
            return g.default.all(i).then(function(n) {
                return v.default.createPromise(function(i, o) {
                    for (var a = n[0].width, s = n[0].height, u = [], l = document.createElement("canvas"), f = l.width = a, c = l.height = s, d = l.getContext("2d"), h = 0; h < e.length; h++) {
                        var p = n[h];
                        if (a !== p.width || s !== p.height) return r.generateMipmaps = !1, r.minFilter = "BilinearNoMipMaps", console.error("The images passed to loadTextureArray() must be of the same size!"), void o(new Error("The images passed to loadTextureArray() must be of the same size!"));
                        d.drawImage(p, 0, 0, f, c);
                        for (var m = d.getImageData(0, 0, f, c).data, y = 0; y < m.length; y++) u.push(m[y])
                    }
                    var v = new Uint8Array(u);
                    r.setImage(v, a, s, t), r.image.dataReady = !0, r.image.width = a, r.image.height = s, i(r)
                })
            })
        },
        //! AT: unused
        i._globalCallback = null, i._finishedLoading = function(e) {
            if (i._globalCallback) try {
                i._globalCallback(e)
            } catch (e) {
                console.error("Error in texture callback:", e)
            }
        };
    var b = new Uint8Array([255, 255, 255, 255]);
    i.DEFAULT_TEXTURE_2D = new a.default(b, null, 1, 1), i.DEFAULT_TEXTURE_CUBE = new a.default([b, b, b, b, b, b], null, 1, 1), i.DEFAULT_TEXTURE_CUBE.variant = "CUBE";
    var x = new Uint8Array([255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]);
    i.DEFAULT_TEXTURE_3D = new a.default(x, null, 1, 1), i.DEFAULT_TEXTURE_3D.variant = "3D", i.DEFAULT_TEXTURE_3D.nSlices = 4, i.DEFAULT_TEXTURE_2DArray = new a.default(x, null, 1, 1), i.DEFAULT_TEXTURE_2DArray.variant = "2DArray", i.DEFAULT_TEXTURE_2DArray.nSlices = 4, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }

    function s(e) {
        return e.charAt(0).toLowerCase() + e.substr(1)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var u = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        l = n(8),
        f = r(l),
        c = n(56),
        d = r(c),
        h = n(278),
        p = r(h),
        m = n(3),
        y = (r(m), function(e) {
            function t(e, n, r) {
                i(this, t);
                var a = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                //! AT: users are always confused about this - I'll have to hide it
                return a._world = e, Object.defineProperty(a, "world", {
                    value: e,
                    writable: !1
                }), a._components = [], a.id = void 0 !== r ? r : d.default.createUniqueId("entity"), a._index = t.entityCount, a._tags = new Set, a._attributes = new Map, a.name = void 0 !== n ? n : "Entity_" + a._index, a.skip = !1, a.hidden = !1, a._hidden = !1, a.isVisible = !1, a.isOccluded = !1, a.static = !1, a._scriptContext = null, t.entityCount++, a
            }
            //! AT: not sure if 'add' is a better name - need to search for something short and compatible with the other 'set' methods
            return a(t, e), u(t, [{
                key: "set",
                value: function() {
                    for (var e = 0; e < arguments.length; e++) {
                        var t = arguments[e];
                        if (t instanceof f.default) this.setComponent(t);
                        else {
                            if (!this._world) return this;
                            for (var n = this._world._components, r = 0; r < n.length; r++) {
                                if (n[r].applyOnEntity(t, this)) break
                            }
                        }
                    }
                    return this
                }
            }, {
                key: "addToWorld",
                value: function(e) {
                    return this._world.addEntity(this, e), this
                }
            }, {
                key: "removeFromWorld",
                value: function(e) {
                    return this._world.removeEntity(this, e), this
                }
            }, {
                key: "setComponent",
                value: function(e) {
                    return this.hasComponent(e.type) ? this : (this._components.push(e), this[s(e.type)] = e, e.entity = this, e.attached(this), e.applyAPI(this), this._world && this._world.entityManager.containsEntity(this) && this._world.changedEntity(this, e, "addedComponent"), this)
                }
            }, {
                key: "hasComponent",
                value: function(e) {
                    return !!this[s(e)]
                }
            }, {
                key: "getComponent",
                value: function(e) {
                    return this[s(e)]
                }
            }, {
                key: "clearComponent",
                value: function(e) {
                    var t = s(e),
                        n = this[t];
                    if (n && this._components.indexOf(n) > -1) {
                        n.detached(this), n.entity = null, n.removeAPI(this);
                        var r = this._components.indexOf(n);
                        this._components.splice(r, 1), delete this[t], this._world && this._world.entityManager.containsEntity(this) && this._world.changedEntity(this, n, "removedComponent")
                    }
                    return this
                }
            }, {
                key: "setTag",
                value: function(e) {
                    return this._tags.add(e), this
                }
            }, {
                key: "hasTag",
                value: function(e) {
                    return this._tags.has(e)
                }
            }, {
                key: "clearTag",
                value: function(e) {
                    return this._tags.delete(e), this
                }
            }, {
                key: "setAttribute",
                value: function(e, t) {
                    return this._attributes.set(e, t), this
                }
            }, {
                key: "hasAttribute",
                value: function(e) {
                    return this._attributes.has(e)
                }
            }, {
                key: "getAttribute",
                value: function(e) {
                    return this._attributes.get(e)
                }
            }, {
                key: "clearAttribute",
                value: function(e) {
                    return this._attributes.delete(e), this
                }
            }, {
                key: "toString",
                value: function() {
                    //! AT: should also return a list of its components or something more descriptive than just the name
                    return this.name
                }
            }, {
                key: "getScriptContext",
                value: function() {
                    return this._scriptContext || (this._scriptContext = {
                        entity: this,
                        entityData: {}
                    }), this._scriptContext
                }
            }]), t
        }(p.default));
    y.entityCount = 0, t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        o.default.call(this, e), this.range = 1e3, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(119),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.update = function(e) {
        e.matrix.getTranslation(this.translation)
    }, r.prototype.copy = function(e) {
        return o.default.prototype.copy.call(this, e), this.range = e.range, this
    }, r.prototype.clone = function() {
        var e = new r(this.color.clone());
        return e.copy(this), e
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this._rotation = (new s.default).copy(e ? e._rotation : s.default.IDENTITY), this._scale = (new l.default).copy(e ? e._scale : l.default.ONE), this._translation = (new l.default).copy(e ? e._translation : l.default.ZERO)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(10),
        a = (r(o), n(34)),
        s = r(a),
        u = n(0),
        l = r(u),
        f = n(4),
        c = r(f);
    i.prototype.applyTo = function(e) {
        e.rotation.copyQuaternion(this._rotation), e.scale.set(this._scale), e.translation.set(this._translation), e.update()
    }, i.prototype.set = function(e) {
        this._rotation.copy(e._rotation), this._scale.copy(e._scale), this._translation.copy(e._translation)
    }, i.prototype.blend = function(e, t, n) {
        var r = arguments.length > 3 && void 0 !== arguments[3] && arguments[3],
            o = n || new i,
            a = new l.default(e._translation),
            u = new l.default(e._scale),
            f = new s.default(e._rotation);
        return r && (a.set(this._translation).add(e._translation), u.set(this._scale.x * e._scale.x, this._scale.y * e._scale.y, this._scale.z * e._scale.z), f.set(this._rotation).mul(e._rotation)), t = c.default.clamp(t, 0, 1), o._translation.set(this._translation).lerp(a, t), o._scale.set(this._scale).lerp(u, t), s.default.slerp(this._rotation, f, t, o._rotation), o
    }, i.prototype.equals = function(e) {
        return this._translation.equals(e._translation) && this._scale.equals(e._scale) && this._rotation.equals(e._rotation)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(317),
        a = r(o),
        s = n(96),
        u = r(s),
        l = n(70),
        f = r(l),
        c = n(45),
        d = r(c),
        h = n(215),
        p = r(h);
    i.createParticleSystemEntity = function(e, t, n) {
        var r = e.createEntity(),
            i = new a.default({
                particleCount: t.particleCount || 500
            });
        i.emitters.push(new p.default(t)), r.setComponent(i);
        var o = new f.default(i.meshData);
        r.setComponent(o);
        var s = new u.default;
        return s.materials.push(n), s.cullMode = "Never", r.setComponent(s), r
    }, i.createFlareTexture = function(e, t) {
        e = e || 64,
            //! AT: this modifies the original options object which is intrusive and bad
            t = t || {}, t.startRadius = void 0 !== t.startRadius ? t.startRadius : 0, t.endRadius = void 0 !== t.endRadius ? t.endRadius : e / 2, t.steps = t.steps || [{
                fraction: 0,
                value: 1
            }, {
                fraction: 1,
                value: 0
            }];
        var n = document.createElement("canvas");
        n.width = e, n.height = e;
        for (var r = n.getContext("2d"), i = r.createRadialGradient(e / 2, e / 2, t.startRadius, e / 2, e / 2, t.endRadius), o = 0; o < t.steps.length; o += 1) {
            var a = t.steps[o];
            i.addColorStop(a.fraction, "rgba(255, 255, 255, " + a.value + ")")
        }
        r.fillStyle = i, r.fillRect(0, 0, e, e);
        var s = r.getImageData(0, 0, e, e).data;
        return s = new Uint8Array(s), new d.default(s, null, e, e)
    }, i.createSplashTexture = function(e, t) {
        function n(e, t, n) {
            var r = o.createRadialGradient(e, t, 0, e, t, n);
            r.addColorStop(0, "rgba(255, 255, 255, 0.5)"), r.addColorStop(1, "rgba(255, 255, 255, 0)"), o.fillStyle = r, o.fillRect(e - n, t - n, 2 * n, 2 * n)
        }

        function r(e, t, r, i, o, s) {
            for (var u = (r - e) / a, l = (i - t) / a, f = (s - o) / a, c = 0, d = e, h = t, p = o; c < a; c += 1, d += u, h += l, p += f) n(d, h, p)
        }
        e = e || 64,
            //! AT: this modifies the original options object which is intrusive and bad
            t = t || {}, t.nTrails = void 0 !== t.nTrails ? t.nTrails : 8, t.trailStartRadius = void 0 !== t.trailStartRadius ? t.trailStartRadius : 1, t.trailEndRadius = void 0 !== t.trailEndRadius ? t.trailEndRadius : 4;
        var i = document.createElement("canvas");
        i.width = e, i.height = e;
        var o = i.getContext("2d"),
            a = 30;
        ! function(e, t, n, i, o, a, s) {
            for (var u = 0; u < s; u += 1) {
                var l = Math.random() * Math.PI * 2,
                    f = 4 * Math.random() + n,
                    c = 4 * Math.random() - i;
                r(e + Math.cos(l) * f, t + Math.sin(l) * f, e + Math.cos(l) * c, t + Math.sin(l) * c, o, a)
            }
        }(e / 2, e / 2, e / 2 / 10 * 1, e / 2 / 10 * 9, t.trailStartRadius, t.trailEndRadius, t.nTrails);
        var s = o.getImageData(0, 0, e, e).data;
        return s = new Uint8Array(s), new d.default(s, null, e, e)
    }, i.createPlanktonTexture = function(e, t) {
        function n(e, t, n) {
            var r = i.createRadialGradient(e, t, 0, e, t, n);
            r.addColorStop(0, "rgba(255, 255, 255, 1)"), r.addColorStop(.3, "rgba(255, 255, 255, 1)"), r.addColorStop(1, "rgba(255, 255, 255, 0)"), i.fillStyle = r, i.fillRect(e - n, t - n, 2 * n, 2 * n)
        }
        e = e || 64,
            //! AT: this modifies the original options object which is intrusive and bad
            t = t || {}, t.nPoints = void 0 !== t.nPoints ? t.nPoints : 10, t.minRadius = void 0 !== t.minRadius ? t.minRadius : 2, t.maxRadius = void 0 !== t.maxRadius ? t.maxRadius : 5;
        var r = document.createElement("canvas");
        r.width = e, r.height = e;
        var i = r.getContext("2d");
        ! function(r) {
            for (var i = 0; i < r; i += 1) n(Math.random() * (e - 2 * t.maxRadius) + t.maxRadius, Math.random() * (e - 2 * t.maxRadius) + t.maxRadius, Math.random() * (t.maxRadius - t.minRadius) + t.minRadius)
        }(t.nPoints);
        var o = i.getImageData(0, 0, e, e).data;
        return o = new Uint8Array(o), new d.default(o, null, e, e)
    }, i.createSnowflakeTexture = function() {
        function e() {
            r.beginPath(), r.moveTo(0, 0), r.lineTo(0, 90);
            for (var e = 0; e < 6; e += 1) r.moveTo(0, 25 + 10 * e), r.lineTo(16 - 1.5 * e, 35 + 10 * e), r.moveTo(0, 25 + 10 * e), r.lineTo(-(16 - 1.5 * e), 35 + 10 * e);
            r.stroke()
        }
        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 64,
            n = document.createElement("canvas");
        n.width = t, n.height = t;
        var r = n.getContext("2d");
        r.strokeStyle = "#FFF", r.lineWidth = 4, r.lineCap = "round", r.translate(t / 2, t / 2), r.scale(t / 100 / 2, t / 100 / 2),
            function(e, t) {
                for (var n = 2 * Math.PI / e, i = 0; i < e; i += 1) r.rotate(n), t()
            }(7, e);
        var i = r.getImageData(0, 0, t, t).data;
        return i = new Uint8Array(i), new d.default(i, null, t, t)
    }, t.default = i
}, function(e, t, n) {
    var r = n(53);
    e.exports = Object("z").propertyIsEnumerable(0) ? Object : function(e) {
        return "String" == r(e) ? e.split("") : Object(e)
    }
}, function(e, t) {
    t.f = {}.propertyIsEnumerable
}, function(e, t, n) {
    var r = n(53),
        i = n(23)("toStringTag"),
        o = "Arguments" == r(function() {
            return arguments
        }()),
        a = function(e, t) {
            try {
                return e[t]
            } catch (e) {}
        };
    e.exports = function(e) {
        var t, n, s;
        return void 0 === e ? "Undefined" : null === e ? "Null" : "string" == typeof(n = a(t = Object(e), i)) ? n : o ? r(t) : "Object" == (s = r(t)) && "function" == typeof t.callee ? "Arguments" : s
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        e && (this._rootPath = e, "/" !== e.slice(-1) && (this._rootPath += "/")), this.options = t || {}, this._cache = {}
    }

    function o(e, t) {
        for (var n = 0; n < t.length; n++) e[t[n]] = !0;
        return e
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(143),
        s = r(a),
        u = n(17),
        l = r(u),
        f = n(3),
        c = r(f),
        d = n(56),
        h = r(d),
        p = n(12),
        m = r(p);
    i.prototype.prefill = function(e, t) {
        t ? this._cache = e : c.default.extend(this._cache, e)
    }, i.prototype.clear = function() {
        this._cache = {}
    }, i.prototype.get = function(e) {
        e = e || {};
        var t = e.url || "",
            n = new XMLHttpRequest;
        return n.open("GET", t, !0), e.responseType && (n.responseType = e.responseType), l.default.createPromise(function(e, t) {
            var r = function r() {
                4 === n.readyState && (n.status >= 200 && n.status <= 299 ? (n.removeEventListener("readystatechange", r), e(n)) : (n.removeEventListener("readystatechange", r), t(n.statusText)))
            };
            n.addEventListener("readystatechange", r), n.send()
        })
    }, i.ARRAY_BUFFER = "arraybuffer", i.crossOrigin = !0;
    var y = {
        mp4: "video/mp4",
        ogv: "video/ogg",
        webm: "video/webm"
    };
    i.prototype.load = function(e, t) {
        function n(e, t) {
            return e && i.types[t] && i.types[t][e]
        }
        var r = this,
            o = h.default.parseURL(e).path,
            a = o.substr(o.lastIndexOf(".") + 1).toLowerCase();
        if (e || l.default.reject("Path was undefined"), 0 === e.indexOf(i.ENGINE_SHADER_PREFIX) || 0 === e.indexOf(i.GOO_SHADER_PREFIX)) return l.default.resolve();
        if (this._cache[e] && !t) return n(a, "bundle") && this.prefill(this._cache[e], t), this._cache[e] instanceof m.default.Promise ? this._cache[e] : l.default.resolve(this._cache[e]);
        var s = this._rootPath ? this._rootPath + e : e;
        if (n(a, "image")) return this._cache[e] = this._loadImage(s), this._cache[e];
        if (n(a, "video")) return this._cache[e] = this._loadVideo(s, y[a]), this._cache[e];
        if (n(a, "audio")) return this._cache[e] = this._loadAudio(s), this._cache[e];
        var u = {
            url: s
        };
        return n(a, "binary") && (u.responseType = i.ARRAY_BUFFER), this._cache[e] = this.get(u).then(function(e) {
            if (n(a, "bundle")) {
                var i = JSON.parse(e.response);
                return r.prefill(i, t), i
            }
            return n(a, "json") ? JSON.parse(e.response) : e.response
        }).then(null, function(t) {
            throw new Error("Could not load data from " + e + ", " + t)
        })
    }, i.prototype.update = function(e, t) {
        return this._cache[e] = t, l.default.resolve(t)
    }, i.prototype._loadImage = function(e) {
        window.URL = window.URL || window.webkitURL;
        var t = new Image;
        return i.crossOrigin && (t.crossOrigin = "anonymous"), l.default.createPromise(function(n, r) {
            var i = function() {
                    t.dataReady = !0, window.URL && void 0 !== window.URL.revokeObjectURL && window.URL.revokeObjectURL(t.src), t.removeEventListener("load", i), t.removeEventListener("error", o), n(t)
                },
                o = function(n) {
                    t.removeEventListener("load", i), t.removeEventListener("error", o), r("Could not load image from " + e + ", " + n)
                };
            t.addEventListener("load", i, !1), t.addEventListener("error", o, !1), t.src = e
        })
    }, i.prototype._loadVideo = function(e, t) {
        var n = document.createElement("video"),
            r = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
        i.crossOrigin && (n.crossOrigin = "anonymous");
        var o = l.default.createPromise(function(t, i) {
                var o = void 0,
                    a = function() {
                        n.dataReady || console.warn("Video is not ready"), n.removeEventListener("canplay", s), n.removeEventListener("loadstart", u), clearTimeout(o), t(n)
                    },
                    s = function() {
                        n.dataReady = !0, a()
                    },
                    u = function() {
                        r ? a() : o = setTimeout(a, 1e3)
                    };
                n.addEventListener("canplay", s, !1), n.addEventListener("loadstart", u, !1), n.addEventListener("error", function(t) {
                    i("Could not load video from " + e + ", " + t)
                }, !1)
            }),
            a = {
                url: e,
                responseType: i.ARRAY_BUFFER
            };
        return this.get(a).then(function(e) {
            var r = new Blob([e.response], {
                    type: t
                }),
                i = window.URL.createObjectURL(r);
            n.src = i
        }), o
    }, i.prototype._loadAudio = function(e) {
        var t = {
            url: e,
            responseType: i.ARRAY_BUFFER
        };
        return this.get(t).then(function(e) {
            return e.response
        }).then(null, function(t) {
            throw new Error("Could not load data from " + e + ", " + t)
        })
    }, i.ENGINE_SHADER_PREFIX = "SUMERIAN_ENGINE_SHADERS/", i.GOO_SHADER_PREFIX = "GOO_ENGINE_SHADERS/", i.types = {
        text: {
            vert: !0,
            frag: !0
        },
        json: {
            shader: !0,
            script: !0,
            entity: !0,
            material: !0,
            scene: !0,
            mesh: !0,
            texture: !0,
            skeleton: !0,
            animation: !0,
            clip: !0,
            bundle: !0,
            project: !0,
            machine: !0,
            posteffects: !0,
            animstate: !0,
            sound: !0,
            speech: !0,
            environment: !0,
            skybox: !0
        },
        image: {
            jpg: !0,
            jpeg: !0,
            png: !0,
            gif: !0
        },
        video: {
            mp4: !0,
            ogv: !0,
            webm: !0
        },
        binary: o({
            dat: !0,
            bin: !0
        }, Object.keys(s.default.loaders)),
        audio: {
            mp3: !0,
            wav: !0,
            ogg: !0
        },
        bundle: {
            bundle: !0
        }
    }, i.types.asset = o({}, Object.keys(i.types.image).concat(Object.keys(i.types.binary))), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this._size = e
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(3),
        s = r(a),
        u = n(4),
        l = r(u),
        f = ["x", "y", "z", "w"];
    f = ["_x", "_y", "_z", "_w"], i.setupAliases = function(e, t) {
        t.forEach(function(t, n) {
            var r = f[n];
            t.forEach(function(t) {
                Object.defineProperty(e, t, {
                    get: function() {
                        return this[r]
                    },
                    set: function(e) {
                        if (this[r] = e, isNaN(this[r])) throw new Error("Tried setting NaN to vector component " + t)
                    }
                })
            })
        })
    }, i.setupIndices = function(e, t) {
        for (var n = function() {
                throw new Error("Vector component access through indices is not supported anymore")
            }, r = 0; r < t; r++) Object.defineProperty(e, r, {
            get: n,
            set: n
        })
    }, i.addReturnCheck = function(e, t) {
        var n = e[t];
        e[t] = function() {
            var e = n.apply(this, arguments);
            if (isNaN(e)) throw new Error("Vector method " + t + " returned NaN");
            return e
        }
    }, i.addReturnChecks = function(e, t) {
        t.forEach(i.addReturnCheck.bind(null, e))
    }, Object.defineProperty(i.prototype, "data", {
        get: s.default.warnOnce("The .data property of Vector was removed, please use the .x, .y, .z, .w properties instead.", function() {
            var e = [],
                t = this;
            return Object.defineProperties(e, {
                0: {
                    get: function() {
                        return t.x
                    },
                    set: function(e) {
                        t.x = e
                    }
                },
                1: {
                    get: function() {
                        return t.y
                    },
                    set: function(e) {
                        t.y = e
                    }
                },
                2: {
                    get: function() {
                        return t.z
                    },
                    set: function(e) {
                        t.z = e
                    }
                },
                3: {
                    get: function() {
                        return t.w
                    },
                    set: function(e) {
                        t.w = e
                    }
                }
            }), e
        })
    }), i.add = s.default.warnOnce("Vector.add is deprecated.", function(e, t, n) {
        var r = e.data || e,
            o = t.data || t,
            a = e._size;
        n || (n = new i(a));
        for (var s = 0; s < a; s++) n.data[s] = r[s] + o[s];
        return n
    }), i.prototype.add = s.default.warnOnce("Vector.prototype.add is deprecated.", function(e) {
        return i.add(this, e, this)
    }), i.sub = s.default.warnOnce("Vector.sub is deprecated.", function(e, t, n) {
        var r = e.data || e,
            o = t.data || t,
            a = e._size;
        n || (n = new i(a));
        for (var s = 0; s < a; s++) n.data[s] = r[s] - o[s];
        return n
    }), i.prototype.sub = s.default.warnOnce("Vector.prototype.sub is deprecated.", function(e) {
        return i.sub(this, e, this)
    }), i.mul = s.default.warnOnce("Vector.mul is deprecated.", function(e, t, n) {
        var r = e.data || e,
            o = t.data || t,
            a = e._size;
        n || (n = new i(a));
        for (var s = 0; s < a; s++) n.data[s] = r[s] * o[s];
        return n
    }), i.prototype.mul = s.default.warnOnce("Vector.prototype.mul is deprecated.", function(e) {
        return i.mul(this, e, this)
    }), i.div = s.default.warnOnce("Vector.div is deprecated.", function(e, t, n) {
        var r = e.data || e,
            o = t.data || t,
            a = e._size;
        n || (n = new i(a));
        for (var s = 0; s < a; s++) n.data[s] = r[s] / o[s];
        return n
    }), i.prototype.div = s.default.warnOnce("Vector.prototype.div is deprecated.", function(e) {
        return i.div(this, e, this)
    }), i.copy = s.default.warnOnce("Vector.copy is deprecated.", function(e, t) {
        var n = e._size;
        t || (t = new i(n));
        for (var r = 0; r < n; r++) t.data[r] = e.data[r];
        return t
    }), i.prototype.copy = s.default.warnOnce("Vector.prototype.copy  is deprecated.", function(e) {
        for (var t = e._size, n = 0; n < t; n++) this.data[n] = e.data[n];
        return this
    }), i.dot = s.default.warnOnce("Vector.dot is deprecated.", function(e, t) {
        for (var n = e.data || e, r = t.data || t, i = e._size, o = 0, a = 0; a < i; a++) o += n[a] * r[a];
        return o
    }), i.prototype.dot = s.default.warnOnce("Vector.prototype.dot is deprecated.", function(e) {
        return i.dot(this, e)
    }), i.apply = s.default.warnOnce("Vector.apply is deprecated.", function(e, t, n) {
        var r = e.rows,
            o = e.cols,
            a = t._size;
        if (n || (n = new i(r)), n === t) return i.copy(i.apply(e, t), n);
        for (var s = 0; s < o; s++)
            for (var u = s * r, l = 0; l < r; l++) {
                for (var f = 0, c = 0; c < a; c++) f += e.data[c * e.rows + l] * t.data[c];
                n.data[u + l] = f
            }
        return n
    }), i.prototype.apply = s.default.warnOnce("Vector.prototype.apply is deprecated.", function(e) {
        return i.apply(e, this, this)
    }), i.equals = s.default.warnOnce("Vector.equals is deprecated.", function(e, t) {
        var n = e._size;
        if (n !== t._size) return !1;
        for (var r = 0; r < n; r++)
            if (!(Math.abs(e.data[r] - t.data[r]) <= l.default.EPSILON)) return !1;
        return !0
    }), i.prototype.equals = s.default.warnOnce("Vector.prototype.equals is deprecated.", function(e) {
        return i.equals(this, e)
    }), i.distanceSquared = s.default.warnOnce("Vector.distanceSquared is deprecated.", function(e, t) {
        return i.sub(e, t).lengthSquared()
    }), i.prototype.distanceSquared = s.default.warnOnce("Vector.prototype.distanceSquared is deprecated.", function(e) {
        return i.sub(this, e).lengthSquared()
    }), i.distance = s.default.warnOnce("Vector.distance is deprecated.", function(e, t) {
        return i.sub(e, t).length()
    }), i.prototype.distance = s.default.warnOnce("Vector.prototype.distance is deprecated.", function(e) {
        return i.sub(this, e).length()
    }), i.prototype.lengthSquared = s.default.warnOnce("Vector.prototype.lengthSquared is deprecated.", function() {
        return i.dot(this, this)
    }), i.prototype.length = s.default.warnOnce("Vector.prototype.length is deprecated.", function() {
        return Math.sqrt(i.dot(this, this))
    }), i.prototype.scale = s.default.warnOnce("Vector.prototype.scale is deprecated.", function(e) {
        for (var t = this._size - 1; t >= 0; t--) this.data[t] *= e;
        return this
    }), i.prototype.invert = s.default.warnOnce("Vector.prototype.invert is deprecated.", function() {
        for (var e = 0; e < this._size; e++) this.data[e] = 0 - this.data[e];
        return this
    }), i.prototype.normalize = s.default.warnOnce("Vector.prototype.normalize is deprecated.", function() {
        var e = this.length(),
            t = this._size;
        if (e < l.default.EPSILON)
            for (var n = 0; n < t; n++) this.data[n] = 0;
        else {
            e = 1 / e;
            for (var r = 0; r < t; r++) this.data[r] *= e
        }
        return this
    }), i.prototype.clone = s.default.warnOnce("Vector.prototype.clone is deprecated.", function() {
        return i.copy(this)
    }), i.prototype.set = s.default.warnOnce("Vector.prototype.set is deprecated.", function() {
        if (1 === arguments.length && "object" === o(arguments[0]))
            if (arguments[0] instanceof i) this.copy(arguments[0]);
            else
                for (var e = 0; e < arguments[0].length; e++) this.data[e] = arguments[0][e];
        else
            for (var t = 0; t < arguments.length; t++) this.data[t] = arguments[t];
        return this
    }), i.prototype.toString = s.default.warnOnce("Vector.prototype.toString is deprecated.", function() {
        var e = "";
        e += "[";
        for (var t = 0; t < this._size; t++) e += this.data[t], e += t !== this._size - 1 ? ", " : "";
        return e += "]"
    }), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        //! AT: this is one of the few classes that's cloning its input
        this.center = new o.default, e && this.center.set(e),
            //! AT: can these be private?
            this.min = new o.default(1 / 0, 1 / 0, 1 / 0), this.max = new o.default(-1 / 0, -1 / 0, -1 / 0)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.reset = function() {
        return this.center.setDirect(0, 0, 0), this.min.setDirect(1 / 0, 1 / 0, 1 / 0), this.max.setDirect(-1 / 0, -1 / 0, -1 / 0), this
    }, r.prototype.copy = function(e) {
        return this.center.copy(e.center), this.min.copy(e.min), this.min.copy(e.min), this
    }, r.Outside = 0, r.Inside = 1, r.Intersects = 2, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        this.translation = new o.default, this.color = e ? e.clone() : new o.default(1, 1, 1), this.intensity = 1, this.specularIntensity = 1, this.shadowCaster = !1, this.lightCookie = null, this.shadowSettings = {
                size: 100,
                near: 1,
                far: 1e3,
                resolution: [512, 512],
                upVector: o.default.UNIT_Y.clone(),
                darkness: 1,
                shadowOffset: -.001,
                shadowType: "VSM"
            },
            //! AT: please extract this in its own class
            this.changedProperties = !1, this.changedColor = !1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.destroy = function(e) {
        var t = this.shadowSettings;
        t.shadowData && (t.shadowData.shadowTarget && t.shadowData.shadowTarget.destroy(e.context), t.shadowData.shadowTargetDown && t.shadowData.shadowTargetDown.destroy(e.context), t.shadowData.shadowBlurred && t.shadowData.shadowBlurred.destroy(e.context)), delete t.shadowData
    }, r.prototype.invalidateHandles = function(e) {
        var t = this.shadowSettings;
        t.shadowData && (t.shadowData.shadowTarget && e.invalidateRenderTarget(t.shadowData.shadowTarget), t.shadowData.shadowTargetDown && e.invalidateRenderTarget(t.shadowData.shadowTargetDown), t.shadowData.shadowBlurred && e.invalidateRenderTarget(t.shadowData.shadowBlurred))
    }, r.prototype.copy = function(e) {
        return this.translation.copy(e.translation), this.color.copy(e.color), this.intensity = e.intensity, this.specularIntensity = e.specularIntensity, this.shadowCaster = e.shadowCaster, e.lightCookie && (this.lightCookie = e.lightCookie.clone()), this.shadowSettings.size = e.shadowSettings.size, this.shadowSettings.near = e.shadowSettings.near, this.shadowSettings.far = e.shadowSettings.far, this.shadowSettings.resolution[0] = e.shadowSettings.resolution[0], this.shadowSettings.resolution[1] = e.shadowSettings.resolution[1], this.shadowSettings.upVector.copy(e.shadowSettings.upVector), this.shadowSettings.darkness = e.shadowSettings.darkness, this.shadowSettings.shadowType = e.shadowSettings.shadowType, this.changedProperties = e.changedProperties, this.changedColor = e.changedColor, this
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var i = arguments[0];
            e = i.radialSamples, t = i.radiusTop, n = i.radiusBottom, r = i.height
        }
        this.radialSamples = e || 8, this.radiusTop = void 0 === t ? .5 : t, this.radiusBottom = void 0 === n ? this.radiusTop : n, this.height = void 0 === r ? 1 : r;
        var o = a.default.defaultMap([a.default.POSITION, a.default.NORMAL, a.default.TEXCOORD0]);
        a.default.call(this, o, 4 * this.radialSamples + 2 + 2, 3 * this.radialSamples * 4), this.indexModes = ["Triangles"], this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(3),
        f = r(l);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        var e = [],
            t = [],
            n = [],
            r = [],
            i = this.height,
            o = i / 2,
            s = this.radiusTop,
            l = this.radiusBottom,
            f = this.radialSamples,
            c = 2 * Math.PI / f,
            d = 1 / f,
            h = 4 * f + 2 + 2 - 1,
            p = new u.default,
            m = 0;
        i && (m = Math.tan((l - s) / i));
        for (var y = 0, v = 0, _ = 0; y < f; y++, v += c, _ += d) {
            var g = Math.cos(v),
                b = Math.sin(v),
                x = g * s,
                w = b * s,
                E = g * l,
                S = b * l;
            e.push(x, w, o, E, S, -o, x, w, o, E, S, -o), p.setDirect(g, b, m), p.normalize(), t.push(0, 0, 1, 0, 0, -1, p.x, p.y, p.z, p.x, p.y, p.z), n.push(g / 4 + .25, b / 4 + .75, g / 4 + .25, b / 4 + .25, .5, _, 1, _)
        }
        e.push(s, 0, o, l, 0, -o), t.push(1, 0, 0, 1, 0, 0), n.push(.5, 1, 1, 1);
        for (var M = 0; M < f - 1; M++) r.push(h, 4 * M + 0, 4 * M + 4, 4 * M + 1, h - 1, 4 * M + 5, 4 * M + 4 + 2, 4 * M + 2, 4 * M + 4 + 3, 4 * M + 2, 4 * M + 3, 4 * M + 4 + 3);
        return r.push(h, 4 * M + 0, 0, 4 * M + 1, h - 1, 1, 4 * M + 4, 4 * M + 2, 4 * M + 5, 4 * M + 2, 4 * M + 3, 4 * M + 5), e.push(0, 0, -o, 0, 0, o), t.push(0, 0, -.5, 0, 0, .5), n.push(.25, .25, .25, .75), this.getAttributeBuffer(a.default.POSITION).set(e), this.getAttributeBuffer(a.default.NORMAL).set(t), this.getAttributeBuffer(a.default.TEXCOORD0).set(n), this.getIndexBuffer().set(r), this
    }, i.prototype.clone = function() {
        return new i(f.default.shallowSelectiveClone(this, ["radialSamples", "radiusTop", "radiusBottom", "height"]))
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(98),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i),
        a = function e(t) {
            if (r(this, e), this._animationComponent = t && t.animationComponent || null, null === this._animationComponent) throw new o.default("[Sumerian] Could not find Animation Component in '" + (t && t.name) + "'")
        };
    t.default = a
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.getSourceData = function() {}, r.prototype.setTime = function() {
        return !0
    }, r.prototype.setStartTime = function() {}, r.prototype.resetClips = function() {}, r.prototype.shiftClipTime = function() {}, r.prototype.setTimeScale = function() {}, r.prototype.isActive = function() {
        return !0
    }, r.prototype.clone = function() {}, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(119),
        c = r(f),
        d = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n.type = "LightComponent", n.light = e, n.hidden = !1, n._transformDirty = !0, n._transformUpdatedListener = null, Object.seal(n), n
            }
            return a(t, e), s(t, [{
                key: "attached",
                value: function() {
                    var e = this;
                    this.entity.on("transformUpdated", this._transformUpdatedListener = function() {
                        e._transformDirty = !0
                    })
                }
            }, {
                key: "detached",
                value: function() {
                    this.entity.off("transformUpdated", this._transformUpdatedListener), this._transformUpdatedListener = null
                }
            }, {
                key: "updateLight",
                value: function(e) {
                    this.light.update(e)
                }
            }, {
                key: "copy",
                value: function(e) {
                    return this.light.copy(e), this.hidden = e.hidden, this
                }
            }, {
                key: "clone",
                value: function() {
                    var e = new t(this.light.clone());
                    return e.hidden = this.hidden, e
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    if (e instanceof c.default) {
                        var r = new t(e);
                        return n.setComponent(r), !0
                    }
                }
            }]), t
        }(l.default);
    d.type = "LightComponent", t.default = d
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = n(17),
        i = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(r);
    t.default = i.default
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        o = n(76),
        a = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(o),
        s = function() {
            function e() {
                r(this, e)
            }
            return i(e, null, [{
                key: "create",
                value: function(e, t) {
                    return a.default.create(e, t)
                }
            }]), e
        }();
    t.default = s
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(3),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.DEFAULTS_BY_TYPE = {
        array: [],
        float: 0,
        int: 0,
        string: "",
        vec2: [0, 0],
        vec3: [0, 0, 0],
        vec4: [0, 0, 0, 0],
        boolean: !1,
        animation: null,
        camera: null,
        entity: null,
        image: null,
        sound: null,
        texture: null,
        json: null,
        text: null
    }, r.REF_TYPES = ["animation", "camera", "entity", "image", "sound", "texture", "json", "text"], r.isRefType = function(e) {
        return o.default.contains(r.REF_TYPES, e)
    }, r.TYPE_VALIDATORS = function() {
        var e = function(e) {
                return function(t) {
                    return Array.isArray(t) && t.length === e
                }
            },
            t = function(e) {
                function t(t) {
                    return o.default.isString(t) && o.default.getExtension(t) === e
                }

                function n(n) {
                    return n && t(n[e + "Ref"])
                }
                return function(e) {
                    return t(e) || n(e)
                }
            };
        return {
            array: o.default.isArray,
            float: o.default.isNumber,
            number: o.default.isNumber,
            string: o.default.isString,
            boolean: o.default.isBoolean,
            int: o.default.isInteger,
            vec2: e(2),
            vec3: e(3),
            vec4: e(4),
            animation: t("animation"),
            camera: t("camera"),
            entity: t("entity"),
            image: t("image"),
            sound: t("sound"),
            texture: t("texture"),
            json: t("json"),
            text: t("text")
        }
    }(), r.PARAMETER_TYPES = ["string", "int", "float", "vec2", "vec3", "vec4", "boolean", "texture", "sound", "camera", "entity", "animation", "json", "text"], r.PARAMETER_CONTROLS = function() {
        var e = {
                string: ["key"],
                int: ["spinner", "slider", "jointSelector"],
                float: ["spinner", "slider"],
                vec2: [],
                vec3: ["color"],
                vec4: ["color"],
                boolean: ["checkbox"],
                texture: [],
                sound: [],
                camera: [],
                entity: [],
                animation: [],
                json: [],
                text: []
            },
            t = Object.keys(e),
            n = !0,
            r = !1,
            i = void 0;
        try {
            for (var o, a = t[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) {
                var s = o.value;
                Array.prototype.push.apply(e[s], ["dropdown", "select"])
            }
        } catch (e) {
            r = !0, i = e
        } finally {
            try {
                !n && a.return && a.return()
            } finally {
                if (r) throw i
            }
        }
        return e
    }(), r.PROPERTY_TYPES = [{
        prop: "key",
        type: "string",
        mustBeDefined: !0,
        minLength: 1
    }, {
        prop: "type",
        type: "string",
        mustBeDefined: !0,
        minLength: 1,
        getAllowedValues: function() {
            return r.PARAMETER_TYPES
        }
    }, {
        prop: "control",
        type: "string",
        getAllowedValues: function(e) {
            return r.PARAMETER_CONTROLS[e.type]
        }
    }, {
        prop: "name",
        type: "string"
    }, {
        prop: "min",
        type: "number"
    }, {
        prop: "max",
        type: "number"
    }, {
        prop: "scale",
        type: "number"
    }, {
        prop: "decimals",
        type: "number"
    }, {
        prop: "precision",
        type: "number"
    }, {
        prop: "exponential",
        type: "boolean"
    }], r.fillDefaultParameterValues = function(e, t) {
        if (t instanceof Array) {
            var n = [];
            t.forEach(function(t) {
                t && "string" == typeof t.key && (n.push(t.key), void 0 === e[t.key] && (e[t.key] = o.default.clone(t.default)))
            });
            //! AT: when does this ever happen?
            for (var r in e) - 1 === n.indexOf(r) && "enabled" !== r && delete e[r]
        }
    }, r.fillParameterSpecDefaults = function(e) {
        function t(e) {
            return "string" != typeof e || 0 === e.length ? "" : (e[0].toUpperCase() + e.slice(1)).replace(/(.)([A-Z])/g, "$1 $2")
        }
        e instanceof Array && e.forEach(function(e) {
            e && (null !== e.default && void 0 !== e.default || (e.default = o.default.deepClone(r.DEFAULTS_BY_TYPE[e.type])), void 0 === e.name && (e.name = t(e.key)))
        })
    }, r.getKey = function(e) {
        return r._keys[e] ? r._keys[e] : e.charCodeAt(0)
    }, r._keys = {
        Backspace: 8,
        Tab: 9,
        Enter: 13,
        Shift: 16,
        Ctrl: 17,
        Alt: 18,
        Meta: 91,
        Pause: 19,
        Capslock: 20,
        Esc: 27,
        Space: 32,
        Pageup: 33,
        Pagedown: 34,
        End: 35,
        Home: 36,
        Leftarrow: 37,
        Uparrow: 38,
        Rightarrow: 39,
        Downarrow: 40,
        Insert: 45,
        Delete: 46,
        0: 48,
        1: 49,
        2: 50,
        3: 51,
        4: 52,
        5: 53,
        6: 54,
        7: 55,
        8: 56,
        9: 57,
        a: 65,
        b: 66,
        c: 67,
        d: 68,
        e: 69,
        f: 70,
        g: 71,
        h: 72,
        i: 73,
        j: 74,
        k: 75,
        l: 76,
        m: 77,
        n: 78,
        o: 79,
        p: 80,
        q: 81,
        r: 82,
        s: 83,
        t: 84,
        u: 85,
        v: 86,
        w: 87,
        x: 88,
        y: 89,
        z: 90,
        A: 65,
        B: 66,
        C: 67,
        D: 68,
        E: 69,
        F: 70,
        G: 71,
        H: 72,
        I: 73,
        J: 74,
        K: 75,
        L: 76,
        M: 77,
        N: 78,
        O: 79,
        P: 80,
        Q: 81,
        R: 82,
        S: 83,
        T: 84,
        U: 85,
        V: 86,
        W: 87,
        X: 88,
        Y: 89,
        Z: 90,
        "0numpad": 96,
        "1numpad": 97,
        "2numpad": 98,
        "3numpad": 99,
        "4numpad": 100,
        "5numpad": 101,
        "6numpad": 102,
        "7numpad": 103,
        "8numpad": 104,
        "9numpad": 105,
        Multiply: 106,
        Plus: 107,
        Minus: 109,
        Dot: 110,
        Slash1: 111,
        F1: 112,
        F2: 113,
        F3: 114,
        F4: 115,
        F5: 116,
        F6: 117,
        F7: 118,
        F8: 119,
        F9: 120,
        F10: 121,
        F11: 122,
        F12: 123,
        Equals: 187,
        Comma: 188,
        Slash: 191,
        Backslash: 220
    }, r._keyInverse = function(e) {
        for (var t = {}, n = Object.keys(e), r = 0; r < n.length; r++) t[e[n[r]]] = n[r];
        return t
    }(r._keys), r.keyForCode = function(e) {
        return r._keyInverse[e]
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        e = e || {}, this.halfExtents = e.halfExtents ? new a.default(e.halfExtents) : new a.default(.5, .5, .5), u.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(82),
        u = r(s);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, i.prototype.transform = function(e, t) {
        t.halfExtents.set(e.scale).mul(this.halfExtents)
    }, i.prototype.clone = function() {
        return new i({
            halfExtents: this.halfExtents
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        e = e || {}, this.radius = void 0 !== e.radius ? e.radius : .5, o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(82),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.transform = function(e, t) {
        var n = e.scale;
        t.radius = this.radius * Math.max(Math.abs(n.x), Math.abs(n.y), Math.abs(n.z))
    }, r.prototype.clone = function() {
        return new r({
            radius: this.radius
        })
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.renderList = e, this.filter = t, this.clearColor = new f.default(0, 0, 0, 0), this.oldClearColor = new f.default, this.renderToScreen = !1, this.overrideMaterial = null, this.enabled = !0, this.clear = !0, this.needsSwap = !1, this.viewportSize = void 0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(24),
        a = r(o),
        s = n(68),
        u = r(s),
        l = n(36),
        f = r(l);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, i.prototype.render = function(e, t, n, r, i, o, s, u) {
        if (o = o || a.default.mainCamera) {
            s = s || [];
            var l = void 0;
            l = this.filter ? this.renderList.filter(this.filter) : this.renderList, this.renderToScreen ? e.render(l, null, o, s, null, this.clear, this.overrideMaterial) : e.render(l, null, o, s, n, this.clear, this.overrideMaterial), this.clearColor
        }
    }, t.default = i
}, , , function(e, t, n) {
    var r = n(13),
        i = r["__core-js_shared__"] || (r["__core-js_shared__"] = {});
    e.exports = function(e) {
        return i[e] || (i[e] = {})
    }
}, function(e, t, n) {
    var r = n(43),
        i = n(32),
        o = n(86);
    e.exports = function(e) {
        return function(t, n, a) {
            var s, u = r(t),
                l = i(u.length),
                f = o(a, l);
            if (e && n != n) {
                for (; l > f;)
                    if ((s = u[f++]) != s) return !0
            } else
                for (; l > f; f++)
                    if ((e || f in u) && u[f] === n) return e || f || 0;
            return !e && -1
        }
    }
}, function(e, t) {
    t.f = Object.getOwnPropertySymbols
}, function(e, t) {
    e.exports = function(e, t, n) {
        var r = void 0 === n;
        switch (t.length) {
            case 0:
                return r ? e() : e.call(n);
            case 1:
                return r ? e(t[0]) : e.call(n, t[0]);
            case 2:
                return r ? e(t[0], t[1]) : e.call(n, t[0], t[1]);
            case 3:
                return r ? e(t[0], t[1], t[2]) : e.call(n, t[0], t[1], t[2]);
            case 4:
                return r ? e(t[0], t[1], t[2], t[3]) : e.call(n, t[0], t[1], t[2], t[3])
        }
        return e.apply(n, t)
    }
}, function(e, t, n) {
    var r = n(19),
        i = n(53),
        o = n(23)("match");
    e.exports = function(e) {
        var t;
        return r(e) && (void 0 !== (t = e[o]) ? !!t : "RegExp" == i(e))
    }
}, function(e, t, n) {
    var r = n(23)("iterator"),
        i = !1;
    try {
        var o = [7][r]();
        o.return = function() {
            i = !0
        }, Array.from(o, function() {
            throw 2
        })
    } catch (e) {}
    e.exports = function(e, t) {
        if (!t && !i) return !1;
        var n = !1;
        try {
            var o = [7],
                a = o[r]();
            a.next = function() {
                return {
                    done: n = !0
                }
            }, o[r] = function() {
                return a
            }, e(o)
        } catch (e) {}
        return n
    }
}, function(e, t, n) {
    "use strict";
    var r = n(11);
    e.exports = function() {
        var e = r(this),
            t = "";
        return e.global && (t += "g"), e.ignoreCase && (t += "i"), e.multiline && (t += "m"), e.unicode && (t += "u"), e.sticky && (t += "y"), t
    }
}, function(e, t, n) {
    "use strict";
    var r = n(40),
        i = n(41),
        o = n(14),
        a = n(54),
        s = n(23);
    e.exports = function(e, t, n) {
        var u = s(e),
            l = n(a, u, "" [e]),
            f = l[0],
            c = l[1];
        o(function() {
            var t = {};
            return t[u] = function() {
                return 7
            }, 7 != "" [e](t)
        }) && (i(String.prototype, e, f), r(RegExp.prototype, u, 2 == t ? function(e, t) {
            return c.call(e, this, t)
        } : function(e) {
            return c.call(e, this)
        }))
    }
}, function(e, t, n) {
    "use strict";
    var r = n(13),
        i = n(1),
        o = n(41),
        a = n(91),
        s = n(78),
        u = n(106),
        l = n(90),
        f = n(19),
        c = n(14),
        d = n(137),
        h = n(102),
        p = n(175);
    e.exports = function(e, t, n, m, y, v) {
        var _ = r[e],
            g = _,
            b = y ? "set" : "add",
            x = g && g.prototype,
            w = {},
            E = function(e) {
                var t = x[e];
                o(x, e, "delete" == e ? function(e) {
                    return !(v && !f(e)) && t.call(this, 0 === e ? 0 : e)
                } : "has" == e ? function(e) {
                    return !(v && !f(e)) && t.call(this, 0 === e ? 0 : e)
                } : "get" == e ? function(e) {
                    return v && !f(e) ? void 0 : t.call(this, 0 === e ? 0 : e)
                } : "add" == e ? function(e) {
                    return t.call(this, 0 === e ? 0 : e), this
                } : function(e, n) {
                    return t.call(this, 0 === e ? 0 : e, n), this
                })
            };
        if ("function" == typeof g && (v || x.forEach && !c(function() {
                (new g).entries().next()
            }))) {
            var S = new g,
                M = S[b](v ? {} : -0, 1) != S,
                C = c(function() {
                    S.has(1)
                }),
                T = d(function(e) {
                    new g(e)
                }),
                R = !v && c(function() {
                    for (var e = new g, t = 5; t--;) e[b](t, t);
                    return !e.has(-0)
                });
            T || (g = t(function(t, n) {
                l(t, g, e);
                var r = p(new _, t, g);
                return void 0 != n && u(n, y, r[b], r), r
            }), g.prototype = x, x.constructor = g), (C || R) && (E("delete"), E("has"), y && E("get")), (R || M) && E(b), v && x.clear && delete x.clear
        } else g = m.getConstructor(t, e, y, b), a(g.prototype, n), s.NEED = !0;
        return h(g, e), w[e] = g, i(i.G + i.W + i.F * (g != _), w), v || m.setStrong(g, e, y), g
    }
}, function(e, t, n) {
    for (var r, i = n(13), o = n(40), a = n(83), s = a("typed_array"), u = a("view"), l = !(!i.ArrayBuffer || !i.DataView), f = l, c = 0, d = "Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(","); c < 9;)(r = i[d[c++]]) ? (o(r.prototype, s, !0), o(r.prototype, u, !0)) : f = !1;
    e.exports = {
        ABV: l,
        CONSTR: f,
        TYPED: s,
        VIEW: u
    }
}, function(e, t, n) {
    e.exports = n(84) || !n(14)(function() {
        var e = Math.random();
        __defineSetter__.call(null, e, function() {}), delete n(13)[e]
    })
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        var e = this;
        a.default.apply(this, arguments), R.default.addListener("playStateChanged", function(t) {
            e._objects.forEach(function(e) {
                if (e.image && e.image.play && e.image.pause) {
                    var n = e.image;
                    "play" === t ? n.play() : "stop" === t ? (n.pause(), n.currentTime = 0) : "pause" === t && n.pause()
                }
            })
        })
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(45),
        u = r(s),
        l = n(144),
        f = r(l),
        c = n(263),
        d = r(c),
        h = n(264),
        p = r(h),
        m = n(265),
        y = r(m),
        v = n(266),
        _ = r(v),
        g = n(17),
        b = r(g),
        x = n(3),
        w = r(x),
        E = n(267),
        S = r(E),
        M = n(56),
        C = r(M),
        T = n(5),
        R = r(T),
        A = n(4),
        O = r(A),
        P = n(26),
        D = r(P);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("texture", i), i.minFilters = ["NearestNeighborNoMipMaps", "NearestNeighborNearestMipMap", "NearestNeighborLinearMipMap", "BilinearNoMipMaps", "BilinearNearestMipMap", "Trilinear"], i.magFilters = ["NearestNeighbor", "Bilinear"], i.noMipMapAlternatives = {
        NearestNeighborNoMipMaps: "NearestNeighborNoMipMaps",
        NearestNeighborNearestMipMap: "NearestNeighborNoMipMaps",
        NearestNeighborLinearMipMap: "NearestNeighborNoMipMaps",
        BilinearNoMipMaps: "BilinearNoMipMaps",
        BilinearNearestMipMap: "BilinearNoMipMaps",
        Trilinear: "BilinearNoMipMaps"
    }, i.loaders = {
        dds: f.default,
        crn: d.default,
        tga: p.default,
        pvr: y.default,
        ktx: _.default
    }, i.WHITE = new Uint8Array([255, 255, 255, 255]), i.BLACK = new Uint8Array([0, 0, 0, 255]), i.prototype._prepare = function(e) {
        w.default.defaults(e, {
            wrapS: "Repeat",
            wrapT: "Repeat",
            magFilter: "Bilinear",
            minFilter: "Trilinear",
            anisotropy: 1,
            offset: [0, 0],
            repeat: [1, 1],
            flipY: !0,
            lodBias: 0,
            loop: !0
        })
    }, i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        t && this.world.sumerianRunner && t.destroy(this.world.sumerianRunner.renderer.context), this._objects.delete(e)
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype._loadWebSupportedImage = function(e, t, n) {
        return this.loadObject(t.imageRef, n).then(function(t) {
            return e.image !== t && e.setImage(t), e
        })
    }, i.prototype._loadSpecialImage = function(e, t, n) {
        var r = i.loaders[n],
            o = t.imageRef;
        return this.loadObject(o).then(function(n) {
            return n && n.preloaded ? (w.default.extend(e.image, n.image), e.format = n.format, e.setNeedsUpdate(), e) : ((new r).load(n, e, t.flipY, 0, n.byteLength), e)
        })
    }, i.prototype._loadVideo = function(e, t, n) {
        return this.loadObject(t.imageRef, n).then(function(r) {
            return r.width = r.videoWidth, r.height = r.videoHeight, r.loop = void 0 === t.loop || t.loop, O.default.isPowerOfTwo(r.width) && O.default.isPowerOfTwo(r.height) && D.default.Webgl2 || (e.generateMipmaps = !1, e.minFilter = "BilinearNoMipMaps"), e.setImage(r), e.updateCallback = function() {
                return !r.paused
            }, !1 === t.autoPlay || n.editMode ? (r.pause(), r.currentTime = 0) : r.play(), e
        })
    }, i.prototype._loadImage = function(e, t, n) {
        var r = t.imageRef,
            o = C.default.parseURL(r).path,
            a = o.substr(o.lastIndexOf(".") + 1).toLowerCase();
        return i.loaders[a] ? this._loadSpecialImage(e, t, a, n) : -1 !== ["jpg", "jpeg", "png", "gif"].indexOf(a) ? this._loadWebSupportedImage(e, t, n) : -1 !== ["mp4", "ogv", "webm"].indexOf(a) ? this._loadVideo(e, t, n) : b.default.reject(new Error("Unknown image type: " + a))
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        return a.default.prototype._update.call(this, e, t, n).then(function(e) {
            if (e) {
                var o = void 0;
                return e.wrapS === t.wrapS && e.wrapT === t.wrapT || e.setNeedsUpdate(), e.wrapS = t.wrapS, e.wrapT = t.wrapT, -1 !== i.magFilters.indexOf(t.magFilter) && (e.magFilter = t.magFilter), -1 !== i.minFilters.indexOf(t.minFilter) && (e.minFilter = !1 !== t.generateMipmaps ? t.minFilter : i.noMipMapAlternatives[t.minFilter]), e.anisotropy = Math.max(t.anisotropy, 1), t.format && (e.format = t.format), t.type && (e.type = t.type), e.offset.setDirect(t.offset[0], t.offset[1]), e.repeat.setDirect(t.repeat[0], t.repeat[1]), e.lodBias = t.lodBias, e.flipY !== t.flipY && (e.flipY = t.flipY, e.setNeedsUpdate()), e.generateMipmaps !== t.generateMipmaps && (e.generateMipmaps = !1 !== t.generateMipmaps, e.setNeedsUpdate()), e.updateCallback = null, t.imageRef ? t.lazy ? (e.loadImage = function() {
                    return r._loadImage(e, t, n)
                }, o = e) : o = r._loadImage(e, t, n) : o = t.svgData ? b.default.createPromise(function(n, r) {
                    S.default.renderSvgToCanvas(t.svgData, {}, function(t) {
                        t ? (e.setImage(t), n(e)) : r("could not render svg to canvas")
                    })
                }) : e, n && n.texture && n.texture.dontwait ? e : o
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.dwSize = 0, this.dwFlags = 0, this.dwFourCC = 0, this.dwRGBBitCount = 0, this.dwRBitMask = 0, this.dwGBitMask = 0, this.dwBBitMask = 0, this.dwABitMask = 0
    }

    function o() {
        this.dwSize = 0, this.dwFlags = 0, this.dwHeight = 0, this.dwWidth = 0, this.dwLinearSize = 0, this.dwDepth = 0, this.dwMipMapCount = 0, this.dwAlphaBitDepth = 0, this.dwReserved1 = [], this.ddpf = null, this.dwCaps = 0, this.dwCaps2 = 0, this.dwCaps3 = 0, this.dwCaps4 = 0, this.dwTextureStage = 0
    }

    function a() {
        this.flipVertically = !1, this.bpp = 0, this.header = null, this.headerDX10 = null, this.mipmapByteSizes = []
    }

    function s() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var u = n(193),
        l = r(u),
        f = n(26),
        c = r(f);
    i.HEADER_OFFSET = 19, i.DDPF_ALPHAPIXELS = 1, i.DDPF_ALPHA = 2, i.DDPF_FOURCC = 4, i.DDPF_RGB = 64, i.DDPF_YUV = 512, i.DDPF_LUMINANCE = 131072, i.read = function(e) {
        var t = new i;
        if (t.dwSize = e[i.HEADER_OFFSET + 0], 32 !== t.dwSize) throw new Error("invalid pixel format size: " + t.dwSize);
        return t.dwFlags = e[i.HEADER_OFFSET + 1], t.dwFourCC = e[i.HEADER_OFFSET + 2], t.dwRGBBitCount = e[i.HEADER_OFFSET + 3], t.dwRBitMask = e[i.HEADER_OFFSET + 4], t.dwGBitMask = e[i.HEADER_OFFSET + 5], t.dwBBitMask = e[i.HEADER_OFFSET + 6], t.dwABitMask = e[i.HEADER_OFFSET + 7], t
    }, o.DDSD_CAPS = 1, o.DDSD_HEIGHT = 2, o.DDSD_WIDTH = 4, o.DDSD_PITCH = 8, o.DDSD_PIXELFORMAT = 4096, o.DDSD_MIPMAPCOUNT = 131072, o.DDSD_LINEARSIZE = 524288, o.DDSD_DEPTH = 8388608, o.DDSCAPS_COMPLEX = 8, o.DDSCAPS_MIPMAP = 4194304, o.DDSCAPS_TEXTURE = 4096, o.DDSCAPS2_CUBEMAP = 512, o.DDSCAPS2_CUBEMAP_POSITIVEX = 1024, o.DDSCAPS2_CUBEMAP_NEGATIVEX = 2048, o.DDSCAPS2_CUBEMAP_POSITIVEY = 4096, o.DDSCAPS2_CUBEMAP_NEGATIVEY = 8192, o.DDSCAPS2_CUBEMAP_POSITIVEZ = 16384, o.DDSCAPS2_CUBEMAP_NEGATIVEZ = 32768, o.DDSCAPS2_VOLUME = 2097152, o.read = function(e) {
        var t = new o;
        if (t.dwSize = e[1], 124 !== t.dwSize) throw new Error("invalid dds header size: " + t.dwSize);
        t.dwFlags = e[2], t.dwHeight = e[3], t.dwWidth = e[4], t.dwLinearSize = e[5], t.dwDepth = e[6], t.dwMipMapCount = e[7], t.dwAlphaBitDepth = e[8];
        for (var n = 0; n < t.dwReserved1.length; n++) t.dwReserved1[n] = e[9 + n];
        t.ddpf = i.read(e), t.dwCaps = e[27], t.dwCaps2 = e[28], t.dwCaps3 = e[29], t.dwCaps4 = e[30], t.dwTextureStage = e[31];
        var r = 1 + Math.ceil(Math.log(Math.max(t.dwHeight, t.dwWidth)) / Math.log(2));
        return l.default.isSet(t.dwCaps, o.DDSCAPS_MIPMAP) ? l.default.isSet(t.dwFlags, o.DDSD_MIPMAPCOUNT) ? t.dwMipMapCount !== r && console.warn("Got " + t.dwMipMapCount + " mipmaps, expected " + r) : t.dwMipMapCount = r : t.dwMipMapCount = 1, t
    }, a.prototype.calcMipmapSizes = function(e) {
        for (var t = this.header.dwWidth, n = this.header.dwHeight, r = 0, i = 0; i < this.header.dwMipMapCount; i++) r = e ? ~~((t + 3) / 4) * ~~((n + 3) / 4) * this.bpp * 2 : ~~(t * n * this.bpp / 8), this.mipmapByteSizes.push(4 * ~~((r + 3) / 4)), t = ~~(t / 2) > 1 ? ~~(t / 2) : 1, n = ~~(n / 2) > 1 ? ~~(n / 2) : 1
    }, s.updateDepth = function(e, t) {
        if (l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP)) {
            var n = 0;
            if (l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_POSITIVEX) && n++, l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_NEGATIVEX) && n++, l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_POSITIVEY) && n++, l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_NEGATIVEY) && n++, l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_POSITIVEZ) && n++, l.default.isSet(t.header.dwCaps2, o.DDSCAPS2_CUBEMAP_NEGATIVEZ) && n++, 6 !== n) throw new Error("Cubemaps without all faces defined are not currently supported.");
            e.depth = n
        } else e.depth = t.header.dwDepth > 0 ? t.header.dwDepth : 1
    }, s.readDXT = function(e, t, n, r) {
        if (r.image.isCompressed = !0, !n.flipVertically) return new Uint8Array(e.buffer, e.byteOffset + 0, t);
        for (var i = n.header.dwWidth, o = n.header.dwHeight, a = new Uint8Array(t), s = 0, u = 0; u < n.header.dwMipMapCount; u++) {
            var f = e.subarray(s, s + n.mipmapByteSizes[u]),
                c = l.default.flipDXT(f, i, o, r.format);
            a.set(c, s), s += c.length, i = ~~(i / 2) > 1 ? ~~(i / 2) : 1, o = ~~(o / 2) > 1 ? ~~(o / 2) : 1
        }
        return a
    }, s.readUncompressed = function(e, t, n, r, i, o, a, s) {
        var u = l.default.shiftCount(a.header.ddpf.dwRBitMask),
            f = l.default.shiftCount(a.header.ddpf.dwGBitMask),
            c = l.default.shiftCount(a.header.ddpf.dwBBitMask),
            d = l.default.shiftCount(a.header.ddpf.dwABitMask),
            h = ~~(a.header.ddpf.dwRGBBitCount / 8),
            p = 1 * l.default.getComponents(s.format),
            m = new Uint8Array(t),
            y = a.header.dwWidth,
            v = a.header.dwHeight,
            _ = 0,
            g = 0,
            b = 0,
            x = [];
        for (b = 0; b < h; b++) x.push(0);
        for (var w = 0; w < a.header.dwMipMapCount; w++) {
            for (var E = 0; E < v; E++)
                for (var S = 0; S < y; S++) {
                    for (b = 0; b < h; b++) x[b] = e[g++];
                    b = l.default.getIntFromBytes(x);
                    var M = (b & a.header.ddpf.dwRBitMask) >> u,
                        C = (b & a.header.ddpf.dwGBitMask) >> f,
                        T = (b & a.header.ddpf.dwBBitMask) >> c,
                        R = (b & a.header.ddpf.dwABitMask) >> d;
                    i ? m[_++] = R : r ? (m[_++] = M, o && (m[_++] = R)) : n && (m[_++] = M, m[_++] = C, m[_++] = T, o && (m[_++] = R))
                }
            _ += y * v * p, y = ~~(y / 2) > 1 ? ~~(y / 2) : 1, v = ~~(v / 2) > 1 ? ~~(v / 2) : 1
        }
        return m
    }, s.populate = function(e, t, n) {
        var r = t.header.ddpf.dwFlags,
            o = l.default.isSet(r, i.DDPF_FOURCC),
            a = l.default.isSet(r, i.DDPF_RGB),
            u = l.default.isSet(r, i.DDPF_ALPHAPIXELS),
            f = l.default.isSet(r, i.DDPF_LUMINANCE),
            c = l.default.isSet(r, i.DDPF_ALPHA);
        if (e.type = "UnsignedByte", o) {
            var d = t.header.ddpf.dwFourCC;
            if (d === l.default.getIntFromString("DXT1")) t.bpp = 4, e.format = "PrecompressedDXT1A";
            else if (d === l.default.getIntFromString("DXT3")) t.bpp = 8, e.format = "PrecompressedDXT3";
            else {
                if (d !== l.default.getIntFromString("DXT5")) throw d === l.default.getIntFromString("DX10") ? new Error("dxt10 LATC formats not supported currently: " + t.headerDX10.dxgiFormat) : d === l.default.getIntFromString("DXT2") ? new Error("DXT2 is not supported.") : d === l.default.getIntFromString("DXT4") ? new Error("DXT4 is not supported.") : new Error("unsupported compressed dds format found (" + d + ")");
                t.bpp = 8, e.format = "PrecompressedDXT5"
            }
        } else if (t.bpp = t.header.ddpf.dwRGBBitCount, a) e.format = u ? "RGBA" : "RGB";
        else {
            if (!f && !u) throw new Error("unsupported uncompressed dds format found.");
            f && u ? e.format = "LuminanceAlpha" : f ? e.format = "Luminance" : c && (e.format = "Alpha")
        }
        t.calcMipmapSizes(o), e.image.mipmapSizes = t.mipmapByteSizes;
        for (var h = 0, p = 0; p < t.mipmapByteSizes.length; p++) h += t.mipmapByteSizes[p];
        for (var m = [], p = 0; p < e.image.depth; p++) o ? m.push(s.readDXT(n, h, t, e)) : (a || f || c) && m.push(s.readUncompressed(n, h, a, f, c, u, t, e));
        e.image.data = 1 === e.image.depth ? m[0] : m, e.image.useArrays = !0
    }, s.prototype.load = function(e, t, n, r, i) {
        var u = new Int32Array(e, r + 0, 32);
        if (u[0] !== l.default.getIntFromString("DDS ")) throw new Error("Not a dds file.");
        var f = new a;
        f.flipVertically = n, f.header = o.read(u), f.headerDX10 = f.header.ddpf.dwFourCC === l.default.getIntFromString("DX10") ? o.read(Int32Array.create(e, r + 128, 5)) : null;
        var c = t.image;
        void 0 !== c && null !== c || (c = {}, t.image = c), c.width = f.header.dwWidth, c.height = f.header.dwHeight, s.updateDepth(c, f);
        var d = 128 + (f.headerDX10 ? 20 : 0);
        s.populate(t, f, new Uint8Array(e, r + d, i - d)), (!f.mipmapByteSizes || f.mipmapByteSizes.length < 2) && (t.minFilter = "BilinearNoMipMaps"), c.bpp = f.bpp, c.dataReady = !0, c.isData = !0, t.needsUpdate = !0
    }, s.prototype.isSupported = function() {
        return !!c.default.CompressedTextureS3TC
    }, s.prototype.toString = function() {
        return "DdsLoader"
    }, t.default = s
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.rows = e || 0, this.cols = t || 0, this.data = new Float32Array(this.rows * this.cols)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(4),
        s = r(a),
        u = n(3),
        l = r(u);
    i.setupAliases = function(e, t) {
        t.forEach(function(t, n) {
            t.forEach(function(t) {
                Object.defineProperty(e, t, {
                    get: function() {
                        return this.data[n]
                    },
                    set: function(e) {
                        if (this.data[n] = e, isNaN(this.data[n])) throw new Error("Tried setting NaN to matrix component " + t)
                    }
                })
            }), Object.defineProperty(e, n, {
                get: function() {
                    return this.data[n]
                },
                set: function(e) {
                    if (this.data[n] = e, isNaN(this.data[n])) throw new Error("Tried setting NaN to matrix component " + n)
                }
            })
        })
    }, i.prototype.checkIntegrity = function() {
        for (var e = 0; e < this.data.length; e++)
            if (isNaN(this.data[e])) throw new Error("Matrix contains NaN at index " + e)
    }, i.addPostCheck = function(e, t) {
        var n = e[t];
        e[t] = function() {
            var e = n.apply(this, arguments);
            if ("number" == typeof e && isNaN(e)) throw new Error("Matrix method " + t + " returned NaN");
            return this.checkIntegrity(), e
        }
    }, i.addPostChecks = function(e, t) {
        t.forEach(i.addPostCheck.bind(null, e))
    }, i.add = l.default.warnOnce("Matrix.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.", function(e, t, n) {
        var r = e.rows,
            o = e.cols;
        if (n || (n = new i(r, o)), t instanceof i)
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] + t.data[a];
        else
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] + t;
        return n
    }), i.prototype.add = l.default.warnOnce("Matrix.prototype.add is deprecated. Use Matrix3.prototype.add, Matrix2.prototype.add or Matrix4.prototype.add instead.", function(e) {
        return i.add(this, e, this)
    }), i.sub = l.default.warnOnce("Matrix.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.", function(e, t, n) {
        var r = e.rows,
            o = e.cols;
        if (n || (n = new i(r, o)), t instanceof i)
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] - t.data[a];
        else
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] - t;
        return n
    }), i.prototype.sub = l.default.warnOnce("Matrix.prototype.sub is deprecated. Use Matrix3.prototype.sub, Matrix2.prototype.sub or Matrix4.prototype.sub instead.", function(e) {
        return i.sub(this, e, this)
    }), i.mul = l.default.warnOnce("Matrix.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.", function(e, t, n) {
        var r = e.rows,
            o = e.cols;
        if (n || (n = new i(r, o)), t instanceof i)
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] * t.data[a];
        else
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] * t;
        return n
    }), i.prototype.mul = l.default.warnOnce("Matrix.prototype.mul is deprecated. Use Matrix3.prototype.mul, Matrix2.prototype.mul or Matrix4.prototype.mul instead.", function(e) {
        return i.mul(this, e, this)
    }), i.div = l.default.warnOnce("Matrix.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.", function(e, t, n) {
        var r = e.rows,
            o = e.cols;
        if (n || (n = new i(r, o)), t instanceof i)
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] / t.data[a];
        else {
            t = 1 / t;
            for (var a = 0; a < e.data.length; a++) n.data[a] = e.data[a] * t
        }
        return n
    }), i.prototype.div = l.default.warnOnce("Matrix.prototype.div is deprecated. Use Matrix3.prototype.div, Matrix2.prototype.div or Matrix4.prototype.div instead.", function(e) {
        return i.div(this, e, this)
    }), i.combine = l.default.warnOnce("Matrix.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.", function(e, t, n) {
        var r = e.rows,
            o = t.cols,
            a = e.cols = t.rows;
        if (n || (n = new i(r, o)), n === e || n === t) return i.copy(i.combine(e, t), n);
        for (var s = 0; s < o; s++)
            for (var u = s * r, l = 0; l < r; l++) {
                for (var f = 0, c = 0; c < a; c++) f += e.data[c * e.rows + l] * t.data[s * t.rows + c];
                n.data[u + l] = f
            }
        return n
    }), i.prototype.combine = l.default.warnOnce("Matrix.prototype.combine is deprecated. Use Matrix2/3/4.prototype.mul or Matrix2/3/4.prototype.mul2 instead.", function(e) {
        return i.combine(this, e, this)
    }), i.transpose = l.default.warnOnce("Matrix.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.", function(e, t) {
        var n = e.cols,
            r = e.rows;
        if (t || (t = new i(n, r)), t === e) return i.copy(i.transpose(e), t);
        for (var o = 0; o < r; o++)
            for (var a = o * n, s = 0; s < n; s++) t.data[a + s] = e.data[s * r + o];
        return t
    }), i.prototype.transpose = l.default.warnOnce("Matrix.prototype.transpose is deprecated. Use Matrix2/3/4.prototype.transpose instead.", function() {
        return i.transpose(this, this)
    }), i.copy = l.default.warnOnce("Matrix.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.", function(e, t) {
        var n = e.rows,
            r = e.cols;
        return t || (t = new i(n, r)), t.data.set(e.data), t
    }), i.prototype.copy = l.default.warnOnce("Matrix.prototype.copy is deprecated. Use Matrix2/3/4.prototype.copy instead.", function(e) {
        return i.copy(e, this)
    }), i.equals = l.default.warnOnce("Matrix.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.", function(e, t) {
        if (e.rows !== t.rows || e.cols !== t.cols) return !1;
        for (var n = 0; n < e.data.length; n++)
            if (!(Math.abs(e.data[n] - t.data[n]) <= s.default.EPSILON)) return !1;
        return !0
    }), i.prototype.equals = l.default.warnOnce("Matrix.prototype.equals is deprecated. Use Matrix2/3/4.prototype.equals instead.", function(e) {
        return i.equals(this, e)
    }), i.prototype.isOrthogonal = l.default.warnOnce("Matrix.prototype.isOrthogonal is deprecated. Use Matrix2/3/4.prototype.isOrthogonal instead.", function() {
        for (var e = 0; e < this.cols; e++)
            for (var t = e + 1; t < this.cols; t++) {
                for (var n = e * this.rows, r = t * this.rows, i = 0, o = 0; o < this.rows; o++) i += this.data[n + o] * this.data[r + o];
                if (Math.abs(i) > s.default.EPSILON) return !1
            }
        return !0
    }), i.prototype.isNormal = l.default.warnOnce("Matrix.prototype.isNormal is deprecated. Use Matrix2/3/4.prototype.isNormal instead.", function() {
        for (var e = 0; e < this.cols; e++) {
            for (var t = e * this.rows, n = 0, r = 0; r < this.rows; r++) n += this.data[t + r] * this.data[t + r];
            if (Math.abs(n - 1) > s.default.EPSILON) return !1
        }
        return !0
    }), i.prototype.isOrthonormal = l.default.warnOnce("Matrix.prototype.isOrthonormal is deprecated. Use Matrix2/3/4.prototype.isOrthonormal instead.", function() {
        return this.isOrthogonal() && this.isNormal()
    }), i.prototype.clone = l.default.warnOnce("Matrix.prorotype.clone is deprecated. Use Matrix2/3/4.prototype.clone instead.", function() {
        return i.copy(this)
    }), i.prototype.set = l.default.warnOnce("Matrix.prototype.set is deprecated. Use Matrix2/3/4.prototype.set instead.", function() {
        if (1 === arguments.length && "object" === o(arguments[0]))
            if (arguments[0] instanceof i) this.copy(arguments[0]);
            else
                for (var e = 0; e < arguments[0].length; e++) this.data[e] = arguments[0][e];
        else
            for (var e = 0; e < arguments.length; e++) this.data[e] = arguments[e];
        return this
    }), i.prototype.toString = l.default.warnOnce("Matrix.prorotype.toString is deprecated.", function() {
        for (var e = "", t = 0; t < this.cols; t++) {
            var n = t * this.rows;
            e += "[";
            for (var r = 0; r < this.rows; r++) e += this.data[n + r], e += r !== this.rows - 1 ? ", " : "";
            e += t !== this.cols - 1 ? "], " : "]"
        }
        return e
    }), t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(26),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.createIndexBuffer = function(e, t) {
            var n = void 0;
            if (t <= 256) n = "Trident" === r.browserType ? new Uint16Array(e) : new Uint8Array(e);
            else if (t <= 65536) n = new Uint16Array(e);
            else {
                if (!o.default.ElementIndexUInt) throw new Error("Maximum number of vertices is 65536. Got: " + t);
                n = new Uint32Array(e)
            }
            return n
        },
        function() {
            var e = ["Trident", "MSIE", "Firefox", "Safari", "Chrome", "Opera"],
                t = "undefined" != typeof navigator && navigator.userAgent || "",
                n = e.length - 1;
            for (n; n > -1 && -1 === t.indexOf(e[n]); n--);
            r.browserType = e[n]
        }(), r.cloneTypedArray = function(e) {
            return new e.constructor(e)
        }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}

    function o(e, t, n) {
        var r = document.createElement("canvas");
        r.width = t, r.height = n;
        var i = r.getContext("2d"),
            o = i.createImageData(t, n);
        return o.data.set(e), i.putImageData(o, 0, 0), r
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(3),
        s = r(a),
        u = n(4),
        l = r(u),
        f = n(26),
        c = r(f);
    i.getByteSize = function(e) {
        var t = void 0;
        switch (e) {
            case "Byte":
            case "UnsignedByte":
                t = 1;
                break;
            case "Short":
            case "UnsignedShort":
            case "HalfFloat":
                t = 2;
                break;
            case "Int":
            case "Float":
                t = 4;
                break;
            case "Double":
                t = 8;
                break;
            default:
                throw new Error("Unknown type: " + e)
        }
        return t
    }, i.checkGLError = function(e) {
        for (var t = e.getError(), n = null; t != e.NO_ERROR;) {
            if (t == e.INVALID_ENUM) n = "[INVALID_ENUM] An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.";
            else if (t == e.INVALID_VALUE) n = "[INVALID_VALUE] A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.";
            else if (t == e.INVALID_OPERATION) n = "[INVALID_OPERATION] The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.";
            else if (t == e.FRAMEBUFFER_COMPLETE) n = "[FRAMEBUFFER_COMPLETE] The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.";
            else {
                if (t == e.OUT_OF_MEMORY) throw new Error("[OUT_OF_MEMORY] There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.");
                n = "[UNKNOWN_ERROR]" + t
            }
            t = e.getError()
        }
        return n
    }, i.checkFrameBufferStatus = function(e) {
        for (var t = e.checkFramebufferStatus(e.FRAMEBUFFER), n = !1; t !== e.FRAMEBUFFER_COMPLETE;) {
            n = !0, t === e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT ? console.error("Frame buffer missing attachment.") : t === e.FRAMEBUFFER_UNSUPPORTED ? console.error("Frame buffer unsupported.") : t === e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS ? console.error("Framebuffer incomplete dimensions.") : t === e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT ? console.error("Framebuffer incomplete attachment.") : 36059 == t ? (console.error("Frame Buffer Status Error (OSX-specific error code): " + t + ". Continuing Execution."), n = !1) : console.error("Frame Buffer Status Error: " + t);
            break
        }
        if (n) throw new Error("Stopping due to error")
    }, i.isPowerOfTwo = l.default.isPowerOfTwo, i.nearestPowerOfTwo = l.default.nearestPowerOfTwo, i.clone = s.default.deepClone, i._blankImages = {}, i.getBlankImage = function(e, t, n, r, o, a) {
        var s = l.default.nearestPowerOfTwo(n),
            u = l.default.nearestPowerOfTwo(r);
        s = Math.min(s, o), u = Math.min(u, o);
        var f = 4 === t.length ? "rgba(" + Number(255 * t[0]).toFixed(0) + "," + Number(255 * t[1]).toFixed(0) + "," + Number(255 * t[2]).toFixed(0) + "," + Number(t[3]).toFixed(2) + ")" : "rgb(" + Number(255 * t[0]).toFixed(0) + "," + Number(255 * t[1]).toFixed(0) + "," + Number(255 * t[2]).toFixed(0) + ")",
            c = f + s + "x" + u,
            d = i._blankImages[c];
        if (!d) {
            d = document.createElement("canvas"), d.width = s, d.height = u;
            var h = d.getContext("2d");
            h.beginPath(), h.rect(0, 0, s, u), h.fillStyle = f, h.fill(), i._blankImages[c] = d
        }
        void 0 === a ? e.image = d : (e.image.isData = !1, e.image.data[a] = d)
    }, i.scaleImage = function(e, t, n, r, i, a) {
        var s = l.default.nearestPowerOfTwo(n),
            u = l.default.nearestPowerOfTwo(r);
        if (s = Math.min(s, i), u = Math.min(u, i), t.width !== s || t.height !== u) {
            var f = document.createElement("canvas");
            f.width = s, f.height = u, t.getAttribute && f.setAttribute("data-ref", t.getAttribute("data-ref"));
            var c = f.getContext("2d");
            t.data ? c.drawImage(o(t.data, t.width, t.height), 0, 0, t.width, t.height, 0, 0, s, u) :
                //! AT: this will choke if fed with a manually created texture ([0, 0, 0, 255, ...])
                c.drawImage(t, 0, 0, t.width, t.height, 0, 0, s, u), f.dataReady = !0, f.src = t.src, f.originalWidth = n, f.originalHeight = r, void 0 === a ? e.image = f : e.image.data[a] = f
        }
    };
    var d = !1,
        h = !1;
    i.getGLType = function(e, t) {
        var n = void 0;
        switch (t) {
            case "2D":
                n = e.TEXTURE_2D;
                break;
            case "2DArray":
                n = e.TEXTURE_2D_ARRAY, c.default.Webgl2 || (n = e.TEXTURE_2D, d || (console.warn("WARNING: RendererUtils.getGLType(): Texture2DArrays are not supported on WebGL1. Returning Texture2D instead."), d = !0));
                break;
            case "3D":
                n = e.TEXTURE_3D, c.default.Webgl2 || (n = e.TEXTURE_2D, h || (console.warn("WARNING: RendererUtils.getGLType(): 3D textures are not supported on WebGL1. Returning Texture2D instead."), h = !0));
                break;
            case "CUBE":
                n = e.TEXTURE_CUBE_MAP;
                break;
            default:
                throw new Error("Invalid texture type: " + t)
        }
        return n
    }, i.getGLWrap = function(e, t) {
        var n = void 0;
        switch (t) {
            case "Repeat":
                n = e.REPEAT;
                break;
            case "MirroredRepeat":
                n = e.MIRRORED_REPEAT;
                break;
            case "EdgeClamp":
                n = e.CLAMP_TO_EDGE;
                break;
            default:
                throw new Error("Invalid WrapMode type: " + t)
        }
        return n
    }, i.getGlFormatFromInternal = function(e, t) {
        var n = void 0;
        switch (t) {
            case "RGBA":
                n = e.RGBA;
                break;
            case "RGB":
                n = e.RGB;
                break;
            case "Alpha":
                n = e.ALPHA;
                break;
            case "Luminance":
                n = e.LUMINANCE;
                break;
            case "LuminanceAlpha":
                n = e.LUMINANCE_ALPHA;
                break;
            case "R8":
            case "R16F":
            case "R32F":
                n = e.RED;
                break;
            case "R8UI":
                n = e.RED_INTEGER;
                break;
            case "RG8":
            case "RG16F":
            case "RG32F":
                n = e.RG;
                break;
            case "RGUI":
            case "RG8UI":
            case "RG16UI":
            case "RG32UI":
                n = e.RG_INTEGER;
                break;
            case "RGB8":
            case "SRGB8":
            case "RGB565":
            case "R11FG11FB10F":
            case "RGB9E5":
            case "RGB16F":
            case "RGB32F":
                n = e.RGB;
                break;
            case "RGB8UI":
                n = e.RGB_INTEGER;
                break;
            case "RGBA8":
            case "SRGB8A8":
            case "RGB5A1":
            case "RGB10A2":
            case "RGBA4":
            case "RGBA16F":
            case "RGBA32F":
                n = e.RGBA;
                break;
            case "RGBA8UI":
                n = e.RGBA_INTEGER;
                break;
            default:
                throw new Error("Unsupported format: " + t)
        }
        return n
    }, i.getGLRenderBufferInternalFormat = function(e, t) {
        var n = void 0;
        switch (t) {
            case "R8":
                n = e.R8;
                break;
            case "R8UI":
                n = e.R8UI;
                break;
            case "R8I":
                n = e.R8I;
                break;
            case "R16UI":
                n = e.R16UI;
                break;
            case "R16I":
                n = e.R16I;
                break;
            case "R16F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.R16F;
                break;
            case "R32F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.R32F;
                break;
            case "R32UI":
                n = e.R32UI;
                break;
            case "R32I":
                n = e.R32I;
                break;
            case "RG8":
                n = e.RG8;
                break;
            case "RG8UI":
                n = e.RG8UI;
                break;
            case "RG8I":
                n = e.RG8I;
                break;
            case "RG16UI":
                n = e.RG16UI;
                break;
            case "RG16I":
                n = e.RG16I;
                break;
            case "RG16F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.RG16F;
                break;
            case "RG32F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.RG32F;
                break;
            case "RG32UI":
                n = e.RG32UI;
                break;
            case "RG32I":
                n = e.RG32I;
                break;
            case "RGB8":
                n = e.RGB8;
                break;
            case "RGBA8":
                n = e.RGBA8;
                break;
            case "SRGB8_ALPHA8":
                n = e.SRGB8_ALPHA8;
                break;
            case "RGBA4":
                n = e.RGBA4;
                break;
            case "RGB565":
                n = e.RGB565;
                break;
            case "RGB5_A1":
                n = e.RGB5_A1;
                break;
            case "RGB10_A2":
                n = e.RGB10_A2;
                break;
            case "RGBA8UI":
                n = e.RGBA8UI;
                break;
            case "RGBA8I":
                n = e.RGBA8I;
                break;
            case "RGB10_A2UI":
                n = e.RGB10_A2UI;
                break;
            case "RGBA16UI":
                n = e.RGBA16UI;
                break;
            case "RGBA16I":
                n = e.RGBA16I;
                break;
            case "RGBA16F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.RGBA16F;
                break;
            case "RGBA32I":
                n = e.RGBA32I;
                break;
            case "RGBA32UI":
                n = e.RGBA32UI;
                break;
            case "RGBA32F":
                if (n = e.RGBA32F, !c.default.FloatColorBuffer) {
                    console.warn("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t + ". Using DEPTH_COMPONENT16 as fallback format instead."), n = e.DEPTH_COMPONENT16
                }
                break;
            case "R11F_G11F_B10F":
                if (!c.default.FloatColorBuffer) throw new Error("EXT_color_buffer_float extension not supported, which is needed for renderbuffer format: " + t);
                n = e.R11F_G11F_B10F;
                break;
            default:
                throw new Error("Unsupported format: " + t)
        }
        return n
    }, i.getGLInternalFormat = function(e, t) {
        var n = void 0;
        switch (t) {
            case "RGBA":
                n = e.RGBA;
                break;
            case "RGB":
                n = e.RGB;
                break;
            case "Alpha":
                n = e.ALPHA;
                break;
            case "Luminance":
                n = e.LUMINANCE;
                break;
            case "LuminanceAlpha":
                n = e.LUMINANCE_ALPHA;
                break;
            case "R8":
                n = e.R8;
                break;
            case "R16F":
                n = e.R16F;
                break;
            case "R32F":
                n = e.R32F;
                break;
            case "R8UI":
                n = e.R8UI;
                break;
            case "RG8":
                n = e.RG8;
                break;
            case "RG16F":
                n = e.RG16F;
                break;
            case "RG32F":
                n = e.RG32F;
                break;
            case "RG8UI":
                n = e.RG8UI;
                break;
            case "RGB8":
                n = e.RGB8;
                break;
            case "SRGB8":
                n = e.SRGB8;
                break;
            case "RGB565":
                n = e.RGB565;
                break;
            case "R11FG11FB10F":
                n = e.R11F_G11F_B10F;
                break;
            case "RGB9E5":
                n = e.RGB9_E5;
                break;
            case "RGB16F":
                n = e.RGB16F;
                break;
            case "RGB32F":
                n = e.RGB32F;
                break;
            case "RGB8UI":
                n = e.RGB8UI;
                break;
            case "RGBA8":
                n = e.RGBA8;
                break;
            case "SRGB8A8":
                n = e.SRGB8_ALPHA8;
                break;
            case "RGB5A1":
                n = e.RGB5_A1;
                break;
            case "RGB10A2":
                n = e.RGB10_A2;
                break;
            case "RGBA4":
                n = e.RGBA4;
                break;
            case "RGBA16F":
                n = e.RGBA16F;
                break;
            case "RGBA32F":
                n = e.RGBA32F;
                break;
            case "RGBA8UI":
                n = e.RGBA8UI;
                break;
            default:
                throw new Error("Unsupported format: " + t)
        }
        if (void 0 == n && !c.default.Webgl2) {
            var r = e.RGBA;
            console.warn("Requested glInternalFormat " + t + " is not supported on WebGL 1.0. Using RGBA instead as the internal format."), n = r
        }
        return n
    }, i.getGLInternalFormat3D = function(e, t) {
        var n = void 0;
        switch (t) {
            case "RGBA":
                n = e.RGBA;
                break;
            case "RGB":
                n = e.RGB;
                break;
            case "Alpha":
                n = e.ALPHA;
                break;
            case "Luminance":
                n = e.LUMINANCE;
                break;
            case "LuminanceAlpha":
                n = e.LUMINANCE_ALPHA;
                break;
            case "R8":
                n = e.R8;
                break;
            case "R16F":
                n = e.R16F;
                break;
            case "R32F":
                n = e.R32F;
                break;
            case "R8UI":
                n = e.R8UI;
                break;
            case "RG8":
                n = e.RG8;
                break;
            case "RG16F":
                n = e.RG16F;
                break;
            case "RG32F":
                n = e.RG32F;
                break;
            case "RGUI":
                n = e.RGUI;
                break;
            case "RGB8":
                n = e.RGB8;
                break;
            case "SRGB8":
                n = e.SRGB8;
                break;
            case "RGB565":
                n = e.RGB565;
                break;
            case "R11FG11FB10F":
                n = e.R11F_G11F_B10F;
                break;
            case "RGB9E5":
                n = e.RGB9_E5;
                break;
            case "RGB16F":
                n = e.RGB16F;
                break;
            case "RGB32F":
                n = e.RGB32F;
                break;
            case "RGB8UI":
                n = e.RGB8UI;
                break;
            case "RGBA8":
                n = e.RGBA8;
                break;
            case "SRGB8A8":
                n = e.SRGB8_APLHA8;
                break;
            case "RGB5A1":
                n = e.RGB5_A1;
                break;
            case "RGBA4":
                n = e.RGBA4444;
                break;
            case "RGBA16F":
                n = e.RGBA16F;
                break;
            case "RGBA32F":
                n = e.RGBA32F;
                break;
            case "RGBA8UI":
                n = e.RGBA8UI;
                break;
            default:
                throw new Error("Unsupported 3d or 2d array texture format: " + t)
        }
        return n
    }, i.getGLPixelDataType = function(e, t) {
        return i.getGLDataType(e, t)
    }, i.warnDataTypeNotSupported = function(e, t, n) {
        console.warn("Texture format " + e + " requires " + t + " extension (WebGL 1), which is not available on this platform. Using " + n + " as the texture format instead.")
    }, i.getGLDataType = function(e, t) {
        var n = void 0;
        if (c.default.Webgl2) switch (t) {
            case "Float":
            case "Double":
                n = e.FLOAT;
                break;
            case "Byte":
                n = e.BYTE;
                break;
            case "UnsignedByte":
                n = e.UNSIGNED_BYTE;
                break;
            case "Short":
                n = e.SHORT;
                break;
            case "UnsignedShort":
                n = e.UNSIGNED_SHORT;
                break;
            case "Int":
                n = e.INT;
                break;
            case "UnsignedInt":
                n = e.UNSIGNED_INT;
                break;
            case "UnsignedShort565":
                n = e.UNSIGNED_SHORT_5_6_5;
                break;
            case "UnsignedShort4444":
                n = e.UNSIGNED_SHORT_4_4_4_4;
                break;
            case "UnsignedShort5551":
                n = e.UNSIGNED_SHORT_5_5_5_1;
                break;
            case "HalfFloat":
                n = e.HALF_FLOAT;
                break;
            case "UnsignedInt2101010Rev":
                n = e.UNSIGNED_INT_2_10_10_10_REV;
                break;
            case "UnsignedInt10F11F11FRev":
                n = e.UNSIGNED_INT_10F_11F_11F_REV;
                break;
            case "UnsignedInt5999Rev":
                n = e.UNSIGNED_INT_5_9_9_9_REV;
                break;
            case "UnsignedInt248":
                n = e.UNSIGNED_INT_24_8;
                break;
            default:
                throw new Error("Unknown datatype: " + t)
        } else switch (t) {
            case "UnsignedByte":
                n = e.UNSIGNED_BYTE;
                break;
            case "UnsignedShort565":
                n = e.UNSIGNED_SHORT_5_6_5;
                break;
            case "UnsignedShort4444":
                n = e.UNSIGNED_SHORT_4_4_4_4;
                break;
            case "UnsignedShort5551":
                n = e.UNSIGNED_SHORT_5_5_5_1;
                break;
            case "Float":
            case "Double":
                c.default.TextureFloat ? n = e.FLOAT : (i.warnDataTypeNotSupported(t, "OES_texture_float", "UNSIGNED_BYTE"), n = e.UNSIGNED_BYTE);
                break;
            case "UnsignedShort":
                c.default.DepthTexture ? n = e.UNSIGNED_SHORT : (i.warnDataTypeNotSupported(t, "WEBGL_depth_texture", "UNSIGNED_BYTE"), n = e.UNSIGNED_BYTE);
                break;
            case "UnsignedInt":
                c.default.DepthTexture ? n = e.UNSIGNED_INT : (i.warnDataTypeNotSupported(t, "WEBGL_depth_texture", "UNSIGNED_BYTE"), n = e.UNSIGNED_BYTE);
                break;
            case "UnsignedInt248":
                c.default.DepthTexture ? n = c.default.DepthTexture.UNSIGNED_INT_24_8_WEBGL : (i.warnDataTypeNotSupported(t, "WEBGL_depth_texture", "UNSIGNED_BYTE"), n = e.UNSIGNED_BYTE);
                break;
            case "HalfFloat":
                if (c.default.TextureHalfFloat) n = c.default.TextureHalfFloat.HALF_FLOAT_OES;
                else {
                    var r = c.default.TextureFloat ? "FLOAT" : "UNSIGNED_BYTE";
                    i.warnDataTypeNotSupported(t, "OES_texture_half_float", r), n = c.default.TextureFloat ? e.FLOAT : e.UNSIGNED_BYTE
                }
                break;
            case "UnsignedInt2101010Rev":
            case "UnsignedInt10F11F11FRev":
            case "UnsignedInt5999Rev":
            case "Byte":
            case "Short":
                console.warn("Texture format " + t + " is not supported on WebGL 1.0. Using UNSIGNED_BYTE as the texture format instead."), n = e.UNSIGNED_BYTE;
                break;
            default:
                throw new Error("Unknown datatype: " + t)
        }
        return void 0 == n && (console.error("Requested glInternalFormat " + t + " returning an undefined glDataType."), n = e.UNSIGNED_BYTE), n
    }, i.getTextureFilterFallBack = function(e, t) {
        return function(e) {
            if (c.default.Webgl2 || c.default.TextureFloatLinear) return e;
            switch (e) {
                case "Bilinear":
                    return "NearestNeighbor";
                case "BilinearNoMipMaps":
                    return "NearestNeighborNoMipMaps";
                case "Trilinear":
                    return "NearestNeighborLinearMipMap";
                case "BilinearNearestMipMap":
                    return "NearestNeighborNearestMipMap";
                default:
                    return e
            }
        }(function(e, t) {
            if (t) return e;
            if (c.default.Webgl2) return "Trilinear" === e ? "BilinearNoMipMaps" : e;
            switch (e) {
                case "NearestNeighborNoMipMaps":
                case "NearestNeighborNearestMipMap":
                case "NearestNeighborLinearMipMap":
                    return "NearestNeighborNoMipMaps";
                case "BilinearNoMipMaps":
                case "Trilinear":
                case "BilinearNearestMipMap":
                    return "BilinearNoMipMaps";
                default:
                    return e
            }
        }(e, t))
    }, i.getSamplerFilterFallBack = function(e) {
        if (!window.chrome) return e;
        switch (e) {
            case "NearestNeighborNoMipMaps":
            case "NearestNeighborNearestMipMap":
            case "NearestNeighborLinearMipMap":
                return "NearestNeighborNoMipMaps";
            case "BilinearNoMipMaps":
            case "Trilinear":
            case "BilinearNearestMipMap":
                return "BilinearNoMipMaps";
            default:
                return e
        }
    }, i.getTextureWrapFallBack = function(e, t) {
        return t || c.default.Webgl2 ? e : "EdgeClamp"
    }, i.getGLMagFilter = function(e, t) {
        var n = void 0;
        switch (t) {
            case "Bilinear":
                n = e.LINEAR;
                break;
            case "NearestNeighbor":
                n = e.NEAREST;
                break;
            default:
                throw new Error("Invalid MagnificationFilter type: " + t)
        }
        return n
    }, i.getGLMinFilter = function(e, t) {
        var n = void 0;
        switch (t) {
            case "BilinearNoMipMaps":
                n = e.LINEAR;
                break;
            case "Trilinear":
                n = e.LINEAR_MIPMAP_LINEAR;
                break;
            case "BilinearNearestMipMap":
                n = e.LINEAR_MIPMAP_NEAREST;
                break;
            case "NearestNeighborNoMipMaps":
                n = e.NEAREST;
                break;
            case "NearestNeighborNearestMipMap":
                n = e.NEAREST_MIPMAP_NEAREST;
                break;
            case "NearestNeighborLinearMipMap":
                n = e.NEAREST_MIPMAP_LINEAR;
                break;
            default:
                throw new Error("Invalid MinificationFilter type: " + t)
        }
        return n
    }, i.getGLTextureCompMode = function(e, t) {
        var n = void 0;
        switch (t) {
            case "None":
                n = e.NONE;
                break;
            case "CompareRefToTexture":
                n = e.COMPARE_REF_TO_TEXTURE;
                break;
            default:
                throw new Error("Invalid texture compare mode: " + t)
        }
        return n
    }, i.getGLTextureCompFunc = function(e, t) {
        var n = void 0;
        switch (t) {
            case "LEqual":
                n = e.LEQUAL;
                break;
            case "GEqual":
                n = e.GEQUAL;
                break;
            case "Less":
                n = e.LESS;
                break;
            case "Greater":
                n = e.GREATER;
                break;
            case "Equal":
                n = e.EQUAL;
                break;
            case "NotEqual":
                n = e.NOTEQUAL;
                break;
            case "Always":
                n = e.ALWAYS;
                break;
            case "Never":
                n = e.NEVER;
                break;
            default:
                throw new Error("Invalid texture compare function: " + t)
        }
        return n
    }, i.getGLBufferTarget = function(e, t) {
        return "ElementArrayBuffer" === t ? e.ELEMENT_ARRAY_BUFFER : e.ARRAY_BUFFER
    }, i.getGLArrayType = function(e, t) {
        var n = null;
        return t instanceof Uint8Array ? n = e.UNSIGNED_BYTE : t instanceof Uint16Array ? n = e.UNSIGNED_SHORT : t instanceof Uint32Array ? n = e.UNSIGNED_INT : t instanceof Int8Array ? n = e.UNSIGNED_BYTE : t instanceof Int16Array ? n = e.UNSIGNED_SHORT : t instanceof Int32Array && (n = e.UNSIGNED_INT), n
    }, i.getGLByteSize = function(e) {
        return e.BYTES_PER_ELEMENT || 1
    }, i.getGLCubeMapFace = function(e, t) {
        var n = void 0;
        switch (t) {
            case "PositiveX":
                n = e.TEXTURE_CUBE_MAP_POSITIVE_X;
                break;
            case "NegativeX":
                n = e.TEXTURE_CUBE_MAP_NEGATIVE_X;
                break;
            case "PositiveY":
                n = e.TEXTURE_CUBE_MAP_POSITIVE_Y;
                break;
            case "NegativeY":
                n = e.TEXTURE_CUBE_MAP_NEGATIVE_Y;
                break;
            case "PositiveZ":
                n = e.TEXTURE_CUBE_MAP_POSITIVE_Z;
                break;
            case "NegativeZ":
                n = e.TEXTURE_CUBE_MAP_NEGATIVE_Z;
                break;
            default:
                throw new Error("Invalid cubemap face: " + t)
        }
        return n
    }, i.getGLBufferUsage = function(e, t) {
        var n = void 0;
        switch (t) {
            case "StaticDraw":
                n = e.STATIC_DRAW;
                break;
            case "DynamicDraw":
                n = e.DYNAMIC_DRAW;
                break;
            case "StreamDraw":
                n = e.STREAM_DRAW;
                break;
            default:
                n = e.STATIC_DRAW
        }
        return n
    }, i.getGLIndexMode = function(e, t) {
        var n = void 0;
        switch (t) {
            case "Triangles":
                n = e.TRIANGLES;
                break;
            case "TriangleStrip":
                n = e.TRIANGLE_STRIP;
                break;
            case "TriangleFan":
                n = e.TRIANGLE_FAN;
                break;
            case "Lines":
                n = e.LINES;
                break;
            case "LineStrip":
                n = e.LINE_STRIP;
                break;
            case "LineLoop":
                n = e.LINE_LOOP;
                break;
            case "Points":
                n = e.POINTS;
                break;
            default:
                n = e.TRIANGLES
        }
        return n
    }, i.getGLDepthFunc = function(e, t) {
        var n = void 0;
        switch (t) {
            case "Never":
                n = e.NEVER;
                break;
            case "Always":
                n = e.ALWAYS;
                break;
            case "Less":
                n = e.LESS;
                break;
            case "LessEqual":
                n = e.LEQUAL;
                break;
            case "Equal":
                n = e.EQUAL;
                break;
            case "GreaterEqual":
                n = e.GEQUAL;
                break;
            case "Greater":
                n = e.GREATER;
                break;
            case "NotEqual":
                n = e.NOTEQUAL;
                break;
            default:
                n = e.LEQUAL
        }
        return n
    }, i.getGLBlendParam = function(e, t) {
        var n = void 0;
        switch (t) {
            case "AddEquation":
                n = e.FUNC_ADD;
                break;
            case "SubtractEquation":
                n = e.FUNC_SUBTRACT;
                break;
            case "ReverseSubtractEquation":
                n = e.FUNC_REVERSE_SUBTRACT;
                break;
            case "ZeroFactor":
                n = e.ZERO;
                break;
            case "OneFactor":
                n = e.ONE;
                break;
            case "SrcColorFactor":
                n = e.SRC_COLOR;
                break;
            case "OneMinusSrcColorFactor":
                n = e.ONE_MINUS_SRC_COLOR;
                break;
            case "SrcAlphaFactor":
                n = e.SRC_ALPHA;
                break;
            case "OneMinusSrcAlphaFactor":
                n = e.ONE_MINUS_SRC_ALPHA;
                break;
            case "DstAlphaFactor":
                n = e.DST_ALPHA;
                break;
            case "OneMinusDstAlphaFactor":
                n = e.ONE_MINUS_DST_ALPHA;
                break;
            case "DstColorFactor":
                n = e.DST_COLOR;
                break;
            case "OneMinusDstColorFactor":
                n = e.ONE_MINUS_DST_COLOR;
                break;
            case "SrcAlphaSaturateFactor":
                n = e.SRC_ALPHA_SATURATE;
                break;
            default:
                throw new Error("Unknown blend param: " + t)
        }
        return n
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(0),
        c = r(f),
        d = n(30),
        h = r(d),
        p = n(5),
        m = r(p),
        y = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n.type = "CameraComponent", n.camera = e, n.leftVec = new c.default(-1, 0, 0), n.upVec = new c.default(0, 1, 0), n.dirVec = new c.default(0, 0, -1), n._transformUpdatedListener = null, n._transformDirty = !0, Object.seal(n), n
            }
            return a(t, e), s(t, [{
                key: "setUpVector",
                value: function(e) {
                    0 === e ? (this.leftVec.setDirect(0, -1, 0), this.upVec.setDirect(1, 0, 0), this.dirVec.setDirect(0, 0, -1)) : 2 === e ? (this.leftVec.setDirect(-1, 0, 0), this.upVec.setDirect(0, 0, 1), this.dirVec.setDirect(0, -1, 0)) : (this.leftVec.setDirect(-1, 0, 0), this.upVec.setDirect(0, 1, 0), this.dirVec.setDirect(0, 0, -1))
                }
            }, {
                key: "attached",
                value: function() {
                    var e = this;
                    this.entity.on("transformUpdated", this._transformUpdatedListener = function() {
                        e._transformDirty = !0
                    })
                }
            }, {
                key: "detached",
                value: function() {
                    this.entity.off("transformUpdated", this._transformUpdatedListener), this._transformUpdatedListener = null
                }
            }, {
                key: "updateCamera",
                value: function(e) {
                    //! AT: let's prevent scaling or skewing from spilling in the view(projection) matrix
                    var t = this.leftVec.clone().applyPost(e.rotation),
                        n = this.upVec.clone().applyPost(e.rotation),
                        r = this.dirVec.clone().applyPost(e.rotation),
                        i = new c.default(0, 0, 0);
                    e.matrix.getTranslation(i), this.camera.setFrame(i, t, n, r)
                }
            }, {
                key: "copy",
                value: function(e) {
                    return this.camera.copy(e.camera), this.leftVec.copy(e.leftVec), this.upVec.copy(e.upVec), this.dirVec.copy(e.dirVec), this
                }
            }, {
                key: "clone",
                value: function() {
                    var e = new t(this.camera.clone());
                    return e.leftVec.copy(this.leftVec), e.upVec.copy(this.upVec), e.dirVec.copy(this.dirVec), e
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    if (e instanceof h.default) {
                        var r = new t(e);
                        return n.setComponent(r), !0
                    }
                }
            }]), t
        }(l.default);
    y.type = "CameraComponent", y.prototype.api = {
        //! AT: the component holds no reference to its entity therefore this method could never stay on the component
        setAsMainCamera: function() {
            return m.default.emit("sumerian.setCurrentCamera", {
                camera: this.cameraComponent.camera,
                entity: this
            }), this
        }
    }, t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        u = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        l = n(10),
        f = r(l),
        c = n(0),
        d = r(c),
        h = n(8),
        p = r(h),
        m = n(63),
        y = r(m),
        v = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return e.type = "TransformComponent", e.parent = null, e.children = [], e.transform = new f.default, e.worldTransform = new f.default, e._localTransformDirty = !0, e._worldTransformDirty = !0, Object.seal(e), e
            }
            return a(t, e), u(t, [{
                key: "getTranslation",
                value: function() {
                    return this.sync().transform.translation
                }
            }, {
                key: "getWorldTranslation",
                value: function() {
                    return this.sync().worldTransform.translation
                }
            }, {
                key: "setTranslation",
                value: function() {
                    return this.transform.translation.set(d.default.fromAny.apply(null, arguments)), this.setUpdated(), this
                }
            }, {
                key: "addTranslation",
                value: function() {
                    return this.transform.translation.add(d.default.fromAny.apply(null, arguments)), this.setUpdated(), this
                }
            }, {
                key: "getScale",
                value: function() {
                    return this.sync().transform.scale
                }
            }, {
                key: "getWorldScale",
                value: function() {
                    return this.sync().worldTransform.scale
                }
            }, {
                key: "setScale",
                value: function() {
                    return this.transform.scale.set(d.default.fromAny.apply(null, arguments)), this.setUpdated(), this
                }
            }, {
                key: "getRotationMatrix",
                value: function() {
                    return this.sync().transform.rotation
                }
            }, {
                key: "setRotationMatrix",
                value: function(e) {
                    return this.transform.rotation.copy(e), this.setUpdated(), this
                }
            }, {
                key: "getWorldRotationMatrix",
                value: function() {
                    return this.sync().worldTransform.rotation
                }
            }, {
                key: "getRotation",
                value: function(e) {
                    return e = e || new d.default, this.sync().transform.rotation.toAngles(e)
                }
            }, {
                key: "addRotation",
                value: function() {
                    if (this.getRotation(_), 1 === arguments.length && "object" === s(arguments[0])) {
                        var e = arguments[0];
                        e instanceof d.default ? this.transform.rotation.fromAngles(_.x + e.x, _.y + e.y, _.z + e.z) : 3 === e.length && this.transform.rotation.fromAngles(_.x + e[0], _.y + e[1], _.z + e[2])
                    } else this.transform.rotation.fromAngles(_.x + arguments[0], _.y + arguments[1], _.z + arguments[2]);
                    return this.setUpdated(), this
                }
            }, {
                key: "setRotation",
                value: function() {
                    if (1 === arguments.length && "object" === s(arguments[0])) {
                        var e = arguments[0];
                        e instanceof d.default ? this.transform.rotation.fromAngles(e.x, e.y, e.z) : 3 === e.length && this.transform.rotation.fromAngles(e[0], e[1], e[2])
                    } else this.transform.rotation.fromAngles(arguments[0], arguments[1], arguments[2]);
                    return this.setUpdated(), this
                }
            }, {
                key: "lookAt",
                value: function(e, t) {
                    return 3 === arguments.length ? this.transform.lookAt(new d.default(arguments[0], arguments[1], arguments[2])) : e.transformComponent ? this.transform.lookAt(e.transformComponent.sync().worldTransform.translation, t) : (Array.isArray(e) && (e = d.default.fromArray(e)), Array.isArray(t) && (t = d.default.fromArray(t)), this.transform.lookAt(e, t)), this.setUpdated(), this
                }
            }, {
                key: "setUpdated",
                value: function() {
                    this._worldTransformDirty = this._localTransformDirty = !0
                }
            }, {
                key: "attached",
                value: function(e) {
                    this.entity = e
                }
            }, {
                key: "detached",
                value: function() {
                    this.entity = void 0
                }
            }, {
                key: "attachChild",
                value: function(e, t) {
                    for (var n = this; n;) {
                        if (n === e) return void console.warn("attachChild: An object can't be added as a descendant of itself.");
                        n = n.parent
                    }
                    e.parent && e.parent.detachChild(e), t && (e.sync(), this.sync(), e.transform.multiply(this.worldTransform.invert(), e.transform), e.setUpdated()), e.parent = this, this.children.push(e)
                }
            }, {
                key: "detachChild",
                value: function(e, t) {
                    if (e === this) return void console.warn("detachChild: An object can't be removed from itself.");
                    t && e.transform.copy(e.sync().worldTransform);
                    var n = this.children.indexOf(e); - 1 !== n && (e.parent = null, this.children.splice(n, 1)), e.setUpdated()
                }
            }, {
                key: "updateTransform",
                value: function() {
                    this.transform.update(), this._localTransformDirty = !1, this._worldTransformDirty = !0
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    var r = n.transformComponent;
                    r || (r = new t);
                    var i = !1;
                    if (Array.isArray(e) && 3 === e.length ? (r.transform.translation.setDirect(e[0], e[1], e[2]), i = !0) : e instanceof d.default ? (r.transform.translation.setDirect(e.x, e.y, e.z), i = !0) : "object" === (void 0 === e ? "undefined" : s(e)) && void 0 !== e.x && void 0 !== e.y && void 0 !== e.z ? (r.transform.translation.setDirect(e.x, e.y, e.z), i = !0) : e instanceof f.default && (r.transform = e, i = !0), i) return r.setUpdated(), n.setComponent(r), !0
                }
            }]), t
        }(p.default);
    v.type = "TransformComponent",
        //! AT: can this stay not on the prototype, but on the constructor?
        v.prototype.api = {
            setTranslation: function() {
                return v.prototype.setTranslation.apply(this.transformComponent, arguments), this
            },
            setRotation: function() {
                return v.prototype.setRotation.apply(this.transformComponent, arguments), this
            },
            setScale: function() {
                return v.prototype.setScale.apply(this.transformComponent, arguments), this
            },
            lookAt: function() {
                return v.prototype.lookAt.apply(this.transformComponent, arguments), this
            },
            move: function() {
                return v.prototype.move.apply(this.transformComponent, arguments), this
            },
            getTranslation: function() {
                return v.prototype.getTranslation.apply(this.transformComponent, arguments)
            },
            getRotation: function() {
                return v.prototype.getRotation.apply(this.transformComponent, arguments)
            },
            getScale: function() {
                return v.prototype.getScale.apply(this.transformComponent, arguments)
            },
            addTranslation: function() {
                return v.prototype.addTranslation.apply(this.transformComponent, arguments), this
            },
            addRotation: function() {
                return v.prototype.addRotation.apply(this.transformComponent, arguments), this
            },
            attachChild: function(e, t) {
                return this.transformComponent.attachChild(e.transformComponent, t), this
            },
            detachChild: function(e, t) {
                return this.transformComponent.detachChild(e.transformComponent, t), this
            },
            children: function() {
                return new y.default(this).children()
            },
            parent: function() {
                return new y.default(this).parent()
            },
            traverse: function(e, t) {
                if (t = void 0 !== t ? t : 0, !1 !== e(this, t))
                    for (var n = 0; n < this.transformComponent.children.length; n++) {
                        var r = this.transformComponent.children[n].entity;
                        r.traverse(e, t + 1)
                    }
                return this
            },
            traverseUp: function(e) {
                for (var t = this.transformComponent; !1 !== e(t.entity) && t.parent;) t = t.parent;
                return this
            },
            hide: function() {
                return this._hidden = !0, this.traverse(function(e) {
                    for (var t = 0; t < e._components.length; t++) {
                        var n = e._components[t];
                        "boolean" == typeof n.hidden && (n.hidden = !0)
                    }
                }), this
            },
            show: function() {
                this._hidden = !1;
                for (var e = this; e.transformComponent.parent;)
                    if (e = e.transformComponent.parent.entity, e._hidden) {
                        for (var t = 0; t < this._components.length; t++) {
                            var n = this._components[t];
                            "boolean" == typeof n.hidden && (n.hidden = !0)
                        }
                        return this
                    }
                return this.traverse(function(e) {
                    if (e._hidden) return !1;
                    for (var t = 0; t < e._components.length; t++) {
                        var n = e._components[t];
                        "boolean" == typeof n.hidden && (n.hidden = e._hidden)
                    }
                }), this
            },
            isVisiblyHidden: function() {
                var e = this;
                if (e._hidden) return !0;
                for (; e.transformComponent.parent;)
                    if (e = e.transformComponent.parent.entity, e._hidden) return !0;
                return !1
            },
            isHidden: function() {
                return this._hidden
            }
        }, v.entitySelectionAPI = {
            setTranslation: v.prototype.api.setTranslation,
            setRotation: v.prototype.api.setRotation,
            setScale: v.prototype.api.setScale,
            lookAt: v.prototype.api.lookAt,
            move: v.prototype.api.move,
            addTranslation: v.prototype.api.addTranslation,
            addRotation: v.prototype.api.addRotation,
            hide: v.prototype.api.hide,
            show: v.prototype.api.show
        };
    var _ = new d.default;
    v.prototype.move = function() {
        var e = new d.default;
        return function() {
            var t = d.default.fromAny.apply(null, arguments);
            return this.transform.applyForwardVector(t, e), this.addTranslation(e), this
        }
    }(), v.prototype.updateWorldTransform = function() {
        var e = {
            type: "transformUpdated"
        };
        return function() {
            this._localTransformDirty && this.updateTransform();
            var t = this.worldTransform,
                n = this.transform;
            this.parent ? t.multiply(this.parent.worldTransform, n) : t.copy(n), t.updateNormalMatrix();
            var r = this.entity;
            r && r.fire(e), this._worldTransformDirty = !1
        }
    }(), v.prototype.sync = function() {
        var e = [];
        return function() {
            for (var t = this; null !== t;) e.push(t), t = t.parent;
            for (var n = !1, r = e.length - 1; r >= 0; r--) {
                var i = e[r];
                if (i._worldTransformDirty || n) {
                    n = !0, i.updateWorldTransform();
                    for (var o = i.children, a = o.length; a--;) o[a]._worldTransformDirty = !0
                }
            }
            return e.length = 0, this
        }
    }(), t.default = v
}, function(e, t, n) {
    "use strict";

    function r() {
        this.opaqueSorter = function(e, t) {
            var n = e.meshRendererComponent.materials[0].shader,
                r = t.meshRendererComponent.materials[0].shader;
            return null === n || null === r ? 0 : n.defineKey === r.defineKey ? e.meshRendererComponent._renderDistance - t.meshRendererComponent._renderDistance : r.defineKey < n.defineKey ? -1 : r.defineKey > n.defineKey ? 1 : 0
        }, this.transparentSorter = function(e, t) {
            return t.meshRendererComponent._renderDistance - e.meshRendererComponent._renderDistance
        }, this.bucketSorter = function(e, t) {
            return e - t
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i),
        a = [],
        s = new o.default;
    r.prototype.sort = function(e, t) {
        var n = 0,
            i = {};
        a.length = 0;
        for (var o = 0, u = e.length; o < u; o++) {
            var l = e[o],
                f = l.meshRendererComponent;
            if (f && 0 !== f.materials.length) {
                var c = f.materials[0].getRenderQueue(),
                    d = 0,
                    h = f.worldBound;
                null !== h ? d = s.set(t.translation).sub(h.center).lengthSquared() : l.transformComponent && (d = s.set(t.translation).sub(l.transformComponent.worldTransform.translation).lengthSquared()), f._renderDistance = d;
                var p = i[c];
                p || (p = [], i[c] = p, a.push(c)), p.push(l)
            } else e[n] = l, n++
        }
        a.length > 1 && a.sort(this.bucketSorter);
        for (var m = 0, y = a.length; m < y; m++) {
            var v = a[m],
                _ = i[v],
                g = _.length;
            g > 1 && v >= 0 && (v < r.TRANSPARENT ? _.sort(this.opaqueSorter) : _.sort(this.transparentSorter));
            for (var b = 0; b < g; b++) e[n] = _[b], n++
        }
    }, r.BACKGROUND = 0, r.OPAQUE = 1e3, r.TRANSPARENT = 2e3, r.OVERLAY = 3e3, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(69),
        h = r(d),
        p = n(63),
        m = r(p),
        y = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e._type = "VRCameraRigComponent", e._display = null, e._displayId = null, e._resolutionMultiplier = 1, e._displayType = "all", e._onlyShowWhenPresenting = !0, e._loadGamepads = !0, e._startAtCurrentCamera = !0, e._currentVR = !1, e._trackingLevel = "eye", Object.seal(e), e
            }
            return a(t, e), s(t, [{
                key: "setAsMainCameraRig",
                value: function() {
                    c.default.emit(h.default.SET_CURRENT_VR, {
                        data: this._data,
                        entity: this.entity
                    })
                }
            }, {
                key: "releaseMainCameraRig",
                value: function() {
                    c.default.emit(h.default.RELEASE_CURRENT_VR, {
                        entity: this.entity
                    })
                }
            }, {
                key: "clone",
                value: function() {
                    var e = new t;
                    return e.copy(this), e
                }
            }, {
                key: "copy",
                value: function(e) {
                    return this.updateVRCameraRig(e.display), this
                }
            }, {
                key: "updateVRCameraRig",
                value: function(e, t) {
                    null === e ? (this._display = null, this._displayId = null) : "all" === this.displayType && (this._display = e, this._displayId = e.displayId), this._resolutionMultiplier = t;
                    var n = this.findVRCamera();
                    n && (n.hMDCameraComponent.updateData(this._display), n.hMDCameraComponent.vrCamRig = this)
                }
            }, {
                key: "findVRCamera",
                value: function() {
                    return new m.default(this.entity).children().children().top.find(function(e) {
                        return e.hMDCameraComponent
                    })
                }
            }, {
                key: "api",
                get: function() {
                    return {
                        //! AT: the component holds no reference to its entity therefore this method could never stay on the component
                        setAsMainCameraRig: function() {
                            return c.default.emit(h.default.SET_CURRENT_VR, {
                                data: this._data,
                                entity: this
                            }), this
                        }
                    }
                }
            }, {
                key: "type",
                get: function() {
                    return this._type
                }
            }, {
                key: "display",
                get: function() {
                    return this._display
                }
            }, {
                key: "displayId",
                get: function() {
                    return this._displayId
                }
            }, {
                key: "data",
                get: function() {
                    return this._data
                }
            }, {
                key: "displayType",
                get: function() {
                    return this._displayType
                },
                set: function(e) {
                    this._displayType = e
                }
            }, {
                key: "resolutionMultiplier",
                get: function() {
                    return this._resolutionMultiplier
                }
            }, {
                key: "onlyShowWhenPresenting",
                get: function() {
                    return this._onlyShowWhenPresenting
                },
                set: function(e) {
                    this._onlyShowWhenPresenting = e
                }
            }, {
                key: "loadGamepads",
                get: function() {
                    return this._loadGamepads
                },
                set: function(e) {
                    this._loadGamepads = e
                }
            }, {
                key: "isStartAtCurrentCamera",
                get: function() {
                    return this._startAtCurrentCamera
                },
                set: function(e) {
                    this._startAtCurrentCamera = e
                }
            }, {
                key: "isCurrentVR",
                get: function() {
                    return this._currentVR
                },
                set: function(e) {
                    e !== this._currentVR && (this._currentVR = e, e ? this.setAsMainCameraRig() : this.releaseMainCameraRig())
                }
            }, {
                key: "trackingLevel",
                get: function() {
                    return this._trackingLevel
                },
                set: function(e) {
                    this._trackingLevel = e
                }
            }]), t
        }(l.default);
    t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        if (!e.world) throw new Error("World argument cannot be null");
        if (this._world = e.world, e.ajax) this._ajax = e.ajax;
        else {
            if (!e.rootPath) throw new Error("ajax or rootPath must be defined");
            this._ajax = new l.default(e.rootPath)
        }
        this._objects = new Map, this._handlers = {}
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                var n = [],
                    r = !0,
                    i = !1,
                    o = void 0;
                try {
                    for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t); r = !0);
                } catch (e) {
                    i = !0, o = e
                } finally {
                    try {
                        !r && s.return && s.return()
                    } finally {
                        if (i) throw o
                    }
                }
                return n
            }
            return function(t, n) {
                if (Array.isArray(t)) return t;
                if (Symbol.iterator in Object(t)) return e(t, n);
                throw new TypeError("Invalid attempt to destructure non-iterable instance")
            }
        }(),
        a = n(25),
        s = r(a),
        u = n(116),
        l = r(u),
        f = n(12),
        c = r(f),
        d = n(56),
        h = (r(d), n(17)),
        p = r(h),
        m = n(64),
        y = r(m),
        v = n(3),
        _ = r(v),
        g = n(201),
        b = r(g),
        x = n(203);
    n(20), n(274), n(292), n(293), n(299), n(300), n(301), n(302), n(303), n(304), n(305), n(306), n(143), n(307), n(308), n(309), n(211), n(312), n(314), n(213), n(319), n(320), n(322), n(323), n(713), n(714), i.prototype.preload = function(e, t) {
        this._ajax.prefill(e, t)
    }, i.prototype.clear = function() {
        var e = [];
        for (var t in this._handlers) e.push(this._handlers[t].clear());
        if (this._ajax.clear instanceof Function && this._ajax.clear(), this._world && this._world.sumerianRunner) {
            b.default.clearCache(this._world.sumerianRunner.renderer.context);
            for (var n = 0; n < this._world.sumerianRunner.renderSystems.length; n++) {
                var r = this._world.sumerianRunner.renderSystems[n].lights;
                if (r)
                    for (var i = 0; i < r.length; i++) r[i].destroy(this._world.sumerianRunner.renderer)
            }
            this._world.sumerianRunner.renderer.clearShaderCache()
        }
        return c.default.all(e)
    }, i.prototype.load = function(e, t) {
        t = t || {};
        var n = this._loadObject.bind(this, e, t);
        return !0 === t.preloadBinaries ? this._loadBinariesFromRefs(e, t).then(n) : n()
    }, i.prototype.loadInstance = function(e, t) {
        var n = this;
        t = t || {};
        var r = new Map,
            o = function(e) {
                return r.get(e) || e
            },
            a = new Map,
            s = function(e) {
                return a.get(e) || e
            },
            u = "instance_" + String(w++) + "_",
            l = function(e) {
                var t = a.get(e);
                return t || (t = u + e, r.set(t, e), a.set(e, t)), t
            },
            f = void 0;
        if ("entity" === i.getTypeForRef(e)) {
            var c = function e(r) {
                var o = [];
                return r.components && r.components.transform && r.components.transform.children && i._findRefsInConfig(r.components.transform.children, function(r) {
                    l(r), o.push(n._loadRef(r, t).then(e))
                }), i._findRefsInConfig(r, function(e) {
                    var t = i.getTypeForRef(e);
                    E.has(t) && l(e)
                }), Promise.all(o)
            };
            f = this._loadRef(e, t).then(c)
        } else f = Promise.resolve();
        var d = function(e, t, n) {
            return e !== t && (n = _.default.deepClone(n), n.id && n.id === e && (n.id = t), i._findRefsInConfig(n, function(e, t) {
                t(s(e))
            })), n
        };
        return t._mapRefInstanceToActual = o, t._loadInstanceResource = d, f.then(function() {
            return n.load(l(e), t)
        })
    };
    var w = 1,
        E = new Set(["machine"]);
    i.prototype.update = function(e, t, n) {
        var r = this;
        return n = n || {}, this._ajax.update(e, t).then(function(t) {
            return r._updateObject(e, t, n)
        }).then(null, function(t) {
            throw console.error("Error updating " + e + " " + t), t
        })
    }, i.prototype._loadObject = function(e, t) {
        var n = i.getTypeForRef(e),
            r = this._getHandler(n);
        return r ? r.load(e, t) : this._loadRef(e, t)
    }, i.prototype.remove = function(e) {
        return this._objects.delete(e), this.update(e, null)
    }, i.prototype._updateObject = function(e, t, n) {
        var r = i.getTypeForRef(e),
            o = this._getHandler(r);
        return o ? o.update(e, t, n) : i._isRefTypeInGroup(e, "binary") || "bundle" !== r ? p.default.resolve(t) : (console.warn("No handler for type " + r), p.default.resolve(t))
    }, i.prototype._loadRef = function(e, t) {
        var n = x.metrics.now(),
            r = e;
        return t && t._mapRefInstanceToActual && (e = t._mapRefInstanceToActual(e)), this._ajax.load(e, !!t && t.noCache).then(function(n) {
            return t && t._loadInstanceResource && (n = t._loadInstanceResource(e, r, n)), n
        }).then(function(e) {
            var t = x.metrics.now();
            return x.metrics.objectLoadTime.record(t - n), e
        })
    }, i.prototype._loadBinariesFromRefs = function(e, t) {
        function n(e) {
            function n(n) {
                return o._loadRef(n, t).then(function() {
                    r++, t.progressCallback instanceof Function && t.progressCallback(r, e.length)
                })
            }
            x.metrics.scene.numBinaryObjects = e.length;
            var r = 0;
            return c.default.all(e.map(n))
        }
        if ("string" == typeof e) {
            var r = e;
            e = {}, e[r] = r
        }
        var o = this;
        return function(e) {
            function n(e) {
                return o._loadRef(e, t).then(r)
            }

            function r(e) {
                var t = [];
                if (!0 === e.lazy) return p.default.resolve();
                for (var r = i._getRefsFromConfig(e), o = 0, u = r.length; o < u; o++) {
                    var l = r[o];
                    i._isRefTypeInGroup(l, "asset") && !a.has(l) ? a.add(l) : i._isRefTypeInGroup(l, "json") && !s.has(l) && (s.add(l), t.push(n(l)))
                }
                return c.default.all(t)
            }
            var a = new Set,
                s = new Set;
            return r({
                collectionRefs: e
            }).then(function() {
                return y.default.fromValues(a)
            })
        }(e).then(n)
    }, i.prototype._getHandler = function(e) {
        var t = this._handlers[e];
        if (t) return t;
        var n = s.default.getHandler(e);
        return n ? (this._handlers[e] = new n(this._world, this._loadRef.bind(this), this._updateObject.bind(this), this._loadObject.bind(this)), this._handlers[e]) : null
    };
    var S = function(e) {
        if ("string" != typeof e) return !1;
        var t = e.split(".");
        return t[0] && (40 === t[0].length || 32 === t[0].length) && t[1]
    };
    i._getRefsFromConfig = function(e) {
        var t = [];
        return i._findRefsInConfig(e, function(e) {
            return t.push(e)
        }), t
    }, i._findRefsInConfig = function(e, t) {
        var n = !0,
            r = !1,
            a = void 0;
        try {
            for (var s, u = Object.entries(e)[Symbol.iterator](); !(n = (s = u.next()).done); n = !0) {
                var l = s.value,
                    f = o(l, 2),
                    c = f[0],
                    d = f[1];
                (function(n, r) {
                    var a = n.toLowerCase();
                    if (a.endsWith("refs") && r instanceof Object) {
                        var s = !1,
                            u = !0,
                            l = !1,
                            f = void 0;
                        try {
                            for (var c, d = Object.entries(r)[Symbol.iterator](); !(u = (c = d.next()).done); u = !0) {
                                var h = c.value,
                                    p = o(h, 2),
                                    m = p[0],
                                    y = p[1];
                                ! function(e, n) {
                                    S(n) && (t(n, function(t) {
                                        return r[e] = t
                                    }), s = !0)
                                }(m, y)
                            }
                        } catch (e) {
                            l = !0, f = e
                        } finally {
                            try {
                                !u && d.return && d.return()
                            } finally {
                                if (l) throw f
                            }
                        }
                        if (s) return "continue"
                    }
                    if (a.endsWith("ref") && "thumbnailRef" !== n && S(r)) return t(r, function(t) {
                        return e[n] = t
                    }), "continue";
                    r instanceof Object && "assets" !== n && !(r instanceof Array) && i._findRefsInConfig(r, t)
                })(c, d)
            }
        } catch (e) {
            r = !0, a = e
        } finally {
            try {
                !n && u.return && u.return()
            } finally {
                if (r) throw a
            }
        }
    }, i.getTypeForRef = function(e) {
        return e.substr(e.lastIndexOf(".") + 1).toLowerCase()
    }, i._isRefTypeInGroup = function(e, t) {
        var n = i.getTypeForRef(e);
        return i._isTypeInGroup(n, t)
    }, i._isTypeInGroup = function(e, t) {
        return e && l.default.types[t] && l.default.types[t][e]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.id = t, this._name = e, this._steadyStates = {}, this._currentState = null, this._layerBlender = new p.default, this._transitions = {}, this._transitionStates = {}, this._layerType = i.DEFAULT_LAYER_TYPE, this._additiveBaseInverseTransforms = {}, this._additiveAnimationInitialized = !1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(208),
        a = r(o),
        s = n(296),
        u = r(s),
        l = n(297),
        f = r(l),
        c = n(155),
        d = r(c),
        h = n(298),
        p = r(h),
        m = n(80),
        y = r(m),
        v = n(4),
        _ = r(v),
        g = n(10);
    r(g);
    i.BASE_LAYER_NAME = "-BASE_LAYER-", i.DEFAULT_LAYER_TYPE = "Override", i.prototype.getStates = function() {
        return Object.keys(this._steadyStates)
    }, i.prototype.setState = function(e, t) {
        this._steadyStates[e] = t
    }, i.prototype.setBlendWeight = function(e) {
        this._layerBlender && (this._layerBlender._blendWeight = _.default.clamp(e, 0, 1))
    }, i.prototype.getTransitions = function() {
        var e = void 0;
        if (e = this._currentState ? Object.keys(this._currentState._transitions) : [], this._transitions)
            for (var t in this._transitions) - 1 === e.indexOf(t) && e.push(t);
        return e.sort(), e
    }, i.prototype.update = function(e) {
        this._currentState && this._currentState.update(void 0 !== e ? e : y.default.time)
    }, i.prototype.postUpdate = function() {
        this._currentState && this._currentState.postUpdate()
    }, i.prototype.transitionTo = function(e, t, n) {
        t = void 0 !== t ? t : y.default.time;
        var r = this._currentState,
            i = void 0;
        if (this._steadyStates[e] === r) return !1;
        if (!this._steadyStates[e]) return !1;
        if (r && r._transitions && (i = r._transitions[e] || r._transitions["*"]), !i && this._transitions && (i = this._transitions[e] || this._transitions["*"]), r instanceof d.default && i) {
            var o = this._getTransitionByType(i.type);
            return this._doTransition(o, r, this._steadyStates[e], i, t, n), !0
        }
        if (!r && (i = this._transitions[e])) {
            var o = this._getTransitionByType(i.type);
            if (o) return this._doTransition(o, null, this._steadyStates[e], i, t, n), !0
        }
        return !1
    }, i.prototype._doTransition = function(e, t, n, r, i, o) {
        if (t) {
            e._sourceState = t;
            var a = r.timeWindow || [-1, -1];
            if (!e.isValid(a, i)) return void console.warn("State not in allowed time window");
            t.onFinished = null
        }
        e._targetState = n, e.readFromConfig(r), this.setCurrentState(e, !0, i, o)
    }, i.prototype.setCurrentState = function(e, t, n, r) {
        n = void 0 !== n ? n : y.default.time, this._currentState = e, e && (t && e.resetClips(n), e.onFinished = function() {
            this.setCurrentState(e._targetState || null, !1, void 0, r), e instanceof d.default && r instanceof Function && r(), this.update()
        }.bind(this))
    }, i.prototype.getCurrentState = function() {
        return this._currentState
    }, i.prototype.setCurrentStateById = function(e, t, n, r) {
        var i = this.getStateById(e);
        this.setCurrentState(i, t, n, r)
    }, i.prototype.getStateById = function(e) {
        return this._steadyStates[e]
    }, i.prototype.getStateByName = function(e) {
        for (var t in this._steadyStates) {
            if (this._steadyStates[t]._name === e) return this._steadyStates[t]
        }
    }, i.prototype.setCurrentStateByName = function(e, t, n) {
        if (e) {
            var r = this.getStateByName(e);
            if (r) return this.setCurrentState(r, t, n), !0;
            console.warn("unable to find SteadyState named: " + e)
        }
        return !1
    }, i.prototype.getCurrentSourceData = function() {
        return this._layerBlender ? this._layerBlender.getBlendedSourceData() : this._currentState ? this._currentState.getCurrentSourceData() : null
    }, i.prototype.updateLayerBlending = function(e) {
        this._layerBlender && (this._layerBlender._layerA = e, this._layerBlender._layerB = this)
    }, i.prototype.clearCurrentState = function() {
        this.setCurrentState(null)
    }, i.prototype.resetClips = function(e) {
        this._currentState && this._currentState.resetClips(void 0 !== e ? e : y.default.time)
    }, i.prototype.shiftClipTime = function(e) {
        this._currentState && this._currentState.shiftClipTime(void 0 !== e ? e : 0)
    }, i.prototype.setTimeScale = function(e) {
        this._currentState && this._currentState.setTimeScale(e)
    }, i.prototype._getTransitionByType = function(e) {
        if (this._transitionStates[e]) return this._transitionStates[e];
        var t = void 0;
        switch (e) {
            case "Fade":
                t = new a.default;
                break;
            case "SyncFade":
                t = new u.default;
                break;
            case "Frozen":
                t = new f.default;
                break;
            default:
                console.log("Defaulting to frozen transition type"), t = new f.default
        }
        return this._transitionStates[e] = t
    }, i.prototype.clone = function() {
        var e = new i(this._name);
        for (var t in this._steadyStates) e._steadyStates[t] = this._steadyStates[t].clone(), this._steadyStates[t] === this._currentState && (e._currentState = e._steadyStates[t]);
        for (var t in this._transitions) e._transitions[t] = this._transitions[t];
        for (var t in this._transitionStates) e._transitionStates[t] = new this._transitionStates[t].constructor;
        return e
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        f.default.call(this), this._sourceA = e || null, this._sourceB = t || null, this.blendWeight = n || null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(4),
        a = r(o),
        s = n(111),
        u = r(s),
        l = n(122),
        f = r(l);
    i.prototype = Object.create(f.default.prototype), i.prototype.constructor = i, i.prototype.getSourceData = function() {
        var e = this._sourceA ? this._sourceA.getSourceData() : null,
            t = this._sourceB ? this._sourceB.getSourceData() : null;
        return i.combineSourceData(e, t, this.blendWeight)
    }, i.prototype.setTime = function(e) {
        var t = !1,
            n = !1;
        return this._sourceA && (t = this._sourceA.setTime(e)), this._sourceB && (n = this._sourceB.setTime(e)), t || n
    }, i.prototype.resetClips = function(e) {
        this._sourceA && this._sourceA.resetClips(e), this._sourceB && this._sourceB.resetClips(e)
    }, i.prototype.shiftClipTime = function(e) {
        this._sourceA && this._sourceA.shiftClipTime(e), this._sourceB && this._sourceB.shiftClipTime(e)
    }, i.prototype.setTimeScale = function(e) {
        this._sourceA.setTimeScale(e), this._sourceB.setTimeScale(e)
    }, i.prototype.isActive = function() {
        var e = !1;
        return this._sourceA && (e = e || this._sourceA.isActive()), this._sourceB && (e = e || this._sourceB.isActive()), e
    }, i.combineSourceData = function(e, t, n, r) {
        var o = arguments.length > 4 && void 0 !== arguments[4] && arguments[4];
        if (!t || 0 == n) return e;
        if (!e) return t;
        var a = r || {};
        for (var s in e) {
            var l = e[s],
                f = t[s];
            isNaN(l) ? l instanceof u.default ? f ? a[s] = l.blend(f, n, a[s], o) : a[s] ? a[s].set(l) : a[s] = new l.constructor(l) : a[s] = l : i.blendFloatValues(a, s, n, l, f)
        }
        for (var s in t) a[s] || (a[s] = t[s]);
        return a
    }, i.blendFloatValues = function(e, t, n, r, i) {
        isNaN(i) ? e[t] = r : e[t] = a.default.lerp(n, r[0], i[0])
    }, i.prototype.clone = function() {
        return new i(this._sourceA, this._sourceB, this._blendWeight)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        o.default.call(this), this.id = null, this._name = e, this._transitions = {}, this._sourceTree = null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(210),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.setClipSource = function(e) {
        this._sourceTree = e
    }, r.prototype.update = function(e) {
        this._sourceTree.setTime(e) || this.onFinished && this.onFinished()
    }, r.prototype.getCurrentSourceData = function() {
        return this._sourceTree.getSourceData()
    }, r.prototype.getCurrentLoop = function() {
        return this._sourceTree.currentLoop
    }, r.prototype.resetClips = function(e) {
        o.default.prototype.resetClips.call(this, e), this._sourceTree.resetClips(e)
    }, r.prototype.shiftClipTime = function(e) {
        o.default.prototype.shiftClipTime.call(this, e), this._sourceTree.shiftClipTime(e)
    }, r.prototype.setTimeScale = function(e) {
        this._sourceTree.setTimeScale(e)
    }, r.prototype.clone = function() {
        var e = new r(this._name);
        for (var t in this._transitions) e._transitions[t] = this._transitions[t];
        return e._sourceTree = this._sourceTree.clone(), e
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        o.default.call(this, e), this._jointIndex = e ? e._jointIndex : 0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(111),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.set = function(e) {
        o.default.prototype.set.call(this, e), this._jointIndex = e._jointIndex
    }, r.prototype.blend = function(e, t, n) {
        var i = arguments.length > 3 && void 0 !== arguments[3] && arguments[3],
            a = n;
        return a ? a instanceof r && (a._jointIndex = this._jointIndex) : (a = new r, a._jointIndex = this._jointIndex), o.default.prototype.blend.call(this, e, t, a, i)
    }, r.prototype.clone = function() {
        return new r(this)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.getSmoke = function(e) {
        return e = e || {}, e.scale = void 0 !== e.scale ? e.scale : 1, e.spread = void 0 !== e.spread ? e.spread : 2, e.rate = void 0 !== e.spread ? e.rate : 25, e.velocity = void 0 !== e.velocity ? e.velocity : function(t) {
            var n = t.velocity;
            return n.x = 2 * (Math.random() - .5) * e.spread * e.scale, n.y = 2 * (Math.random() + 4) * e.scale, n.z = 2 * (Math.random() - .5) * e.spread * e.scale, n
        }, e.color = e.color || [0, 0, 0], {
            totalParticlesToSpawn: -1,
            releaseRatePerSecond: e.rate,
            minLifetime: .5,
            maxLifetime: 4,
            getEmissionVelocity: e.velocity,
            timeline: [{
                timeOffset: 0,
                spin: 0,
                mass: 1,
                size: 3 * e.scale,
                color: [e.color[0], e.color[1], e.color[2], 1]
            }, {
                timeOffset: 1,
                size: 6 * e.scale,
                color: [e.color[0], e.color[1], e.color[2], 0]
            }]
        }
    }, r.getFire = function(e) {
        return e = e || {}, e.scale = void 0 !== e.scale ? e.scale : 1, e.spread = void 0 !== e.spread ? e.spread : 2, e.velocity = void 0 !== e.velocity ? e.velocity : 10, e.startColor = e.startColor || [1, 1, 0], e.endColor = e.endColor || [1, 0, 0], {
            totalParticlesToSpawn: -1,
            releaseRatePerSecond: 30,
            minLifetime: .5,
            maxLifetime: 2,
            getEmissionVelocity: function(t) {
                var n = t.velocity;
                return n.x = 2 * (Math.random() - .5) * e.spread * e.scale, n.y = (Math.random() + 1) * e.velocity * e.scale, n.z = 2 * (Math.random() - .5) * e.spread * e.scale, n
            },
            timeline: [{
                timeOffset: 0,
                spin: 0,
                mass: 1,
                size: 2 * e.scale,
                color: [e.startColor[0], e.startColor[1], e.startColor[2], 0]
            }, {
                timeOffset: .05,
                color: [e.startColor[0], e.startColor[1], e.startColor[2], 1]
            }, {
                timeOffset: .45,
                color: [e.endColor[0], e.endColor[1], e.endColor[2], .8]
            }, {
                timeOffset: .5,
                size: 3 * e.scale,
                color: [0, 0, 0, 0]
            }]
        }
    }, r.getSnow = function(e) {
        return e = e || {}, e.scale = void 0 !== e.scale ? e.scale : 2, e.spread = void 0 !== e.spread ? e.spread : 50, e.velocity = void 0 !== e.velocity ? e.velocity : 3, e.color = e.color || [1, 1, 1], {
            particleCount: 1e3,
            totalParticlesToSpawn: -1,
            releaseRatePerSecond: 50,
            minLifetime: 15,
            maxLifetime: 25,
            getEmissionPoint: function(t) {
                var n = t.position;
                return e.getEmissionPoint(n), n
            },
            getEmissionVelocity: function(t) {
                var n = t.velocity;
                return e.getEmissionVelocity(n), n
            },
            timeline: [{
                timeOffset: 0,
                spin: 0,
                mass: 1,
                size: 1 * e.scale,
                color: [e.color[0], e.color[1], e.color[2], 0]
            }, {
                timeOffset: .05,
                color: [e.color[0], e.color[1], e.color[2], 1]
            }, {
                timeOffset: .7,
                color: [e.color[0], e.color[1], e.color[2], .8]
            }, {
                timeOffset: .25,
                spin: 5,
                size: .5 * e.scale,
                color: [e.color[0], e.color[1], e.color[2], 0]
            }]
        }
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        t.skeletonMap = t.skeletonMap || {
            originals: [],
            clones: []
        };
        var n = t.skeletonMap.originals.indexOf(e),
            r = void 0;
        return -1 === n ? (r = e.clone(), t.skeletonMap.originals.push(e), t.skeletonMap.clones.push(r)) : r = t.skeletonMap.clones[n], r
    }
    //! AT: this is a huge mess
    function a(e, t, n) {
        var r = e.createEntity(t.name);
        r._tags = d.default.cloneSet(t._tags), r._attributes = d.default.cloneMap(t._attributes), r._hidden = t._hidden, r.static = t.static;
        for (var i = 0; i < t._components.length; i++) {
            var s = t._components[i];
            if ("TransformComponent" === s.type) r.transformComponent.transform.copy(s.transform);
            else if ("MeshDataComponent" === s.type) {
                var u = s.clone(n);
                s.currentPose && (u.currentPose = o(s.currentPose, n)), r.setComponent(u)
            } else if ("AnimationComponent" === s.type) {
                var l = s.clone();
                l._skeletonPose = o(s._skeletonPose, n), r.setComponent(l)
            } else s.clone ? r.setComponent(s.clone(n)) : r.setComponent(s)
        }
        for (var f = 0; f < t.transformComponent.children.length; f++) {
            var c = t.transformComponent.children[f],
                h = a(e, c.entity, n);
            r.transformComponent.attachChild(h.transformComponent)
        }
        return n.callback && n.callback(r), r
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(125),
        l = (r(u), n(46)),
        f = r(l),
        c = n(3),
        d = r(c),
        h = function() {
            function e() {
                i(this, e)
            }
            return s(e, null, [{
                key: "clone",
                value: function(e, t, n) {
                    //! AT: why is everything here overridden anyways?
                    return n = n || {}, a(e, t, n)
                }
            }, {
                key: "getRoot",
                value: function(e) {
                    for (; e.transformComponent.parent;) e = e.transformComponent.parent.entity;
                    return e
                }
            }, {
                key: "getTotalBoundingBox",
                value: function(e) {
                    var t = new f.default,
                        n = !0;
                    if (e.traverse(function(e) {
                            if (e.meshRendererComponent)
                                if (n) {
                                    var r = e.meshRendererComponent.worldBound;
                                    r instanceof f.default ? t.copy(r) : (t.center.set(r.center), t.xExtent = t.yExtent = t.zExtent = r.radius), n = !1
                                } else t.merge(e.meshRendererComponent.worldBound)
                        }), n) {
                        var r = e.transformComponent.worldTransform.translation;
                        t = new f.default(r.clone(), .001, .001, .001)
                    }
                    return t
                }
            }]), e
        }();
    h.updateWorldTransform = d.default.warnOnce("EntityUtils.updateWorldTransform is deprecated. Please use entity.transformComponent.sync instead", function(e) {
        e.updateWorldTransform();
        for (var t = 0; t < e.children.length; t++) h.updateWorldTransform(e.children[t])
    }), t.default = h
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.supported = {
        fullscreen: !0,
        pointerLock: !0
    }, r.requestFullScreen = function() {
        !document.fullscreenElement && document.documentElement.requestFullScreen && document.documentElement.requestFullScreen()
    }, r.exitFullScreen = function() {
        document.fullscreenElement && document.cancelFullScreen && document.cancelFullScreen()
    }, r.toggleFullScreen = function() {
        document.fullscreenElement ? document.cancelFullScreen && document.cancelFullScreen() : document.documentElement.requestFullScreen && document.documentElement.requestFullScreen()
    }, r.requestPointerLock = function(e) {
        var t = e || document.documentElement;
        t.requestPointerLock && t.requestPointerLock()
    }, r.exitPointerLock = function() {
        document.exitPointerLock && document.exitPointerLock()
    }, r.togglePointerLock = function(e) {
        document.pointerLockElement ? r.exitPointerLock() : r.requestPointerLock(e)
    };
    var i = [];
    r.addVisibilityChangeListener = function(e) {
        if ("function" == typeof e) {
            for (var t = ["", "ms", "moz", "webkit"], n = void 0, r = void 0, o = 0; o < t.length; o += 1) {
                var a = t[o] + (0 === t[o].length ? "hidden" : "Hidden"),
                    s = t[o] + "visibilitychange";
                if (void 0 !== document[a]) {
                    n = a, r = s;
                    break
                }
            }
            if (void 0 !== document.addEventListener && void 0 !== n) {
                var u = function() {
                    e(document[n] ? !0 : !1)
                };
                i.push({
                    eventName: r,
                    eventListener: u
                }), document.addEventListener(r, u)
            }
        }
    }, r.clearVisibilityChangeListeners = function() {
        i.forEach(function(e) {
            document.removeEventListener(e.eventName, e.eventListener)
        }), i = []
    }, r.initAllShims = function(e) {
        r.initWebGLShims(), r.initAnimationShims(), r.initFullscreenShims(e), r.initPointerLockShims(e)
    }, r.initWebGLShims = function() {
        window.Uint8ClampedArray = window.Uint8ClampedArray || window.Uint8Array
    }, r.initAnimationShims = function() {
        for (var e = 0, t = ["ms", "moz", "webkit", "o"], n = 0; n < t.length && !window.requestAnimationFrame; n += 1) window.requestAnimationFrame = window[t[n] + "RequestAnimationFrame"], window.cancelAnimationFrame = window[t[n] + "CancelAnimationFrame"] || window[t[n] + "CancelRequestAnimationFrame"];
        void 0 === window.requestAnimationFrame && (window.requestAnimationFrame = function(t) {
            var n = Date.now(),
                r = Math.max(0, 16 - (n - e)),
                i = window.setTimeout(function() {
                    t(n + r)
                }, r);
            return e = n + r, i
        }), void 0 === window.cancelAnimationFrame && (window.cancelAnimationFrame = function(e) {
            clearTimeout(e)
        })
    }, r.initFullscreenShims = function(e) {
        function t() {
            var e = document.createEvent("CustomEvent");
            e.initCustomEvent("fullscreenchange", !0, !1, null), document.dispatchEvent(e)
        }

        function n() {
            var e = document.createEvent("CustomEvent");
            e.initCustomEvent("fullscreenerror", !0, !1, null), document.dispatchEvent(e)
        }
        e = e || window;
        var i = (e.HTMLElement || e.Element).prototype;
        if (!Object.hasOwnProperty.call(document, "fullscreenEnabled")) {
            var o = function() {
                return "webkitIsFullScreen" in document ? function() {
                    return document.webkitFullscreenEnabled
                } : "mozFullScreenEnabled" in document ? function() {
                    return document.mozFullScreenEnabled
                } : (r.supported.fullscreen = !1, function() {
                    return !1
                })
            }();
            Object.defineProperty(document, "fullscreenEnabled", {
                enumerable: !0,
                configurable: !1,
                writeable: !1,
                get: o
            })
        }
        if (!Object.hasOwnProperty.call(document, "fullscreenElement")) {
            var a = function() {
                for (var e = ["webkitCurrentFullScreenElement", "webkitFullscreenElement", "mozFullScreenElement"], t = 0; t < e.length; t += 1)
                    if (e[t] in document) return function(t) {
                        return function() {
                            return document[e[t]]
                        }
                    }(t);
                return function() {
                    return null
                }
            }();
            Object.defineProperty(document, "fullscreenElement", {
                enumerable: !0,
                configurable: !1,
                writeable: !1,
                get: a
            })
        }
        document.addEventListener("webkitfullscreenchange", t, !1), document.addEventListener("mozfullscreenchange", t, !1), document.addEventListener("webkitfullscreenerror", n, !1), document.addEventListener("mozfullscreenerror", n, !1), i.requestFullScreen || (i.requestFullScreen = function() {
            return i.msRequestFullscreen ? function() {
                this.msRequestFullscreen()
            } : i.webkitRequestFullscreen ? function() {
                this.webkitRequestFullscreen(e.Element.ALLOW_KEYBOARD_INPUT)
            } : i.webkitRequestFullScreen ? function() {
                this.webkitRequestFullScreen(e.Element.ALLOW_KEYBOARD_INPUT)
            } : i.mozRequestFullScreen ? function() {
                this.mozRequestFullScreen()
            } : function() {}
        }()), document.cancelFullScreen || (document.cancelFullScreen = function() {
            return document.webkitCancelFullScreen || document.mozCancelFullScreen || function() {}
        }())
    }, r.initPointerLockShims = function(e) {
        function t() {
            var e = document.createEvent("CustomEvent");
            e.initCustomEvent("pointerlockchange", !0, !1, null), document.dispatchEvent(e)
        }

        function n() {
            var e = document.createEvent("CustomEvent");
            e.initCustomEvent("pointerlockerror", !0, !1, null), document.dispatchEvent(e)
        }
        e = e || window;
        var i = (e.HTMLElement || e.Element).prototype;
        if (e.MouseEvent) {
            var o = e.MouseEvent.prototype;
            if ("movementX" in o || Object.defineProperty(o, "movementX", {
                    enumerable: !0,
                    configurable: !1,
                    writeable: !1,
                    get: function() {
                        return this.webkitMovementX || this.mozMovementX || 0
                    }
                }), "movementY" in o || Object.defineProperty(o, "movementY", {
                    enumerable: !0,
                    configurable: !1,
                    writeable: !1,
                    get: function() {
                        return this.webkitMovementY || this.mozMovementY || 0
                    }
                }), navigator.pointer || (navigator.pointer = navigator.webkitPointer || navigator.mozPointer), document.addEventListener("webkitpointerlockchange", t, !1), document.addEventListener("webkitpointerlocklost", t, !1), document.addEventListener("mozpointerlockchange", t, !1), document.addEventListener("mozpointerlocklost", t, !1), document.addEventListener("webkitpointerlockerror", n, !1), document.addEventListener("mozpointerlockerror", n, !1), !("pointerLockElement" in document)) {
                var a = function() {
                    return "webkitPointerLockElement" in document ? function() {
                        return document.webkitPointerLockElement
                    } : "mozPointerLockElement" in document ? function() {
                        return document.mozPointerLockElement
                    } : function() {
                        return null
                    }
                }();
                Object.defineProperty(document, "pointerLockElement", {
                    enumerable: !0,
                    configurable: !1,
                    writeable: !1,
                    get: a
                })
            }
            i.requestPointerLock || (i.requestPointerLock = function() {
                return i.webkitRequestPointerLock ? function() {
                    this.webkitRequestPointerLock()
                } : i.mozRequestPointerLock ? function() {
                    this.mozRequestPointerLock()
                } : navigator.pointer ? function() {
                    navigator.pointer.lock(this, t, n)
                } : (r.supported.pointerLock = !1, function() {})
            }()), document.exitPointerLock || (document.exitPointerLock = function() {
                return document.webkitExitPointerLock || document.mozExitPointerLock || function() {
                    navigator.pointer && navigator.pointer.unlock()
                }
            }())
        }
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }

    function s() {
        return "undefined" != typeof window && window.sumerian || {}
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var u = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        l = n(8),
        f = r(l),
        c = n(5),
        d = r(c),
        h = n(76),
        p = r(h),
        m = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n.type = "ScriptComponent", n.wasSetup = !1, e instanceof Array ? n.scripts = e : n.scripts = e ? [e] : [], Object.seal(n), n
            }
            return a(t, e), u(t, [{
                key: "setup",
                value: function(e) {
                    for (var t = e._world.getSystem("ScriptSystem"), n = 0; n < this.scripts.length; n++) {
                        var r = this.scripts[n];
                        if (!r.context && (r.context = t.makeScriptContext(e), r.parameters || (r.parameters = {}), void 0 !== r.parameters.enabled ? r.enabled = r.parameters.enabled : r.enabled = !0, r.setup && r.enabled)) try {
                            r.setup(r.parameters, r.context, s())
                        } catch (e) {
                            this._handleError(r, e, "setup")
                        }
                    }
                    this.wasSetup = !0
                }
            }, {
                key: "run",
                value: function(e) {
                    for (var t = 0; t < this.scripts.length; t++) {
                        var n = this.scripts[t];
                        if (n && n.run && (void 0 === n.enabled || n.enabled)) try {
                            n.run(e, e._world.tpf, n.context, n.parameters)
                        } catch (e) {
                            this._handleError(n, e, "run")
                        } else if (n.update && (void 0 === n.enabled || n.enabled)) try {
                            n.update(n.parameters, n.context, s())
                        } catch (e) {
                            this._handleError(n, e, "update")
                        }
                    }
                }
            }, {
                key: "lateRun",
                value: function() {
                    for (var e = 0; e < this.scripts.length; e++) {
                        var t = this.scripts[e];
                        if (t.lateUpdate && (void 0 === t.enabled || t.enabled)) try {
                            t.lateUpdate(t.parameters, t.context, s())
                        } catch (e) {
                            this._handleError(t, e, "lateUpdate")
                        }
                    }
                }
            }, {
                key: "fixedUpdate",
                value: function() {
                    for (var e = 0; e < this.scripts.length; e++) {
                        var t = this.scripts[e];
                        if (t.fixedUpdate && (void 0 === t.enabled || t.enabled)) try {
                            t.fixedUpdate(t.parameters, t.context, s())
                        } catch (e) {
                            this._handleError(t, e, "fixedUpdate")
                        }
                    }
                }
            }, {
                key: "cleanup",
                value: function() {
                    for (var e = 0; e < this.scripts.length; e++) {
                        var t = this.scripts[e];
                        if (t.context) {
                            if (t.cleanup && t.enabled) try {
                                t.cleanup(t.parameters, t.context, s())
                            } catch (e) {
                                this._handleError(t, e, "cleanup")
                            }
                            t.enabled = !1, t.context = null
                        }
                    }
                    this.wasSetup = !1
                }
            }, {
                key: "startScripts",
                value: function() {
                    this.scripts.forEach(function(e) {
                        e.parameters && !1 === e.parameters.enabled ? e.enabled = !1 : e.enabled = !0
                    })
                }
            }, {
                key: "stopScripts",
                value: function() {
                    this.scripts.forEach(function(e) {
                        e.enabled = !1
                    })
                }
            }, {
                key: "_handleError",
                value: function(e, t, n) {
                    e.enabled = !1;
                    var r = {
                        id: e.id,
                        errors: [{
                            message: t.message || t,
                            phase: n
                        }]
                    };
                    if (t instanceof Error) {
                        var i = t.stack.split("\n")[1].match(/(\d+):\d+\)$/);
                        i && (r.line = parseInt(i[1], 10) - 1)
                    }
                    console.error(r.errors[0].message, r), d.default.emit("sumerian.scriptError", r)
                }
            }], [{
                key: "applyOnEntity",
                value: function(e, n) {
                    if (e instanceof Function || e && e.run instanceof Function || e && e.update instanceof Function) {
                        var r = void 0;
                        return n.scriptComponent ? r = n.scriptComponent : (r = new t, n.setComponent(r)), r.scripts.push(e.run instanceof Function || e.update instanceof Function ? e : {
                            run: e
                        }), !0
                    }
                }
            }, {
                key: "clone",
                value: function(e) {
                    var n = new t,
                        r = !0,
                        i = !1,
                        o = void 0;
                    try {
                        for (var a, s = this.scripts[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                            var u = a.value;
                            n.scripts.push(p.default.clone(u))
                        }
                    } catch (e) {
                        i = !0, o = e
                    } finally {
                        try {
                            !r && s.return && s.return()
                        } finally {
                            if (i) throw o
                        }
                    }
                    return n
                }
            }]), t
        }(f.default);
    m.type = "ScriptComponent", t.default = m
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        e = e || {}, this.meshData = e.meshData, this.scale = void 0 !== e.scale ? new u.default(e.scale) : new u.default(1, 1, 1), a.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(82),
        a = r(o),
        s = n(0),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.transform = function(e, t) {
        t.scale.set(this.scale).mul(e.scale)
    }, i.prototype.clone = function() {
        return new i({
            meshData: this.meshData,
            scale: this.scale
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(82),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.transform = function() {}, r.prototype.clone = function() {
        return new r
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        e = e || {}, this.radius = void 0 !== e.radius ? e.radius : .5, this.height = void 0 !== e.height ? e.height : 1, o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(82),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.transform = function(e, t) {
        var n = e.scale;
        t.radius = Math.max(n.x, n.y) * this.radius, t.height = n.z * this.height
    }, r.prototype.clone = function() {
        return new r({
            radius: this.radius,
            height: this.height
        })
    }, t.default = r
}, , , , function(e, t, n) {
    var r = n(19),
        i = n(13).document,
        o = r(i) && r(i.createElement);
    e.exports = function(e) {
        return o ? i.createElement(e) : {}
    }
}, function(e, t, n) {
    var r = n(13),
        i = n(71),
        o = n(84),
        a = n(235),
        s = n(28).f;
    e.exports = function(e) {
        var t = i.Symbol || (i.Symbol = o ? {} : r.Symbol || {});
        "_" == e.charAt(0) || e in t || s(t, e, {
            value: a.f(e)
        })
    }
}, function(e, t, n) {
    var r = n(132)("keys"),
        i = n(83);
    e.exports = function(e) {
        return r[e] || (r[e] = i(e))
    }
}, function(e, t) {
    e.exports = "constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")
}, function(e, t, n) {
    var r = n(53);
    e.exports = Array.isArray || function(e) {
        return "Array" == r(e)
    }
}, function(e, t, n) {
    e.exports = n(13).document && document.documentElement
}, function(e, t, n) {
    var r = n(19),
        i = n(11),
        o = function(e, t) {
            if (i(e), !r(t) && null !== t) throw TypeError(t + ": can't set as prototype!")
        };
    e.exports = {
        set: Object.setPrototypeOf || ("__proto__" in {} ? function(e, t, r) {
            try {
                r = n(72)(Function.call, n(48).f(Object.prototype, "__proto__").set, 2), r(e, []), t = !(e instanceof Array)
            } catch (e) {
                t = !0
            }
            return function(e, n) {
                return o(e, n), t ? e.__proto__ = n : r(e, n), e
            }
        }({}, !1) : void 0),
        check: o
    }
}, function(e, t) {
    e.exports = "\t\n\v\f\r \u2028\u2029\ufeff"
}, function(e, t, n) {
    var r = n(19),
        i = n(173).set;
    e.exports = function(e, t, n) {
        var o, a = t.constructor;
        return a !== n && "function" == typeof a && (o = a.prototype) !== n.prototype && r(o) && i && i(e, o), e
    }
}, function(e, t, n) {
    "use strict";
    var r = n(79),
        i = n(54);
    e.exports = function(e) {
        var t = String(i(this)),
            n = "",
            o = r(e);
        if (o < 0 || o == 1 / 0) throw RangeError("Count can't be negative");
        for (; o > 0;
            (o >>>= 1) && (t += t)) 1 & o && (n += t);
        return n
    }
}, function(e, t) {
    e.exports = Math.sign || function(e) {
        return 0 == (e = +e) || e != e ? e : e < 0 ? -1 : 1
    }
}, function(e, t) {
    var n = Math.expm1;
    e.exports = !n || n(10) > 22025.465794806718 || n(10) < 22025.465794806718 || -2e-17 != n(-2e-17) ? function(e) {
        return 0 == (e = +e) ? e : e > -1e-6 && e < 1e-6 ? e + e * e / 2 : Math.exp(e) - 1
    } : n
}, function(e, t, n) {
    var r = n(79),
        i = n(54);
    e.exports = function(e) {
        return function(t, n) {
            var o, a, s = String(i(t)),
                u = r(n),
                l = s.length;
            return u < 0 || u >= l ? e ? "" : void 0 : (o = s.charCodeAt(u), o < 55296 || o > 56319 || u + 1 === l || (a = s.charCodeAt(u + 1)) < 56320 || a > 57343 ? e ? s.charAt(u) : o : e ? s.slice(u, u + 2) : a - 56320 + (o - 55296 << 10) + 65536)
        }
    }
}, function(e, t, n) {
    "use strict";
    var r = n(84),
        i = n(1),
        o = n(41),
        a = n(40),
        s = n(39),
        u = n(104),
        l = n(181),
        f = n(102),
        c = n(49),
        d = n(23)("iterator"),
        h = !([].keys && "next" in [].keys()),
        p = function() {
            return this
        };
    e.exports = function(e, t, n, m, y, v, _) {
        l(n, t, m);
        var g, b, x, w = function(e) {
                if (!h && e in C) return C[e];
                switch (e) {
                    case "keys":
                    case "values":
                        return function() {
                            return new n(this, e)
                        }
                }
                return function() {
                    return new n(this, e)
                }
            },
            E = t + " Iterator",
            S = "values" == y,
            M = !1,
            C = e.prototype,
            T = C[d] || C["@@iterator"] || y && C[y],
            R = T || w(y),
            A = y ? S ? w("entries") : R : void 0,
            O = "Array" == t ? C.entries || T : T;
        if (O && (x = c(O.call(new e))) !== Object.prototype && (f(x, E, !0), r || s(x, d) || a(x, d, p)), S && T && "values" !== T.name && (M = !0, R = function() {
                return T.call(this)
            }), r && !_ || !h && !M && C[d] || a(C, d, R), u[t] = R, u[E] = p, y)
            if (g = {
                    values: S ? R : w("values"),
                    keys: v ? R : w("keys"),
                    entries: A
                }, _)
                for (b in g) b in C || o(C, b, g[b]);
            else i(i.P + i.F * (h || M), t, g);
        return g
    }
}, function(e, t, n) {
    "use strict";
    var r = n(87),
        i = n(77),
        o = n(102),
        a = {};
    n(40)(a, n(23)("iterator"), function() {
        return this
    }), e.exports = function(e, t, n) {
        e.prototype = r(a, {
            next: i(1, n)
        }), o(e, t + " Iterator")
    }
}, function(e, t, n) {
    var r = n(136),
        i = n(54);
    e.exports = function(e, t, n) {
        if (r(t)) throw TypeError("String#" + n + " doesn't accept regex!");
        return String(i(e))
    }
}, function(e, t, n) {
    var r = n(23)("match");
    e.exports = function(e) {
        var t = /./;
        try {
            "/./" [e](t)
        } catch (n) {
            try {
                return t[r] = !1, !"/./" [e](t)
            } catch (e) {}
        }
        return !0
    }
}, function(e, t, n) {
    var r = n(104),
        i = n(23)("iterator"),
        o = Array.prototype;
    e.exports = function(e) {
        return void 0 !== e && (r.Array === e || o[i] === e)
    }
}, function(e, t, n) {
    "use strict";
    var r = n(28),
        i = n(77);
    e.exports = function(e, t, n) {
        t in e ? r.f(e, t, i(0, n)) : e[t] = n
    }
}, function(e, t, n) {
    var r = n(115),
        i = n(23)("iterator"),
        o = n(104);
    e.exports = n(71).getIteratorMethod = function(e) {
        if (void 0 != e) return e[i] || e["@@iterator"] || o[r(e)]
    }
}, function(e, t, n) {
    "use strict";
    var r = n(35),
        i = n(86),
        o = n(32);
    e.exports = function(e) {
        for (var t = r(this), n = o(t.length), a = arguments.length, s = i(a > 1 ? arguments[1] : void 0, n), u = a > 2 ? arguments[2] : void 0, l = void 0 === u ? n : i(u, n); l > s;) t[s++] = e;
        return t
    }
}, function(e, t, n) {
    "use strict";
    var r = n(105),
        i = n(250),
        o = n(104),
        a = n(43);
    e.exports = n(180)(Array, "Array", function(e, t) {
        this._t = a(e), this._i = 0, this._k = t
    }, function() {
        var e = this._t,
            t = this._k,
            n = this._i++;
        return !e || n >= e.length ? (this._t = void 0, i(1)) : "keys" == t ? i(0, n) : "values" == t ? i(0, e[n]) : i(0, [n, e[n]])
    }, "values"), o.Arguments = o.Array, r("keys"), r("values"), r("entries")
}, function(e, t, n) {
    var r = n(11),
        i = n(42),
        o = n(23)("species");
    e.exports = function(e, t) {
        var n, a = r(e).constructor;
        return void 0 === a || void 0 == (n = r(a)[o]) ? t : i(n)
    }
}, function(e, t, n) {
    var r, i, o, a = n(72),
        s = n(135),
        u = n(172),
        l = n(167),
        f = n(13),
        c = f.process,
        d = f.setImmediate,
        h = f.clearImmediate,
        p = f.MessageChannel,
        m = 0,
        y = {},
        v = function() {
            var e = +this;
            if (y.hasOwnProperty(e)) {
                var t = y[e];
                delete y[e], t()
            }
        },
        _ = function(e) {
            v.call(e.data)
        };
    d && h || (d = function(e) {
        for (var t = [], n = 1; arguments.length > n;) t.push(arguments[n++]);
        return y[++m] = function() {
            s("function" == typeof e ? e : Function(e), t)
        }, r(m), m
    }, h = function(e) {
        delete y[e]
    }, "process" == n(53)(c) ? r = function(e) {
        c.nextTick(a(v, e, 1))
    } : p ? (i = new p, o = i.port2, i.port1.onmessage = _, r = a(o.postMessage, o, 1)) : f.addEventListener && "function" == typeof postMessage && !f.importScripts ? (r = function(e) {
        f.postMessage(e + "", "*")
    }, f.addEventListener("message", _, !1)) : r = "onreadystatechange" in l("script") ? function(e) {
        u.appendChild(l("script")).onreadystatechange = function() {
            u.removeChild(this), v.call(e)
        }
    } : function(e) {
        setTimeout(a(v, e, 1), 0)
    }), e.exports = {
        set: d,
        clear: h
    }
}, function(e, t, n) {
    var r = n(13),
        i = n(190).set,
        o = r.MutationObserver || r.WebKitMutationObserver,
        a = r.process,
        s = r.Promise,
        u = "process" == n(53)(a);
    e.exports = function() {
        var e, t, n, l = function() {
            var r, i;
            for (u && (r = a.domain) && r.exit(); e;) {
                i = e.fn, e = e.next;
                try {
                    i()
                } catch (r) {
                    throw e ? n() : t = void 0, r
                }
            }
            t = void 0, r && r.enter()
        };
        if (u) n = function() {
            a.nextTick(l)
        };
        else if (o) {
            var f = !0,
                c = document.createTextNode("");
            new o(l).observe(c, {
                characterData: !0
            }), n = function() {
                c.data = f = !f
            }
        } else if (s && s.resolve) {
            var d = s.resolve();
            n = function() {
                d.then(l)
            }
        } else n = function() {
            i.call(r, l)
        };
        return function(r) {
            var i = {
                fn: r,
                next: void 0
            };
            t && (t.next = i), e || (e = i, n()), t = i
        }
    }
}, function(e, t, n) {
    "use strict";
    var r = n(13),
        i = n(27),
        o = n(84),
        a = n(141),
        s = n(40),
        u = n(91),
        l = n(14),
        f = n(90),
        c = n(79),
        d = n(32),
        h = n(88).f,
        p = n(28).f,
        m = n(187),
        y = n(102),
        v = r.ArrayBuffer,
        _ = r.DataView,
        g = r.Math,
        b = r.RangeError,
        x = r.Infinity,
        w = v,
        E = g.abs,
        S = g.pow,
        M = g.floor,
        C = g.log,
        T = g.LN2,
        R = i ? "_b" : "buffer",
        A = i ? "_l" : "byteLength",
        O = i ? "_o" : "byteOffset",
        P = function(e, t, n) {
            var r, i, o, a = Array(n),
                s = 8 * n - t - 1,
                u = (1 << s) - 1,
                l = u >> 1,
                f = 23 === t ? S(2, -24) - S(2, -77) : 0,
                c = 0,
                d = e < 0 || 0 === e && 1 / e < 0 ? 1 : 0;
            for (e = E(e), e != e || e === x ? (i = e != e ? 1 : 0, r = u) : (r = M(C(e) / T), e * (o = S(2, -r)) < 1 && (r--, o *= 2), e += r + l >= 1 ? f / o : f * S(2, 1 - l), e * o >= 2 && (r++, o /= 2), r + l >= u ? (i = 0, r = u) : r + l >= 1 ? (i = (e * o - 1) * S(2, t), r += l) : (i = e * S(2, l - 1) * S(2, t), r = 0)); t >= 8; a[c++] = 255 & i, i /= 256, t -= 8);
            for (r = r << t | i, s += t; s > 0; a[c++] = 255 & r, r /= 256, s -= 8);
            return a[--c] |= 128 * d, a
        },
        D = function(e, t, n) {
            var r, i = 8 * n - t - 1,
                o = (1 << i) - 1,
                a = o >> 1,
                s = i - 7,
                u = n - 1,
                l = e[u--],
                f = 127 & l;
            for (l >>= 7; s > 0; f = 256 * f + e[u], u--, s -= 8);
            for (r = f & (1 << -s) - 1, f >>= -s, s += t; s > 0; r = 256 * r + e[u], u--, s -= 8);
            if (0 === f) f = 1 - a;
            else {
                if (f === o) return r ? NaN : l ? -x : x;
                r += S(2, t), f -= a
            }
            return (l ? -1 : 1) * r * S(2, f - t)
        },
        I = function(e) {
            return e[3] << 24 | e[2] << 16 | e[1] << 8 | e[0]
        },
        k = function(e) {
            return [255 & e]
        },
        N = function(e) {
            return [255 & e, e >> 8 & 255]
        },
        L = function(e) {
            return [255 & e, e >> 8 & 255, e >> 16 & 255, e >> 24 & 255]
        },
        B = function(e) {
            return P(e, 52, 8)
        },
        F = function(e) {
            return P(e, 23, 4)
        },
        j = function(e, t, n) {
            p(e.prototype, t, {
                get: function() {
                    return this[n]
                }
            })
        },
        U = function(e, t, n, r) {
            var i = +n,
                o = c(i);
            if (i != o || o < 0 || o + t > e[A]) throw b("Wrong index!");
            var a = e[R]._b,
                s = o + e[O],
                u = a.slice(s, s + t);
            return r ? u : u.reverse()
        },
        V = function(e, t, n, r, i, o) {
            var a = +n,
                s = c(a);
            if (a != s || s < 0 || s + t > e[A]) throw b("Wrong index!");
            for (var u = e[R]._b, l = s + e[O], f = r(+i), d = 0; d < t; d++) u[l + d] = f[o ? d : t - d - 1]
        },
        z = function(e, t) {
            f(e, v, "ArrayBuffer");
            var n = +t,
                r = d(n);
            if (n != r) throw b("Wrong length!");
            return r
        };
    if (a.ABV) {
        if (!l(function() {
                new v
            }) || !l(function() {
                new v(.5)
            })) {
            v = function(e) {
                return new w(z(this, e))
            };
            for (var G, W = v.prototype = w.prototype, H = h(w), X = 0; H.length > X;)(G = H[X++]) in v || s(v, G, w[G]);
            o || (W.constructor = v)
        }
        var Y = new _(new v(2)),
            q = _.prototype.setInt8;
        Y.setInt8(0, 2147483648), Y.setInt8(1, 2147483649), !Y.getInt8(0) && Y.getInt8(1) || u(_.prototype, {
            setInt8: function(e, t) {
                q.call(this, e, t << 24 >> 24)
            },
            setUint8: function(e, t) {
                q.call(this, e, t << 24 >> 24)
            }
        }, !0)
    } else v = function(e) {
        var t = z(this, e);
        this._b = m.call(Array(t), 0), this[A] = t
    }, _ = function(e, t, n) {
        f(this, _, "DataView"), f(e, v, "DataView");
        var r = e[A],
            i = c(t);
        if (i < 0 || i > r) throw b("Wrong offset!");
        if (n = void 0 === n ? r - i : d(n), i + n > r) throw b("Wrong length!");
        this[R] = e, this[O] = i, this[A] = n
    }, i && (j(v, "byteLength", "_l"), j(_, "buffer", "_b"), j(_, "byteLength", "_l"), j(_, "byteOffset", "_o")), u(_.prototype, {
        getInt8: function(e) {
            return U(this, 1, e)[0] << 24 >> 24
        },
        getUint8: function(e) {
            return U(this, 1, e)[0]
        },
        getInt16: function(e) {
            var t = U(this, 2, e, arguments[1]);
            return (t[1] << 8 | t[0]) << 16 >> 16
        },
        getUint16: function(e) {
            var t = U(this, 2, e, arguments[1]);
            return t[1] << 8 | t[0]
        },
        getInt32: function(e) {
            return I(U(this, 4, e, arguments[1]))
        },
        getUint32: function(e) {
            return I(U(this, 4, e, arguments[1])) >>> 0
        },
        getFloat32: function(e) {
            return D(U(this, 4, e, arguments[1]), 23, 4)
        },
        getFloat64: function(e) {
            return D(U(this, 8, e, arguments[1]), 52, 8)
        },
        setInt8: function(e, t) {
            V(this, 1, e, k, t)
        },
        setUint8: function(e, t) {
            V(this, 1, e, k, t)
        },
        setInt16: function(e, t) {
            V(this, 2, e, N, t, arguments[2])
        },
        setUint16: function(e, t) {
            V(this, 2, e, N, t, arguments[2])
        },
        setInt32: function(e, t) {
            V(this, 4, e, L, t, arguments[2])
        },
        setUint32: function(e, t) {
            V(this, 4, e, L, t, arguments[2])
        },
        setFloat32: function(e, t) {
            V(this, 4, e, F, t, arguments[2])
        },
        setFloat64: function(e, t) {
            V(this, 8, e, B, t, arguments[2])
        }
    });
    y(v, "ArrayBuffer"), y(_, "DataView"), s(_.prototype, a.VIEW, !0), t.ArrayBuffer = v, t.DataView = _
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(26),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.isSupported = function() {
        return !!o.default.CompressedTextureS3TC
    }, r.shiftCount = function(e) {
        if (0 === e) return 0;
        for (var t = 0; 0 == (1 & e);)
            if (e >>= 1, ++t > 32) throw new Error("invalid mask!");
        return t
    }, r.isSet = function(e, t) {
        return (e & t) === t
    }, r.getIntFromString = function(e) {
        for (var t = [], n = 0; n < e.length; n++) t[n] = e.charCodeAt(n);
        return r.getIntFromBytes(t)
    }, r.getIntFromBytes = function(e) {
        var t = 0;
        return t |= (255 & e[0]) << 0, e.length > 1 && (t |= (255 & e[1]) << 8), e.length > 2 && (t |= (255 & e[2]) << 16), e.length > 3 && (t |= (255 & e[3]) << 24), t
    }, r.getComponents = function(e) {
        switch (e) {
            case "Alpha":
                return 1;
            case "RGB":
                return 3;
            case "RGBA":
                return 4;
            case "Luminance":
                return 1;
            case "LuminanceAlpha":
                return 2;
            case "PrecompressedDXT1":
            case "PrecompressedDXT1A":
                return 1;
            case "PrecompressedDXT3":
            case "PrecompressedDXT5":
                return 2
        }
        return 0
    }, r.flipDXT = function(e, t, n, i) {
        for (var o = new Uint8Array(e.length), a = t + 3 >> 2, s = n + 3 >> 2, u = 8 * r.getComponents(i), l = 0; l < s; l++)
            for (var f = s - l - 1, c = 0; c < a; c++) {
                var d = (f * a + c) * u,
                    h = (l * a + c) * u;
                switch (i) {
                    case "PrecompressedDXT1":
                    case "PrecompressedDXT1A":
                        o[d + 0] = e[h + 0], o[d + 1] = e[h + 1], o[d + 2] = e[h + 2], o[d + 3] = e[h + 3], o[d + 4] = e[h + 7], o[d + 5] = e[h + 6], o[d + 6] = e[h + 5], o[d + 7] = e[h + 4];
                        break;
                    case "PrecompressedDXT3":
                        o[d + 0] = e[h + 6], o[d + 1] = e[h + 7], o[d + 2] = e[h + 4], o[d + 3] = e[h + 5], o[d + 4] = e[h + 2], o[d + 5] = e[h + 3], o[d + 6] = e[h + 0], o[d + 7] = e[h + 1], o[d + 8] = e[h + 8], o[d + 9] = e[h + 9], o[d + 10] = e[h + 10], o[d + 11] = e[h + 11], o[d + 12] = e[h + 15], o[d + 13] = e[h + 14], o[d + 14] = e[h + 13], o[d + 15] = e[h + 12];
                        break;
                    case "PrecompressedDXT5":
                        o[d + 0] = e[h + 0], o[d + 1] = e[h + 1], r.getBytesFromUInt24(o, d + 5, r.flipUInt24(r.getUInt24(e, h + 2))), r.getBytesFromUInt24(o, d + 2, r.flipUInt24(r.getUInt24(e, h + 5))), o[d + 8] = e[h + 8], o[d + 9] = e[h + 9], o[d + 10] = e[h + 10], o[d + 11] = e[h + 11], o[d + 12] = e[h + 15], o[d + 13] = e[h + 14], o[d + 14] = e[h + 13], o[d + 15] = e[h + 12]
                }
            }
        return o
    }, r.getUInt24 = function(e, t) {
        var n = 0;
        return n |= (255 & e[t + 0]) << 0, n |= (255 & e[t + 1]) << 8, n |= (255 & e[t + 2]) << 16
    }, r.getBytesFromUInt24 = function(e, t, n) {
        e[t + 0] = 255 & n, e[t + 1] = (65280 & n) >> 8, e[t + 2] = (16711680 & n) >> 16
    }, r.ThreeBitMask = 7, r.flipUInt24 = function(e) {
        for (var t = [], n = 0; n < 2; n++) t.push([0, 0, 0, 0]);
        t[0][0] = e & r.ThreeBitMask, e >>= 3, t[0][1] = e & r.ThreeBitMask, e >>= 3, t[0][2] = e & r.ThreeBitMask, e >>= 3, t[0][3] = e & r.ThreeBitMask, e >>= 3, t[1][0] = e & r.ThreeBitMask, e >>= 3, t[1][1] = e & r.ThreeBitMask, e >>= 3, t[1][2] = e & r.ThreeBitMask, e >>= 3, t[1][3] = e & r.ThreeBitMask;
        var i = 0;
        return i |= t[1][0] << 0, i |= t[1][1] << 3, i |= t[1][2] << 6, i |= t[1][3] << 9, i |= t[0][0] << 12, i |= t[0][1] << 15, i |= t[0][2] << 18, i |= t[0][3] << 21
    }, t.default = r
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = n(64),
        i = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(r);
    t.default = i.default
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(66),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i),
        a = new o.default;
    r.pick = function(e, t, n, i) {
        var o = e.entityManager.getEntities();
        return r.pickFromList(e, o, t, n, i)
    }, r.pickFromList = function(e, t, n, r, i) {
        var o = e.sumerianRunner.renderer;
        n.getPickRay(r, i, o.domElement.offsetWidth, o.domElement.offsetHeight, a);
        for (var s = [], u = 0; u < t.length; u++) {
            var l = t[u],
                f = l.meshRendererComponent;
            if (f && f.isPickable) {
                var c = f.worldBound.intersectsRayWhere(a);
                c && c.distances.length && s.push({
                    entity: l,
                    intersection: c
                })
            }
        }
        return s.sort(function(e, t) {
            return e.intersection.distances[0] - t.intersection.distances[0]
        }), s
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {
        this.currentBuffer = {
            ArrayBuffer: {
                buffer: null,
                valid: !1
            },
            ElementArrayBuffer: {
                buffer: null,
                valid: !1
            }
        }, this.currentFrameBuffer = null, this.clippingTestValid = !1, this.clippingTestEnabled = !1, this.clips = [], this.enabledTextures = 0, this.texturesValid = !1, this.currentTextureArraysUnit = 0, this.textureRecord = [], this.usedProgram = null, this.boundAttributes = [], this.enabledAttributes = [], this.newlyEnabledAttributes = [], this.depthRecord = {}, this.cullRecord = {}, this.blendRecord = {}, this.offsetRecord = {}, this.lineRecord = {}, this.pointRecord = {}, this.maxBoundSamplerUnit = -1, this.shaderCache = new Map, this.attributeCache = [], Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.invalidateBuffer = function(e) {
        this.currentBuffer[e].buffer = null, this.currentBuffer[e].valid = !1
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.glSampler = null, e = e || {}, a.default.copyOptions(this, e, {
            wrapS: "Repeat",
            wrapT: "Repeat",
            wrapR: "Repeat",
            magFilter: "Bilinear",
            minFilter: "Trilinear",
            compareFunc: "LEqual",
            compareMode: "None",
            maxLod: 1e3,
            minLod: -1e3
        }), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(3),
        a = r(o),
        s = n(147),
        u = r(s);
    i.prototype.destroy = function(e) {
        this.glSampler && (e.deleteSampler(this.glSampler), this.glSampler = null)
    }, i.prototype.initialize = function(e) {
        e.samplerParameteri(this.glSampler, e.TEXTURE_MIN_FILTER, u.default.getGLMinFilter(e, this.minFilter)), e.samplerParameteri(this.glSampler, e.TEXTURE_MAG_FILTER, u.default.getGLMagFilter(e, this.magFilter)), e.samplerParameteri(this.glSampler, e.TEXTURE_WRAP_S, u.default.getGLWrap(e, this.wrapS)), e.samplerParameteri(this.glSampler, e.TEXTURE_WRAP_T, u.default.getGLWrap(e, this.wrapT)), e.samplerParameteri(this.glSampler, e.TEXTURE_WRAP_R, u.default.getGLWrap(e, this.wrapR)), e.samplerParameteri(this.glSampler, e.TEXTURE_COMPARE_MODE, u.default.getGLTextureCompMode(e, this.compareMode)), e.samplerParameteri(this.glSampler, e.TEXTURE_COMPARE_FUNC, u.default.getGLTextureCompFunc(e, this.compareFunc)), e.samplerParameteri(this.glSampler, e.TEXTURE_MAX_LOD, this.maxLod), e.samplerParameteri(this.glSampler, e.TEXTURE_MIN_LOD, this.minLod)
    }, i.prototype.compareTo = function(e) {
        return this.wrapS === e.wrapS && this.wrapT === e.wrapT && this.wrapR === e.wrapR && this.magFilter === e.magFilter && this.minFilter === e.minFilter && this.compareFunc === e.compareFunc && this.compareMode === e.compareMode && this.minLod === e.minLod && this.maxLod === e.maxLod
    }, i.prototype.clone = function() {
        return new i({
            wrapS: this.wrapS,
            wrapT: this.wrapT,
            wrapR: this.wrapR,
            magFilter: this.magFilter,
            minFilter: this.minFilter,
            compareFunc: this.compareFunc,
            compareMode: this.compareMode,
            maxLod: this.maxLod,
            minLod: this.minLod
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        o = function() {
            function e() {
                r(this, e), this.installedAPI = {}
            }
            return i(e, [{
                key: "applyAPI",
                value: function(e) {
                    var t = this.api;
                    for (var n in t) {
                        if (void 0 !== e[n]) throw new Error("Could not install method " + n + " of " + this.type + " as it is already taken");
                        e[n] = t[n], this.installedAPI[n] = !0
                    }
                }
            }]), e
        }();
    t.default = o
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        c.default.call(this), this.projectionMode = c.default.Perspective, this.injectedProjection = null, this.injectedViewMatrix = null, this.transformMatrix = null, this.screenWidth = null, this.screenHeight = null, this.resolutionWidth = null, this.resolutionHeight = null, this.setProjectionMatrixPerspective(e), this.setViewMatrix(t, n), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = (r(o), n(36)),
        s = (r(a), n(38)),
        u = r(s),
        l = n(118),
        f = (r(l), n(30)),
        c = r(f);
    i.prototype = Object.create(c.default.prototype), i.prototype.constructor = i, i.prototype.setProjectionMode = function(e) {
        console.warn("WebVR camera is not allowed to set to projectionMode: " + e + ". Reset to Perspective"), this.projectionMode = c.default.Perspective
    }, i.prototype.setProjectionMatrixPerspective = function(e) {
        e && e.data && (this.injectedProjection = e.clone(), c.default.prototype.setProjectionMatrixPerspective.call(this, this.injectedProjection))
    }, i.prototype.updateProjectionMatrix = function() {
        null != this.injectedProjection ? this.projection = this.injectedProjection : c.default.prototype.updateProjectionMatrix.call(this)
    }, i.prototype.setViewMatrix = function(e, t) {
        if (t && t.data ? this.transformMatrix = t.clone() : this.transformMatrix = new u.default, e && e.data) {
            var n = new u.default;
            this.injectedViewMatrix = e.clone(), c.default.prototype.setViewMatrix.call(this, n.mul2(this.injectedViewMatrix, this.transformMatrix))
        }
    }, i.prototype.updateModelViewMatrix = function() {
        null != this.injectedViewMatrix ? (this.modelView.setIdentity(), this.modelView.mul2(this.injectedViewMatrix, this.transformMatrix)) : c.default.prototype.updateModelViewMatrix.call(this)
    }, i.prototype.copy = function(e) {
        return this.translation.set(e.translation), this._left.set(e._left), this._up.set(e._up), this._direction.set(e._direction), this.fov = e.fov, this.aspect = e.aspect, this.near = e.near, this.far = e.far, this.left = e.left, this.right = e.right, this.top = e.top, this.bottom = e.bottom, this._frustumLeft = e._frustumLeft, this._frustumRight = e._frustumRight, this._frustumBottom = e._frustumBottom, this._frustumTop = e._frustumTop, this._frustumNear = e._frustumNear, this._frustumFar = e._frustumFar, this.injectedProjection = e.injectedProjection, this.injectedViewMatrix = e.injectedViewMatrix, this.transformMatrix = e.transformMatrix, this.onFrustumChange(), this.onFrameChange(), this
    }, i.prototype.pack = function(e) {
        console.warn("WebVRCamera do not support pack: sceneBounds:" + e)
    }, i.prototype.setToObliqueMatrix = function(e) {
        console.warn("WebVRCamera do not support setToObliqueMatrix: clipPlane:" + e)
    }, i.prototype.clone = function() {
        var e = new i(this.injectedProjection, this.injectedViewMatrix, this.transformMatrix);
        return e.copy(this), e
    }, i.prototype.setRenderSize = function(e, t, n) {
        this.screenWidth = e, this.screenHeight = t;
        var r = n || 1;
        this.resolutionHeight = this.screenHeight * r, this.resolutionWidth = this.screenWidth * r
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var r = arguments[0];
            e = r.nSegments, t = r.radius, n = r.pointiness
        }
        //! AT: in cylinder and cone this is called radialSamples
        this.nSegments = e || 8, this.radius = t || 1, this.pointiness = n || 0;
        var i = a.default.defaultMap([a.default.POSITION, a.default.NORMAL, a.default.TEXCOORD0]);
        a.default.call(this, i, this.nSegments + 1, 3 * this.nSegments), this.indexModes = ["Triangles"], this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(3),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        for (var e = [], t = [], n = [], r = [], i = Math.atan2(this.radius, this.pointiness), o = 2 * Math.PI / this.nSegments, s = 0, u = 0; s < this.nSegments; s++, u += o) e.push(Math.cos(u) * this.radius, Math.sin(u) * this.radius, 0), t.push(Math.cos(u) * Math.cos(i), Math.sin(u) * Math.cos(i), Math.sin(i)), n.push(.5 * Math.cos(u) + .5, .5 * Math.sin(u) + .5), r.push(this.nSegments, s, (s + 1) % this.nSegments);
        return e.push(0, 0, this.pointiness), t.push(0, 0, 1), n.push(.5, .5), this.getAttributeBuffer(a.default.POSITION).set(e), this.getAttributeBuffer(a.default.NORMAL).set(t), this.getAttributeBuffer(a.default.TEXCOORD0).set(n), this.getIndexBuffer().set(r), this
    }, i.prototype.clone = function() {
        return new i(u.default.shallowSelectiveClone(this, ["nSegments", "radius", "pointiness"]))
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}

    function o(e, t) {
        return e + Object.keys(t).map(function(e) {
            return "" + e + t[e]
        }).join("")
    }

    function a(e, t, n) {
        var r = o(e, t),
            i = S.get(r);
        return i || (i = n(), E.push(r), S.set(r, i), E.length > M && (r = E.shift(), S.delete(r)), i)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = n(57),
        u = r(s),
        l = n(59),
        f = r(l),
        c = n(97),
        d = r(c),
        h = n(120),
        p = r(h),
        m = n(202),
        y = r(m),
        v = n(200),
        _ = r(v),
        g = n(290),
        b = r(g),
        x = n(92),
        w = r(x),
        E = [],
        S = new Map,
        M = 100;
    i.createQuad = function(e, t) {
        return t && 1 === t.xExtent && 1 === t.yExtent && 1 === t.tileX && 1 === t.tileY ? t : a("quad", {}, function() {
            return new f.default(1, 1, 1, 1)
        })
    }, i.createBox = function(e, t) {
        e = e || {}, w.default.defaults(e, {
            textureMode: "Uniform"
        });
        return t && 1 === t.xExtent && 1 === t.yExtent && 1 === t.zExtent && 1 === t.tileX && 1 === t.tileY && e.textureMode === t.textureMode.name ? t : a("box", e, function() {
            return new u.default(1, 1, 1, 1, 1, e.textureMode)
        })
    }, i.createSphere = function(e, t) {
        return e = e || {}, w.default.defaults(e, {
            zSamples: 8,
            radialSamples: 8,
            textureMode: "Projected",
            radius: 1
        }), t && e.zSamples === t.zSamples - 1 && e.radialSamples === t.radialSamples && e.textureMode === t.textureMode.name && e.radius === t.radius ? t : a("sphere", e, function() {
            return new d.default(e.zSamples, e.radialSamples, e.radius, e.textureMode)
        })
    }, i.createCylinder = function(e, t) {
        return e = e || {}, w.default.defaults(e, {
            radialSamples: 8,
            radius: 1
        }), t && e.radialSamples === t.radialSamples && e.radius === t.radius ? t : a("cylinder", e, function() {
            return new p.default(e.radialSamples, e.radius)
        })
    }, i.createTorus = function(e, t) {
        return e = e || {}, w.default.defaults(e, {
            radialSamples: 8,
            circleSamples: 12,
            tubeRadius: .2,
            centerRadius: 1
        }), t && e.radialSamples === t._radialSamples && e.circleSamples === t._circleSamples && e.tubeRadius === t._tubeRadius && e.centerRadius === t._centerRadius ? t : a("torus", e, function() {
            return new y.default(e.circleSamples, e.radialSamples, e.tubeRadius, e.centerRadius)
        })
    }, i.createDisk = function(e, t) {
        return e = e || {}, w.default.defaults(e, {
            radialSamples: 8,
            pointiness: 0,
            radius: 1
        }), t && e.radialSamples === t.nSegments && e.pointiness === t.pointiness && e.radius === t.radius ? t : e.pointiness === Math.floor(e.pointiness) ? a("disk", e, function() {
            return new _.default(e.radialSamples, e.radius, e.pointiness)
        }) : new _.default(e.radialSamples, e.radius, e.pointiness)
    }, i.createCone = function(e, t) {
        return e = e || {}, w.default.defaults(e, {
            radialSamples: 8,
            height: 0,
            radius: 1
        }), t && e.radialSamples === t.radialSamples && e.height === t.height && e.radius === t.radius ? t : e.height === Math.floor(e.height) ? a("cone", e, function() {
            return new b.default(e.radialSamples, e.radius, e.height)
        }) : new b.default(e.radialSamples, e.radius, e.height)
    }, i.clearCache = function(e) {
        e && S.forEach(function(t) {
            t.destroy(e)
        }), E.length = 0, S.clear()
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    //! AT: there's a method for doing this exact thing on typed arrays, copyWithin()
    function i(e, t, n) {
        e[3 * n + 0] = e[3 * t + 0], e[3 * n + 1] = e[3 * t + 1], e[3 * n + 2] = e[3 * t + 2]
    }

    function o(e, t, n) {
        e[2 * n + 0] = e[2 * t + 0], e[2 * n + 1] = e[2 * t + 1]
    }

    function a(e, t, n, r) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var i = arguments[0];
            e = i.circleSamples, t = i.radialSamples, n = i.tubeRadius, r = i.centerRadius
        }
        this.circleSamples = void 0 !== e ? e : 8, this.radialSamples = void 0 !== t ? t : 8, this.tubeRadius = void 0 !== n ? n : 1, this.centerRadius = void 0 !== r ? r : 2, this.viewInside = !1;
        var o = u.default.defaultMap([u.default.POSITION, u.default.NORMAL, u.default.TEXCOORD0]),
            a = (this.circleSamples + 1) * (this.radialSamples + 1),
            s = 6 * this.circleSamples * this.radialSamples;
        u.default.call(this, o, a, s), this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = n(6),
        u = r(s),
        l = n(0),
        f = r(l),
        c = n(4),
        d = r(c),
        h = n(3),
        p = r(h);
    a.prototype = Object.create(u.default.prototype), a.prototype.constructor = a, a.prototype.rebuild = function() {
        for (var e = this.getAttributeBuffer(u.default.POSITION), t = this.getAttributeBuffer(u.default.NORMAL), n = this.getAttributeBuffer(u.default.TEXCOORD0), r = this.getIndexBuffer(), a = 1 / this.circleSamples, s = 1 / this.radialSamples, l = 0, c = new f.default, h = new f.default, p = new f.default, m = 0; m < this.circleSamples; m += 1) {
            var y = m * a,
                v = d.default.TWO_PI * y,
                _ = Math.cos(v),
                g = Math.sin(v);
            c.setDirect(_, g, 0), h.copy(c).scale(this.centerRadius);
            for (var b = l, x = 0; x < this.radialSamples; x++) {
                var w = x * s,
                    E = d.default.TWO_PI * w,
                    S = Math.cos(E),
                    M = Math.sin(E);
                p.copy(c).scale(S), p.z += M, p.normalize(), this.viewInside ? (t[3 * l + 0] = -p.x, t[3 * l + 1] = -p.y, t[3 * l + 2] = -p.z) : (t[3 * l + 0] = p.x, t[3 * l + 1] = p.y, t[3 * l + 2] = p.z), p.scale(this.tubeRadius).add(h), e[3 * l + 0] = p.x, e[3 * l + 1] = p.y, e[3 * l + 2] = p.z, n[2 * l + 0] = w, n[2 * l + 1] = y, l++
            }
            i(e, b, l), i(t, b, l), n[2 * l + 0] = 1, n[2 * l + 1] = y, l++
        }
        for (var C = 0; C <= this.radialSamples; C++, l++) i(e, C, l), i(t, C, l), o(n, C, l), n[2 * l + 1] = 1;
        for (var T = 0, R = 0, A = 0; A < this.circleSamples; A += 1) {
            var O = R,
                P = O + 1;
            R += this.radialSamples + 1;
            var D = R,
                I = D + 1;
            for (l = 0; l < this.radialSamples; l++) this.viewInside ? (r[T++] = O++, r[T++] = P, r[T++] = D, r[T++] = P++, r[T++] = I++, r[T++] = D++) : (r[T++] = O++, r[T++] = D, r[T++] = P, r[T++] = P++, r[T++] = D++, r[T++] = I++)
        }
        return this
    }, a.prototype.clone = function() {
        return new a(p.default.shallowSelectiveClone(this, ["circleSamples", "radialSamples", "tubeRadius", "centerRadius"]))
    }, t.default = a
}, function(e, t, n) {
    "use strict";
    var r = this && this.__assign || Object.assign || function(e) {
        for (var t, n = 1, r = arguments.length; n < r; n++) {
            t = arguments[n];
            for (var i in t) Object.prototype.hasOwnProperty.call(t, i) && (e[i] = t[i])
        }
        return e
    };
    t.__esModule = !0;
    var i = n(711),
        o = n(712),
        a = function() {
            function e(e, t, n) {
                this.id = e, this.units = t, this.histogram = n
            }
            return e.prototype.record = function(e) {
                this.histogram.record(e)
            }, e.prototype.getSerializable = function() {
                return r({}, this.histogram.getSerializable(), {
                    id: this.id,
                    units: this.units
                })
            }, e
        }();
    t.NumericMetric = a;
    var s = function() {
        function e() {
            this.fps = e.m(new a("FPS", "count", new o.default(10, 100))), this.objectLoadTime = e.m(new a("objectLoadTime", "ms", new i.default(0, 5e4))), this.scene = new u, this.now = e.getNowPolyfill()
        }
        return e.m = function(t) {
            return e.histograms.push(t), t
        }, e.getNowPolyfill = function() {
            return window.performance && window.performance.now ? performance.now.bind(performance) : Date.now.bind(Date)
        }, e.prototype.getReport = function() {
            var t = this,
                n = e.histograms.filter(function(e) {
                    return e.histogram.cardinality > 0
                }).map(function(e) {
                    return r({}, e.getSerializable(), {
                        packageDate: (new Date).toDateString()
                    }, t.scene)
                });
            return e.histograms.forEach(function(e) {
                return e.histogram.clear()
            }), n
        }, e.histograms = new Array, e
    }();
    t.Metrics = s;
    var u = function() {
        function e() {
            this.numBinaryObjects = 0
        }
        return e
    }();
    t.SceneMetrics = u;
    var l = new s;
    t.metrics = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(4),
        l = r(u),
        f = n(37),
        c = r(f),
        d = n(121),
        h = r(d),
        p = n(5),
        m = r(p),
        y = n(98),
        v = r(y),
        _ = function(e) {
            function t(e, n, r) {
                i(this, t);
                var a = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, n));
                if (a._emoteTransitionDuration = .5, a._gesturer = r, a._emoteLayer = null, a._curEmoteBlendWeight = 0, a._targetEmoteBlendWeight = 0, a._fadeOutTriggerTime = 1 / 0, a._blendWeightDampingStore = new c.default, a._fadeOutTimeCounter = -1, a._emoteLayer = a._animationComponent.layers.find(function(e) {
                        return e._name === t.EMOTE_LAYER_NAME
                    }), !a._emoteLayer) throw new v.default("[Sumerian] Could not find Emote Layer '" + t.EMOTE_LAYER_NAME + "'");
                return a._entityEmoteEventBusName = t.getEmoteEventName(e.id), a._entityEmoteStoppedEventName = t.getEmoteStoppedEventName(e.id), m.default.addListener(a._entityEmoteEventBusName, a.onEmoteEvent = function(e) {
                    if (e && a._emoteLayer) {
                        var t = e.endsWith(".animstate") ? a._emoteLayer.getStateById(e) : a._emoteLayer.getStateByName(e);
                        t ? (a._fadeOutTimeCounter = 0, a._fadeOutTriggerTime = (t._sourceTree._clip._maxTime - t._sourceTree._startTime) * Math.abs(t._sourceTree._clipInstance._loopCount) - a._emoteTransitionDuration, a._emoteLayer.setCurrentState(t, !0, void 0, function() {
                            a._targetEmoteBlendWeight = 0, m.default.emit(a._entityEmoteStoppedEventName)
                        }), a._targetEmoteBlendWeight = 1) : console.warn("[Sumerian] HostComponent: No emote found for '" + e + "'")
                    }
                }), a
            }
            return a(t, e), s(t, null, [{
                key: "getEmoteEventName",
                value: function(e) {
                    return e + t.EMOTE_EVENT_NAME_SUFFIX
                }
            }, {
                key: "getEmoteStoppedEventName",
                value: function(e) {
                    return e + t.EMOTE_STOPPED_EVENT_NAME_SUFFIX
                }
            }]), s(t, [{
                key: "entityDetached",
                value: function() {
                    this.onEmoteEvent && m.default.removeListener(this._entityEmoteEventBusName, this.onEmoteEvent)
                }
            }, {
                key: "process",
                value: function(e) {
                    this._fadeOutTimeCounter >= 0 && (this._fadeOutTimeCounter += e, this._fadeOutTimeCounter >= this._fadeOutTriggerTime && (this._fadeOutTimeCounter = -1, this._targetEmoteBlendWeight = 0)), Math.abs(this._curEmoteBlendWeight - this._targetEmoteBlendWeight) > .01 && (l.default.smoothDamp(this._curEmoteBlendWeight, this._targetEmoteBlendWeight, this._blendWeightDampingStore, e, this._emoteTransitionDuration), this._curEmoteBlendWeight = l.default.clamp(this._blendWeightDampingStore._x, 0, 1), this._emoteLayer && this._emoteLayer.setBlendWeight(this._curEmoteBlendWeight), this._gesturer && (this._gesturer || this._gesturer.setBlendWeight(1 - ths._curEmoteBlendWeight)))
                }
            }]), t
        }(h.default),
        g = function(e, t) {
            Object.defineProperty(_, e, {
                value: t,
                writable: !1,
                enumerable: !0,
                configurable: !1
            })
        };
    g("EMOTE_LAYER_NAME", "__Emote__"), g("EMOTE_EVENT_NAME_SUFFIX", ".emoteEvent"), g("EMOTE_STOPPED_EVENT_NAME_SUFFIX", ".emoteStoppedEvent"), t.default = _
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(121),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(98),
        h = r(d),
        p = function(e) {
            function t(e, n) {
                i(this, t);
                var r = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, n));
                return r._lipSyncLayer = null, r._currentViseme = null, r._initAnimLayersAndStates(), r._entityVisemeEventBusName = e.id + ".visemeEvent", c.default.addListener(r._entityVisemeEventBusName, r.onVisemeEvent = function(e) {
                    if (r._lipSyncLayer && r._currentViseme !== e) {
                        r._currentViseme = e;
                        var t = r._lipSyncLayer.getStateByName(r._currentViseme);
                        t ? r._lipSyncLayer.transitionTo(t.id) : console.warn("[Sumerian] HostComponent: No viseme target found for '" + e + "'")
                    }
                }), r._entityStartSpeakingEventBusName = e.id + t.START_SPEECH_CHANNEL_SUFFIX, c.default.addListener(r._entityStartSpeakingEventBusName, r.onStartSpeakingEvent = function() {
                    r._torsoTalkLayer && r._torsoTalkAnimState && r._torsoTalkLayer.transitionTo(r._torsoTalkAnimState.id)
                }), r._entityStopSpeakingEventBusName = e.id + t.STOP_SPEECH_CHANNEL_SUFFIX, c.default.addListener(r._entityStopSpeakingEventBusName, r.onStopSpeakingEvent = function() {
                    r._torsoTalkLayer && r._torsoStandAnimState && r._torsoTalkLayer.transitionTo(r._torsoStandAnimState.id)
                }), r.onVisemeEvent("sil"), r
            }
            return a(t, e), s(t, [{
                key: "_initAnimLayersAndStates",
                value: function() {
                    if (this._lipSyncLayer = this._animationComponent.layers.find(function(e) {
                            return e._name === t.LIP_SYNC_LAYER_NAME
                        }), !this._lipSyncLayer) throw new h.default("[Sumerian] Could not find Lip Sync Layer '" + t.LIP_SYNC_LAYER_NAME + "'");
                    if (this._torsoTalkLayer = this._animationComponent.layers.find(function(e) {
                            return e._name === t.TORSO_TALK_LAYER_NAME
                        }), !this._torsoTalkLayer) throw new h.default("[Sumerian] Could not find Torso Talk Layer '" + t.TORSO_TALK_LAYER_NAME + "'");
                    if (this._torsoStandAnimState = this._torsoTalkLayer.getStateByName(t.TORSO_STAND_ANIMSTATE_NAME), !this._torsoStandAnimState) throw new h.default("[Sumerian] Could not find expected Standing Torso Animation State '" + t.TORSO_STAND_ANIMSTATE_NAME + "' in AnimLayer '" + t.TORSO_TALK_LAYER_NAME + "'");
                    if (this._torsoTalkAnimState = this._torsoTalkLayer.getStateByName(t.TORSO_TALK_ANIMSTATE_NAME), !this._torsoTalkAnimState) throw new h.default("[Sumerian] Could not find expected Talking Torso Animation State '" + t.TORSO_TALK_ANIMSTATE_NAME + "' in AnimLayer '" + t.TORSO_TALK_LAYER_NAME + "'")
                }
            }, {
                key: "entityDetached",
                value: function() {
                    this.onVisemeEvent && c.default.removeListener(this._entityVisemeEventBusName, this.onVisemeEvent), this.onStartSpeakingEvent && c.default.removeListener(this._entityStartSpeakingEventBusName, this.onStartSpeakingEvent), this.onStopSpeakingEvent && c.default.removeListener(this._entityStopSpeakingEventBusName, this.onStopSpeakingEvent)
                }
            }]), t
        }(l.default),
        m = function(e, t) {
            Object.defineProperty(p, e, {
                value: t,
                writable: !1,
                enumerable: !0,
                configurable: !1
            })
        };
    m("START_SPEECH_CHANNEL_SUFFIX", ".startSpeechEvent"), m("STOP_SPEECH_CHANNEL_SUFFIX", ".stopSpeechEvent"), m("LIP_SYNC_LAYER_NAME", "__LipSync__"), m("TORSO_STAND_ANIMSTATE_NAME", "idle_pose"), m("TORSO_TALK_ANIMSTATE_NAME", "talking_additive"), m("TORSO_TALK_LAYER_NAME", "__TorsoTalk__"), t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(37),
        l = r(u),
        f = n(0),
        c = r(f),
        d = n(4),
        h = r(d),
        p = n(34),
        m = r(p),
        y = n(10),
        v = r(y),
        _ = n(194),
        g = r(_),
        b = n(5),
        x = r(b),
        w = n(207),
        E = r(w),
        S = n(153),
        M = r(S),
        C = n(155),
        T = r(C),
        R = n(156),
        A = r(R),
        O = n(99),
        P = r(O),
        D = n(121),
        I = r(D),
        k = n(98),
        N = r(k),
        L = function(e) {
            function t(e, n, r, a, s) {
                i(this, t);
                var u = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, a));
                return u._initDefaults(), u._initConfig(e), u._initLayerData(), u._initLookAtData(n, r, s), u._initTransformData(a), u._initJointData(), u._setupLayers(), u
            }
            return a(t, e), s(t, [{
                key: "_initDefaults",
                value: function() {
                    var e = this;
                    this._targetTransformComponent = null, this._lookTarget = t.TargetType.Direction, this._faceTarget = t.FaceTargetType.EyesCenter, this._lastMicroSaccadeTime = 0, this._microSaccadeCountDown = 0, this._macroSaccadeCountDown = 0, this._maxHorizontalEyeSpeed = 0, this._maxVerticalEyeSpeed = 0, this._horizontalEyeDuration = 0, this._verticalEyeDuration = 0, this._microSaccadeTarget = new l.default, this._macroSaccadeTarget = new l.default, this._currentHorizontalSpeed = {
                        value: 0
                    }, this._currentVerticalSpeed = {
                        value: 0
                    }, this._currentEyeTarget = new l.default, this._currentBrowTarget = new l.default, this._currentHeadTarget = new l.default, this._eyeLookValues = new l.default, this.events = {}, this._jointNames = {}, this._jointNames.leftEyeName = "def_l_eye", this._jointNames.rightEyeName = "def_r_eye", this._jointNames.neckAName = "def_c_neckA", this._jointNames.neckBName = "def_c_neckB", this._jointNames.eyelidRegEx = /^def_[lr]_(upper|lower)Lid[0-9]+$/, this._jointNames.browRegEx = /^def_[clr]_(foreheadUp|foreheadMid|brow|upEye|noseBridge|temple|underEye|cheekUp|cheekMid|zygomatic)[0-9]*$/, this._poseNames = {}, this._poseNames.lookAnim_u = "look_u", this._poseNames.lookAnim_ur = "look_ur", this._poseNames.lookAnim_r = "look_r", this._poseNames.lookAnim_dr = "look_dr", this._poseNames.lookAnim_d = "look_d", this._poseNames.lookAnim_dl = "look_dl", this._poseNames.lookAnim_l = "look_l", this._poseNames.lookAnim_ul = "look_ul", this._poseNames.lookAnim_neutral = "look_neutral", this._interpolationSpeeds = {}, this._interpolationSpeeds.head = 3.5, this._interpolationSpeeds.eye = 25, this._interpolationSpeeds.brow = 10, this._lookTransformData = {}, Object.values(this._poseNames).forEach(function(t) {
                        return e._lookTransformData[t] = {}
                    }), this._lookBlend2DMap = {}
                }
            }, {
                key: "_initConfig",
                value: function(e) {
                    e && (this._jointNames.leftEyeName = e.leftEyeName || this._jointNames.leftEyeName, this._jointNames.rightEyeName = e.rightEyeName || this._jointNames.rightEyeName, this._jointNames.neckAName = e.neckAName || this._jointNames.neckAName, this._jointNames.neckBName = e.neckBName || this._jointNames.neckBName, this._jointNames.eyelidRegEx = e.eyelidRegEx ? new RegExp(e.eyelidRegEx) : this._jointNames.eyelidRegEx, this._jointNames.browRegEx = e.browRegEx ? new RegExp(e.browRegEx) : this._jointNames.browRegEx, this._poseNames.lookAnim_u = e.lookAnim_u || this._poseNames.lookAnim_u, this._poseNames.lookAnim_ur = e.lookAnim_ur || this._poseNames.lookAnim_ur, this._poseNames.lookAnim_r = e.lookAnim_r || this._poseNames.lookAnim_r, this._poseNames.lookAnim_dr = e.lookAnim_dr || this._poseNames.lookAnim_dr, this._poseNames.lookAnim_d = e.lookAnim_d || this._poseNames.lookAnim_d, this._poseNames.lookAnim_dl = e.lookAnim_dl || this._poseNames.lookAnim_dl, this._poseNames.lookAnim_l = e.lookAnim_l || this._poseNames.lookAnim_l, this._poseNames.lookAnim_ul = e.lookAnim_ul || this._poseNames.lookAnim_ul, this._poseNames.lookAnim_neutral = e.lookAnim_neutral || this._poseNames.lookAnim_neutral, this._interpolationSpeeds.head = e.headRotateSpeed || this._interpolationSpeeds.head, this._interpolationSpeeds.eye = e.eyeRotateSpeed || this._interpolationSpeeds.eye, this._interpolationSpeeds.brow = e.browSpeed || this._interpolationSpeeds.brow), this._lookBlend2DMap[this._poseNames.lookAnim_u] = new l.default(0, 1), this._lookBlend2DMap[this._poseNames.lookAnim_ur] = new l.default(.707, .707), this._lookBlend2DMap[this._poseNames.lookAnim_r] = new l.default(1, 0), this._lookBlend2DMap[this._poseNames.lookAnim_dr] = new l.default(.707, -.707), this._lookBlend2DMap[this._poseNames.lookAnim_d] = new l.default(0, -1), this._lookBlend2DMap[this._poseNames.lookAnim_dl] = new l.default(-.707, -.707), this._lookBlend2DMap[this._poseNames.lookAnim_l] = new l.default(-1, 0), this._lookBlend2DMap[this._poseNames.lookAnim_ul] = new l.default(-.707, .707), this._lookBlend2DMap[this._poseNames.lookAnim_neutral] = new l.default(0, 0)
                }
            }, {
                key: "_initLayerData",
                value: function() {
                    if (this._lookAnimLayer = this._animationComponent.layers.find(function(e) {
                            return e._name === t.LOOK_LAYER_NAME
                        }), !this._lookAnimLayer) throw new N.default("[Sumerian] Host PointOfInterest Error: Could not find expected animLayer '" + t.LOOK_LAYER_NAME + "'")
                }
            }, {
                key: "_initLookAtData",
                value: function(e, t, n) {
                    var r = this;
                    this._pointOfInterestType = e, this.events.setLookAtTarget || (this.events.setLookAtTarget = x.default.makeChannel(t.id + ".setLookAtTarget"), this.onSetLookAtTarget = function(e) {
                        "LookAtEntity" === r._pointOfInterestType && e && (r._targetTransformComponent = e.transformComponent)
                    }, this.events.setLookAtTarget.addListener(this.onSetLookAtTarget)), this.events.setLookAtTarget.emit(n)
                }
            }, {
                key: "_initTransformData",
                value: function(e) {
                    this._hostEntity = e;
                    var t = e.transformComponent,
                        n = this._findParentEntityForSkeletonPose(t, this._animationComponent._skeletonPose);
                    this._parentTransformComponent = n ? n.transformComponent : e.transformComponent
                }
            }, {
                key: "_initJointData",
                value: function() {
                    var e = this;
                    this._eyeNames = [this._jointNames.leftEyeName, this._jointNames.rightEyeName], this._eyeJoints = [];
                    var t = this._animationComponent._skeletonPose._skeleton._joints.find(function(t) {
                        return t._name === e._jointNames.leftEyeName
                    });
                    t && this._eyeJoints.push(t), t = this._animationComponent._skeletonPose._skeleton._joints.find(function(t) {
                        return t._name === e._jointNames.rightEyeName
                    }), t && this._eyeJoints.push(t), this._neckNames = [this._jointNames.neckAName, this._jointNames.neckBName], this._neckJoints = [], t = this._animationComponent._skeletonPose._skeleton._joints.find(function(t) {
                        return t._name === e._jointNames.neckAName
                    }), t && this._neckJoints.push(t), (t = this._animationComponent._skeletonPose._skeleton._joints.find(function(t) {
                        return t._name === e._jointNames.neckBName
                    })) && this._neckJoints.push(t);
                    var n = this.findJoints(this._animationComponent._skeletonPose._skeleton, this._jointNames.eyelidRegEx);
                    this._eyelidNames = n.map(function(e) {
                        return e._name
                    }), n = this.findJoints(this._animationComponent._skeletonPose._skeleton, this._jointNames.browRegEx), this._browNames = n.map(function(e) {
                        return e._name
                    }), this._initLookTransformDataAndLimits(this._eyeNames.concat(this._eyelidNames).concat(this._neckNames).concat(this._browNames))
                }
            }, {
                key: "_initLookTransformDataAndLimits",
                value: function(e) {
                    var t = this;
                    for (var n in this._lookTransformData)
                        for (var r = this._lookAnimLayer.getStateByName(n)._sourceTree._clip, i = r._channels.length; --i >= 0;) {
                            var o = r._channels[i]._channelName.split(":"),
                                a = o[o.length - 1];
                            if (e.indexOf(a) > -1) {
                                var s = new A.default;
                                r._channels[i].getData(0, s), this._lookTransformData[n][a] = s
                            }
                        }
                    var u = [this._poseNames.lookAnim_d, this._poseNames.lookAnim_u, this._poseNames.lookAnim_l, this._poseNames.lookAnim_r],
                        l = [this._jointNames.leftEyeName, this._jointNames.neckAName, this._jointNames.neckBName];
                    u.forEach(function(e) {
                        l.forEach(function(n) {
                            if (void 0 === t._lookTransformData[e][n]) throw new N.default("[Sumerian] Host Point of Interest could not find required joint '" + n + "' for pose '" + e + "'; Point of Interest will be disabled for this host...")
                        })
                    }), this._lastLookLocalH = new c.default(0, 0, 1), this._lastLookLocalV = new c.default(0, 0, 1);
                    var f = new c.default;
                    this._eyeAngles = {}, this._eyeAngles.MinV = this._lookTransformData[this._poseNames.lookAnim_d][this._jointNames.leftEyeName]._rotation.toAngleAxis(f), this._eyeAngles.MinV *= f.getComponent(0), this._eyeAngles.MaxV = this._lookTransformData[this._poseNames.lookAnim_u][this._jointNames.leftEyeName]._rotation.toAngleAxis(f), this._eyeAngles.MaxV *= f.getComponent(0), this._eyeAngles.MinH = this._lookTransformData.look_l[this._jointNames.leftEyeName]._rotation.toAngleAxis(f), this._eyeAngles.MinH *= f.getComponent(1), this._eyeAngles.MaxH = this._lookTransformData[this._poseNames.lookAnim_r][this._jointNames.leftEyeName]._rotation.toAngleAxis(f), this._eyeAngles.MaxH *= f.getComponent(1), this._headAngles = {}, this._neckAngles = {}, this._headAngles.MinV = this._lookTransformData[this._poseNames.lookAnim_d][this._jointNames.neckBName]._rotation.toAngleAxis(f), this._headAngles.MinV *= f.getComponent(0), this._neckAngles.MinV = this._lookTransformData[this._poseNames.lookAnim_d][this._jointNames.neckAName]._rotation.toAngleAxis(f), this._neckAngles.MinV *= f.getComponent(0), this._headAngles.MinV += this._neckAngles.MinV, this._headAngles.MaxV = this._lookTransformData[this._poseNames.lookAnim_u][this._jointNames.neckBName]._rotation.toAngleAxis(f), this._headAngles.MaxV *= f.getComponent(0), this._neckAngles.MaxV = this._lookTransformData[this._poseNames.lookAnim_u][this._jointNames.neckAName]._rotation.toAngleAxis(f), this._neckAngles.MaxV *= f.getComponent(0), this._headAngles.MaxV += this._neckAngles.MaxV, this._headAngles.MinH = this._lookTransformData.look_l[this._jointNames.neckBName]._rotation.toAngleAxis(f), this._headAngles.MinH *= f.getComponent(1), this._neckAngles.MinH = this._lookTransformData.look_l[this._jointNames.neckAName]._rotation.toAngleAxis(f), this._neckAngles.MinH *= f.getComponent(1), this._headAngles.MinH += this._neckAngles.MinH, this._headAngles.MaxH = this._lookTransformData[this._poseNames.lookAnim_r][this._jointNames.neckBName]._rotation.toAngleAxis(f), this._headAngles.MaxH *= f.getComponent(1), this._neckAngles.MaxH = this._lookTransformData[this._poseNames.lookAnim_r][this._jointNames.neckAName]._rotation.toAngleAxis(f), this._neckAngles.MaxH *= f.getComponent(1), this._headAngles.MaxH += this._neckAngles.MaxH, this._lookLimits = {}, this._lookLimits.eyeMinH = Math.min(this._eyeAngles.MinH, this._eyeAngles.MaxH), this._lookLimits.eyeMaxH = Math.max(this._eyeAngles.MinH, this._eyeAngles.MaxH), this._lookLimits.eyeMinV = Math.min(this._eyeAngles.MinV, this._eyeAngles.MaxV), this._lookLimits.eyeMaxV = Math.max(this._eyeAngles.MinV, this._eyeAngles.MaxV), this._lookLimits.headMinH = Math.min(this._headAngles.MinH, this._headAngles.MaxH), this._lookLimits.headMaxH = Math.max(this._headAngles.MinH, this._headAngles.MaxH), this._lookLimits.headMinV = Math.min(this._headAngles.MinV, this._headAngles.MaxV), this._lookLimits.headMaxV = Math.max(this._headAngles.MinV, this._headAngles.MaxV)
                }
            }, {
                key: "_setupLayers",
                value: function() {
                    var e = this._lookAnimLayer.getStateByName(this._poseNames.lookAnim_neutral)._sourceTree._clip;
                    this._namespace = "", this._lookLayer = this.createManagedLayer(e, "Look", this._neckNames.concat(this._eyeNames).concat(this._eyelidNames).concat(this._browNames)), this._lookSource = this._lookLayer.getCurrentState()._sourceTree, this._animationComponent.addLayer(this._lookLayer)
                }
            }, {
                key: "process",
                value: function() {
                    this.trackEyes(), this.updateMacroSaccade(), this.updateMicroSaccade(), this.updateEyeMovement()
                }
            }, {
                key: "entityDetached",
                value: function() {
                    this._animationComponent && this._lookLayer && g.default.remove(this._animationComponent.layers, this._lookLayer), this.events.setLookAtTarget && this.onSetLookAtTarget && this.events.setLookAtTarget.removeListener(this.onSetLookAtTarget)
                }
            }, {
                key: "_findParentEntityForSkeletonPose",
                value: function(e, t) {
                    var n = null;
                    if (e.children.find(function(e) {
                            return e.entity._components && e.entity._components.find(function(e) {
                                return "MeshDataComponent" === e.type && e.currentPose == t
                            })
                        })) n = e.entity;
                    else
                        for (var r = 0; r < e.children.length && !(n = this._findParentEntityForSkeletonPose(e.children[r], t)); r++);
                    return n
                }
            }, {
                key: "findJoints",
                value: function(e, t) {
                    var n = e._joints,
                        r = [];
                    for (var i in n) t.test(n[i]._name) && r.push(n[i]);
                    return r
                }
            }, {
                key: "createManagedLayer",
                value: function(e, t, n) {
                    var r = new E.default("Source " + t),
                        i = [],
                        o = e._channels[0]._channelName.split(":");
                    o.length > 1 && (this._namespace = o.slice(0, o.length - 1).join(":") + ":");
                    for (var a = 0; a < n.length; a++) i.push(this._namespace + n[a]);
                    r.initFromClip(e, "Include", i);
                    var s = new T.default("State " + t);
                    s.setClipSource(r);
                    var u = new M.default("Layer " + t);
                    return u.setState(s), u.setCurrentState(s), u.setBlendWeight(1), u._layerType = "Additive", u
                }
            }, {
                key: "getWorldTransform",
                value: function(e) {
                    for (var t = this._animationComponent, n = e, r = [t._skeletonPose._localTransforms[e._index]]; n._parentIndex != P.default.NO_PARENT;) r.unshift(t._skeletonPose._localTransforms[n._parentIndex]), n = t._skeletonPose._skeleton._joints[n._parentIndex];
                    var i = new v.default;
                    i.copy(this._parentTransformComponent.worldTransform);
                    for (var o = 0; o < r.length; o++) {
                        var a = new v.default;
                        a = i.combine(r[o], i, a), i.copy(a)
                    }
                    return i
                }
            }, {
                key: "getFaceTargetPos",
                value: function(e) {
                    var n = void 0,
                        r = new l.default;
                    switch (e) {
                        case t.FaceTargetType.LeftEye:
                            n = r.lerp(new l.default(.15, 0), .75);
                            break;
                        case t.FaceTargetType.RightEye:
                            n = r.lerp(new l.default(-.15, 0), .75);
                            break;
                        case t.FaceTargetType.Mouth:
                            var i = new l.default(0, 1);
                            n = r.sub(i).scale(.4).scale(.3);
                            break;
                        default:
                            n = new l.default
                    }
                    return n
                }
            }, {
                key: "track",
                value: function(e) {
                    var t = new v.default;
                    e.parentTransform.invert(t);
                    var n = t.clone();
                    n.scale = new c.default(1, 1, 1);
                    var r = new c.default;
                    n.applyForwardVector(e.lookDir, r);
                    var i = new c.default(r.x, 0, r.z),
                        o = new c.default(0, r.y, r.z);
                    0 === i.length() ? this._lastLookLocalH.x > this._lastLookLocalH.z ? i.x = Math.sign(this._lastLookLocalH.x) : i.z = Math.sign(this._lastLookLocalH.z) : i.z < 0 && (i.z = this._lastLookLocalH.z), 0 === o.length() ? this._lastLookLocalV.y > this._lastLookLocalV.z ? o.y = Math.sign(this._lastLookLocalV.y) : o.z = Math.sign(this._lastLookLocalV.z) : o.z < 0 && (o.z = i.z), this._lastLookLocalH.copy(i), this._lastLookLocalV.copy(o);
                    var a = new c.default,
                        s = new m.default;
                    s.fromVectorToVector(c.default.UNIT_Z, i);
                    var u = s.toAngleAxis(a);
                    u = h.default.clamp(u * a.y, e.lookMinH, e.lookMaxH);
                    var f = new m.default;
                    f.fromVectorToVector(c.default.UNIT_Z, o);
                    var d = f.toAngleAxis(a);
                    d = h.default.clamp(d * a.x, e.lookMinV, e.lookMaxV);
                    var p = 0,
                        y = 0;
                    return p = h.default.logicalXOR(d < 0, d - e.lookAngleMinV <= 0) ? e.lookAngleMinV ? -1 * Math.abs(d / e.lookAngleMinV) : 0 : e.lookAngleMaxV ? Math.abs(d / e.lookAngleMaxV) : 0, y = h.default.logicalXOR(u < 0, u - e.lookAngleMinH <= 0) ? e.lookAngleMinH ? -1 * Math.abs(u / e.lookAngleMinH) : 0 : e.lookAngleMaxH ? Math.abs(u / e.lookAngleMaxH) : 0, new l.default(y, p)
                }
            }, {
                key: "trackBrows",
                value: function(e, t) {
                    if (Math.abs(e) > .4) {
                        e = (e - .4 * (e / Math.abs(e))) / .6
                    } else e = 0;
                    if (Math.abs(t) > .4) {
                        t = (t - .4 * (t / Math.abs(t))) / .6
                    } else t = 0;
                    this.blend2D(e, t, this._interpolationSpeeds.brow, this._browNames)
                }
            }, {
                key: "trackEyes",
                value: function() {
                    if (this._targetTransformComponent) {
                        var e = this._animationComponent,
                            t = e._skeletonPose._skeleton._joints[this._eyeJoints[0]._parentIndex],
                            n = this.getWorldTransform(t),
                            r = this.getWorldTransform(this._eyeJoints[0]),
                            i = this.getWorldTransform(this._eyeJoints[1]),
                            o = r.translation.clone().add(i.translation).scale(.5),
                            a = this._targetTransformComponent.getWorldTranslation().clone().sub(o);
                        a.normalize();
                        var s = {
                            parentTransform: n,
                            lookDir: a,
                            lookMinH: this._lookLimits.eyeMinH,
                            lookMaxH: this._lookLimits.eyeMaxH,
                            lookMinV: this._lookLimits.eyeMinV,
                            lookMaxV: this._lookLimits.eyeMaxV,
                            lookAngleMinH: this._eyeAngles.MinH,
                            lookAngleMaxH: this._eyeAngles.MaxH,
                            lookAngleMinV: this._eyeAngles.MinV,
                            lookAngleMaxV: this._eyeAngles.MaxV
                        };
                        this._eyeLookValues.copy(this.track(s))
                    }
                }
            }, {
                key: "trackHead",
                value: function() {
                    if (this._targetTransformComponent) {
                        var e = this._animationComponent,
                            t = e._skeletonPose._skeleton._joints[this._neckJoints[0]._parentIndex],
                            n = this.getWorldTransform(t),
                            r = this.getWorldTransform(this._eyeJoints[0]),
                            i = this.getWorldTransform(this._eyeJoints[1]),
                            o = r.translation.clone().add(i.translation).scale(.5),
                            a = this._targetTransformComponent.getWorldTranslation().clone().sub(o);
                        a.normalize();
                        var s = {
                                parentTransform: n,
                                lookDir: a,
                                lookMinH: this._lookLimits.headMinH,
                                lookMaxH: this._lookLimits.headMaxH,
                                lookMinV: this._lookLimits.headMinV,
                                lookMaxV: this._lookLimits.headMaxV,
                                lookAngleMinH: this._headAngles.MinH,
                                lookAngleMaxH: this._headAngles.MaxH,
                                lookAngleMinV: this._headAngles.MinV,
                                lookAngleMaxV: this._headAngles.MaxV
                            },
                            u = this.track(s);
                        this.blend2D(u.x, u.y, this._interpolationSpeeds.head, this._neckNames)
                    }
                }
            }, {
                key: "setMacroSaccade",
                value: function(e, t) {
                    this._macroSaccadeTarget.x = this._currentEyeTarget.x + e, this._macroSaccadeTarget.y = this._currentEyeTarget.y + t, this._lastMicroSaccadeTime = this._hostEntity._world.time, this.setMicroSaccade(this._macroSaccadeTarget.x, this._macroSaccadeTarget.y), this._microSaccadeCountDown += .75
                }
            }, {
                key: "updateMacroSaccade",
                value: function() {
                    if (this._macroSaccadeCountDown -= this._hostEntity._world.tpf, this._macroSaccadeCountDown <= 0) {
                        if (this._lookTarget == t.TargetType.Direction) {
                            var e = (h.default.degFromRad(Math.abs(this._lookLimits.eyeMinV)) + h.default.degFromRad(Math.abs(this._lookLimits.eyeMaxV))) / 2,
                                n = h.default.randomInRange(6.5 / e, 6.5 / (.5 * e)),
                                r = h.default.randomInRange(-n, n),
                                i = (h.default.degFromRad(Math.abs(this._lookLimits.eyeMinH)) + h.default.degFromRad(Math.abs(this._lookLimits.eyeMaxH))) / 2,
                                o = h.default.randomInRange(10 / i, 10 / (.5 * i)),
                                a = h.default.randomInRange(-o, o);
                            this.setMacroSaccade(a, r), this._macroSaccadeCountDown = h.default.randomInRange(5, 8)
                        } else if (this._lookTarget == TargetType.Face) switch (this._faceTarget) {
                            case t.FaceTargetType.LeftEye:
                                this._faceTarget = Math.random() < .75 ? t.FaceTargetType.RightEye : t.FaceTargetType.Mouth;
                                break;
                            case t.FaceTargetType.RightEye:
                                this._faceTarget = Math.random() < .75 ? t.FaceTargetType.LeftEye : t.FaceTargetType.Mouth;
                                break;
                            case t.FaceTargetType.Mouth:
                            case t.FaceTargetType.EyesCenter:
                                this._faceTarget = Math.random() < .5 ? t.FaceTargetType.LeftEye : t.FaceTargetType.RightEye
                        }
                        var s = this.getFaceTargetPos(this._faceTarget);
                        this.setMacroSaccade(s.x, s.y), this._faceTarget == t.FaceTargetType.Mouth ? this._macroSaccadeCountDown = h.default.randomInRange(.4, .9) : this._macroSaccadeCountDown = h.default.randomInRange(1.5, 4)
                    }
                }
            }, {
                key: "setMicroSaccade",
                value: function(e, t) {
                    var n = this._currentEyeTarget.x + e,
                        r = this._currentEyeTarget.y + t,
                        i = e > 0 ? e * h.default.degFromRad(this._lookLimits.eyeMaxH) : e * h.default.degFromRad(this._lookLimits.eyeMinH),
                        o = t > 0 ? t * h.default.degFromRad(this._lookLimits.eyeMaxV) : t * h.default.degFromRad(this._lookLimits.eyeMinV),
                        a = Math.abs(this.deltaAngle(0, i)),
                        s = Math.abs(this.deltaAngle(0, o));
                    this._maxHorizontalEyeSpeed = 473 * (1 - Math.exp(-a / 7.8)), this._maxVerticalEyeSpeed = 473 * (1 - Math.exp(-s / 7.8));
                    var u = .00235;
                    this._horizontalEyeDuration = .025 + u * a, this._verticalEyeDuration = .025 + u * s, this._microSaccadeTarget.x = n, this._microSaccadeTarget.y = r, this._microSaccadeCountDown = h.default.randomInRange(.8, 1.75), this._microSaccadeCountDown *= .714285714285714
                }
            }, {
                key: "updateMicroSaccade",
                value: function() {
                    if ((this._lookTarget === t.TargetType.Direction || this._lookTarget === t.TargetType.Object || this._lookTarget === t.TargetType.Face) && (this._microSaccadeCountDown -= this._hostEntity._world.tpf, this._microSaccadeCountDown <= 0)) {
                        var e = h.default.randomInRange(3 / 35, 3 / 17.5),
                            n = h.default.randomInRange(-e, e),
                            r = h.default.randomInRange(-e, e);
                        this._lookTarget === t.TargetType.Face && (n *= .5, r *= .5), this.setMicroSaccade(r, n)
                    }
                }
            }, {
                key: "updateEyeMovement",
                value: function() {
                    var e = h.default.smoothDamp(this._eyeLookValues.x, this._eyeLookValues.x + this._microSaccadeTarget.x, this._currentHorizontalSpeed, this._hostEntity._world.tpf, this._horizontalEyeDuration, this._maxHorizontalEyeSpeed),
                        t = h.default.smoothDamp(this._eyeLookValues.y, this._eyeLookValues.y + this._microSaccadeTarget.y, this._currentVerticalSpeed, this._hostEntity._world.tpf, this._verticalEyeDuration, this._maxVerticalEyeSpeed);
                    this.blend2D(e, t, this._interpolationSpeeds.eye, this._eyeNames.concat(this._eyelidNames)), this.trackBrows(this._eyeLookValues.x, this._eyeLookValues.y), (Math.abs(this._eyeLookValues.x) > .5 || Math.abs(this._eyeLookValues.y) > .5) && this.trackHead(), this._eyeLookValues.setDirect(e, t)
                }
            }, {
                key: "deltaAngle",
                value: function(e, t) {
                    var n = t - e,
                        r = n - 360 * Math.floor(n / 360);
                    return r = Math.max(0, Math.min(360, r)), r > 180 && (r -= 360), r
                }
            }, {
                key: "interpolateLookLayerJoint",
                value: function(e, t, n) {
                    var r = new c.default;
                    this._lookSource.getTranslation(e, r), r = r.lerp(t._translation, n), this._lookSource.setTranslation(e, r);
                    var i = new m.default;
                    this._lookSource.getRotation(e, i), i = i.slerp(t._rotation, n), this._lookSource.setRotation(e, i);
                    var o = new c.default;
                    this._lookSource.getScale(e, o), o = o.lerp(t._scale, n), this._lookSource.setScale(e, o)
                }
            }, {
                key: "getBlend2DLookDirection",
                value: function(e) {
                    for (var t = Object.keys(this._lookBlend2DMap), n = null, r = 0; r < t.length; r++)
                        if (e.equals(this._lookBlend2DMap[t[r]])) {
                            n = t[r];
                            break
                        }
                    if (!n) throw "Unable to determine direction in HostPointOfInterest.getBlend2DLookDirection()";
                    return n
                }
            }, {
                key: "blend2D",
                value: function(e, t, n, r) {
                    var i = Math.sign(e),
                        o = Math.sign(t),
                        a = new l.default(e, t),
                        s = void 0,
                        u = Math.min(this._hostEntity._world.tpf * n, 1);
                    if (i && o) {
                        a.normalize();
                        var f = new l.default(i, o),
                            c = this.getBlend2DLookDirection(f.clone().scale(.707)),
                            d = h.default.degFromRad(Math.acos(a.dotDirect(i, 0))),
                            p = new l.default(i, 0);
                        d > 45 && (p.setDirect(0, o), d = 90 - d), a = new l.default(e, t);
                        var m = this.getBlend2DLookDirection(p),
                            y = 1 - a.length();
                        s = d / 45;
                        for (var v in r) {
                            var _ = r[v],
                                g = new A.default;
                            this._lookTransformData[m][_].blend(this._lookTransformData[c][_], s, g);
                            var b = new A.default;
                            g.blend(this._lookTransformData[this._poseNames.lookAnim_neutral][_], y, b), _ = this._namespace + _, this.interpolateLookLayerJoint(_, b, u)
                        }
                    } else {
                        s = a.length();
                        var x = this.getBlend2DLookDirection(new l.default(i, o));
                        for (var w in r) {
                            var E = r[w],
                                S = new A.default;
                            this._lookTransformData[this._poseNames.lookAnim_neutral][E].blend(this._lookTransformData[x][E], s, S), E = this._namespace + E, this.interpolateLookLayerJoint(E, S, u)
                        }
                    }
                }
            }]), t
        }(I.default);
    Object.defineProperty(L, "TargetType", {
        writable: !1,
        enumerable: !0,
        configurable: !1,
        value: {
            Face: 0,
            Object: 1,
            Direction: 2,
            StraightAhead: 3
        }
    }), Object.defineProperty(L, "FaceTargetType", {
        writable: !1,
        enumerable: !0,
        configurable: !1,
        value: {
            EyesCenter: 0,
            LeftEye: 1,
            RightEye: 2,
            Mouth: 3
        }
    }), Object.defineProperty(L, "LOOK_LAYER_NAME", {
        writable: !1,
        enumerable: !0,
        configurable: !1,
        value: "__POI__"
    }), t.default = L
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        d.default.call(this), this._sourceName = e || null, this._data = {}
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(111),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(34),
        f = r(l),
        c = n(122),
        d = r(c);
    i.prototype = Object.create(d.default.prototype), i.prototype.constructor = i, i.prototype.setTranslation = function(e, t) {
        var n = this._data[e];
        n instanceof a.default && n._translation.set(t)
    }, i.prototype.getTranslation = function(e, t) {
        var n = this._data[e];
        return n instanceof a.default && (t = t || new u.default, t.set(n._translation)), t
    }, i.prototype.setScale = function(e, t) {
        var n = this._data[e];
        n instanceof a.default && n._scale.set(t)
    }, i.prototype.getScale = function(e, t) {
        var n = this._data[e];
        return n instanceof a.default && (t = t || new u.default, t.set(n._scale)), t
    }, i.prototype.setRotation = function(e, t) {
        var n = this._data[e];
        n instanceof a.default && n._rotation.set(t)
    }, i.prototype.getRotation = function(e, t) {
        var n = this._data[e];
        return n instanceof a.default && (t = t || new f.default, t.set(n._rotation)), t
    }, i.prototype.initFromClip = function(e, t, n) {
        if ("Include" === t && n && n.length)
            for (var r = 0, i = n.length; r < i; r++) {
                var o = n[r],
                    a = e.findChannelByName(o);
                if (a) {
                    var s = a.getData(0);
                    this._data[o] = s
                } else console.error("Channel not in clip: " + o)
            } else
                for (var r = 0, i = e._channels.length; r < i; r++) {
                    var a = e._channels[r],
                        o = a._channelName;
                    if ("Exclude" === t && n && n.length && n.indexOf(o) > -1) {
                        var s = a.getData(0);
                        this._data[o] = s
                    }
                }
    }, i.prototype.getChannelData = function(e) {
        return this._data[e]
    }, i.prototype.getSourceData = function() {
        return this._data
    }, i.prototype.clone = function() {
        var e = {};
        for (var t in this._data) e[t] = this._data[t].clone();
        return new i(this._sourceName, e)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(209),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.update = function(e) {
        o.default.prototype.update.call(this, e), this._sourceState && this._sourceState.update(e), this._targetState && this._targetState.update(e)
    }, r.prototype.getCurrentLoop = function() {
        return this._targetState.getCurrentLoop()
    }, r.prototype.postUpdate = function() {
        this._sourceState && this._sourceState.postUpdate(), this._targetState && this._targetState.postUpdate()
    }, r.prototype.resetClips = function(e) {
        o.default.prototype.resetClips.call(this, e), this._targetState && this._targetState.resetClips(e)
    }, r.prototype.shiftClipTime = function(e) {
        o.default.prototype.shiftClipTime.call(this, e), this._targetState && this._targetState.shiftClipTime(e), this._sourceState && this._sourceState.shiftClipTime(e)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.call(this), this._sourceState = null, this._targetState = null, this._percent = 0, this._sourceData = null, this._fadeTime = 0, this._blendType = i.BLENDTYPES.LINEAR
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(210),
        a = r(o),
        s = n(154),
        u = r(s),
        l = n(4),
        f = r(l);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.BLENDTYPES = {}, i.BLENDTYPES.LINEAR = "Linear", i.BLENDTYPES.CUBIC = "SCurve3", i.BLENDTYPES.QUINTIC = "SCurve5", i.prototype.getCurrentLoop = function() {
        return 0
    }, i.prototype.update = function(e) {
        var t = e - this._globalStartTime;
        if (t > this._fadeTime && this.onFinished) return void this.onFinished();
        var n = t / this._fadeTime;
        switch (this._blendType) {
            case i.BLENDTYPES.CUBIC:
                this._percent = f.default.scurve3(n);
                break;
            case i.BLENDTYPES.QUINTIC:
                this._percent = f.default.scurve5(n);
                break;
            default:
                this._percent = n
        }
    }, i.prototype.readFromConfig = function(e) {
        e && (void 0 !== e.fadeTime && (this._fadeTime = e.fadeTime), void 0 !== e.blendType && (this._blendType = e.blendType))
    }, i.prototype.getCurrentSourceData = function() {
        var e = this._sourceState ? this._sourceState.getCurrentSourceData() : null,
            t = this._targetState ? this._targetState.getCurrentSourceData() : null;
        return this._sourceData || (this._sourceData = {}), u.default.combineSourceData(e, t, this._percent, this._sourceData)
    }, i.prototype.isValid = function(e, t) {
        var n = t - this._sourceState._globalStartTime,
            r = e[0],
            i = e[1];
        return r <= 0 ? i <= 0 || n <= i : i <= 0 ? n >= r : r <= i ? r <= n && n <= i : n >= r || n <= i
    }, i.prototype.resetClips = function(e) {
        a.default.prototype.resetClips.call(this, e), this._percent = 0
    }, i.prototype.shiftClipTime = function(e) {
        a.default.prototype.shiftClipTime.call(this, e)
    }, i.prototype.setTimeScale = function(e) {
        this._sourceState && this._sourceState.setTimeScale(e), this._targetState && this._targetState.setTimeScale(e)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        this._globalStartTime = 0, this.onFinished = null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.update = function() {}, r.prototype.postUpdate = function() {}, r.prototype.getCurrentSourceData = function() {}, r.prototype.resetClips = function(e) {
        this._globalStartTime = e
    }, r.prototype.shiftClipTime = function(e) {
        this._globalStartTime += e
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        if (a.default.apply(this, arguments), this._audioCache = {}, void 0 !== window.Audio) {
            var e = new Audio;
            this._codecs = [{
                type: "mp3",
                enabled: !!e.canPlayType("audio/mpeg;")
            }, {
                type: "ogg",
                enabled: !!e.canPlayType('audio/ogg; codecs="vorbis"')
            }, {
                type: "wav",
                enabled: !!e.canPlayType('audio/wav; codecs="1"')
            }]
        } else this._codecs = []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(75),
        u = r(s),
        l = n(311),
        f = r(l),
        c = n(17),
        d = r(c),
        h = n(3),
        p = r(h);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("sound", i), i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        t && (t.stop(), this._objects.delete(e))
    }, i.prototype._prepare = function(e) {
        p.default.defaults(e, {
            loop: !1,
            audioRefs: {},
            volume: 1,
            spatialize: !1,
            autoPlay: !1,
            name: "A Sound"
        })
    }, i.prototype._create = function() {
        return new f.default
    }, i.prototype._update = function(e, t, n) {
        if (!u.default.isSupported()) return d.default.resolve();
        var r = this;
        return a.default.prototype._update.call(this, e, t, n).then(function(e) {
            if (e) {
                e.update(t);
                for (var n = 0; n < r._codecs.length; n++) {
                    var i = r._codecs[n],
                        o = t.audioRefs[i.type];
                    if (o && i.enabled) return r._audioCache[o] ? (e.setAudioBuffer(r._audioCache[o]), e) : r.loadObject(o).then(function(e) {
                        return d.default.createPromise(function(t) {
                            u.default.getContext().decodeAudioData(e, function(e) {
                                t(e)
                            }, function() {
                                console.error("Could not decode audio " + o), t(null)
                            })
                        })
                    }).then(function(t) {
                        return t && (r._audioCache[o] = t, e.setAudioBuffer(t)), e
                    })
                }
                return console.warn("No supported audioformat was found"), e
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(12),
        l = n(7),
        f = r(l),
        c = n(5),
        d = r(c),
        h = function(e) {
            function t() {
                i(this, t);
                var e = [],
                    n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "AwsSystem", e));
                return n._credentials = null, n._cognitoIdentityPoolId = null, n
            }
            return a(t, e), s(t, [{
                key: "updateConfig",
                value: function(e) {
                    var t = this;
                    arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                    return e && e.cognitoIdentityPoolId ? this._cognitoIdentityPoolId == e.cognitoIdentityPoolId ? u.Promise.resolve() : (this._cognitoIdentityPoolId = e.cognitoIdentityPoolId, this._ensureSDK(e.sdkUrl).then(function() {
                        return t._setupCognitoIdentityCredentials(e.cognitoIdentityPoolId), e.initIotDataClient ? t._initIotDataClient().then(function() {
                            return t._ready()
                        }) : t._ready()
                    })) : this._clearCredentials()
                }
            }, {
                key: "_setupCognitoIdentityCredentials",
                value: function(e) {
                    this._region = this._getRegionFromCognitoIdentityPoolId(e), this._credentials = new AWS.CognitoIdentityCredentials({
                        IdentityPoolId: e
                    }), this._customUserAgent = "SumerianScene", AWS.config.update({
                        region: this._region,
                        credentials: this._credentials,
                        customUserAgent: this._customUserAgent
                    })
                }
            }, {
                key: "_getRegionFromCognitoIdentityPoolId",
                value: function(e) {
                    var t = /(.*?):.+/.exec(e);
                    return t ? t[1] : void 0
                }
            }, {
                key: "_ensureSDK",
                value: function(e) {
                    return window.AWS ? u.Promise.resolve() : new u.Promise(function(t, n) {
                        var r = document.getElementById("__AWS_SDK_SCRIPT__");
                        if (!r) {
                            var i = document.getElementsByTagName("head")[0];
                            r = document.createElement("script"), r.id = "__AWS_SDK_SCRIPT__", r.type = "text/javascript", r.src = e, i.appendChild(r)
                        }
                        r.addEventListener("load", function() {
                            return t()
                        }), r.addEventListener("error", function(e) {
                            return n(e)
                        })
                    })
                }
            }, {
                key: "_initIotDataClient",
                value: function(e) {
                    var t = this;
                    return new u.Promise(function(e, n) {
                        new AWS.Iot({
                            region: t._region,
                            credentials: t._credentials,
                            customUserAgent: t._customUserAgent
                        }).describeEndpoint({}, function(n, r) {
                            if (n) return console.error("IoT Data Client failed to initialize!", n), e();
                            window.AWSIotData = new AWS.IotData({
                                endpoint: r.endpointAddress,
                                region: t._region,
                                credentials: t._credentials,
                                customUserAgent: t._customUserAgent
                            }), e()
                        })
                    })
                }
            }, {
                key: "_clearCredentials",
                value: function() {
                    return this._credentials && AWS && (this._credentials === AWS.config.credentials && (AWS.config.credentials = null), this._credentials = null), u.Promise.resolve()
                }
            }, {
                key: "_ready",
                value: function() {
                    d.default.emit(t.SDK_READY, !0, !0)
                }
            }]), t
        }(f.default);
    h.SDK_READY = "aws.sdkReady", t.default = h
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(3),
        u = r(s),
        l = n(5),
        f = r(l),
        c = n(67),
        d = r(c),
        h = n(316),
        p = r(h),
        m = n(12),
        y = r(m),
        v = {
            backgroundColor: [.3, .3, .3, 1],
            globalAmbient: [0, 0, 0],
            fog: {
                enabled: !1,
                color: [1, 1, 1],
                near: 10,
                far: 1e3
            }
        },
        _ = {
            volume: 1,
            reverb: 0,
            rolloffFactor: .4,
            maxDistance: 100
        };
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("environment", i), i.prototype._prepare = function(e) {
        u.default.defaults(e, v)
    }, i.prototype._create = function() {
        return {
            weatherState: {}
        }
    }, i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        if (this._objects.delete(e), t) {
            for (var n in t.weatherState) i.weatherHandlers[n].remove(t.weatherState);
            f.default.emit("sumerian.setClearColor", v.backgroundColor), d.default.CLEAR_COLOR = v.backgroundColor, d.default.GLOBAL_AMBIENT = v.globalAmbient.slice(0, 3), d.default.USE_FOG = v.fog.enabled, d.default.FOG_COLOR = v.fog.color.slice(0, 3), d.default.FOG_SETTINGS = [v.fog.near, v.fog.far];
            var r = this.world.getSystem("SoundSystem");
            r && (r.updateConfig(_), r.setReverb(null))
        }
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        return a.default.prototype._update.call(this, e, t, n).then(function(e) {
            if (e) {
                var o = t.backgroundColor,
                    a = o[3];
                e.backgroundColor = [o[0] * a, o[1] * a, o[2] * a, o[3]], e.globalAmbient = t.globalAmbient.slice(0, 3), e.fog = u.default.deepClone(t.fog), f.default.emit("sumerian.setClearColor", e.backgroundColor), d.default.CLEAR_COLOR = e.backgroundColor, d.default.GLOBAL_AMBIENT = e.globalAmbient, d.default.USE_FOG = e.fog.enabled, d.default.FOG_COLOR = e.fog.color.slice(0, 3), d.default.FOG_SETTINGS = [e.fog.near, t.fog.far];
                for (var s in t.weather) {
                    var l = i.weatherHandlers[s];
                    l && l.update.call(r, t.weather[s], e.weatherState)
                }
                var c = [];
                if (t.skyboxRef) i.currentSkyboxRef = t.skyboxRef, c.push(r._load(t.skyboxRef, {
                    reload: !0
                }));
                else if (i.currentSkyboxRef) {
                    var h = r.updateObject(i.currentSkyboxRef, null).then(function() {
                        delete i.currentSkyboxRef
                    });
                    c.push(h)
                }
                var p = r.world.getSystem("SoundSystem");
                if (t.sound && p)
                    if (p.updateConfig(t.sound), t.sound.reverbRef) {
                        var h = r._load(t.sound.reverbRef, n).then(function(e) {
                            p.setReverb(e._buffer)
                        });
                        c.push(h)
                    } else p.setReverb(null);
                return y.default.all(c).then(function() {
                    return e
                })
            }
        })
    }, i.weatherHandlers = {
        snow: {
            update: function(e, t) {
                e.enabled ? (t.snow && t.snow.enabled || (t.snow = t.snow || {}, t.snow.enabled = !0, t.snow.snow = new p.default(this.world.sumerianRunner)), t.snow.snow.setEmissionVelocity(e.velocity), t.snow.snow.setReleaseRatePerSecond(e.rate), t.snow.snow.setEmissionHeight(e.height)) : t.snow && t.snow.enabled && (t.snow.snow.remove(), t.snow.enabled = !1, delete t.snow.snow)
            },
            remove: function(e) {
                e.snow && e.snow.snow && (e.snow.snow.remove(), e.snow.enabled = !1, delete e.snow.snow)
            }
        }
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.getRandomVelocityOffY = function(e, t, n, i, o) {
        var a = t + Math.random() * (n - t),
            s = 2 * Math.PI * Math.random();
        return e.x = Math.cos(s) * Math.sin(a), e.y = Math.cos(a), e.z = Math.sin(s) * Math.sin(a), o && r.applyEntityTransformVector(e, o), e.scale(i), e
    }, r.randomPointInCube = function(e, t, n, r, i) {
        return e.x = 2 * Math.random() * t - t + (i ? i.x : 0), e.y = 2 * Math.random() * n - n + (i ? i.y : 0), e.z = 2 * Math.random() * r - r + (i ? i.z : 0), e
    }, r.createConstantForce = function(e) {
        var t = new o.default(e);
        return {
            enabled: !0,
            prepare: function() {},
            apply: function(e, n) {
                n.velocity.x += t.x * e, n.velocity.y += t.y * e, n.velocity.z += t.z * e
            }
        }
    }, r.applyEntityTransformPoint = function(e, t) {
        return t.transformComponent && t.transformComponent.worldTransform ? t.transformComponent.sync().worldTransform.applyForward(e, e) : e
    }, r.applyEntityTransformVector = function(e, t) {
        return t.transformComponent && t.transformComponent.worldTransform ? t.transformComponent.sync().worldTransform.applyForwardVector(e, e) : e
    }, r.applyTimeline = function(e, t) {
        for (var n = e.age, r = e.lifeSpan, i = 0, o = 0, a = 0, s = 0, u = r, l = r, f = r, c = r, d = 0, h = void 0, p = null, m = null, y = null, v = null, _ = null, g = null, b = null, x = null, w = null, E = 0, S = t.length; E < S; E++) {
            var M = t[E];
            d += (M.timeOffset ? M.timeOffset : 0) * r, null === g && void 0 !== M.color && (d > n ? (u = d, g = M) : (i = d, p = M)), null === b && void 0 !== M.mass && (d > n ? (l = d, b = M) : (o = d, m = M)), d <= n && void 0 !== M.uvIndex && (_ = M), null === x && void 0 !== M.size && (d > n ? (f = d, x = M) : (a = d, y = M)), null === w && void 0 !== M.spin && (d > n ? (c = d, w = M) : (s = d, v = M))
        }
        h = (n - i) / (u - i);
        var C = null !== p ? p.color : [1, 1, 1, 1],
            T = null !== g ? g.color : C;
        e.color.x = (1 - h) * C[0] + h * T[0], e.color.y = (1 - h) * C[1] + h * T[1], e.color.z = (1 - h) * C[2] + h * T[2], e.color.w = (1 - h) * C[3] + h * T[3], h = (n - o) / (l - o), C = null !== m ? m.mass : 1, T = null !== b ? b.mass : C, e.mass = (1 - h) * C + h * T, e.uvIndex = null !== _ ? _.uvIndex : 0, h = (n - a) / (f - a), C = null !== y ? y.size : 1, T = null !== x ? x.size : C, e.size = (1 - h) * C + h * T, h = (n - s) / (c - s), C = null !== v ? v.spin : 0, T = null !== w ? w.spin : C, e.spin = (1 - h) * C + h * T
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        f.default.copyOptions(this, e, {
            totalParticlesToSpawn: -1,
            maxLifetime: 3,
            minLifetime: 2,
            timeline: void 0,
            influences: [],
            getEmissionPoint: function(e, t) {
                var n = e.position;
                return n.setDirect(0, 0, 0), a.default.applyEntityTransformPoint(n, t)
            },
            getEmissionVelocity: function(e, t) {
                var n = e.velocity;
                return n.setDirect(0, 1, 0), a.default.applyEntityTransformVector(n, t)
            },
            getParticleBillboardVectors: i.CAMERA_BILLBOARD_FUNC,
            releaseRatePerSecond: 10,
            enabled: !0
        }), this.particlesWaitingToRelease = 0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(214),
        a = r(o),
        s = n(24),
        u = r(s),
        l = n(92),
        f = r(l);
    i.CAMERA_BILLBOARD_FUNC = function(e) {
            var t = u.default.mainCamera;
            t && (e.bbX.set(t._left), e.bbY.set(t._up))
        },
        //! AT: is it just a glorified rand(min, max) function?
        i.prototype.nextParticleLifeSpan = function() {
            return this.minLifetime + (this.maxLifetime - this.minLifetime) * Math.random()
        }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r, o) {
        var s = void 0;
        if (e === i.SPHERE) this.meshData = new u.default(16, 32, 1, n || u.default.TextureModes.Projected), t instanceof Array && (t = t[0]), t && (s = (new y.default).loadTexture2D(t));
        else {
            if (e !== i.BOX) throw new Error("Unknown geometry type");
            this.meshData = new a.default(1, 1, 1), t.length && (s = (new y.default).loadTextureCube(t, {
                flipY: !1,
                wrapS: "EdgeClamp",
                wrapT: "EdgeClamp"
            }))
        }
        var l = new p.default("skybox", b.default.clone(x[e]));
        o && l.setDefine("HDR", !0);
        var f = new d.default(l.getShaderDefinition(), "Skybox material");
        f.cullState.cullFace = "Front", f.depthState.enabled = !1, f.renderQueue = 1, s && s.then(function(e) {
            f.setTexture(p.default.DIFFUSE_MAP, e)
        }), this.materials = [f], this.transform = new _.default;
        var c = e === i.SPHERE ? Math.PI / 2 : 0;
        this.transform.rotation.fromAngles(c, r, 0), this.transform.update(), this.active = !0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(57),
        a = r(o),
        s = n(97),
        u = r(s),
        l = n(6),
        f = r(l),
        c = n(9),
        d = r(c),
        h = n(29),
        p = r(h),
        m = n(108),
        y = r(m),
        v = n(10),
        _ = r(v),
        g = n(3),
        b = r(g),
        x = {
            box: {
                name: "Skybox.box",
                defines: {
                    HDR: !1
                },
                attributes: {
                    vertexPosition: f.default.POSITION
                },
                uniforms: {
                    normalMatrix: p.default.NORMAL_MATRIX,
                    viewMatrix: p.default.VIEW_MATRIX,
                    projectionMatrix: p.default.PROJECTION_MATRIX,
                    near: p.default.NEAR_PLANE,
                    diffuseMap: p.default.DIFFUSE_MAP
                },
                vshader: "\n      attribute vec3 vertexPosition;\n\n      uniform mat3 normalMatrix;\n      uniform mat4 viewMatrix;\n      uniform mat4 projectionMatrix;\n      uniform float near;\n\n      varying vec3 eyeVec;\n\n      void main(void) {\n        eyeVec = vertexPosition * normalMatrix * near * 10.0;\n        vec3 worldPos = mat3(viewMatrix) * eyeVec;\n        gl_Position = projectionMatrix * vec4(worldPos, 1.0);\n      }",
                fshader: "\n      uniform samplerCube diffuseMap;\n\n      varying vec3 eyeVec;\n\n      void main(void) {\n        vec4 cube = textureCube(diffuseMap, eyeVec);\n        if (cube.a < 0.05) discard;\n\n        #ifdef HDR\n        // Gamma-correction (Reinhard's)\n        vec3 result = cube.rgb;\n        result = result / (result + vec3(1.0));\n        gl_FragColor = vec4(pow(result, vec3(1.0/2.2)), 1.0);\n        #else\n        gl_FragColor = cube;\n        #endif\n      }"
            },
            sphere: {
                name: "Skybox.sphere",
                defines: {
                    HDR: !1
                },
                attributes: {
                    vertexPosition: f.default.POSITION,
                    vertexUV0: f.default.TEXCOORD0
                },
                uniforms: {
                    normalMatrix: p.default.NORMAL_MATRIX,
                    viewMatrix: p.default.VIEW_MATRIX,
                    projectionMatrix: p.default.PROJECTION_MATRIX,
                    near: p.default.NEAR_PLANE,
                    diffuseMap: p.default.DIFFUSE_MAP
                },
                vshader: " \n      attribute vec3 vertexPosition;\n      attribute vec2 vertexUV0;\n\n      uniform mat3 normalMatrix;\n      uniform mat4 viewMatrix;\n      uniform mat4 projectionMatrix;\n      uniform float near;\n\n      varying vec2 texCoord0;\n\n      void main(void) {\n        texCoord0 = vertexUV0;\n\n        vec3 worldPos = mat3(viewMatrix) * normalMatrix * vertexPosition * near * 10.0;\n        gl_Position = projectionMatrix * vec4(worldPos, 1.0);\n      }",
                fshader: "\n      precision mediump float;\n\n      uniform sampler2D diffuseMap;\n\n      varying vec2 texCoord0;\n      \n      void main(void)\n      {\n        vec4 sphere = texture2D(diffuseMap, texCoord0);\n        if (sphere.a < 0.05) discard;\n\n        #ifdef HDR\n        // Gamma-correction (Reinhard's)\n        vec3 result = sphere.rgb;\n        result = result / (result + vec3(1.0));\n        gl_FragColor = vec4(pow(result, vec3(1.0/2.2)), 1.0);\n        #else\n        gl_FragColor = sphere;\n        #endif\n      }"
            }
        };
    i.SPHERE = "sphere", i.BOX = "box", t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        for (var n = t.timeSamples, r = Date.now(), i = 0, o = 0, a = !1, s = 0, u = n.length; s < u; s++) r - n[s] < t.maxSampleTimeMS && (i += t.xSamples[s], o += t.ySamples[s], a = !0);
        a ? t.velocity.setDirect(i * e.orbitSpeed / n.length, o * e.orbitSpeed / n.length) : t.velocity.setDirect(0, 0)
    }

    function o(e, t) {
        t.smoothness = Math.pow(w.default.clamp(e.smoothness, 0, 1), .3), t.inertia = Math.pow(w.default.clamp(e.drag, 0, 1), .3), t.dragButton = ["Any", "Left", "Middle", "Right", "None"].indexOf(e.dragButton) - 1, t.dragButton < -1 ? t.dragButton = -1 : 4 === t.dragButton && (t.dragButton = null), t.dirty = !0
    }

    function a(e, t, n, r) {
        var o = r.dragButton,
            a = r.mouseState; - 1 !== o && o !== e && !1 !== t || (a.buttonDown = t, t ? (a.lastX = NaN, a.lastY = NaN, r.velocity.setDirect(0, 0), r.spherical.y = w.default.moduloPositive(r.spherical.y, w.default.TWO_PI), r.targetSpherical.set(r.spherical)) : i(n, r))
    }

    function s(e, t, n, r) {
        var i = r.targetSpherical;
        if (n.clampAzimuth) {
            var o = n.minAzimuth * w.default.DEG_TO_RAD,
                a = n.maxAzimuth * w.default.DEG_TO_RAD;
            i.y = w.default.radialClamp(i.y - e, o, a)
        } else i.y -= e;
        var s = n.minAscent * w.default.DEG_TO_RAD,
            u = n.maxAscent * w.default.DEG_TO_RAD;
        i.z = w.default.clamp(i.z + t, s, u), r.dirty = !0
    }

    function u(e, t, n, r) {
        var i = 0,
            o = 0,
            a = r.mouseState;
        isNaN(a.lastX) || isNaN(a.lastY) ? (a.lastX = e, a.lastY = t) : (i = -(e - a.lastX), o = t - a.lastY, a.lastX = e, a.lastY = t), !a.buttonDown || 0 === i && 0 === o || (r.timeSamples[r.sample] = Date.now(), r.xSamples[r.sample] = i, r.ySamples[r.sample] = o, r.sample++, r.sample > r.timeSamples.length - 1 && (r.sample = 0), r.velocity.setDirect(0, 0), s(n.orbitSpeed * i, n.orbitSpeed * o, n, r))
    }

    function l(e, t, n) {
        var r = Math.max(-1, Math.min(1, -e.wheelDelta || e.detail));
        r *= T * n.targetSpherical.x;
        var i = n.targetSpherical;
        i.x = w.default.clamp(i.x + t.zoomSpeed * r, t.minZoomDistance, t.maxZoomDistance), n.dirty = !0
    }

    function f(e, t, n) {
        if (n.velocity.lengthSquared() > R) {
            s(n.velocity.x, n.velocity.y, t, n);
            var r = w.default.lerp(n.inertia, 0, 1 - e / n.inertia);
            n.velocity.scale(r)
        } else n.velocity.setDirect(0, 0, 0)
    }

    function c(e, t) {
        if (t.entity.cameraComponent) {
            var n = t.entity.cameraComponent.camera;
            if (n.projectionMode === S.default.Parallel) {
                t.size = n.top, t.size /= e;
                var r = t.size;
                n.setFrustum(null, null, -r, r, r, -r)
            }
        }
    }

    function d(e, t) {
        if (t.dirty) {
            var n = t.spherical,
                r = t.targetSpherical,
                i = t.lookAtPoint,
                o = t.goingToLookAt,
                a = t.cartesian,
                s = t.entity,
                u = s.transformComponent,
                l = u.transform,
                d = w.default.lerp(t.smoothness, 1, t.world.tpf);
            o.distanceSquared(i) < R ? i.set(o) : i.lerp(o, d), t.inertia > 0 && f(s._world.tpf, e, t);
            var h = n,
                p = r;
            h.y = w.default.lerp(d, h.y, p.y), h.z = w.default.lerp(d, h.z, p.z);
            var m = h.x;
            h.x = w.default.lerp(d, h.x, p.x), m /= h.x, c(m, t), w.default.sphericalToCartesian(h.x, h.y, h.z, a), l.translation.set(a.add(i)), l.translation.equals(i) || l.lookAt(i, t.worldUpVector), n.distanceSquared(r) < R && t.lookAtPoint.equals(t.goingToLookAt) && (h.y = w.default.moduloPositive(h.y, w.default.TWO_PI), r.set(n), t.dirty = !1), u.setUpdated(), t.entity.cameraComponent && C.default.emit("sumerian.cameraPositionChanged", {
                spherical: t.spherical.toArray(),
                translation: l.translation.toArray(),
                lookAtPoint: t.lookAtPoint.toArray(),
                id: s.id
            })
        }
    }

    function h(e, t) {
        var n = Object.keys(t.listeners),
            r = !0,
            i = !1,
            o = void 0;
        try {
            for (var a, s = n[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                var u = a.value;
                t.domElement.removeEventListener(u, t.listeners[u])
            }
        } catch (e) {
            i = !0, o = e
        } finally {
            try {
                !r && s.return && s.return()
            } finally {
                if (i) throw o
            }
        }
        t.domElement.removeEventListener("mousewheel", t.preventScroll), t.domElement.removeEventListener("DOMMouseScroll", t.preventScroll)
    }

    function p(e, t) {
        var n = 0,
            r = !!navigator.userAgent.match(/Android/i),
            i = {
                wheelDelta: 0
            };
        t.preventScroll = function(e) {
            e.preventDefault(), e.stopPropagation()
        }, t.domElement.addEventListener("mousewheel", t.preventScroll, !0), t.domElement.addEventListener("DOMMouseScroll", t.preventScroll, !0), t.listeners = {
            mousedown: function(n) {
                if (!e.whenUsed || t.entity === t.activeCameraEntity) {
                    var r = n.button;
                    0 === r && (n.altKey ? r = 2 : n.shiftKey && (r = 1)), a(r, !0, e, t)
                }
            },
            mouseup: function(n) {
                var r = n.button;
                0 === r && (n.altKey ? r = 2 : n.shiftKey && (r = 1)), a(r, !1, e, t)
            },
            mousemove: function(n) {
                e.whenUsed && t.entity !== t.activeCameraEntity || u(n.clientX, n.clientY, e, t)
            },
            mouseleave: function(e) {
                t.orbitListeners.mouseup(e)
            },
            mousewheel: function(n) {
                e.whenUsed && t.entity !== t.activeCameraEntity || l(n, e, t)
            },
            touchstart: function(n) {
                e.whenUsed && t.entity !== t.activeCameraEntity || a(t.dragButton, 1 === n.targetTouches.length, e, t), r && n.preventDefault()
            },
            touchend: function() {
                a(t.dragButton, !1, e, t), n = 0
            },
            touchmove: function(r) {
                if (!e.whenUsed || t.entity === t.activeCameraEntity) {
                    var o = void 0,
                        a = void 0,
                        s = void 0,
                        f = r.targetTouches,
                        c = f[0].clientX,
                        d = f[0].clientY;
                    if (2 === f.length) {
                        var h = f[1].clientX,
                            p = f[1].clientY;
                        s = (c - h) * (c - h) + (d - p) * (d - p)
                    } else o = c, a = d, u(o, a, e, t);
                    var m = (s - n) / Math.max(t.domElement.offsetHeight, t.domElement.offsetWidth);
                    m /= 3, 0 === n ? n = s : 2 === f.length && Math.abs(m) > .3 && (i.wheelDelta = m, l(i, e, t), n = s)
                }
            }
        }, t.listeners.DOMMouseScroll = t.listeners.mousewheel, t.listeners.mouseleave = t.listeners.mouseup;
        var o = Object.keys(t.listeners),
            s = !0,
            f = !1,
            c = void 0;
        try {
            for (var d, h = o[Symbol.iterator](); !(s = (d = h.next()).done); s = !0) {
                var p = d.value;
                t.domElement.addEventListener(p, t.listeners[p])
            }
        } catch (e) {
            f = !0, c = e
        } finally {
            try {
                !s && h.return && h.return()
            } finally {
                if (f) throw c
            }
        }
        t.domElement.oncontextmenu = function() {
            return !1
        }
    }

    function m(e, t) {
        t.dirty = !0, t.timeSamples = [0, 0, 0, 0, 0], t.xSamples = [0, 0, 0, 0, 0], t.ySamples = [0, 0, 0, 0, 0], t.sample = 0, t.velocity = new b.default, t.cartesian = new _.default, t.worldUpVector = _.default.UNIT_Y.clone(), t.maxSampleTimeMS = 200, t.mouseState = {
            buttonDown: !1,
            lastX: NaN,
            lastY: NaN
        }, o(e, t);
        var n = void 0;
        if (e.lookAtDistance) {
            var r = t.entity.getRotation();
            n = t.spherical = new _.default(e.lookAtDistance, -r.y + Math.PI / 2, -r.x)
        } else n = e.spherical instanceof Array ? t.spherical = new _.default(e.spherical[0], e.spherical[1] * w.default.DEG_TO_RAD, e.spherical[2] * w.default.DEG_TO_RAD) : e.spherical ? t.spherical = new _.default(e.spherical.x, e.spherical.y * w.default.DEG_TO_RAD, e.spherical.z * w.default.DEG_TO_RAD) : t.spherical = new _.default(15, 0, 0);
        if (t.targetSpherical = n.clone(), e.lookAtDistance) {
            var i = t.entity.transformComponent.transform.rotation;
            t.lookAtPoint = new _.default(0, 0, -e.lookAtDistance), t.lookAtPoint.applyPost(i), t.lookAtPoint.add(t.entity.getTranslation())
        } else e.lookAtPoint ? t.lookAtPoint = e.lookAtPoint instanceof Array ? _.default.fromArray(e.lookAtPoint) : e.lookAtPoint.clone() : t.lookAtPoint = new _.default;
        t.goingToLookAt = t.lookAtPoint.clone(), c(1, t), p(e, t)
    }

    function y() {
        return {
            setup: m,
            update: d,
            cleanup: h,
            argsUpdated: o
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var v = n(0),
        _ = r(v),
        g = n(37),
        b = r(g),
        x = n(4),
        w = r(x),
        E = n(30),
        S = r(E),
        M = n(5),
        C = r(M),
        T = .035,
        R = 1e-6;
    y.externals = {
        key: "OrbitCamControlScript",
        name: "OrbitCamera Control",
        description: "Enables camera to orbit around a point in 3D space using the mouse",
        parameters: [{
            key: "whenUsed",
            default: !0,
            name: "When Camera Used",
            description: "Script only runs when the camera to which it is added is being used.",
            type: "boolean"
        }, {
            key: "dragButton",
            description: "Button to enable dragging",
            default: "Any",
            options: ["Any", "Left", "Middle", "Right", "None"],
            type: "string",
            control: "select"
        }, {
            key: "orbitSpeed",
            default: .005,
            type: "float",
            scale: .001,
            decimals: 3
        }, {
            key: "zoomSpeed",
            default: 1,
            type: "float",
            scale: .1
        }, {
            key: "drag",
            name: "Inertia",
            default: .9,
            type: "float",
            control: "slider",
            min: 0,
            max: 1
        }, {
            key: "smoothness",
            default: .4,
            type: "float",
            min: 0,
            max: 1,
            control: "slider"
        }, {
            key: "minZoomDistance",
            default: 1,
            type: "float",
            min: .01
        }, {
            key: "maxZoomDistance",
            default: 1e3,
            type: "float",
            min: 1
        }, {
            key: "minAscent",
            description: "Maximum arc the camera can reach below the target point",
            default: -89.99,
            type: "float",
            control: "slider",
            min: -89.99,
            max: 89.99
        }, {
            key: "maxAscent",
            description: "Maximum arc the camera can reach above the target point",
            default: 89.99,
            type: "float",
            control: "slider",
            min: -89.99,
            max: 89.99
        }, {
            key: "clampAzimuth",
            default: !1,
            type: "boolean"
        }, {
            key: "minAzimuth",
            description: "Maximum arc the camera can reach clockwise of the target point",
            default: 90,
            type: "int",
            control: "slider",
            min: 0,
            max: 360
        }, {
            key: "maxAzimuth",
            description: "Maximum arc the camera can reach counter-clockwise of the target point",
            default: 270,
            type: "int",
            control: "slider",
            min: 0,
            max: 360
        }, {
            key: "lookAtDistance",
            description: "The point to orbit around",
            default: 15,
            type: "float",
            min: .001
        }]
    }, t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e(e, t, n) {
            e.touchMode = "Double", i.setup(e, t, n), o.setup(e, t, n)
        }

        function t(e, t, n) {
            o.update(e, t, n), i.update(e, t, n)
        }

        function n(e, t, n) {
            o.cleanup(e, t, n), i.cleanup(e, t, n)
        }

        function r(e, t, n) {
            o.argsUpdated(e, t, n), i.argsUpdated(e, t, n)
        }
        var i = a.default.create(u.default),
            o = a.default.create(f.default);
        return {
            setup: e,
            cleanup: n,
            update: t,
            argsUpdated: r
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    for (var o = n(125), a = r(o), s = n(217), u = r(s), l = n(219), f = r(l), c = n(3), d = r(c), h = u.default.externals.parameters, p = f.default.externals.parameters, m = d.default.deepClone(h.concat(p.slice(1))), y = m.length - 1; y >= 0; y--) {
        var v = m[y];
        "panSpeed" !== v.key && "touchMode" !== v.key || m.splice(y, 1)
    }
    for (var _ = 0; _ < m.length; _++) {
        var g = m[_];
        switch (g.key) {
            case "dragButton":
                g.default = "Right";
                break;
            case "panButton":
                g.default = "Middle";
                break;
            case "panSpeed":
                g.default = 1;
                break;
            case "touchMode":
                g.default = "Double"
        }
    }
    i.externals = {
        key: "OrbitNPanControlScript",
        name: "Orbit and Pan Control",
        description: "This is a combo of orbitcamcontrolscript and pancamcontrolscript",
        parameters: m
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e(e) {
            var t = 0,
                n = 0,
                r = e[0].clientX,
                i = e[0].clientY;
            if (e.length >= 2) {
                var o = e[1].clientX,
                    a = e[1].clientY;
                t = (r + o) / 2, n = (i + a) / 2
            } else t = r, n = i;
            return [t, n]
        }

        function t(e, t) {
            t.panButton = ["Any", "Left", "Middle", "Right"].indexOf(e.panButton) - 1, t.panButton < -1 && (t.panButton = -1), t.dirty = !0, y = !0
        }

        function n(n, r) {
            t(n, r), h = r.goingToLookAt, o = a.default.UNIT_Y.clone(), s = a.default.UNIT_X.clone().negate(), l = new a.default, c = new a.default, r.translation = r.entity.transformComponent.transform.translation.clone();
            var i = r.world.sumerianRunner.renderer;
            r.devicePixelRatio = i._useDevicePixelRatio && window.devicePixelRatio ? window.devicePixelRatio / i.svg.currentScale : 1, p = {
                x: 0,
                y: 0,
                ox: 0,
                oy: 0,
                dx: 0,
                dy: 0,
                down: !1
            }, m = {
                mousedown: function(e) {
                    if (!n.whenUsed || r.entity === r.activeCameraEntity) {
                        var t = e.button;
                        if (0 === t && (e.altKey ? t = 2 : e.shiftKey && (t = 1)), t === r.panButton || -1 === r.panButton) {
                            p.down = !0;
                            var i = void 0 !== e.offsetX ? e.offsetX : e.layerX,
                                o = void 0 !== e.offsetY ? e.offsetY : e.layerY;
                            p.ox = p.x = i, p.oy = p.y = o
                        }
                    }
                },
                mouseup: function(e) {
                    var t = e.button;
                    0 === t && (e.altKey ? t = 2 : e.shiftKey && (t = 1)), p.down = !1, p.dx = p.dy = 0
                },
                mousemove: function(e) {
                    if ((!n.whenUsed || r.entity === r.activeCameraEntity) && p.down) {
                        var t = void 0 !== e.offsetX ? e.offsetX : e.layerX,
                            i = void 0 !== e.offsetY ? e.offsetY : e.layerY;
                        p.x = t, p.y = i, r.dirty = !0
                    }
                },
                mouseleave: function() {
                    p.down = !1, p.ox = p.x, p.oy = p.y
                },
                touchstart: function(t) {
                    if (!n.whenUsed || r.entity === r.activeCameraEntity) {
                        if (p.down = "Any" === n.touchMode || "Single" === n.touchMode && 1 === t.targetTouches.length || "Double" === n.touchMode && 2 === t.targetTouches.length, !p.down) return;
                        var i = e(t.targetTouches);
                        p.ox = p.x = i[0], p.oy = p.y = i[1]
                    }
                },
                touchmove: function(t) {
                    if (!n.whenUsed || r.entity === r.activeCameraEntity) {
                        if (!p.down) return;
                        var i = e(t.targetTouches);
                        p.x = i[0], p.y = i[1], r.dirty = !0
                    }
                },
                touchend: function() {
                    p.down = !1, p.ox = p.x, p.oy = p.y
                }
            };
            var u = Object.keys(m),
                f = !0,
                d = !1,
                y = void 0;
            try {
                for (var v, _ = u[Symbol.iterator](); !(f = (v = _.next()).done); f = !0) {
                    var g = v.value;
                    r.domElement.addEventListener(g, m[g])
                }
            } catch (e) {
                d = !0, y = e
            } finally {
                try {
                    !f && _.return && _.return()
                } finally {
                    if (d) throw y
                }
            }
            r.dirty = !0
        }

        function r(e, t) {
            if (t.dirty) {
                if (p.dx = p.x - p.ox, p.dy = p.y - p.oy, 0 === p.dx && 0 === p.dy && !y) return void(t.dirty = !!t.lookAtPoint);
                y = !1, e.invertX && (p.dx = -p.dx), e.invertY && (p.dy = -p.dy), p.ox = p.x, p.oy = p.y;
                var n = u.default.mainCamera,
                    r = t.entity,
                    i = r.transformComponent.transform,
                    a = r.cameraComponent.camera;
                if (h && n) {
                    if (h.equals(n.translation)) return;
                    var m = t.viewportWidth / t.devicePixelRatio,
                        v = t.viewportHeight / t.devicePixelRatio;
                    n.getScreenCoordinates(h, m, v, l), l.subDirect(p.dx, p.dy, 0), n.getWorldCoordinates(l.x, l.y, m, v, l.z, l), h.set(l)
                } else l.set(o).scale(p.dy), c.set(s).scale(p.dx),
                    //! schteppe: use world coordinates for both by default?
                    r.cameraComponent && r.cameraComponent.camera && (a = r.cameraComponent.camera, l.scale((a._frustumTop - a._frustumBottom) / t.viewportHeight), c.scale((a._frustumRight - a._frustumLeft) / t.viewportWidth)), l.add(c), l.applyPost(i.rotation), a.projectionMode === d.default.Perspective ? l.scale(20 * e.panSpeed) : l.scale(e.panSpeed), t.translation.add(l), r.transformComponent.setTranslation(t.translation), t.dirty = !1;
                f.default.emit("sumerian.cameraPositionChanged", {
                    translation: i.translation.toArray(),
                    lookAtPoint: h ? h.toArray() : null,
                    id: r.id
                })
            }
        }

        function i(e, t) {
            var n = Object.keys(m),
                r = !0,
                i = !1,
                o = void 0;
            try {
                for (var a, s = n[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                    var u = a.value;
                    t.domElement.removeEventListener(u, m[u])
                }
            } catch (e) {
                i = !0, o = e
            } finally {
                try {
                    !r && s.return && s.return()
                } finally {
                    if (i) throw o
                }
            }
        }
        var o = void 0,
            s = void 0,
            l = void 0,
            c = void 0,
            h = void 0,
            p = void 0,
            m = void 0,
            y = !1;
        return {
            setup: n,
            update: r,
            cleanup: i,
            argsUpdated: t
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(24),
        u = r(s),
        l = n(5),
        f = r(l),
        c = n(30),
        d = r(c);
    i.externals = {
        key: "PanCamControlScript",
        name: "PanCamera Control",
        description: "Enables camera to pan around a point in 3D space using the mouse",
        parameters: [{
            key: "whenUsed",
            type: "boolean",
            name: "When Camera Used",
            description: "Script only runs when the camera to which it is added is being used.",
            default: !0
        }, {
            key: "panButton",
            name: "Pan button",
            description: "Only pan with this button",
            type: "string",
            control: "select",
            default: "Any",
            options: ["Any", "Left", "Middle", "Right"]
        }, {
            key: "touchMode",
            description: "Number of fingers needed to trigger panning.",
            type: "string",
            control: "select",
            default: "Double",
            options: ["Any", "Single", "Double"]
        }, {
            key: "panSpeed",
            type: "float",
            default: 1,
            scale: .01
        }]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e() {
            _.x = p.strafeLeft - p.strafeRight, _.z = p.forward - p.back
        }

        function t(t) {
            if (!t.altKey) switch (u.default.keyForCode(t.keyCode)) {
                case h.crawlKey:
                    p.crawling = !0;
                    break;
                case h.forwardKey:
                    p.forward = 1, e();
                    break;
                case h.backKey:
                    p.back = 1, e();
                    break;
                case h.strafeLeftKey:
                    p.strafeLeft = 1, e();
                    break;
                case h.strafeRightKey:
                    p.strafeRight = 1, e()
            }
        }

        function n(t) {
            if (!t.altKey) switch (u.default.keyForCode(t.keyCode)) {
                case h.crawlKey:
                    p.crawling = !1;
                    break;
                case h.forwardKey:
                    p.forward = 0, e();
                    break;
                case h.backKey:
                    p.back = 0, e();
                    break;
                case h.strafeLeftKey:
                    p.strafeLeft = 0, e();
                    break;
                case h.strafeRightKey:
                    p.strafeRight = 0, e()
            }
        }

        function r(e) {
            e.setAttribute("tabindex", -1), e.addEventListener("keydown", t, !1), e.addEventListener("keyup", n, !1)
        }

        function i(e, t) {
            h = e, t.moveState = p = {
                strafeLeft: 0,
                strafeRight: 0,
                forward: 0,
                back: 0,
                crawling: !1
            }, f = t.entity, c = f.transformComponent, d = c.transform, b.copy(d.translation), r(t.domElement)
        }

        function o(e, t) {
            if ((m || !_.equals(a.default.ZERO)) && (m || !e.whenUsed || t.entity === t.activeCameraEntity)) {
                m = !1, g.setDirect(y.x * _.z + v.x * _.x, y.y * _.z + v.y * _.x, y.z * _.z + v.z * _.x), g.normalize();
                var n = t.world.tpf * (p.crawling ? e.crawlSpeed : e.walkSpeed);
                g.scale(n);
                var r = d.rotation;
                g.applyPost(r), b.add(g), d.translation.copy(b), c.setUpdated()
            }
        }

        function s(e, r) {
            r.domElement.removeEventListener("keydown", t, !1), r.domElement.removeEventListener("keyup", n, !1)
        }

        function l() {
            m = !0
        }
        var f = void 0,
            c = void 0,
            d = void 0,
            h = void 0,
            p = void 0,
            m = !1,
            y = new a.default(0, 0, -1),
            v = new a.default(-1, 0, 0),
            _ = new a.default,
            g = new a.default,
            b = new a.default;
        return {
            setup: i,
            update: o,
            cleanup: s,
            argsUpdated: l
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(126),
        u = r(s);
    i.externals = {
        key: "WASD",
        name: "WASD Control",
        description: "Enables moving via the WASD keys",
        parameters: [{
            key: "whenUsed",
            type: "boolean",
            name: "When Camera Used",
            description: "Script only runs when the camera to which it is added is being used.",
            default: !0
        }, {
            key: "crawlKey",
            type: "string",
            control: "key",
            default: "Shift"
        }, {
            key: "forwardKey",
            type: "string",
            control: "key",
            default: "W"
        }, {
            key: "backKey",
            type: "string",
            control: "key",
            default: "S"
        }, {
            key: "strafeLeftKey",
            type: "string",
            control: "key",
            default: "A"
        }, {
            key: "strafeRightKey",
            type: "string",
            control: "key",
            default: "D"
        }, {
            key: "walkSpeed",
            type: "int",
            control: "slider",
            default: 10,
            min: 1,
            max: 100,
            exponential: !0
        }, {
            key: "crawlSpeed",
            control: "slider",
            type: "int",
            default: 1,
            min: .1,
            max: 10,
            exponential: !0
        }]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e(e) {
            S.whenUsed && E.entity !== E.activeCameraEntity || (-1 === w || e.button === w || 3 === w && !y) && (p = !0, v = g = e.clientX, _ = b = e.clientY)
        }

        function t() {
            m || f.default.requestPointerLock()
        }

        function n(e) {
            m || S.whenUsed && E.entity !== E.activeCameraEntity || (m && void 0 !== e.movementX ? (g += e.movementX, b += e.movementY) : p && (g = e.clientX, b = e.clientY))
        }

        function r(e) {
            S.whenUsed && E.entity !== E.activeCameraEntity || m && void 0 !== e.movementX && (g += e.movementX, b += e.movementY)
        }

        function i() {
            p = !1
        }

        function o() {
            m && (p = !1)
        }

        function s() {
            m = !!document.pointerLockElement, document.pointerLockElement ? (E.domElement.removeEventListener("mousedown", t), y = !0) : E.domElement.addEventListener("mousedown", t)
        }

        function l(u, l) {
            E = l, S = u, (w = c.indexOf(u.button) - 1) < -1 && (w = -1);
            var d = l.domElement;
            3 === w && (document.addEventListener("pointerlockchange", s), f.default.requestPointerLock(), document.addEventListener("mousemove", r), document.addEventListener("mousemove", o), d.addEventListener("mousedown", t)), d.addEventListener("mousemove", n), d.addEventListener("mousedown", e), d.addEventListener("mouseup", i), x = new a.default, l.entity.transformComponent.transform.rotation.toAngles(x), M = x.y
        }

        function d(e, t) {
            if (g !== v || b !== _) {
                var n = g - v,
                    r = b - _,
                    i = t.entity,
                    o = i.transformComponent.transform.rotation;
                o.toAngles(x);
                var a = x.x,
                    s = x.y,
                    l = e.maxAscent * u.default.DEG_TO_RAD,
                    f = e.minAscent * u.default.DEG_TO_RAD;
                a = u.default.clamp(a - r * e.speed / 200, f, l);
                var c = e.maxAzimuth * u.default.DEG_TO_RAD - M,
                    d = e.minAzimuth * u.default.DEG_TO_RAD - M;
                s -= n * e.speed / 200, e.clampAzimuth && (s = u.default.radialClamp(s, d, c)), o.fromAngles(a, s, 0), i.transformComponent.setUpdated(), v = g, _ = b
            }
        }

        function h(o, a) {
            var u = a.domElement;
            3 === w && (f.default.exitPointerLock(), document.removeEventListener("mousemove", r), document.removeEventListener("pointerlockchange", s), u.removeEventListener("mousedown", t)), u.removeEventListener("mousemove", n), u.removeEventListener("mousedown", e), u.removeEventListener("mouseup", i)
        }
        var p = !1,
            m = !1,
            y = !1,
            v = 0,
            _ = 0,
            g = 0,
            b = 0,
            x = void 0,
            w = void 0,
            E = void 0,
            S = void 0,
            M = void 0;
        return {
            setup: l,
            update: d,
            cleanup: h
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(4),
        u = r(s),
        l = n(159),
        f = r(l),
        c = ["Any", "Left", "Middle", "Right", "None"];
    i.externals = {
        key: "MouseLookScript",
        name: "Mouse Look Control",
        description: "Click and drag to change rotation of entity, usually a camera",
        parameters: [{
            key: "whenUsed",
            type: "boolean",
            name: "When Camera Used",
            description: "Script only runs when the camera to which it is added is being used.",
            default: !0
        }, {
            key: "button",
            name: "Mouse button",
            type: "string",
            control: "select",
            default: "Left",
            options: c
        }, {
            key: "speed",
            name: "Turn Speed",
            type: "float",
            control: "slider",
            default: 1,
            min: -10,
            max: 10,
            scale: .1
        }, {
            key: "maxAscent",
            name: "Max Ascent",
            type: "float",
            control: "slider",
            default: 89.95,
            min: -89.95,
            max: 89.95
        }, {
            key: "minAscent",
            name: "Min Ascent",
            type: "float",
            control: "slider",
            default: -89.95,
            min: -89.95,
            max: 89.95
        }, {
            key: "clampAzimuth",
            default: !1,
            type: "boolean"
        }, {
            key: "minAzimuth",
            description: "Maximum arc the camera can reach clockwise of the target point",
            default: -90,
            type: "int",
            control: "slider",
            min: -180,
            max: 0
        }, {
            key: "maxAzimuth",
            description: "Maximum arc the camera can reach counter-clockwise of the target point",
            default: 90,
            type: "int",
            control: "slider",
            min: 0,
            max: 180
        }]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        e = e || {}, this.point = e.point ? new o.default(e.point) : new o.default, this.normal = e.normal ? new o.default(e.normal) : new o.default, this.entity = e.entity || null, this.distance = e.distance || -1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(0),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.reset = function() {
        this.entity = null, this.distance = -1
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        var t = this;
        a.default.call(this, "LineRenderSystem", []), this._lineRenderers = [], this.world = e, this._lineRenderers.push(new f.default(this.world)), this.camera = null, this.renderList = [], u.default.addListener("sumerian.setCurrentCamera", function(e) {
            t.camera = e.camera
        })
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(7),
        a = r(o),
        s = n(5),
        u = r(s),
        l = n(347),
        f = r(l),
        c = n(0),
        d = r(c);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i;
    var h = new d.default,
        p = new d.default,
        m = new d.default;
    i.axis = ["x", "y", "z"], i.prototype.WHITE = new d.default(1, 1, 1), i.prototype.RED = new d.default(1, 0, 0), i.prototype.GREEN = new d.default(0, 1, 0), i.prototype.BLUE = new d.default(0, 0, 1), i.prototype.AQUA = new d.default(0, 1, 1), i.prototype.MAGENTA = new d.default(1, 0, 1), i.prototype.YELLOW = new d.default(1, 1, 0), i.prototype.BLACK = new d.default(0, 0, 0), i.prototype.drawLine = function(e, t, n) {
        this._lineRenderers[0]._addLine(e, t, n)
    }, i.prototype._drawAxisLine = function(e, t, n, r, o, a, s, u) {
        var l = i.axis[n],
            f = i.axis[r],
            c = p.set(e);
        c[l] += t[l] * o;
        var d = m.set(c);
        d[f] += t[f] * a, void 0 !== u && (c.applyPostPoint(u), d.applyPostPoint(u)), this.drawLine(c, d, s)
    }, i.prototype.drawAABox = function(e, t, n, r) {
        for (var i = h.set(t).sub(e), o = 0; o < 3; o++) {
            for (var a = 0; a < 3; a++) a !== o && this._drawAxisLine(e, i, o, a, 1, 1, n, r);
            this._drawAxisLine(t, i, o, o, -1, 1, n, r), this._drawAxisLine(e, i, o, o, 1, -1, n, r)
        }
    }, i.prototype.drawCross = function(e, t, n) {
        n = n || .05;
        var r = h.set(e).addDirect(-n, 0, -n),
            i = p.set(e).addDirect(n, 0, n);
        this.drawLine(r, i, t), r = h.set(e).addDirect(n, 0, -n), i = p.set(e).addDirect(-n, 0, n), this.drawLine(r, i, t), r = h.set(e).addDirect(0, -n, 0), i = p.set(e).addDirect(0, n, 0), this.drawLine(r, i, t)
    }, i.prototype.render = function(e) {
        for (var t = 0; t < this._lineRenderers.length; t++) {
            var n = this._lineRenderers[t];
            n._updateVertexData(), n._manageRenderList(this.renderList), n._clear()
        }
        e.checkResize(this.camera), this.camera && e.render(this.renderList, null, this.camera, null, null, !1)
    }, i.prototype.clear = function() {
        for (var e = 0; e < this._lineRenderers.length; e++) {
            this._lineRenderers[e]._remove()
        }
        delete this._lineRenderers, this.world.sumerianRunner.renderer.clearShaderCache()
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        e = e || {}, a.default.apply(this, arguments), this.type = "RigidBodyComponent", this.cannonBody = null, this._dirty = !0, this._isKinematic = !!e.isKinematic, this._mass = void 0 !== e.mass ? e.mass : 1, this._isKinematic ? this._mass = 0 : 0 === this._mass && (this._isKinematic = !0), this._initialized = !1, this._velocity = e.velocity ? e.velocity.clone() : new u.default, this._angularVelocity = e.angularVelocity ? e.angularVelocity.clone() : new u.default, this._linearDamping = void 0 !== e.linearDamping ? e.linearDamping : .01, this._angularDamping = void 0 !== e.angularDamping ? e.angularDamping : .05, this._sleepingThreshold = void 0 !== e.sleepingThreshold ? e.sleepingThreshold : .2, this._sleepingTimeLimit = void 0 !== e.sleepingTimeLimit ? e.sleepingTimeLimit : 1, C || (C = new CANNON.Vec3, T = new CANNON.Vec3), this._colliderEntities = [], this.interpolation = i.INTERPOLATE, this._constraints = i.FREEZE_NONE
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(350),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(34),
        f = r(l),
        c = n(127),
        d = r(c),
        h = n(128),
        p = r(h),
        m = n(161),
        y = r(m),
        v = n(351),
        _ = r(v),
        g = n(352),
        b = r(g),
        x = n(226),
        w = r(x),
        E = n(4),
        S = r(E),
        M = new f.default,
        C = void 0,
        T = void 0;
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.type = "RigidBodyComponent", i.FREEZE_NONE = 0, i.FREEZE_POSITION_X = 1, i.FREEZE_POSITION_Y = 2, i.FREEZE_POSITION_Z = 4, i.FREEZE_ROTATION_X = 8, i.FREEZE_ROTATION_Y = 16, i.FREEZE_ROTATION_Z = 32, i.FREEZE_POSITION = i.FREEZE_POSITION_X | i.FREEZE_POSITION_Y | i.FREEZE_POSITION_Z, i.FREEZE_ROTATION = i.FREEZE_ROTATION_X | i.FREEZE_ROTATION_Y | i.FREEZE_ROTATION_Z, i.FREEZE_ALL = i.FREEZE_POSITION | i.FREEZE_ROTATION, i.NONE = 1, i.INTERPOLATE = 2,
        //! SH: Making room for future "EXTRAPOLATE"
        i.numCylinderSegments = 10, i.prototype.setTransformFromEntity = function(e) {
            var t = e.transformComponent.sync().worldTransform,
                n = this.cannonBody;
            n.position.copy(t.translation), n.previousPosition.copy(t.translation), n.interpolatedPosition.copy(t.translation), M.fromRotationMatrix(t.rotation), n.quaternion.copy(M), n.previousQuaternion.copy(M), n.interpolatedQuaternion.copy(M)
        }, i.prototype.applyForceWorld = function(e, t) {
            var n = C;
            n.copy(e);
            var r = T;
            r.copy(t), r.vsub(this.cannonBody.position, r), this.cannonBody.applyForce(n, r)
        }, i.prototype.applyForceLocal = function(e, t) {
            var n = C;
            n.copy(e);
            var r = CANNON.Vec3.ZERO;
            t && (r = T, r.copy(t));
            var i = this.cannonBody;
            i.vectorToWorldFrame(n, n), i.vectorToWorldFrame(r, r), i.applyForce(n, r)
        }, i.prototype.applyForce = function(e, t) {
            var n = C;
            n.copy(e);
            var r = CANNON.Vec3.ZERO;
            t && (r = T, r.copy(t)), this.cannonBody.applyForce(n, r)
        }, i.prototype.applyTorque = function(e) {
            C.copy(e), this.cannonBody.torque.vadd(C, this.cannonBody.torque)
        }, i.prototype.applyTorqueLocal = function(e) {
            var t = C;
            t.copy(e), this.cannonBody.vectorToWorldFrame(t, t), this.cannonBody.torque.vadd(t, this.cannonBody.torque)
        }, i.prototype.applyImpulse = function(e, t) {
            C.copy(e), T.copy(t), this.cannonBody.applyImpulse(C, T)
        }, i.prototype.applyImpulseLocal = function(e, t) {
            C.copy(e), T.copy(t), this.cannonBody.applyLocalImpulse(C, T)
        }, i.prototype.setVelocity = function(e) {
            this.cannonBody && this.cannonBody.velocity.copy(e), this._velocity.set(e)
        }, i.prototype.getVelocity = function(e) {
            var t = this.cannonBody,
                n = t ? t.velocity : this._velocity;
            e.setDirect(n.x, n.y, n.z)
        }, i.prototype.setAngularVelocity = function(e) {
            this.cannonBody && this.cannonBody.angularVelocity.copy(e), this._angularVelocity.set(e)
        }, i.prototype.getAngularVelocity = function(e) {
            var t = this.cannonBody,
                n = t ? t.angularVelocity : this._angularVelocity;
            e.setDirect(n.x, n.y, n.z)
        }, i.prototype.setPosition = function(e) {
            this.cannonBody && this.cannonBody.position.copy(e)
        }, i.prototype.getPosition = function(e) {
            if (this.cannonBody) {
                var t = this.cannonBody.position;
                e.setDirect(t.x, t.y, t.z)
            }
        }, i.prototype.getInterpolatedPosition = function(e) {
            if (this.cannonBody) {
                var t = this.cannonBody.previousPosition,
                    n = this.cannonBody.position,
                    r = this._system.world.interpolationTime;
                e.setDirect(S.default.lerp(r, t.x, n.x), S.default.lerp(r, t.y, n.y), S.default.lerp(r, t.z, n.z))
            }
        }, i.prototype.setQuaternion = function(e) {
            this.cannonBody && this.cannonBody.quaternion.copy(e)
        }, i.prototype.getQuaternion = function(e) {
            if (this.cannonBody) {
                var t = this.cannonBody.quaternion;
                e.setDirect(t.x, t.y, t.z, t.w)
            }
        }, i.prototype.getInterpolatedQuaternion = function(e) {
            if (this.cannonBody) {
                var t = this.cannonBody.previousQuaternion,
                    n = this.cannonBody.quaternion,
                    r = this._system.world.interpolationTime;
                e.setDirect(S.default.lerp(r, t.x, n.x), S.default.lerp(r, t.y, n.y), S.default.lerp(r, t.z, n.z), S.default.lerp(r, t.w, n.w))
            }
        }, Object.defineProperties(i.prototype, {
            linearDamping: {
                get: function() {
                    return this._linearDamping
                },
                set: function(e) {
                    this.cannonBody && (this.cannonBody.linearDamping = e), this._linearDamping = e
                }
            },
            angularDamping: {
                get: function() {
                    return this._angularDamping
                },
                set: function(e) {
                    this.cannonBody && (this.cannonBody.angularDamping = e), this._angularDamping = e
                }
            },
            isKinematic: {
                get: function() {
                    return this._isKinematic
                },
                set: function(e) {
                    this._isKinematic = e, this.cannonBody && (this.cannonBody.type = e ? CANNON.Body.KINEMATIC : CANNON.Body.DYNAMIC, this.cannonBody.updateMassProperties())
                }
            },
            sleepingThreshold: {
                get: function() {
                    return this._sleepingThreshold
                },
                set: function(e) {
                    this._sleepingThreshold = e, this.cannonBody && (this.cannonBody.sleepSpeedLimit = e)
                }
            },
            mass: {
                get: function() {
                    return this._mass
                },
                set: function(e) {
                    this._mass = e, this.cannonBody && (this.cannonBody.mass = e, this.cannonBody.updateMassProperties())
                }
            },
            sleepingTimeLimit: {
                get: function() {
                    return this._sleepingTimeLimit
                },
                set: function(e) {
                    this._sleepingTimeLimit = e, this.cannonBody && (this.cannonBody.sleepTimeLimit = e)
                }
            },
            constraints: {
                get: function() {
                    return this._constraints
                },
                set: function(e) {
                    this._constraints = e;
                    var t = this.cannonBody;
                    t && i.constraintsToCannonFactors(e, t.linearFactor, t.angularFactor)
                }
            }
        }), i.prototype.destroy = function() {
            var e = this,
                t = this.cannonBody;
            t && (t.world.removeBody(t), delete this._system._entities[t.id], t.shapes.forEach(function(t) {
                e._system._shapeIdToColliderEntityMap.delete(t.id)
            }), this.cannonBody = null);
            for (var n = 0; n < this._colliderEntities.length; n++) this._colliderEntities[n].bodyEntity = null;
            this._colliderEntities.length = 0
        }, i.constraintsToCannonFactors = function(e, t, n) {
            t.set(e & i.FREEZE_POSITION_X ? 0 : 1, e & i.FREEZE_POSITION_Y ? 0 : 1, e & i.FREEZE_POSITION_Z ? 0 : 1), n.set(e & i.FREEZE_ROTATION_X ? 0 : 1, e & i.FREEZE_ROTATION_Y ? 0 : 1, e & i.FREEZE_ROTATION_Z ? 0 : 1)
        }, i.prototype.initialize = function() {
            this.destroy();
            var e = this.cannonBody = new CANNON.Body({
                mass: this._mass,
                linearDamping: this._linearDamping,
                angularDamping: this._angularDamping,
                sleepSpeedLimit: this._sleepingThreshold,
                sleepTimeLimit: this._sleepingTimeLimit
            });
            i.constraintsToCannonFactors(this.constraints, e.linearFactor, e.angularFactor), this._system.cannonWorld.addBody(e), this._system._entities[e.id] = this._entity, this._initialized || (e.velocity.copy(this._velocity), e.angularVelocity.copy(this._angularVelocity)), this.traverseColliders(this._entity, function(e, t, n, r) {
                this.addCollider(e, n, r), e.colliderComponent.bodyEntity = this._entity
            }), this._isKinematic && (e.type = CANNON.Body.KINEMATIC), this.setTransformFromEntity(this._entity), e.aabbNeedsUpdate = !0, this.emitInitialized(this._entity)
        }, i.prototype.initializeJoint = function(e) {
            var t = this.cannonBody,
                n = (e.connectedEntity.rigidBodyComponent || e.connectedEntity.colliderComponent).cannonBody,
                r = void 0;
            if (e instanceof _.default) {
                var i = e.localPivot.clone();
                i.mul(this._entity.transformComponent.transform.scale);
                var o = new CANNON.Vec3,
                    a = new CANNON.Vec3;
                if (o.copy(i), e.autoConfigureConnectedPivot) t.pointToWorldFrame(o, a), n.pointToLocalFrame(a, a);
                else {
                    var s = e.connectedLocalPivot.clone();
                    s.mul(e.connectedEntity.transformComponent.transform.scale), a.copy(s)
                }
                r = new CANNON.PointToPointConstraint(t, o, n, a)
            } else if (e instanceof b.default) {
                var o = new CANNON.Vec3,
                    a = new CANNON.Vec3,
                    u = new CANNON.Vec3,
                    l = new CANNON.Vec3,
                    i = e.localPivot.clone();
                if (i.mul(this._entity.transformComponent.transform.scale), o.copy(i), u.copy(e.localAxis), e.autoConfigureConnectedPivot) t.pointToWorldFrame(o, a), n.pointToLocalFrame(a, a);
                else {
                    var s = e.connectedLocalPivot.clone();
                    s.mul(e.connectedEntity.transformComponent.transform.scale), a.copy(s)
                }
                l.copy(e.localAxis), t.vectorToWorldFrame(e.localAxis, l), n.vectorToLocalFrame(l, l), r = new CANNON.HingeConstraint(t, n, {
                    pivotA: o,
                    pivotB: a,
                    axisA: u,
                    axisB: l,
                    collideConnected: e.collideConnected
                })
            } else console.warn("Unhandled joint: ", e);
            r && (t.world.addConstraint(r), e.cannonJoint = r)
        }, i.copyScaleFromColliderToCannonShape = function(e, t) {
            if (t instanceof p.default) e.radius = t.radius;
            else if (t instanceof d.default) e.halfExtents.copy(t.halfExtents), e.updateConvexPolyhedronRepresentation(), e.updateBoundingSphereRadius();
            else if (t instanceof y.default) {
                var n = void 0;
                C || (C = new CANNON.Vec3), n = C, n.copy(t.scale), e.setScale(n)
            }
            e.updateBoundingSphereRadius()
        }, i.prototype.destroyJoint = function(e) {
            var t = this.cannonBody;
            t && e.cannonJoint && (t.world.removeConstraint(e.cannonJoint), e.cannonJoint = null)
        }, i.prototype.addCollider = function(e, t, n) {
            var r = this.cannonBody,
                i = e.colliderComponent;
            i.updateWorldCollider(!0);
            var o = i.worldCollider,
                a = i.cannonShape = w.default.getCannonShape(o);
            this._system._shapeIdToColliderEntityMap.set(a.id, e);
            var s = new CANNON.Material;
            s.friction = i.material ? i.material.friction : -1, s.restitution = i.material ? i.material.restitution : -1, a.material = s, a.collisionResponse = !i.isTrigger;
            var u = new CANNON.Vec3;
            t && u.copy(t);
            var l = new CANNON.Quaternion;
            t && l.copy(n), r.addShape(a, u, l), this._colliderEntities.push(e)
        }, i.prototype.clone = function() {
            return new i({
                isKinematic: this._isKinematic,
                mass: this._mass,
                velocity: this._velocity,
                angularVelocity: this._angularVelocity,
                linearDamping: this._linearDamping,
                angularDamping: this._angularDamping,
                sleepingThreshold: this._sleepingThreshold,
                sleepingTimeLimit: this._sleepingTimeLimit
            })
        }, i.prototype.api = {}, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        e = e || {}, this.connectedEntity = e.connectedEntity || null, this.collideConnected = void 0 !== e.collideConnected && e.collideConnected
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        a.default.apply(this, arguments), this.type = "ColliderComponent", e = e || {}, this.cannonBody = null, this.cannonShape = null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(353),
        a = r(o),
        s = n(127),
        u = r(s),
        l = n(128),
        f = r(l),
        c = n(161),
        d = r(c),
        h = n(162),
        p = r(h),
        m = n(163),
        y = r(m),
        v = n(82),
        _ = r(v),
        g = n(0),
        b = r(g),
        x = n(34),
        w = r(x),
        E = new w.default;
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.type = "ColliderComponent", i.prototype.initialize = function() {
        var e = null;
        this.material && (e = new CANNON.Material, e.friction = this.material.friction, e.restitution = this.material.restitution), this.updateWorldCollider();
        var t = this.cannonShape = i.getCannonShape(this.worldCollider);
        t.material = e, t.collisionResponse = !this.isTrigger;
        var n = this.entity,
            r = n.transformComponent.sync().worldTransform,
            o = new CANNON.Vec3,
            a = new CANNON.Quaternion;
        o.copy(r.translation), E.fromRotationMatrix(r.rotation), a.copy(E);
        var s = new CANNON.Body({
            mass: 0,
            position: o,
            quaternion: a
        });
        this.system.cannonWorld.addBody(s), this.cannonBody = s, this.system._shapeIdToColliderEntityMap.set(t.id, n);
        var l = this.worldCollider;
        if (l instanceof f.default) t.radius = l.radius;
        else if (l instanceof u.default) t.halfExtents.copy(l.halfExtents), t.updateConvexPolyhedronRepresentation();
        else if (l instanceof d.default) {
            var c = new CANNON.Vec3;
            c.copy(l.scale), t.setScale(c)
        }
        t.updateBoundingSphereRadius(), s.computeAABB(), s.addShape(t), s.aabbNeedsUpdate = !0
    }, i.prototype.destroy = function() {
        var e = this,
            t = this.cannonBody;
        t.shapes.forEach(function(t) {
            e.system._shapeIdToColliderEntityMap.delete(t.id)
        }), this.system.cannonWorld.removeBody(t), this.cannonBody = null, this.cannonShape = null
    }, i.numCylinderSegments = 10, i.getCannonShape = function(e) {
        var t = void 0;
        if (e instanceof u.default) {
            var n = new CANNON.Vec3;
            n.copy(e.halfExtents), t = new CANNON.Box(n)
        } else if (e instanceof f.default) t = new CANNON.Sphere(e.radius);
        else if (e instanceof p.default) t = new CANNON.Plane;
        else if (e instanceof y.default) {
            t = new CANNON.Cylinder(e.radius, e.radius, e.height, i.numCylinderSegments);
            var r = new CANNON.Quaternion;
            r.setFromAxisAngle(new b.default(0, 0, 1), -Math.PI / 2), t.transformAllPoints(new b.default, r), t.computeEdges(), t.updateBoundingSphereRadius()
        } else if (e instanceof d.default) {
            if ("Triangles" !== e.meshData.indexModes[0]) throw new Error("MeshCollider data must be a triangle mesh!");
            t = new CANNON.Trimesh(e.meshData.getAttributeBuffer("POSITION"), e.meshData.getIndexBuffer())
        } else console.warn("Unhandled collider: ", e);
        return t
    }, i.applyOnEntity = function(e, t) {
        if (e instanceof _.default) return t.setComponent(new i({
            collider: e
        })), !0
    }, i.prototype.syncTransform = function() {
        this.updateWorldCollider();
        var e = this.entity,
            t = e.transformComponent.sync().worldTransform,
            n = new CANNON.Vec3,
            r = new CANNON.Quaternion;
        n.copy(t.translation), E.fromRotationMatrix(t.rotation), r.copy(E);
        var i = this.cannonBody;
        i.position = n, i.quaternion = r;
        var o = this.worldCollider,
            a = this.cannonShape;
        if (o instanceof f.default) a.radius = o.radius;
        else if (o instanceof u.default) a.halfExtents.copy(o.halfExtents), a.updateConvexPolyhedronRepresentation();
        else if (o instanceof d.default) {
            var s = new CANNON.Vec3;
            s.copy(o.scale), a.setScale(s)
        }
        a.updateBoundingSphereRadius(), i.computeAABB(), i.aabbNeedsUpdate = !0
    }, t.default = i
}, , , , , , , function(e, t) {
    var n;
    n = function() {
        return this
    }();
    try {
        n = n || Function("return this")() || (0, eval)("this")
    } catch (e) {
        "object" == typeof window && (n = window)
    }
    e.exports = n
}, function(e, t, n) {
    e.exports = !n(27) && !n(14)(function() {
        return 7 != Object.defineProperty(n(167)("div"), "a", {
            get: function() {
                return 7
            }
        }).a
    })
}, function(e, t, n) {
    t.f = n(23)
}, function(e, t, n) {
    var r = n(39),
        i = n(43),
        o = n(133)(!1),
        a = n(169)("IE_PROTO");
    e.exports = function(e, t) {
        var n, s = i(e),
            u = 0,
            l = [];
        for (n in s) n != a && r(s, n) && l.push(n);
        for (; t.length > u;) r(s, n = t[u++]) && (~o(l, n) || l.push(n));
        return l
    }
}, function(e, t, n) {
    var r = n(28),
        i = n(11),
        o = n(85);
    e.exports = n(27) ? Object.defineProperties : function(e, t) {
        i(e);
        for (var n, a = o(t), s = a.length, u = 0; s > u;) r.f(e, n = a[u++], t[n]);
        return e
    }
}, function(e, t, n) {
    var r = n(43),
        i = n(88).f,
        o = {}.toString,
        a = "object" == typeof window && window && Object.getOwnPropertyNames ? Object.getOwnPropertyNames(window) : [],
        s = function(e) {
            try {
                return i(e)
            } catch (e) {
                return a.slice()
            }
        };
    e.exports.f = function(e) {
        return a && "[object Window]" == o.call(e) ? s(e) : i(r(e))
    }
}, function(e, t, n) {
    "use strict";
    var r = n(85),
        i = n(134),
        o = n(114),
        a = n(35),
        s = n(113),
        u = Object.assign;
    e.exports = !u || n(14)(function() {
        var e = {},
            t = {},
            n = Symbol(),
            r = "abcdefghijklmnopqrst";
        return e[n] = 7, r.split("").forEach(function(e) {
            t[e] = e
        }), 7 != u({}, e)[n] || Object.keys(u({}, t)).join("") != r
    }) ? function(e, t) {
        for (var n = a(e), u = arguments.length, l = 1, f = i.f, c = o.f; u > l;)
            for (var d, h = s(arguments[l++]), p = f ? r(h).concat(f(h)) : r(h), m = p.length, y = 0; m > y;) c.call(h, d = p[y++]) && (n[d] = h[d]);
        return n
    } : u
}, function(e, t) {
    e.exports = Object.is || function(e, t) {
        return e === t ? 0 !== e || 1 / e == 1 / t : e != e && t != t
    }
}, function(e, t, n) {
    "use strict";
    var r = n(42),
        i = n(19),
        o = n(135),
        a = [].slice,
        s = {},
        u = function(e, t, n) {
            if (!(t in s)) {
                for (var r = [], i = 0; i < t; i++) r[i] = "a[" + i + "]";
                s[t] = Function("F,a", "return new F(" + r.join(",") + ")")
            }
            return s[t](e, n)
        };
    e.exports = Function.bind || function(e) {
        var t = r(this),
            n = a.call(arguments, 1),
            s = function() {
                var r = n.concat(a.call(arguments));
                return this instanceof s ? u(t, r.length, r) : o(t, r, e)
            };
        return i(t.prototype) && (s.prototype = t.prototype), s
    }
}, function(e, t, n) {
    var r = n(13).parseInt,
        i = n(103).trim,
        o = n(174),
        a = /^[\-+]?0[xX]/;
    e.exports = 8 !== r(o + "08") || 22 !== r(o + "0x16") ? function(e, t) {
        var n = i(String(e), 3);
        return r(n, t >>> 0 || (a.test(n) ? 16 : 10))
    } : r
}, function(e, t, n) {
    var r = n(13).parseFloat,
        i = n(103).trim;
    e.exports = 1 / r(n(174) + "-0") != -1 / 0 ? function(e) {
        var t = i(String(e), 3),
            n = r(t);
        return 0 === n && "-" == t.charAt(0) ? -0 : n
    } : r
}, function(e, t, n) {
    var r = n(53);
    e.exports = function(e, t) {
        if ("number" != typeof e && "Number" != r(e)) throw TypeError(t);
        return +e
    }
}, function(e, t, n) {
    var r = n(19),
        i = Math.floor;
    e.exports = function(e) {
        return !r(e) && isFinite(e) && i(e) === e
    }
}, function(e, t) {
    e.exports = Math.log1p || function(e) {
        return (e = +e) > -1e-8 && e < 1e-8 ? e - e * e / 2 : Math.log(1 + e)
    }
}, function(e, t, n) {
    var r = n(11);
    e.exports = function(e, t, n, i) {
        try {
            return i ? t(r(n)[0], n[1]) : t(n)
        } catch (t) {
            var o = e.return;
            throw void 0 !== o && r(o.call(e)), t
        }
    }
}, function(e, t, n) {
    var r = n(42),
        i = n(35),
        o = n(113),
        a = n(32);
    e.exports = function(e, t, n, s, u) {
        r(t);
        var l = i(e),
            f = o(l),
            c = a(l.length),
            d = u ? c - 1 : 0,
            h = u ? -1 : 1;
        if (n < 2)
            for (;;) {
                if (d in f) {
                    s = f[d], d += h;
                    break
                }
                if (d += h, u ? d < 0 : c <= d) throw TypeError("Reduce of empty array with no initial value")
            }
        for (; u ? d >= 0 : c > d; d += h) d in f && (s = t(s, f[d], d, l));
        return s
    }
}, function(e, t, n) {
    "use strict";
    var r = n(35),
        i = n(86),
        o = n(32);
    e.exports = [].copyWithin || function(e, t) {
        var n = r(this),
            a = o(n.length),
            s = i(e, a),
            u = i(t, a),
            l = arguments.length > 2 ? arguments[2] : void 0,
            f = Math.min((void 0 === l ? a : i(l, a)) - u, a - s),
            c = 1;
        for (u < s && s < u + f && (c = -1, u += f - 1, s += f - 1); f-- > 0;) u in n ? n[s] = n[u] : delete n[s], s += c, u += c;
        return n
    }
}, function(e, t) {
    e.exports = function(e, t) {
        return {
            value: t,
            done: !!e
        }
    }
}, function(e, t, n) {
    n(27) && "g" != /./g.flags && n(28).f(RegExp.prototype, "flags", {
        configurable: !0,
        get: n(138)
    })
}, function(e, t, n) {
    "use strict";
    var r = n(253);
    e.exports = n(140)("Map", function(e) {
        return function() {
            return e(this, arguments.length > 0 ? arguments[0] : void 0)
        }
    }, {
        get: function(e) {
            var t = r.getEntry(this, e);
            return t && t.v
        },
        set: function(e, t) {
            return r.def(this, 0 === e ? 0 : e, t)
        }
    }, r, !0)
}, function(e, t, n) {
    "use strict";
    var r = n(28).f,
        i = n(87),
        o = n(91),
        a = n(72),
        s = n(90),
        u = n(54),
        l = n(106),
        f = n(180),
        c = n(250),
        d = n(89),
        h = n(27),
        p = n(78).fastKey,
        m = h ? "_s" : "size",
        y = function(e, t) {
            var n, r = p(t);
            if ("F" !== r) return e._i[r];
            for (n = e._f; n; n = n.n)
                if (n.k == t) return n
        };
    e.exports = {
        getConstructor: function(e, t, n, f) {
            var c = e(function(e, r) {
                s(e, c, t, "_i"), e._i = i(null), e._f = void 0, e._l = void 0, e[m] = 0, void 0 != r && l(r, n, e[f], e)
            });
            return o(c.prototype, {
                clear: function() {
                    for (var e = this, t = e._i, n = e._f; n; n = n.n) n.r = !0, n.p && (n.p = n.p.n = void 0), delete t[n.i];
                    e._f = e._l = void 0, e[m] = 0
                },
                delete: function(e) {
                    var t = this,
                        n = y(t, e);
                    if (n) {
                        var r = n.n,
                            i = n.p;
                        delete t._i[n.i], n.r = !0, i && (i.n = r), r && (r.p = i), t._f == n && (t._f = r), t._l == n && (t._l = i), t[m]--
                    }
                    return !!n
                },
                forEach: function(e) {
                    s(this, c, "forEach");
                    for (var t, n = a(e, arguments.length > 1 ? arguments[1] : void 0, 3); t = t ? t.n : this._f;)
                        for (n(t.v, t.k, this); t && t.r;) t = t.p
                },
                has: function(e) {
                    return !!y(this, e)
                }
            }), h && r(c.prototype, "size", {
                get: function() {
                    return u(this[m])
                }
            }), c
        },
        def: function(e, t, n) {
            var r, i, o = y(e, t);
            return o ? o.v = n : (e._l = o = {
                i: i = p(t, !0),
                k: t,
                v: n,
                p: r = e._l,
                n: void 0,
                r: !1
            }, e._f || (e._f = o), r && (r.n = o), e[m]++, "F" !== i && (e._i[i] = o)), e
        },
        getEntry: y,
        setStrong: function(e, t, n) {
            f(e, t, function(e, t) {
                this._t = e, this._k = t, this._l = void 0
            }, function() {
                for (var e = this, t = e._k, n = e._l; n && n.r;) n = n.p;
                return e._t && (e._l = n = n ? n.n : e._t._f) ? "keys" == t ? c(0, n.k) : "values" == t ? c(0, n.v) : c(0, [n.k, n.v]) : (e._t = void 0, c(1))
            }, n ? "entries" : "values", !n, !0), d(t)
        }
    }
}, function(e, t, n) {
    "use strict";
    var r = n(253);
    e.exports = n(140)("Set", function(e) {
        return function() {
            return e(this, arguments.length > 0 ? arguments[0] : void 0)
        }
    }, {
        add: function(e) {
            return r.def(this, e = 0 === e ? 0 : e, e)
        }
    }, r)
}, function(e, t, n) {
    "use strict";
    var r, i = n(62)(0),
        o = n(41),
        a = n(78),
        s = n(239),
        u = n(256),
        l = n(19),
        f = a.getWeak,
        c = Object.isExtensible,
        d = u.ufstore,
        h = {},
        p = function(e) {
            return function() {
                return e(this, arguments.length > 0 ? arguments[0] : void 0)
            }
        },
        m = {
            get: function(e) {
                if (l(e)) {
                    var t = f(e);
                    return !0 === t ? d(this).get(e) : t ? t[this._i] : void 0
                }
            },
            set: function(e, t) {
                return u.def(this, e, t)
            }
        },
        y = e.exports = n(140)("WeakMap", p, m, u, !0, !0);
    7 != (new y).set((Object.freeze || Object)(h), 7).get(h) && (r = u.getConstructor(p), s(r.prototype, m), a.NEED = !0, i(["delete", "has", "get", "set"], function(e) {
        var t = y.prototype,
            n = t[e];
        o(t, e, function(t, i) {
            if (l(t) && !c(t)) {
                this._f || (this._f = new r);
                var o = this._f[e](t, i);
                return "set" == e ? this : o
            }
            return n.call(this, t, i)
        })
    }))
}, function(e, t, n) {
    "use strict";
    var r = n(91),
        i = n(78).getWeak,
        o = n(11),
        a = n(19),
        s = n(90),
        u = n(106),
        l = n(62),
        f = n(39),
        c = l(5),
        d = l(6),
        h = 0,
        p = function(e) {
            return e._l || (e._l = new m)
        },
        m = function() {
            this.a = []
        },
        y = function(e, t) {
            return c(e.a, function(e) {
                return e[0] === t
            })
        };
    m.prototype = {
        get: function(e) {
            var t = y(this, e);
            if (t) return t[1]
        },
        has: function(e) {
            return !!y(this, e)
        },
        set: function(e, t) {
            var n = y(this, e);
            n ? n[1] = t : this.a.push([e, t])
        },
        delete: function(e) {
            var t = d(this.a, function(t) {
                return t[0] === e
            });
            return ~t && this.a.splice(t, 1), !!~t
        }
    }, e.exports = {
        getConstructor: function(e, t, n, o) {
            var l = e(function(e, r) {
                s(e, l, t, "_i"), e._i = h++, e._l = void 0, void 0 != r && u(r, n, e[o], e)
            });
            return r(l.prototype, {
                delete: function(e) {
                    if (!a(e)) return !1;
                    var t = i(e);
                    return !0 === t ? p(this).delete(e) : t && f(t, this._i) && delete t[this._i]
                },
                has: function(e) {
                    if (!a(e)) return !1;
                    var t = i(e);
                    return !0 === t ? p(this).has(e) : t && f(t, this._i)
                }
            }), l
        },
        def: function(e, t, n) {
            var r = i(o(t), !0);
            return !0 === r ? p(e).set(t, n) : r[e._i] = n, e
        },
        ufstore: p
    }
}, function(e, t, n) {
    var r = n(88),
        i = n(134),
        o = n(11),
        a = n(13).Reflect;
    e.exports = a && a.ownKeys || function(e) {
        var t = r.f(o(e)),
            n = i.f;
        return n ? t.concat(n(e)) : t
    }
}, function(e, t, n) {
    var r = n(32),
        i = n(176),
        o = n(54);
    e.exports = function(e, t, n, a) {
        var s = String(o(e)),
            u = s.length,
            l = void 0 === n ? " " : String(n),
            f = r(t);
        if (f <= u || "" == l) return s;
        var c = f - u,
            d = i.call(l, Math.ceil(c / l.length));
        return d.length > c && (d = d.slice(0, c)), a ? d + s : s + d
    }
}, function(e, t, n) {
    var r = n(85),
        i = n(43),
        o = n(114).f;
    e.exports = function(e) {
        return function(t) {
            for (var n, a = i(t), s = r(a), u = s.length, l = 0, f = []; u > l;) o.call(a, n = s[l++]) && f.push(e ? [n, a[n]] : a[n]);
            return f
        }
    }
}, function(e, t, n) {
    var r = n(115),
        i = n(261);
    e.exports = function(e) {
        return function() {
            if (r(this) != e) throw TypeError(e + "#toJSON isn't generic");
            return i(this)
        }
    }
}, function(e, t, n) {
    var r = n(106);
    e.exports = function(e, t) {
        var n = [];
        return r(e, !1, n.push, n, t), n
    }
}, function(e, t) {
    function n() {
        throw new Error("setTimeout has not been defined")
    }

    function r() {
        throw new Error("clearTimeout has not been defined")
    }

    function i(e) {
        if (f === setTimeout) return setTimeout(e, 0);
        if ((f === n || !f) && setTimeout) return f = setTimeout, setTimeout(e, 0);
        try {
            return f(e, 0)
        } catch (t) {
            try {
                return f.call(null, e, 0)
            } catch (t) {
                return f.call(this, e, 0)
            }
        }
    }

    function o(e) {
        if (c === clearTimeout) return clearTimeout(e);
        if ((c === r || !c) && clearTimeout) return c = clearTimeout, clearTimeout(e);
        try {
            return c(e)
        } catch (t) {
            try {
                return c.call(null, e)
            } catch (t) {
                return c.call(this, e)
            }
        }
    }

    function a() {
        m && h && (m = !1, h.length ? p = h.concat(p) : y = -1, p.length && s())
    }

    function s() {
        if (!m) {
            var e = i(a);
            m = !0;
            for (var t = p.length; t;) {
                for (h = p, p = []; ++y < t;) h && h[y].run();
                y = -1, t = p.length
            }
            h = null, m = !1, o(e)
        }
    }

    function u(e, t) {
        this.fun = e, this.array = t
    }

    function l() {}
    var f, c, d = e.exports = {};
    ! function() {
        try {
            f = "function" == typeof setTimeout ? setTimeout : n
        } catch (e) {
            f = n
        }
        try {
            c = "function" == typeof clearTimeout ? clearTimeout : r
        } catch (e) {
            c = r
        }
    }();
    var h, p = [],
        m = !1,
        y = -1;
    d.nextTick = function(e) {
        var t = new Array(arguments.length - 1);
        if (arguments.length > 1)
            for (var n = 1; n < arguments.length; n++) t[n - 1] = arguments[n];
        p.push(new u(e, t)), 1 !== p.length || m || i(s)
    }, u.prototype.run = function() {
        this.fun.apply(null, this.array)
    }, d.title = "browser", d.browser = !0, d.env = {}, d.argv = [], d.version = "", d.versions = {}, d.on = l, d.addListener = l, d.once = l, d.off = l, d.removeListener = l, d.removeAllListeners = l, d.emit = l, d.prependListener = l, d.prependOnceListener = l, d.listeners = function(e) {
        return []
    }, d.binding = function(e) {
        throw new Error("process.binding is not supported")
    }, d.cwd = function() {
        return "/"
    }, d.chdir = function(e) {
        throw new Error("process.chdir is not supported")
    }, d.umask = function() {
        return 0
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), n(144);
    var o = n(193),
        a = r(o),
        s = n(26),
        u = r(s);
    i.cCRNFmtDXT1 = 0, i.cCRNFmtDXT3 = 1, i.cCRNFmtDXT5 = 2, i.prototype.arrayBufferCopy = function(e, t, n, r) {
        var i = n / 4,
            o = r % 4,
            a = new Uint32Array(e.buffer, 0, (r - o) / 4),
            s = new Uint32Array(t.buffer),
            u = void 0;
        for (u = 0; u < a.length; u++) s[i + u] = a[u];
        for (u = r - o; u < r; u++) t[n + u] = e[u]
    }, i.prototype.load = function(e, t, n) {
        if (void 0 === window.CrunchModule) return void console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file.");
        var r = window.CrunchModule,
            o = new Uint8Array(e),
            s = e.byteLength,
            u = r._malloc(s),
            l = void 0,
            f = void 0,
            c = void 0,
            d = void 0,
            h = void 0,
            p = void 0,
            m = void 0,
            y = void 0;
        this.arrayBufferCopy(o, r.HEAPU8, u, s), l = r._crn_get_dxt_format(u, s);
        var v = void 0;
        switch (l) {
            case i.cCRNFmtDXT1:
                t.format = "PrecompressedDXT1A", v = 4;
                break;
            case i.cCRNFmtDXT3:
                t.format = "PrecompressedDXT3", v = 8;
                break;
            case i.cCRNFmtDXT5:
                t.format = "PrecompressedDXT5", v = 8;
                break;
            default:
                return console.error("Unsupported image format"), 0
        }
        d = r._crn_get_width(u, s), h = r._crn_get_height(u, s), p = r._crn_get_levels(u, s), c = r._crn_get_uncompressed_size(u, s, 0), f = r._malloc(c);
        var _ = t.image;
        void 0 !== _ && null !== _ || (_ = {}, t.image = _), _.width = d, _.height = h, _.depth = 1;
        var g = [];
        for (t.image.mipmapSizes = [], y = 0; y < p; ++y) y && (c = r._crn_get_uncompressed_size(u, s, y)), r._crn_decompress(u, s, f, c, y), m = new Uint8Array(r.HEAPU8.buffer, f, c), n && (m = a.default.flipDXT(m, d, h, t.format)), g.push(m), t.image.mipmapSizes.push(c), d *= .5, h *= .5;
        t.image.data = g, t.image.useArrays = !0, t.type = "UnsignedByte", t.image.isCompressed = !0, p <= 1 && (t.minFilter = "BilinearNoMipMaps"), _.bpp = v, _.dataReady = !0, _.isData = !0, t.needsUpdate = !0, r._free(u), r._free(f)
    }, i.prototype.dxtToRgb565 = function(e, t, n, r) {
        for (var i = new Uint16Array(4), o = new Uint16Array(n * r), a = 0, s = 0, u = 0, l = 0, f = 0, c = 0, d = 0, h = 0, p = 0, m = n / 4, y = r / 4, v = 0; v < y; v++)
            for (var _ = 0; _ < m; _++) u = t + 4 * (v * m + _), i[0] = e[u], i[1] = e[u + 1], l = 31 & i[0], f = 2016 & i[0], c = 63488 & i[0], d = 31 & i[1], h = 2016 & i[1], p = 63488 & i[1], i[2] = 5 * l + 3 * d >> 3 | 5 * f + 3 * h >> 3 & 2016 | 5 * c + 3 * p >> 3 & 63488, i[3] = 5 * d + 3 * l >> 3 | 5 * h + 3 * f >> 3 & 2016 | 5 * p + 3 * c >> 3 & 63488, a = e[u + 2], s = 4 * v * n + 4 * _, o[s] = i[3 & a], o[s + 1] = i[a >> 2 & 3], o[s + 2] = i[a >> 4 & 3], o[s + 3] = i[a >> 6 & 3], s += n, o[s] = i[a >> 8 & 3], o[s + 1] = i[a >> 10 & 3], o[s + 2] = i[a >> 12 & 3], o[s + 3] = i[a >> 14], a = e[u + 3], s += n, o[s] = i[3 & a], o[s + 1] = i[a >> 2 & 3], o[s + 2] = i[a >> 4 & 3], o[s + 3] = i[a >> 6 & 3], s += n, o[s] = i[a >> 8 & 3], o[s + 1] = i[a >> 10 & 3], o[s + 2] = i[a >> 12 & 3], o[s + 3] = i[a >> 14];
        return o
    }, i.prototype.isSupported = function() {
        return !!u.default.CompressedTextureS3TC
    }, i.prototype.toString = function() {
        return "CrunchLoader"
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        this.header = null, this.offset = 0, this.use_rle = !1, this.use_pal = !1, this.use_rgb = !1, this.use_grey = !1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.TYPE_NO_DATA = 0, r.TYPE_INDEXED = 1, r.TYPE_RGB = 2, r.TYPE_GREY = 3, r.TYPE_RLE_INDEXED = 9, r.TYPE_RLE_RGB = 10, r.TYPE_RLE_GREY = 11, r.ORIGIN_MASK = 48, r.ORIGIN_SHIFT = 4, r.ORIGIN_BL = 0, r.ORIGIN_BR = 1, r.ORIGIN_UL = 2, r.ORIGIN_UR = 3, r.prototype.load = function(e, t) {
        this.loadData(new Uint8Array(e));
        var n = this.getCanvas();
        t.setImage(n, n.width, n.height), n.dataReady = !0, t.needsUpdate = !0
    }, r.prototype.loadData = function(e) {
        if (e.length < 19) throw new Error("Targa::load() - Not enough data to contain header.");
        if (this.offset = 0, this.header = {
                id_length: e[this.offset++],
                colormap_type: e[this.offset++],
                image_type: e[this.offset++],
                colormap_index: e[this.offset++] | e[this.offset++] << 8,
                colormap_length: e[this.offset++] | e[this.offset++] << 8,
                colormap_size: e[this.offset++],
                origin: [e[this.offset++] | e[this.offset++] << 8, e[this.offset++] | e[this.offset++] << 8],
                width: e[this.offset++] | e[this.offset++] << 8,
                height: e[this.offset++] | e[this.offset++] << 8,
                pixel_size: e[this.offset++],
                flags: e[this.offset++]
            }, this.checkHeader(), this.header.id_length + this.offset > e.length) throw new Error("Targa::load() - No data ?");
        switch (this.offset += this.header.id_length, this.header.image_type) {
            case r.TYPE_RLE_INDEXED:
                this.use_rle = !0;
                break;
            case r.TYPE_INDEXED:
                this.use_pal = !0;
                break;
            case r.TYPE_RLE_RGB:
                this.use_rle = !0;
                break;
            case r.TYPE_RGB:
                this.use_rgb = !0;
                break;
            case r.TYPE_RLE_GREY:
                this.use_rle = !0;
                break;
            case r.TYPE_GREY:
                this.use_grey = !0
        }
        this.parse(e)
    }, r.prototype.checkHeader = function() {
        switch (this.header.image_type) {
            case r.TYPE_INDEXED:
            case r.TYPE_RLE_INDEXED:
                if (this.header.colormap_length > 256 || 24 !== this.header.colormap_size || 1 !== this.header.colormap_type) throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");
                break;
            case r.TYPE_RGB:
            case r.TYPE_GREY:
            case r.TYPE_RLE_RGB:
            case r.TYPE_RLE_GREY:
                if (this.header.colormap_type) throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");
                break;
            case r.TYPE_NO_DATA:
                throw new Error("Targa::checkHeader() - No data on this TGA file");
            default:
                throw new Error("Targa::checkHeader() - Invalid type '" + this.header.image_type + "'")
        }
        if (this.header.width <= 0 || this.header.height <= 0) throw new Error("Targa::checkHeader() - Invalid image size");
        if (8 !== this.header.pixel_size && 16 !== this.header.pixel_size && 24 !== this.header.pixel_size && 32 !== this.header.pixel_size) throw new Error("Targa::checkHeader() - Invalid pixel size '" + this.header.pixel_size + "'")
    }, r.prototype.parse = function(e) {
        var t = void 0,
            n = void 0,
            r = void 0,
            i = void 0;
        if (t = this.header, r = t.pixel_size >> 3, i = t.width * t.height * r, this.use_pal && (this.palettes = e.subarray(this.offset, this.offset += t.colormap_length * r)), this.use_rle) {
            n = new Uint8Array(i);
            for (var o = void 0, a = void 0, s = void 0, u = 0, l = new Uint8Array(r); u < i;)
                if (o = e[this.offset++], a = 1 + (127 & o), 128 & o) {
                    for (s = 0; s < r; ++s) l[s] = e[this.offset++];
                    for (s = 0; s < a; ++s) n.set(l, u + s * r);
                    u += r * a
                } else {
                    for (a *= r, s = 0; s < a; ++s) n[u + s] = e[this.offset++];
                    u += a
                }
        } else n = e.subarray(this.offset, this.offset += this.use_pal ? t.width * t.height : i);
        this.image = n
    }, r.prototype.getImageData = function(e) {
        var t = this.header.width,
            n = this.header.height,
            i = void 0,
            o = void 0,
            a = void 0,
            s = void 0,
            u = void 0,
            l = void 0,
            f = void 0,
            c = void 0;
        switch (c = e || {
            width: t,
            height: n,
            data: new Uint8Array(t * n * 4)
        }, (this.header.flags & r.ORIGIN_MASK) >> r.ORIGIN_SHIFT) {
            default:
                case r.ORIGIN_UL:
                i = 0,
            a = 1,
            l = t,
            o = 0,
            s = 1,
            u = n;
            break;
            case r.ORIGIN_BL:
                    i = 0,
                a = 1,
                l = t,
                o = n - 1,
                s = -1,
                u = -1;
                break;
            case r.ORIGIN_UR:
                    i = t - 1,
                a = -1,
                l = -1,
                o = 0,
                s = 1,
                u = n;
                break;
            case r.ORIGIN_BR:
                    i = t - 1,
                a = -1,
                l = -1,
                o = n - 1,
                s = -1,
                u = -1
        }
        return f = "getImageData" + (this.use_grey ? "Grey" : "") + this.header.pixel_size + "bits", this[f](c.data, o, s, u, i, a, l), c
    }, r.prototype.getCanvas = function() {
        var e = document.createElement("canvas"),
            t = e.getContext("2d"),
            n = t.createImageData(this.header.width, this.header.height);
        return e.width = this.header.width, e.height = this.header.height, t.putImageData(this.getImageData(n), 0, 0), e
    }, r.prototype.getDataURL = function(e) {
        return this.getCanvas().toDataURL(e || "image/png")
    }, r.prototype.getImageData8bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.palettes,
            l = this.header.width,
            f = void 0,
            c = 0,
            d = void 0,
            h = void 0;
        for (h = t; h !== r; h += n)
            for (d = i; d !== a; d += o, c++) f = s[c], e[4 * (d + l * h) + 3] = 255, e[4 * (d + l * h) + 2] = u[3 * f + 0], e[4 * (d + l * h) + 1] = u[3 * f + 1], e[4 * (d + l * h) + 0] = u[3 * f + 2];
        return e
    }, r.prototype.getImageData16bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.header.width,
            l = void 0,
            f = 0,
            c = void 0,
            d = void 0;
        for (d = t; d !== r; d += n)
            for (c = i; c !== a; c += o, f += 2) l = s[f + 0] + (s[f + 1] << 8), e[4 * (c + u * d) + 0] = (31744 & l) >> 7, e[4 * (c + u * d) + 1] = (992 & l) >> 2, e[4 * (c + u * d) + 2] = (31 & l) >> 3, e[4 * (c + u * d) + 3] = 32768 & l ? 0 : 255;
        return e
    }, r.prototype.getImageData24bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.header.width,
            l = 0,
            f = void 0,
            c = void 0;
        for (c = t; c !== r; c += n)
            for (f = i; f !== a; f += o, l += 3) e[4 * (f + u * c) + 3] = 255, e[4 * (f + u * c) + 2] = s[l + 0], e[4 * (f + u * c) + 1] = s[l + 1], e[4 * (f + u * c) + 0] = s[l + 2];
        return e
    }, r.prototype.getImageData32bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.header.width,
            l = 0,
            f = void 0,
            c = void 0;
        for (c = t; c !== r; c += n)
            for (f = i; f !== a; f += o, l += 4) e[4 * (f + u * c) + 2] = s[l + 0], e[4 * (f + u * c) + 1] = s[l + 1], e[4 * (f + u * c) + 0] = s[l + 2], e[4 * (f + u * c) + 3] = s[l + 3];
        return e
    }, r.prototype.getImageDataGrey8bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.header.width,
            l = void 0,
            f = 0,
            c = void 0,
            d = void 0;
        for (d = t; d !== r; d += n)
            for (c = i; c !== a; c += o, f++) l = s[f], e[4 * (c + u * d) + 0] = l, e[4 * (c + u * d) + 1] = l, e[4 * (c + u * d) + 2] = l, e[4 * (c + u * d) + 3] = 255;
        return e
    }, r.prototype.getImageDataGrey16bits = function(e, t, n, r, i, o, a) {
        var s = this.image,
            u = this.header.width,
            l = 0,
            f = void 0,
            c = void 0;
        for (c = t; c !== r; c += n)
            for (f = i; f !== a; f += o, l += 2) e[4 * (f + u * c) + 0] = s[l + 0], e[4 * (f + u * c) + 1] = s[l + 0], e[4 * (f + u * c) + 2] = s[l + 0], e[4 * (f + u * c) + 3] = s[l + 1];
        return e
    }, r.prototype.isSupported = function() {
        return !0
    }, r.prototype.toString = function() {
        return "TgaLoader"
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(26),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.getTextureByteSize = function(e, t, n) {
        switch (e) {
            case 35840:
            case 35842:
                return Math.floor((Math.max(t, 8) * Math.max(n, 8) * 4 + 7) / 8);
            case 35841:
            case 35843:
                return Math.floor((Math.max(t, 16) * Math.max(n, 8) * 2 + 7) / 8);
            default:
                return 0
        }
    }, r.getMipMappedSize = function(e, t, n, i) {
        for (var o = n, a = i, s = new Array(e), u = 0; u < e; u++) {
            var l = r.getTextureByteSize(t, o, a);
            s[u] = l, o = Math.max(o / 2, 1), a = Math.max(a / 2, 1)
        }
        return s
    }, r.getRowOffsetForCube = function(e, t) {
        for (var n = 0, r = 0; r < e; r++) n += 6 * t[r];
        return n
    }, r.getColumnOffsetForCube = function(e, t, n) {
        return n[e] * t
    }, r.prototype.load = function(e, t, n) {
        var i = new Int32Array(e, 0, 13);
        if (55727696 != i[0] && 1347834371 != i[0]) return console.error("Invalid magic number in PVR header"), 0;
        var o = i[2],
            a = void 0,
            s = void 0,
            u = void 0;
        switch (o) {
            case 0:
                s = 35841, u = "PVR_2BPP_RGB", a = 2;
                break;
            case 1:
                s = 35843, u = "PVR_2BPP_RGBA", a = 2;
                break;
            case 2:
                s = 35840, u = "PVR_4BPP_RGB", a = 4;
                break;
            case 3:
                s = 35842, u = "PVR_4BPP_RGBA", a = 4;
                break;
            default:
                return console.error("Unsupported PVR format: " + o), 0
        }
        var l = i[7],
            f = i[6],
            c = i[11],
            d = i[10],
            h = i[12] + 52,
            p = new Uint8Array(e, h),
            m = t.image;
        void 0 !== m && null !== m || (m = {}, t.image = m), m.width = l, m.height = f, m.depth = 1, m.bpp = a, c <= 1 && (t.minFilter = "BilinearNoMipMaps");
        var y = r.getMipMappedSize(c, s, l, f);
        t.image.mipmapSizes = y;
        for (var v = 0, _ = 0; _ < y.length; _++) v += y[_];
        var g = [];
        if (6 == d) {
            t.variant = "CUBE";
            for (var b = 0; b < 6; b++) {
                for (var x = [], w = 0; w < y.length; w++)
                    for (var E = r.getRowOffsetForCube(w, y) + r.getColumnOffsetForCube(w, b, y), S = 0; S < y[w]; S++) x.push(p[E + S]);
                g.push(new Uint8Array(x))
            }
        } else {
            if (1 != d) return console.error("Unsupported Cube texture with face count != 6. Needs to be a cube wth 6 faces for webgl 1.0"), 0;
            1 == d && (g = p)
        }
        t.image.data = g, t.image.useArrays = !0, t.format = u, t.type = "UnsignedByte", t.image.isCompressed = !0, m.dataReady = !0, m.isData = !0, t.needsUpdate = !0
    }, r.prototype.isSupported = function() {
        return !!o.default.CompressedTexturePVRTC
    }, r.prototype.toString = function() {
        return "PvrtcLoader"
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(26),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.getTextureByteSize = function(e, t, n) {
        switch (e) {
            case 37488:
            case 37489:
            case 37492:
            case 37493:
            case 37494:
            case 37495:
                return Math.floor((t + 3) / 4) * Math.floor((n + 3) / 4) * 8;
            case 37490:
            case 37491:
            case 37496:
            case 37497:
                return Math.floor((t + 3) / 4) * Math.floor((n + 3) / 4) * 16;
            default:
                return 0
        }
    }, r.getBppValue = function(e) {
        switch (e) {
            case 37488:
            case 37489:
            case 37492:
            case 37493:
            case 37494:
            case 37495:
                return 4;
            case 37490:
            case 37491:
            case 37496:
            case 37497:
                return 2;
            default:
                return 0
        }
    }, r.getMipMappedSize = function(e, t, n, i) {
        for (var o = n, a = i, s = new Array(e), u = 0; u < e; u++) {
            var l = r.getTextureByteSize(t, o, a);
            s[u] = l, o = Math.max(o / 2, 1), a = Math.max(a / 2, 1)
        }
        return s
    }, r.getRowOffsetForCube = function(e, t) {
        for (var n = 0, r = 0; r < e; r++) n += 6 * t[r] + 4;
        return n
    }, r.getColumnOffsetForCube = function(e, t, n) {
        return n[e] * t + 4
    }, r.prototype.load = function(e, t, n) {
        var i = new Uint32Array(e, 0, 64);
        if (67305985 != i[3]) return console.error("Invalid magic number in KTX header"), 0;
        var o = i[7],
            a = i[4],
            s = i[5];
        0 != a && 1 != s && console.log("Uncompressed KTX format unsupported.");
        var u = (i[7], void 0);
        switch (o) {
            case 37488:
                u = "KTX_UR11_EAC";
                break;
            case 37489:
                u = "KTX_R11_EAC";
                break;
            case 37490:
                u = "KTX_URG11_EAC";
                break;
            case 37491:
                u = "KTX_RG11_EAC";
                break;
            case 37492:
                u = "KTX_URGB8_ETC2";
                break;
            case 37493:
                u = "KTX_SRGB8_ETC2";
                break;
            case 37494:
                u = "KTX_RGB8A1_ETC2";
                break;
            case 37495:
                u = "KTX_SRGB8A1_ETC2";
                break;
            case 37496:
                u = "KTX_RGBA8_ETC2_EAC";
                break;
            case 37497:
                u = "KTX_SRGBA8_ETC2_EAC";
                break;
            default:
                return console.error("Unsupported KTX-ETC-EAC format: " + o), 0
        }
        var l = i[9],
            f = i[10],
            c = i[14],
            d = i[13],
            h = i[15] + 64,
            p = new Uint8Array(e, h),
            m = (new Uint32Array(e, 64, i[15]), t.image);
        void 0 !== m && null !== m || (m = {}, t.image = m);
        var y = r.getMipMappedSize(c, o, l, f);
        t.image.mipmapSizes = y;
        var v = l,
            _ = f,
            g = 0,
            b = 0,
            x = [];
        if (6 == d) {
            t.variant = "CUBE";
            for (var w = 0; w < d; w++) {
                for (var E = [], S = 0; S < y.length; S++) {
                    for (var M = r.getRowOffsetForCube(S, y) + r.getColumnOffsetForCube(S, w, y), C = new Uint8Array(y[S]), T = 0; T < y[S]; T++) C[T] = p[M + T];
                    E.push(C)
                }
                x[w] = E
            }
        } else
            for (var R = 0; R < y.length; R++) b = y[R], x.push(new Uint8Array(p.buffer, p.byteOffset + g + 4 * R + 4, b * d)), v = ~~(v / 2) > 1 ? ~~(v / 2) : 1, _ = ~~(_ / 2) > 1 ? ~~(_ / 2) : 1, g += b * d;
        m.width = l, m.height = f, m.depth = 1, t.sampler = !1, 1 == c && (t.minFilter = "BilinearNoMipMaps"), t.image.data = x, t.image.bpp = r.getBppValue(o), t.format = u, t.type = "UnsignedByte", t.image.isCompressed = !0, m.dataReady = !0, m.isData = !0, t.needsUpdate = !0
    }, r.prototype.isSupported = function() {
        return !!o.default.CompressedTextureETC
    }, r.prototype.toString = function() {
        return "EtcLoader"
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(17),
        a = r(o),
        s = n(3),
        u = r(s);
    i.loadCanvasFromPath = function(e, t) {
        var n = {};
        3 === arguments.length && (n = arguments[1], t = arguments[2]);
        var r = new Image;
        r.onerror = function() {
            console.error("Failed to load svg!"), t()
        }, r.src = e;
        var i = document.createElement("canvas"),
            o = i.getContext("2d");
        r.onload = function() {
            if (0 === r.width && 0 === r.height) return t();
            if (u.default.defaults(n, {
                    width: r.width,
                    height: r.height,
                    sourceX: 0,
                    sourceY: 0,
                    sourceWidth: r.width,
                    sourceHeight: r.height,
                    destX: 0,
                    destY: 0
                }), u.default.defaults(n, {
                    destWidth: n.width,
                    destHeight: n.height
                }), n.resizeToFit) {
                var e = n.sourceWidth / n.sourceHeight;
                e > 1 ? (n.destHeight = n.destWidth / e, n.destY = .5 * (n.height - n.destHeight)) : e < 1 && (n.destWidth = n.destHeight * e, n.destX = .5 * (n.width - n.destWidth))
            }
            i.width = n.width, i.height = n.height, o.drawImage(r, n.sourceX, n.sourceY, n.sourceWidth, n.sourceHeight, n.destX, n.destY, n.destWidth, n.destHeight), t(i)
        }
    }, i.renderSvgToCanvas = function(e, t, n) {
        var r = "data:image/svg+xml;base64," + btoa(e);
        i.loadCanvasFromPath(r, t, n)
    }, i.getMatrixFromCanvas = function(e) {
        for (var t = e.getContext("2d"), n = [], r = 0; r < e.width; r++) {
            n.push([]);
            for (var i = 0; i < e.height; i++) n[r].push(function(n, r) {
                return n < 0 || n > e.width || r < 0 || r > e.height ? 0 : t.getImageData(n, r, 1, 1).data[0] / 255
            }(r, e.height - (i + 1)))
        }
        return n
    }, i.svgDataToImage = function(e) {
        var t = window.URL || window.webkitURL || window,
            n = new Blob([e], {
                type: "image/svg+xml;charset=utf-8"
            }),
            r = new Image;
        return r.src = t.createObjectURL(n), a.default.createPromise(function(e, t) {
            r.onload = function() {
                e(r)
            }, r.onerror = function() {
                t("Could not load SVG image.")
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t, n, r) {
        for (var i = e.listeners.length, o = 0; o < i; o++) {
            var a = e.listeners[o];
            a && a(t, n, r)
        }
        for (var o = 0; o < e.listeners.length; o++) {
            var a = e.listeners[o];
            a || (e.listeners.splice(o, 1), o--)
        }
    }

    function o(e, t, n, r) {
        function o(e) {
            i(e, t, n, r), e.children.forEach(o)
        }
        o(e)
    }

    function a(e, t) {
        var n = e.indexOf(t); - 1 !== n && (e[n] = null)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function() {
            function e() {
                r(this, e), this.trie = {
                    name: "",
                    listeners: [],
                    children: new Map
                }
            }
            return s(e, [{
                key: "emit",
                value: function(e, t, n) {
                    if (n = !!n, "string" == typeof e) this._emitToSingle(e, t, n);
                    else
                        for (var r = 0; r < e.length; r++) this._emitToSingle(e[r], t, n);
                    return this
                }
            }, {
                key: "_getNode",
                value: function(e, t) {
                    for (var n = this.trie, r = e.split("."), i = 0; i < r.length; i++) {
                        var o = r[i];
                        if (n.children.has(o)) n = n.children.get(o);
                        else {
                            if (!t) return;
                            var a = {
                                listeners: [],
                                children: new Map
                            };
                            n.children.set(o, a), n = a
                        }
                    }
                    return n
                }
            }, {
                key: "_emitToSingle",
                value: function(e, t, n) {
                    var r = this._getNode(e, n);
                    r && (o(r, t, e, this), n && (r.latestData = t, r.latestChannel = e))
                }
            }, {
                key: "addListener",
                value: function(e, t, n) {
                    n = !!n;
                    for (var r = this.trie, i = e.split("."), o = 0; o < i.length; o++) {
                        var a = i[o];
                        if (r.children.has(a)) r = r.children.get(a);
                        else {
                            var s = {
                                listeners: [],
                                children: new Map
                            };
                            r.children.set(a, s), r = s
                        }
                    }
                    return -1 === r.listeners.indexOf(t) && (r.listeners.push(t), n && r.latestData && t(r.latestData, r.latestChannel, this)), this
                }
            }, {
                key: "removeListener",
                value: function(e, t) {
                    var n = this._getNode(e);
                    return n && a(n.listeners, t), this
                }
            }, {
                key: "getLastMessageOn",
                value: function(e) {
                    var t = this._getNode(e);
                    if (t) return t.latestData
                }
            }, {
                key: "removeAllOnChannel",
                value: function(e) {
                    var t = this._getNode(e);
                    return t && (t.listeners = []), this
                }
            }, {
                key: "removeChannelAndChildren",
                value: function(e) {
                    var t = e.split(".");
                    if (t.length > 1) {
                        var n = t.pop(),
                            r = t.join(".");
                        this._getNode(r).children.delete(n)
                    } else this.trie.children.delete(e);
                    return this
                }
            }, {
                key: "_removeListener",
                value: function(e, t) {
                    a(e.listeners, t), e.children.forEach(function(e) {
                        this._removeListener(e, t)
                    }, this)
                }
            }, {
                key: "removeListenerFromAllChannels",
                value: function(e) {
                    return this._removeListener(this.trie, e), this
                }
            }, {
                key: "clear",
                value: function() {
                    this.trie = {
                        name: "",
                        listeners: [],
                        children: new Map
                    }
                }
            }, {
                key: "makeChannel",
                value: function(t) {
                    return new e.Channel(this, t)
                }
            }]), e
        }(),
        l = t.Channel = function() {
            function e(t, n) {
                r(this, e), this._bus = t, this._channelName = n
            }
            return s(e, [{
                key: "addListener",
                value: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                    this._bus.addListener(this._channelName, e, t)
                }
            }, {
                key: "removeListener",
                value: function(e) {
                    this._bus.removeListener(this._channelName, e)
                }
            }, {
                key: "emit",
                value: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                    this._bus.emit(this._channelName, e, t)
                }
            }]), e
        }();
    u.Channel = l, t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    //! AT: slow //will be faster for EntitySelection
    function i(e) {
        for (var t = [], n = 0; n < e.length; n++) {
            var r = e[n];
            e.lastIndexOf(r) === n && t.push(r)
        }
        return t
    }

    function o() {
        if (1 === arguments.length) {
            var e = arguments[0];
            return e instanceof s ? e.top ? e.top : [] : Array.isArray(e) ? e : [e]
        }
        return arguments.length > 1 ? Array.prototype.slice.call(arguments, 0) : []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = function() {
            function e() {
                //! AT: may rather use toArray
                if (r(this, e), this.stack = [], 1 === arguments.length) {
                    var t = arguments[0];
                    t instanceof e ? t.top && this.stack.push(t.top) : Array.isArray(t) ? this.stack.push(t) : this.stack.push([t])
                } else arguments.length > 1 && this.stack.push(Array.prototype.slice.call(arguments, 0));
                this.stack.length > 0 && (this.stack[0] = i(this.stack[0])), this.top = 0 === this.stack.length ? null : this.stack[0]
            }
            return a(e, [{
                key: "contains",
                value: function(e) {
                    return null !== this.top && -1 !== this.top.indexOf(e)
                }
            }, {
                key: "size",
                value: function() {
                    return null === this.top ? 0 : this.top.length
                }
            }, {
                key: "each",
                value: function(e) {
                    //! AT: this check should be done automatically before each method
                    if (null === this.top) return this;
                    for (var t = 0; t < this.top.length && !1 !== e(this.top[t], t); t++);
                    return this
                }
            }, {
                key: "filter",
                value: function(e) {
                    //! AT: this check should be done automatically before each method
                    if (null === this.top) return this;
                    var t = this.top.filter(e);
                    return this.stack.push(t), this.top = t, this
                }
            }, {
                key: "map",
                value: function(e) {
                    //! AT: this check should be done automatically before each method
                    if (null === this.top) return this;
                    var t = this.top.map(e);
                    return this.stack.push(t), this.top = t, this
                }
            }, {
                key: "flatMap",
                value: function(e) {
                    //! AT: this check should be done automatically before each method
                    if (null === this.top) return this;
                    var t = this.top.map(e),
                        n = t.reduce(function(e, t) {
                            return e.concat(t)
                        }, []);
                    return this.stack.push(n), this.top = n, this
                }
            }, {
                key: "reduce",
                value: function(e, t) {
                    //! AT: this check should be done automatically before each method
                    if (null === this.top) return this;
                    var n = [this.top.reduce(e, t)];
                    return this.stack.push(n), this.top = n, this
                }
            }, {
                key: "and",
                value: function() {
                    if (null === this.top) return this;
                    var e = o.apply(void 0, arguments),
                        t = this.top.concat(e);
                    return t = i(t), this.stack.push(t), this.top = t, this
                }
            }, {
                key: "intersects",
                value: function() {
                    if (null === this.top) return this;
                    var e = o.apply(void 0, arguments),
                        t = [],
                        n = void 0,
                        r = void 0;
                    e.length > this.top.length ? (n = this.top, r = e) : (n = e, r = this.top);
                    for (var i = 0; i < n.length; i++) {
                        var a = n[i]; - 1 !== r.indexOf(a) && t.push(a)
                    }
                    return this.stack.push(t), this.top = t, this
                }
            }, {
                key: "without",
                value: function() {
                    if (null === this.top) return this;
                    for (var e = o.apply(void 0, arguments), t = [], n = 0; n < this.top.length; n++) {
                        var r = this.top[n]; - 1 === e.indexOf(r) && t.push(r)
                    }
                    return this.stack.push(t), this.top = t, this
                }
            }, {
                key: "andSelf",
                value: function() {
                    if (null === this.top) return this;
                    if (this.stack.length <= 1) return this;
                    var e = this.stack[this.stack.length - 2],
                        t = e.concat(this.top);
                    return t = i(t), this.stack.push(t), this.top = t, this
                }
            }, {
                key: "end",
                value: function() {
                    return null === this.top ? this : (this.stack.pop(), 0 === this.stack.length ? this.top = null : this.top = this.stack[this.stack.length - 1], this)
                }
            }, {
                key: "first",
                value: function() {
                    return null === this.top ? null : this.top[0]
                }
            }, {
                key: "clone",
                value: function() {
                    var t = new e;
                    //! AT: the array pointed by top is read only it can be shallow copied
                    return t.top = this.top, t.stack = this.stack.concat([]), t
                }
            }, {
                key: "get",
                value: function(e) {
                    return "number" != typeof e ? null === this.top ? [] : this.top.concat([]) : e < 0 ? null === this.top ? void 0 : this.top[this.top.length + e] : null === this.top ? void 0 : this.top[e]
                }
            }, {
                key: "toArray",
                value: function() {
                    return null === this.top ? [] : this.top.concat([])
                }
            }]), e
        }();
    s.EMPTY = new s, s.prototype.forEach = s.prototype.each, t.default = s
}, function(e, t, n) {
    "use strict";

    function r(e, t, n, r) {
        this.x = e, this.y = t, this.w = n, this.h = r
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        this.data = e, this.target = t, this.glBuffer = null, this._dataUsage = "StaticDraw", this._dataNeedsRefresh = !1, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(146),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.setDataUsage = function(e) {
        this._dataUsage = e
    }, r.prototype.setDataNeedsRefresh = function() {
        this._dataNeedsRefresh = !0
    }, r.prototype.destroy = function(e) {
        this.glBuffer && (e.deleteBuffer(this.glBuffer), this.glBuffer = null)
    }, r.prototype.copy = function(e) {
        if (this.data instanceof ArrayBuffer) {
            var t = new Uint8Array(e.data);
            new Uint8Array(this.data).set(t)
        } else this.data.set(e.data);
        return this.target = e.target, this.glBuffer = null, this._dataUsage = e._dataUsage, this._dataNeedsRefresh = !1, this
    }, r.prototype.clone = function() {
        var e = void 0;
        e = this.data instanceof ArrayBuffer ? this.data.slice(0) : o.default.cloneTypedArray(this.data);
        var t = new r(e, this.target);
        return t._dataUsage = this._dataUsage, t._dataNeedsRefresh = !1, t
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.leftTree = null, this.rightTree = null, this.localBound = null, this.worldBound = null, this.section = 0, this.start = 0, this.end = 0, this.boundType = e || i.BOUNDTYPE_BOX
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(46),
        a = r(o),
        s = n(65),
        u = r(s),
        l = n(0),
        f = r(l),
        c = new f.default;
    i.BOUNDTYPE_SPHERE = "sphere", i.BOUNDTYPE_BOX = "box", i.MAX_PRIMITIVES_PER_LEAF = 16, i.prototype.construct = function(e) {
        if (!e.meshRendererComponent || !e.meshDataComponent || !e.transformComponent) return void console.warn("Entity missing required components for boundingtree construction: ", e);
        var t = e.meshDataComponent.meshData;
        if (t.updatePrimitiveCounts(), 1 === t.getSectionCount()) {
            this.primitiveIndices = [];
            for (var n = 0, r = t.getPrimitiveCount(0); n < r; n++) this.primitiveIndices.push(n);
            this.createTree(e, 0, 0, this.primitiveIndices.length)
        } else this.split(e, 0, t.getSectionCount())
    }, i.prototype.createTree = function(e, t, n, r) {
        var o = e.meshDataComponent.meshData;
        this.section = t, this.start = n, this.end = r, this.primitiveIndices && (this.createBounds(), this.localBound.computeFromPrimitives(o, t, this.primitiveIndices, n, r), r - n + 1 <= i.MAX_PRIMITIVES_PER_LEAF || (this.leftTree || (this.leftTree = new i(this.boundType)), this.leftTree.primitiveIndices = this.primitiveIndices, this.leftTree.createTree(e, t, n, Math.floor((n + r) / 2)), this.rightTree || (this.rightTree = new i(this.boundType)), this.rightTree.primitiveIndices = this.primitiveIndices, this.rightTree.createTree(e, t, Math.floor((n + r) / 2), r)))
    }, i.prototype.split = function(e, t, n) {
        var r = n - t,
            o = Math.floor(r / 2);
        if (1 === o) {
            var a = t;
            this.leftTree = new i(this.boundType), this.leftTree.primitiveIndices = [];
            for (var s = 0; s < this.leftTree.primitiveIndices.length; s++) this.leftTree.primitiveIndices.push(s);
            this.leftTree.createTree(e, a, 0, this.leftTree.primitiveIndices.length)
        } else this.leftTree = new i(this.boundType), this.leftTree.split(e, t, t + o);
        if (r - o == 1) {
            var u = t + 1;
            this.rightTree = new i(this.boundType), this.rightTree._primitiveIndices = [];
            for (var l = 0; l < this.rightTree.primitiveIndices.length; l++) this.rightTree.primitiveIndices.push(l);
            this.rightTree.createTree(e, u, 0, this.rightTree.primitiveIndices.length)
        } else this.rightTree = new i(this.boundType), this.rightTree.split(e, t + o, n);
        this.localBound = this.leftTree.localBound.clone(), this.localBound.merge(this.rightTree.localBound), this.worldBound = this.localBound.clone()
    }, i.prototype.createBounds = function() {
        switch (this.boundType) {
            case i.BOUNDTYPE_BOX:
                this.localBound = new a.default, this.worldBound = new a.default;
                break;
            case i.BOUNDTYPE_SPHERE:
                this.localBound = new u.default, this.worldBound = new u.default
        }
    }, i.prototype.findPick = function(e, t, n) {
        if (n || (n = []), !this.localBound.intersectsRay(e)) return n;
        if (this.leftTree && this.leftTree.findPick(e, t, n), this.rightTree) this.rightTree.findPick(e, t, n);
        else if (!this.leftTree)
            for (var r = t.meshDataComponent.meshData, i = null, o = this.start, a = this.end; o < a; o++)
                if (i = r.getPrimitiveVertices(this.primitiveIndices[o], this.section, i), e.intersects(i, !1, c)) {
                    var s = t.transformComponent.sync().worldTransform,
                        u = new f.default;
                    u.set(c), u.applyPostPoint(s.matrix), c.sub(e.origin), c.applyPostPoint(s.matrix);
                    for (var l = c.length(), d = [], h = i.length - 1; h >= 0; h--) d[h] = (new f.default).set(i[h]), d[h].applyPostPoint(s.matrix);
                    n.push({
                        distance: l,
                        point: u,
                        vertices: d
                    })
                }
        return n
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(46),
        c = r(f),
        d = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "BoundingUpdateSystem", ["TransformComponent", "MeshRendererComponent", "MeshDataComponent"]));
                return e._worldBound = new c.default, e._computeWorldBound = null, e
            }
            return a(t, e), s(t, [{
                key: "process",
                value: function(e) {
                    var t = e.length;
                    if (0 === t) return void(this._computeWorldBound = null);
                    for (var n = 0; n < t; n++) {
                        var r = e[n],
                            i = r.meshDataComponent,
                            o = r.transformComponent,
                            a = r.meshRendererComponent;
                        o.sync(), i.modelBoundDirty ? (i.computeBoundFromPoints(), a.updateBounds(i.modelBound, o.worldTransform)) : a._worldBoundDirty && a.updateBounds(i.modelBound, o.worldTransform)
                    }
                    if (this._computeWorldBound && this._computeWorldBound instanceof Function) {
                        for (var n = 0; n < t; n++)
                            if (!e[n].particleComponent) {
                                this._worldBound = e[n].meshRendererComponent.worldBound.clone();
                                break
                            }
                        for (; n < t; n++)
                            if (!e[n].particleComponent) {
                                var s = e[n].meshRendererComponent;
                                this._worldBound = this._worldBound.merge(s.worldBound)
                            }
                        this._computeWorldBound(this._worldBound), this._computeWorldBound = null
                    }
                }
            }, {
                key: "getWorldBound",
                value: function(e) {
                    this._computeWorldBound = e
                }
            }, {
                key: "deleted",
                value: function(e) {
                    e.meshRendererComponent
                }
            }]), t
        }(l.default);
    t.default = d
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "CameraComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(148),
        u = r(s),
        l = n(30),
        f = r(l),
        c = n(3),
        d = r(c);
    i.prototype = Object.create(a.default.prototype), a.default._registerClass("camera", i), i.prototype.constructor = i, i.prototype._prepare = function(e) {
        d.default.defaults(e, {
            near: 1,
            far: 1e4,
            projectionMode: "Perspective",
            aspect: 1,
            lockedRatio: !1
        }), "Perspective" === e.projectionMode && void 0 === e.fov && (e.fov = 45), "Parallel" === e.projectionMode && void 0 === e.size && (e.size = 100), "Perspective" !== e.projectionMode && "Parallel" !== e.projectionMode && (e.projectionMode = "Perspective")
    }, i.prototype._create = function() {
        var e = new f.default(45, 1, 1, 1e3);
        return new u.default(e)
    }, i.prototype.update = function(e, t, n) {
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e) {
                if (e.camera.setProjectionMode(f.default[t.projectionMode]), e.camera.lockedRatio = !1, "Perspective" === t.projectionMode) e.camera.setFrustumPerspective(t.fov, null, t.near, t.far);
                else {
                    var n = t.size;
                    e.camera.setFrustum(t.near, t.far, -n, n, n, -n, null), e.camera.size = n
                }
                return e
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(24),
        h = r(d),
        p = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "CameraSystem", ["TransformComponent", "CameraComponent"])); //! AT: what's up with this? is it unused?
                return e.mainCamera = null, e
            }
            return a(t, e), s(t, [{
                key: "findMainCamera",
                value: function() {
                    if (this._activeEntities.length) {
                        var e = this._activeEntities[0];
                        c.default.emit("sumerian.setCurrentCamera", {
                            camera: e.cameraComponent.camera,
                            entity: e
                        })
                    }
                }
            }, {
                key: "inserted",
                value: function(e) {
                    h.default.mainCamera || c.default.emit("sumerian.setCurrentCamera", {
                        camera: e.cameraComponent.camera,
                        entity: e
                    })
                }
            }, {
                key: "deleted",
                value: function() {}
            }, {
                key: "onPreRender",
                value: function() {
                    for (var e = 0; e < this._activeEntities.length; e++) {
                        var t = this._activeEntities[e],
                            n = t.transformComponent,
                            r = t.cameraComponent;
                        n.sync(), r._transformDirty && (r.updateCamera(n.worldTransform), r._transformDirty = !1)
                    }
                }
            }]), t
        }(l.default);
    t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        for (var n = e.length; n--;)
            if (e[n] !== t[n]) return !1;
        return !0
    }

    function i(e, t, n, r) {
        if (this.renderer = e, this.context = t, this.location = n, this.location.value = void 0, r) switch (r) {
            case "float":
                this.call = this.uniform1f;
                break;
            case "bool":
            case "int":
            case "integer":
            case "sampler2D":
            case "usampler2D":
            case "sampler3D":
            case "samplerCube":
            case "sampler2DArray":
                this.call = this.uniform1i;
                break;
            case "floatarray":
                this.call = this.uniform1fv;
                break;
            case "intarray":
            case "samplerArray":
                this.call = this.uniform1iv;
                break;
            case "ivec2":
                this.call = this.uniform2iv;
                break;
            case "ivec3":
                this.call = this.uniform3iv;
                break;
            case "ivec4":
                this.call = this.uniform4iv;
                break;
            case "vec2":
                this.call = this.uniform2fv;
                break;
            case "vec3":
                this.call = this.uniform3fv;
                break;
            case "vec4":
                this.call = this.uniform4fv;
                break;
            case "mat2":
                this.call = this.uniformMatrix2fv;
                break;
            case "mat3":
                this.call = this.uniformMatrix3fv;
                break;
            case "mat4":
                this.call = this.uniformMatrix4fv;
                break;
            default:
                throw new Error("Uniform type not handled: " + r)
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), i.prototype.uniform1f = function(e) {
        this.location.value !== e && (this.context.uniform1f(this.location, e), this.location.value = e)
    }, i.prototype.uniform1fv = function(e) {
        var t = this.location.value;
        void 0 !== t && r(e, t) || (this.context.uniform1fv(this.location, e), this.location.value = e.slice())
    }, i.prototype.uniform1i = function(e) {
        this.location.value !== e && (this.context.uniform1i(this.location, e), this.location.value = e)
    }, i.prototype.uniform1iv = function(e) {
        var t = this.location.value;
        void 0 !== t && r(e, t) || (this.context.uniform1iv(this.location, e), this.location.value = e.slice())
    }, i.prototype.uniform2f = function(e, t) {
        var n = this.location.value;
        void 0 !== n && n[0] === e && n[1] === t || (this.context.uniform2f(this.location, e, t), this.location.value = [e, t])
    }, i.prototype.uniform2fv = function(e) {
        var t = this.location.value;
        if (void 0 !== t) {
            if (r(e, t)) return
        } else t = this.location.value = new Float64Array(e.length);
        this.context.uniform2fv(this.location, e);
        for (var n = e.length; n--;) t[n] = e[n]
    }, i.prototype.uniform2i = function(e, t) {
        var n = this.location.value;
        void 0 !== n && n[0] === e && n[1] === t || (this.context.uniform2i(this.location, e, t), this.location.value = [e, t])
    }, i.prototype.uniform2iv = function(e) {
        var t = this.location.value;
        void 0 !== t && r(e, t) || (this.context.uniform2iv(this.location, e), this.location.value = e.slice())
    }, i.prototype.uniform3f = function(e, t, n) {
        var r = this.location.value;
        if (void 0 !== r) {
            if (r[0] === e && r[1] === t && r[2] === n) return
        } else r = this.location.value = [];
        this.context.uniform3f(this.location, e, t, n), r[0] = e, r[1] = t, r[2] = n
    }, i.prototype.uniform3fv = function(e) {
        var t = this.location.value;
        if (void 0 !== t) {
            if (r(e, t)) return
        } else t = this.location.value = new Float64Array(e.length);
        this.context.uniform3fv(this.location, e);
        for (var n = e.length; n--;) t[n] = e[n]
    }, i.prototype.uniform3i = function(e, t, n) {
        var r = this.location.value;
        void 0 !== r && r[0] === e && r[1] === t && r[2] === n || (this.context.uniform3i(this.location, e, t, n), this.location.value = [e, t, n])
    }, i.prototype.uniform3iv = function(e) {
        var t = this.location.value;
        void 0 !== t && r(e, t) || (this.context.uniform3iv(this.location, e), this.location.value = e.slice())
    }, i.prototype.uniform4f = function(e, t, n, r) {
        var i = this.location.value;
        void 0 !== i && i[0] === e && i[1] === t && i[2] === n && i[3] === r || (this.context.uniform4f(this.location, e, t, n, r), this.location.value = [e, t, n, r])
    }, i.prototype.uniform4fv = function(e) {
        var t = this.location.value;
        if (void 0 !== t) {
            if (r(e, t)) return
        } else t = this.location.value = new Float64Array(e.length);
        this.context.uniform4fv(this.location, e);
        for (var n = e.length; n--;) t[n] = e[n]
    }, i.prototype.uniform4i = function(e, t, n, r) {
        var i = this.location.value;
        void 0 !== i && i[0] === e && i[1] === t && i[2] === n && i[3] === r || (this.context.uniform4i(this.location, e, t, n, r), this.location.value = [e, t, n, r])
    }, i.prototype.uniform4iv = function(e) {
        var t = this.location.value;
        void 0 !== t && r(e, t) || (this.context.uniform4iv(this.location, e), this.location.value = e.slice())
    }, i.prototype.uniformMatrix2fv = function(e, t) {
        if (t = !0 === t, e.data) {
            var n = this.location.value;
            if (void 0 !== n) {
                if (r(n.data, e.data)) return;
                n.copy(e)
            } else this.location.value = e.clone();
            this.context.uniformMatrix2fv(this.location, t, e.data)
        } else {
            var i = e,
                o = this.location.value;
            if (void 0 !== o) {
                if (r(i, o)) return
            } else o = this.location.value = new Float64Array(i.length);
            this.context.uniformMatrix2fv(this.location, t, i);
            for (var a = i.length; a--;) o[a] = i[a]
        }
    }, i.prototype.uniformMatrix3fv = function(e, t) {
        if (t = !0 === t, e.data) {
            var n = this.location.value;
            if (void 0 !== n) {
                if (r(n.data, e.data)) return;
                n.copy(e)
            } else this.location.value = e.clone();
            this.context.uniformMatrix3fv(this.location, t, e.data)
        } else {
            var i = e,
                o = this.location.value;
            if (void 0 !== o) {
                if (r(i, o)) return
            } else o = this.location.value = new Float64Array(i.length);
            this.context.uniformMatrix3fv(this.location, t, i);
            for (var a = i.length; a--;) o[a] = i[a]
        }
    }, i.prototype.uniformMatrix4fv = function(e, t) {
        if (t = !0 === t, e.data) {
            var n = this.location.value;
            if (void 0 !== n) {
                if (r(n.data, e.data)) return;
                n.copy(e)
            } else this.location.value = e.clone();
            this.context.uniformMatrix4fv(this.location, t, e.data)
        } else {
            var i = e,
                o = this.location.value;
            if (void 0 !== o) {
                if (r(i, o)) return
            } else o = this.location.value = new Float64Array(i.length);
            this.context.uniformMatrix4fv(this.location, t, i);
            for (var a = i.length; a--;) o[a] = i[a]
        }
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        for (var n = e.length, r = t.length, i = Math.min(n, r); i--;)
            if (e[i] !== t[i]) return !1;
        return !0
    }

    function i(e, t, n, r, i) {
        if (void 0 == i)
            for (var o = 0; o < r; ++o) e[n + o] = t[o];
        else
            for (var o = 0; o < r; ++o) {
                e[n + 4 * o] = t[o];
                for (var a = 0; a < i; ++a) e[n + 4 * o + a + 1] = -1
            }
    }

    function o(e, t, n, r, i) {
        if (this.renderer = e, this.context = t, this.dataArray = n, this.dirty = !0, this.offset = r, this.dataArrayF32 = new Float32Array(n), this.dataArrayI32 = new Int32Array(n), i) switch (i) {
            case "float":
                this.call = this.uniform1f;
                break;
            case "bool":
            case "int":
            case "integer":
            case "sampler2D":
            case "sampler3D":
            case "samplerCube":
            case "sampler2DArray":
                this.call = this.uniform1i;
                break;
            case "floatarray":
                this.call = this.uniform1fv;
                break;
            case "intarray":
            case "samplerArray":
                this.call = this.uniform1iv;
                break;
            case "ivec2":
                this.call = this.uniform2iv;
                break;
            case "ivec3":
                this.call = this.uniform3iv;
                break;
            case "ivec4":
                this.call = this.uniform4iv;
                break;
            case "vec2":
                this.call = this.uniform2fv;
                break;
            case "vec3":
                this.call = this.uniform3fv;
                break;
            case "vec4":
                this.call = this.uniform4fv;
                break;
            case "mat2":
                this.call = this.uniformMatrix2fv;
                break;
            case "mat3":
                this.call = this.uniformMatrix3fv;
                break;
            case "mat4":
                this.call = this.uniformMatrix4fv;
                break;
            default:
                throw new Error("Uniform type not handled: " + i)
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), o.prototype.uniformVector = function(e, t, n) {
        for (var o = t.currentInstanceCount, a = (t.material.instanceCount, t.batchNumber, t.padding, !0), s = 0; s < o; ++s) {
            var u = t.renderableIDs[s];
            a = a && r(n, e[u])
        }
        if (a) return !0;
        for (var l = 0; l < o; ++l) {
            var f = t.renderableIDs[l];
            i(n, e[f], this.offset + 4 * l, e[f].length)
        }
        return !1
    }, o.prototype.uniform1f = function(e) {
        this.dataArrayF32[this.offset] !== e && (this.dataArrayF32[this.offset] = e, this.dirty = !0)
    }, o.prototype.uniform1fv = function(e, t) {
        if (t.material.bIsInstanced) {
            for (var n = !0, o = 0; o < t.currentInstanceCount; ++o) {
                var a = t.renderableIDs[o];
                n = n && Math.abs(this.dataArrayF32[this.offset + 4 * o] - e[a]) < 1e-6
            }
            if (n) return;
            for (var s = 0; s < t.currentInstanceCount; ++s) {
                var u = t.renderableIDs[s];
                this.dataArrayF32[this.offset + 4 * s] = e[u];
                for (var l = 0; l < 3; ++l) this.dataArrayF32[this.offset + 4 * s + l + 1] = -1
            }
            return void(this.dirty = !0)
        }
        for (; 0 < e;)
            if (r(this.dataArrayF32, e)) return;
        i(this.dataArrayF32, e, this.offset, e.length, 3), this.dirty = !0
    }, o.prototype.uniform1i = function(e) {
        this.dataArrayI32[this.offset] !== e && (this.dataArrayI32[this.offset] = e, this.dirty = !0)
    }, o.prototype.uniform1iv = function(e) {
        r(this.dataArrayI32, e) || (i(this.dataArrayI32, e, this.offset, e.length), this.dirty = !0)
    }, o.prototype.uniform2f = function(e, t) {
        this.dataArrayF32[this.offset] === e && this.dataArrayF32[this.offset + 1] === t || (this.dataArrayF32[this.offset] = e, this.dataArrayF32[this.offset + 1] = t, this.dirty = !0)
    }, o.prototype.uniform2fv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayF32)) return
        } else {
            if (r(this.dataArrayF32, e)) return;
            i(this.dataArrayF32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniform2i = function(e, t) {
        this.dataArrayI32[this.offset] === e && this.dataArrayI32[this.offset + 1] === t || (this.dataArrayI32[this.offset] = e, this.dataArrayI32[this.offset + 1] = t, this.dirty = !0)
    }, o.prototype.uniform2iv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayI32)) return
        } else {
            if (r(this.dataArrayI32, e)) return;
            i(this.dataArrayI32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniform3f = function(e, t, n) {
        this.dataArrayF32[this.offset] === e && this.dataArrayF32[this.offset + 1] === t && this.dataArrayF32[this.offset + 2] === n || (this.dataArrayF32[this.offset] = e, this.dataArrayF32[this.offset + 1] = t, this.dataArrayF32[this.offset + 2] = n, this.dirty = !0)
    }, o.prototype.uniform3fv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayF32)) return
        } else {
            if (r(this.dataArrayF32, e)) return;
            i(this.dataArrayF32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniform3i = function(e, t, n) {
        this.dataArrayI32[this.offset] === e && this.dataArrayI32[this.offset + 1] === t && this.dataArrayI32[this.offset + 2] === n || (this.dataArrayI32[this.offset] = e, this.dataArrayI32[this.offset + 1] = t, this.dataArrayI32[this.offset + 2] = n, this.dirty = !0)
    }, o.prototype.uniform3iv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayI32)) return
        } else {
            if (r(this.dataArrayI32, e)) return;
            i(this.dataArrayI32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniform4f = function(e, t, n, r) {
        this.dataArrayF32[this.offset] === e && this.dataArrayF32[this.offset + 1] === t && this.dataArrayF32[this.offset + 2] === n && this.dataArrayF32[this.offset + 3] === r || (this.dataArrayF32[this.offset] = e, this.dataArrayF32[this.offset + 1] = t, this.dataArrayF32[this.offset + 2] = n, this.dataArrayF32[this.offset + 3] = r, this.dirty = !0)
    }, o.prototype.uniform4fv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayF32)) return
        } else {
            if (r(this.dataArrayF32, e)) return;
            i(this.dataArrayF32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniform4i = function(e, t, n, r) {
        this.dataArrayI32[this.offset] === e && this.dataArrayI32[this.offset + 1] === t && this.dataArrayI32[this.offset + 2] === n && this.dataArrayI32[this.offset + 3] === r || (this.dataArrayI32[this.offset] = e, this.dataArrayI32[this.offset + 1] = t, this.dataArrayI32[this.offset + 2] = n, this.dataArrayI32[this.offset + 3] = r, this.dirty = !0)
    }, o.prototype.uniform4iv = function(e, t) {
        if (Array.isArray(e[0])) {
            if (this.uniformVector(e, t, this.dataArrayI32)) return
        } else {
            if (r(this.dataArrayI32, e)) return;
            i(this.dataArrayI32, e, this.offset, e.length)
        }
        this.dirty = !0
    }, o.prototype.uniformMatrix2fv = function(e, t) {
        1 == (t = !0 === t) && console.error("uniformMatrix2fv: TODO implement TRANSPOSE!");
        var n = e.data ? e.data : e;
        this.dataArrayF32[this.offset] === n[0] && this.dataArrayF32[this.offset + 1] === n[1] && this.dataArrayF32[this.offset + 2] === n[2] && this.dataArrayF32[this.offset + 3] === n[3] || (this.dataArrayF32[this.offset] = n[0], this.dataArrayF32[this.offset + 1] = n[1], this.dataArrayF32[this.offset + 2] = n[2], this.dataArrayF32[this.offset + 3] = n[3], this.dirty = !0)
    }, o.prototype.uniformMatrix3fv = function(e, t, n) {
        1 == (t = !0 === t) && console.error("uniformMatrix3fv: TODO implement TRANSPOSE!");
        var r = 1;
        void 0 !== n && (r = n);
        for (var i = !0, o = 0; o < r; ++o) {
            var a = 12 * o,
                s = void 0 === n ? Array.isArray(e) ? e : e.data : e[o].data;
            if (!(i = i && this.dataArrayF32[a + this.offset] === s[0] && this.dataArrayF32[a + this.offset + 1] === s[1] && this.dataArrayF32[a + this.offset + 2] === s[2] && this.dataArrayF32[a + this.offset + 4] === s[3] && this.dataArrayF32[a + this.offset + 5] === s[4] && this.dataArrayF32[a + this.offset + 6] === s[5] && this.dataArrayF32[a + this.offset + 8] === s[6] && this.dataArrayF32[a + this.offset + 9] === s[7] && this.dataArrayF32[a + this.offset + 10] === s[8])) break
        }
        if (!i) {
            for (var u = 0; u < r; ++u) {
                var l = 12 * u,
                    f = void 0 === n ? Array.isArray(e) ? e : e.data : e[u].data;
                this.dataArrayF32[l + this.offset] = f[0], this.dataArrayF32[l + this.offset + 1] = f[1], this.dataArrayF32[l + this.offset + 2] = f[2], this.dataArrayF32[l + this.offset + 4] = f[3], this.dataArrayF32[l + this.offset + 5] = f[4], this.dataArrayF32[l + this.offset + 6] = f[5], this.dataArrayF32[l + this.offset + 8] = f[6], this.dataArrayF32[l + this.offset + 9] = f[7], this.dataArrayF32[l + this.offset + 10] = f[8]
            }
            this.dirty = !0
        }
    }, o.prototype.uniformMatrix4fv = function(e, t, n) {
        1 == (t = !0 === t) && console.error("uniformMatrix4fv: TODO implement TRANSPOSE!");
        var r = 1;
        void 0 != n && (r = n);
        for (var i = !0, o = 0; o < r; ++o) {
            var a = 16 * o,
                s = void 0 === n ? Array.isArray(e) ? e : e.data : e[o].data;
            if (!(i = i && this.dataArrayF32[a + this.offset] === s[0] && this.dataArrayF32[a + this.offset + 1] === s[1] && this.dataArrayF32[a + this.offset + 2] === s[2] && this.dataArrayF32[a + this.offset + 3] === s[3] && this.dataArrayF32[a + this.offset + 4] === s[4] && this.dataArrayF32[a + this.offset + 5] === s[5] && this.dataArrayF32[a + this.offset + 6] === s[6] && this.dataArrayF32[a + this.offset + 7] === s[7] && this.dataArrayF32[a + this.offset + 8] === s[8] && this.dataArrayF32[a + this.offset + 9] === s[9] && this.dataArrayF32[a + this.offset + 10] === s[10] && this.dataArrayF32[a + this.offset + 11] === s[11] && this.dataArrayF32[a + this.offset + 12] === s[12] && this.dataArrayF32[a + this.offset + 13] === s[13] && this.dataArrayF32[a + this.offset + 14] === s[14] && this.dataArrayF32[a + this.offset + 15] === s[15])) break
        }
        if (!i) {
            for (var u = 0; u < r; ++u) {
                var l = 16 * u,
                    f = void 0 === n ? Array.isArray(e) ? e : e.data : e[u].data;
                this.dataArrayF32[l + this.offset] = f[0], this.dataArrayF32[l + this.offset + 1] = f[1], this.dataArrayF32[l + this.offset + 2] = f[2], this.dataArrayF32[l + this.offset + 3] = f[3], this.dataArrayF32[l + this.offset + 4] = f[4], this.dataArrayF32[l + this.offset + 5] = f[5], this.dataArrayF32[l + this.offset + 6] = f[6], this.dataArrayF32[l + this.offset + 7] = f[7], this.dataArrayF32[l + this.offset + 8] = f[8], this.dataArrayF32[l + this.offset + 9] = f[9], this.dataArrayF32[l + this.offset + 10] = f[10], this.dataArrayF32[l + this.offset + 11] = f[11], this.dataArrayF32[l + this.offset + 12] = f[12], this.dataArrayF32[l + this.offset + 13] = f[13], this.dataArrayF32[l + this.offset + 14] = f[14], this.dataArrayF32[l + this.offset + 15] = f[15]
            }
            this.dirty = !0
        }
    }, t.default = o
}, function(e, t, n) {
    "use strict";

    function r() {
        this._listenerMap = new Map, this._listenersCopy = []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.fire = function(e) {
        var t = this._listenerMap.get(e.type);
        if (t) {
            e.target = this;
            for (var n = t.length, r = this._listenersCopy, i = 0; i < n; i += 1) r[i] = t[i];
            for (var o = 0; o < n; o += 1) r[o](e)
        }
        return this
    }, r.prototype.on = function(e, t) {
        var n = this._listenerMap.get(e);
        return n ? -1 === n.indexOf(t) && n.push(t) : (n = [t], this._listenerMap.set(e, n)), this
    }, r.prototype.off = function(e, t) {
        if (t) {
            var n = void 0,
                r = this._listenerMap.get(e);
            r && -1 !== (n = r.indexOf(t)) && (r.splice(n, 1), 0 === r.length && this._listenerMap.delete(e))
        } else this._listenerMap.delete(e);
        return this
    }, r.prototype.has = function(e) {
        return this._listenerMap.has(e)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(198),
        l = r(u),
        f = n(63),
        c = r(f),
        d = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return e.type = "EntityManager", e._entitiesById = new Map, e._entitiesByIndex = new Map, e._entityCount = 0, e.api = {
                    id: function() {
                        var e = t.prototype.getEntityById.apply(this, arguments);
                        return new c.default(e)
                    }.bind(e),
                    name: function(e) {
                        var t = this.getEntities();
                        return new c.default(t.filter(function(t) {
                            return t.name === e
                        }))
                    }.bind(e)
                }, e
            }
            return a(t, e), s(t, [{
                key: "added",
                value: function(e) {
                    this.containsEntity(e) || (this._entitiesById.set(e.id, e), //! AT: more entities can share the same id!
                        this._entitiesByIndex.set(e._index, e), this._entityCount++)
                }
            }, {
                key: "removed",
                value: function(e) {
                    this.containsEntity(e) && (this._entitiesById.delete(e.id), //! AT: more entities can share the same id!
                        this._entitiesByIndex.delete(e._index), this._entityCount--)
                }
            }, {
                key: "containsEntity",
                value: function(e) {
                    return this._entitiesByIndex.has(e._index)
                }
            }, {
                key: "getEntityById",
                value: function(e) {
                    return this._entitiesById.get(e)
                }
            }, {
                key: "getEntityByIndex",
                value: function(e) {
                    return this._entitiesByIndex.get(e)
                }
            }, {
                key: "getEntityByName",
                value: function(e) {
                    if (!(this._entityCount <= 0)) {
                        var t = void 0;
                        return this._entitiesByIndex.forEach(function(n) {
                            n.name === e && (t = n)
                        }), t
                    }
                }
            }, {
                key: "size",
                value: function() {
                    return this._entityCount
                }
            }, {
                key: "getEntities",
                value: function() {
                    var e = [];
                    return this._entitiesByIndex.forEach(function(t) {
                        e.push(t)
                    }), e
                }
            }, {
                key: "getTopEntities",
                value: function() {
                    var e = [];
                    return this._entitiesByIndex.forEach(function(t) {
                        t.transformComponent && t.transformComponent.parent || e.push(t)
                    }), e
                }
            }, {
                key: "clear",
                value: function() {
                    this._entitiesById.clear(), this._entitiesByIndex.clear(), this._entityCount = 0
                }
            }]), t
        }(l.default);
    t.default = d
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.reset(), this.renderable = [], this.renderableIDs = [], this.transform = [], this.currentPose = [], Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(109),
        a = r(o),
        s = n(10);
    r(s);
    i.prototype.reset = function() {
        this.lights = null, this.materials = null, this.meshData = null, this.camera = null, this.mainCamera = null, this.lights = null, this.shadowHandler = null, this.renderer = null, this.currentInstanceCount = 0, this.batchNumber = 0, this.padding = 0, this.material = null
    }, i.prototype.addRenderableInstance = function(e, t, n) {
        var r = this.currentInstanceCount;
        if (this.batchNumber = n, e instanceof a.default) {
            this.material = e.meshRendererComponent.materials[0];
            var i = e.meshDataComponent.currentPose;
            this.transform[r] = e.transformComponent.sync().worldTransform, this.currentPose[r] = i || null
        } else {
            var o = e.currentPose;
            this.transform[r] = e.transform, this.currentPose[r] = o || null
        }
        this.renderable[r] = e, this.renderableIDs[r] = t, ++this.currentInstanceCount
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(37),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(6),
        f = r(l);
    i.addTangentBuffer = function(e, t) {
        function n(e) {
            for (var t = [], n = 0; n < e.length; n += 3) t.push(new u.default(e[n + 0], e[n + 1], e[n + 2]));
            return t
        }
        t = t || 0;
        var r = e.getAttributeBuffer(f.default.POSITION);
        if (!r) return !1;
        var i = e.getAttributeBuffer(f.default.NORMAL);
        if (!i) return !1;
        var o = e.getAttributeBuffer("TEXCOORD" + t);
        if (o || 0 === t || (o = e.getAttributeBuffer(f.default.TEXCOORD0)), !o) return !1;
        var s = e.getIndexBuffer();
        if (!s) return !1;
        for (var l = e.vertexCount, c = e.indexCount / 3, d = [], h = [], p = 0; p < l; p += 1) d[p] = new u.default, h[p] = new u.default;
        for (var m = n(r), y = n(i), v = function(e) {
                for (var t = [], n = 0; n < e.length; n += 2) t.push(new a.default(e[n + 0], e[n + 1]));
                return t
            }(o), _ = 0; _ < c; _ += 1) {
            var g = s[3 * _],
                b = s[3 * _ + 1],
                x = s[3 * _ + 2],
                w = m[g],
                E = m[b],
                S = m[x],
                M = v[g],
                C = v[b],
                T = v[x],
                R = E.x - w.x,
                A = S.x - w.x,
                O = E.y - w.y,
                P = S.y - w.y,
                D = E.z - w.z,
                I = S.z - w.z,
                k = C.x - M.x,
                N = T.x - M.x,
                L = C.y - M.y,
                B = T.y - M.y,
                F = 1 / (k * B - N * L);
            if (!1 !== isFinite(F)) {
                var j = new u.default((B * R - L * A) * F, (B * O - L * P) * F, (B * D - L * I) * F),
                    U = new u.default((k * A - N * R) * F, (k * P - N * O) * F, (k * I - N * D) * F);
                d[g].add(j), d[b].add(j), d[x].add(j), h[g].add(U), h[b].add(U), h[x].add(U)
            }
        }
        e.attributeMap[f.default.TANGENT] = f.default.createAttribute(4, "Float"), e.rebuildData(e.vertexCount, e.indexCount, !0);
        for (var V = e.getAttributeBuffer(f.default.TANGENT), z = new u.default, G = new u.default, W = 0; W < l; W += 1) {
            var H = y[W],
                X = d[W],
                Y = H.dot(X);
            z.copy(X).sub(G.copy(H).scale(Y)).normalize(), V[4 * W + 0] = z.x, V[4 * W + 1] = z.y, V[4 * W + 2] = z.z, Y = z.copy(H).cross(X).dot(h[W]);
            var q = Y < 0 ? -1 : 1;
            V[4 * W + 3] = q
        }
        return V
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.depthMaterial = new h.default(m.default.lightDepth, "depthMaterial"), this.depthMaterial.cullState.cullFace = "Back", this.depthMaterial.fullOverride = !0, this.fullscreenPass = new l.default, this.downsample = h.default.createShader(m.default.downsample, "downsample");
        this.blurfilter = h.default.createShader(m.default.convolution, "blurfilter");
        var e = 2 * Math.ceil(6) + 1;
        this.blurfilter.defines = {
            KERNEL_SIZE_FLOAT: e.toFixed(1),
            KERNEL_SIZE_INT: e.toFixed(0)
        }, this.blurfilter.uniforms.cKernel = m.default.convolution.buildKernel(2), this.oldClearColor = new g.default(0, 0, 0, 0), this.shadowClearColor = new g.default(1, 1, 1, 1), this.renderList = [], this.instancedRenderList = new Map, this.shadowList = [], this.first = !0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(26),
        a = (r(o), n(0)),
        s = r(a),
        u = n(50),
        l = r(u),
        f = n(30),
        c = r(f),
        d = n(9),
        h = r(d),
        p = n(15),
        m = r(p),
        y = n(33),
        v = r(y),
        _ = n(36),
        g = r(_),
        b = n(110),
        x = r(b),
        w = n(93),
        E = r(w),
        S = new s.default;
    i.prototype._createShadowData = function(e, t) {
        var n = e.resolution[0],
            r = e.resolution[1];
        if (e.shadowData.shadowTarget && t._deallocateRenderTarget(e.shadowData.shadowTarget), "VSM" === e.shadowType) {
            var i = {
                type: "HalfFloat"
            };
            e.shadowData.shadowTargetDown && t._deallocateRenderTarget(e.shadowData.shadowTargetDown), e.shadowData.shadowTargetDown = new v.default(n / 2, r / 2, i), e.shadowData.shadowBlurred && t._deallocateRenderTarget(e.shadowData.shadowBlurred), e.shadowData.shadowBlurred = new v.default(n / 2, r / 2, i), e.shadowData.shadowTarget = new v.default(n, r, {
                type: "HalfFloat",
                magFilter: "NearestNeighbor",
                minFilter: "NearestNeighborNoMipMaps"
            })
        } else e.shadowData.shadowTarget = new v.default(n, r, {
            magFilter: "NearestNeighbor",
            minFilter: "NearestNeighborNoMipMaps"
        });
        e.shadowData.shadowResult = null, e.shadowRecord.resolution = e.shadowRecord.resolution || [], e.shadowRecord.resolution[0] = n, e.shadowRecord.shadowType = e.shadowType
    }, i.prototype.checkShadowRendering = function(e, t, n, r) {
        if (!0 === this.first) return void(this.first = !1);
        for (var i = 0; i < r.length; i++) {
            var o = r[i];
            if (o.shadowCaster || o.lightCookie) {
                var a = o.shadowSettings;
                a.shadowData || (a.shadowData = {}, a.shadowRecord = {}, a.shadowData.lightCamera = new c.default(55, 1, 1, 1e3));
                var u = a.shadowRecord,
                    l = a.shadowData.lightCamera;
                if (l.translation.copy(o.translation), o.direction ? (S.set(o.translation).add(o.direction), l.lookAt(S, a.upVector)) : l.lookAt(s.default.ZERO, a.upVector), !a.shadowData.shadowTarget || u.angle !== o.angle || !u.resolution || u.resolution[0] !== a.resolution[0] || u.resolution[1] !== a.resolution[1] || u.near !== a.near || u.far !== a.far || u.size !== a.size) {
                    if (u.resolution && u.resolution[0] === a.resolution[0] && u.resolution[1] === a.resolution[1] || this._createShadowData(a, e), o instanceof E.default) l.setFrustumPerspective(o.angle, a.resolution[0] / a.resolution[1], a.near, a.far);
                    else if (o instanceof x.default) l.setFrustumPerspective(90, a.resolution[0] / a.resolution[1], a.near, a.far);
                    else {
                        var f = a.size;
                        l.setFrustum(a.near, a.far, -f, f, f, -f), l.setProjectionMode(c.default.Parallel)
                    }
                    l.update(), u.resolution = u.resolution || [], u.resolution[0] = a.resolution[0], u.resolution[1] = a.resolution[1], u.angle = o.angle, u.near = a.near, u.far = a.far, u.size = a.size
                }
                "VSM" === a.shadowType && u.shadowType !== a.shadowType && (this._createShadowData(a, e), u.shadowType = a.shadowType), l.onFrameChange();
                for (var d = l.getViewProjectionMatrix().data, h = a.shadowData.vpm = a.shadowData.vpm || [], p = 0; p < 16; p++) h[p] = d[p];
                if (o.shadowCaster) {
                    this.depthMaterial.shader.setDefine("SHADOW_TYPE", "VSM" === a.shadowType ? 2 : 0), this.depthMaterial.uniforms.cameraScale = 1 / (l.far - l.near), a.shadowData.cameraScale = this.depthMaterial.uniforms.cameraScale, this.oldClearColor.copy(e.clearColor), e.setClearColor(this.shadowClearColor.r, this.shadowClearColor.g, this.shadowClearColor.b, this.shadowClearColor.a), this.shadowList.length = 0;
                    for (var m = 0; m < n.length; m++) {
                        var y = n[m];
                        y.meshRendererComponent && y.meshRendererComponent.castShadows && !y.isSkybox && this.shadowList.push(y)
                    }
                    switch (t.process(l, this.shadowList, this.renderList, this.instancedRenderList), e.render(this.renderList, null, l, [], a.shadowData.shadowTarget, !0, this.depthMaterial, this.instancedRenderList), a.shadowType) {
                        case "VSM":
                            this.fullscreenPass.material.shader = this.downsample, this.fullscreenPass.render(e, a.shadowData.shadowTargetDown, a.shadowData.shadowTarget, this.instancedRenderList), this.fullscreenPass.material.shader = this.blurfilter, this.fullscreenPass.material.uniforms.uImageIncrement = [2 / a.resolution[0], 0], this.fullscreenPass.render(e, a.shadowData.shadowBlurred, a.shadowData.shadowTargetDown, this.instancedRenderList), this.fullscreenPass.material.uniforms.uImageIncrement = [0, 2 / a.resolution[1]], this.fullscreenPass.render(e, a.shadowData.shadowTargetDown, a.shadowData.shadowBlurred, this.instancedRenderList), a.shadowData.shadowResult = a.shadowData.shadowTargetDown;
                            break;
                        case "PCF":
                        case "Basic":
                        default:
                            a.shadowData.shadowResult = a.shadowData.shadowTarget
                    }
                    e.setClearColor(this.oldClearColor.r, this.oldClearColor.g, this.oldClearColor.b, this.oldClearColor.a)
                }
            }
        }
    }, i.prototype.invalidateHandles = function(e) {
        this.fullscreenPass.invalidateHandles(e), e.invalidateMaterial(this.depthMaterial), e.invalidateShader(this.downsample), e.invalidateShader(this.blurfilter)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        this.reset()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.prototype.reset = function() {
        this.calls = 0, this.occluded = 0, this.vertices = 0, this.indices = 0
    }, r.prototype.toString = function() {
        return "Calls: " + this.calls + "<br/>Occluded: " + this.occluded + "<br/>Vertices: " + this.vertices + "<br/>Indices: " + this.indices
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(17),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i),
        a = "undefined" != typeof window ? window.performance : {};
    a.now = a.now || a.mozNow || a.msNow || a.oNow || a.webkitNow || function() {
        return Date.now()
    }, r.maxTimePerFrame = 50, r.each = function(e) {
        return o.default.createPromise(function(t) {
            function n() {
                for (var o = a.now(); i < e.length && a.now() - o < r.maxTimePerFrame;) e[i](), i++;
                i < e.length ?
                    //! AT: 4 ms is the minimum amount as specified by the HTML standard
                    setTimeout(n, 4) : t()
            }
            var i = 0;
            n()
        })
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.reset(), Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(109),
        a = r(o),
        s = n(10),
        u = r(s);
    i.prototype.reset = function() {
        this.renderable = null, this.lights = null, this.materials = null, this.meshData = null, this.camera = null, this.mainCamera = null, this.lights = null, this.shadowHandler = null, this.renderer = null, this.material = null, this.transform = null, this.currentPose = null, this.occlusionDrawing = !1
    }, i.prototype.fill = function(e) {
        e instanceof a.default ? (this.meshData = e.meshDataComponent ? e.meshDataComponent.meshData : null, this.materials = e.meshRendererComponent ? e.meshRendererComponent.materials : null, this.transform = e.particleComponent ? u.default.IDENTITY : e.transformComponent.sync().worldTransform, e.meshDataComponent && e.meshDataComponent.currentPose ? this.currentPose = e.meshDataComponent.currentPose : this.currentPose = null) : (this.meshData = e.meshData, this.materials = e.materials, this.transform = e.transform, e.currentPose ? this.currentPose = e.currentPose : this.currentPose = null), this.renderable = e
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function(e) {
        function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "VR Camera Rig Entity not found";
            r(this, t);
            var n = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e));
            return n.name = "VRCameraRigEntityNotFoundError", "function" == typeof Error.captureStackTrace ? Error.captureStackTrace(n, n.constructor) : n.stack = new Error(e).stack, n
        }
        return o(t, e), t
    }(Error);
    t.default = a
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function(e) {
        function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "VR headset not found";
            r(this, t);
            var n = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e));
            return n.name = "VRRigNotFoundError", "function" == typeof Error.captureStackTrace ? Error.captureStackTrace(n, n.constructor) : n.stack = new Error(e).stack, n
        }
        return o(t, e), t
    }(Error);
    t.default = a
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function(e) {
        function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "WebVR is not supported in this browser";
            r(this, t);
            var n = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, e));
            return n.name = "WebVRNotSupportedByBrowserError", "function" == typeof Error.captureStackTrace ? Error.captureStackTrace(n, n.constructor) : n.stack = new Error(e).stack, n
        }
        return o(t, e), t
    }(Error);
    t.default = a
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        if (this._passedWriteBuffer = !!e, this.writeBuffer = e, void 0 === this.writeBuffer) {
            var t = window.innerWidth || 1,
                n = window.innerHeight || 1;
            this.writeBuffer = new a.default(t, n)
        }
        this.readBuffer = this.writeBuffer.clone(), this.passes = [], this._clearColor = [0, 0, 0, 1], this.copyPass = new u.default(f.default.copy), this.size = null, this.dirty = !1, this._viewportResizeHandler = function(e) {
            this.dirty = !0, this.size = e
        }.bind(this), d.default.addListener("sumerian.viewportResize", this._viewportResizeHandler, !0)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(33),
        a = r(o),
        s = n(50),
        u = r(s),
        l = n(15),
        f = r(l),
        c = n(5),
        d = r(c);
    i.prototype.destroy = function(e) {
        this.deallocateBuffers(e);
        for (var t = 0; t < this.passes.length; t++) {
            this.passes[t].destroy(e)
        }
        d.default.removeListener("sumerian.viewportResize", this._viewportResizeHandler)
    }, i.prototype.deallocateBuffers = function(e) {
        this.writeBuffer && !this._passedWriteBuffer && this.writeBuffer.destroy(e.context), this.readBuffer && this.readBuffer.destroy(e.context), this.copyPass.destroy(e)
    }, i.prototype.swapBuffers = function() {
        var e = this.readBuffer;
        this.readBuffer = this.writeBuffer, this.writeBuffer = e
    }, i.prototype._checkPassResize = function(e, t) {
        return !e.viewportSize || e.viewportSize.x !== t.x || e.viewportSize.y !== t.y || e.viewportSize.width !== t.width || e.viewportSize.height !== t.height
    }, i.prototype.addPass = function(e, t) {
        this.passes.push(e), e.updateSize && this.size && this._checkPassResize(e, this.size) && (e.updateSize(this.size, t), e.viewportSize = this.size)
    }, i.prototype.setClearColor = function(e) {
        this._clearColor[0] = e[0], this._clearColor[1] = e[1], this._clearColor[2] = e[2], this._clearColor[3] = e[3]
    }, i.prototype.updateSize = function(e) {
        var t = this.size;
        if (t) {
            var n = t.width,
                r = t.height;
            this.deallocateBuffers(e), this.writeBuffer = new a.default(n, r), this.readBuffer = this.writeBuffer.clone();
            for (var i = 0, o = this.passes.length; i < o; i++) {
                var s = this.passes[i];
                s.updateSize && this._checkPassResize(s, t) && (s.updateSize(t, e), s.viewportSize = t)
            }
        }
    }, i.prototype.render = function(e, t, n, r) {
        this.dirty && (this.updateSize(e), this.dirty = !1);
        var i = void 0,
            o = void 0,
            a = this.passes.length;
        for (o = 0; o < a; o++)
            if (i = this.passes[o], i.enabled && (i.render(e, this.writeBuffer, this.readBuffer, t, !1, n, r, this._clearColor), i.needsSwap)) {
                this.swapBuffers()
            }
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var r = arguments[0];
            e = r.radialSamples, t = r.radius, n = r.height
        }
        this.radialSamples = e || 8, this.radius = t || 1, this.height = void 0 === n ? 2 : n;
        var i = a.default.defaultMap([a.default.POSITION, a.default.NORMAL, a.default.TEXCOORD0]);
        a.default.call(this, i, 3 * this.radialSamples + this.radialSamples + 1, 3 * this.radialSamples * 2), this.indexModes = ["Triangles"], this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(3),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        for (var e = [], t = [], n = [], r = [], i = Math.atan2(this.radius, this.height), o = 2 * Math.PI / this.radialSamples, s = 1 / this.radialSamples, u = 0, l = 0, f = 0; u < this.radialSamples; u++, l += o, f += s) e.push(0, 0, this.height, Math.cos(l) * this.radius, Math.sin(l) * this.radius, 0, Math.cos(l + o) * this.radius, Math.sin(l + o) * this.radius, 0), t.push(0, 0, 1, Math.cos(l) * Math.cos(i), Math.sin(l) * Math.cos(i), Math.sin(i), Math.cos(l + o) * Math.cos(i), Math.sin(l + o) * Math.cos(i), Math.sin(i)), n.push(f + s / 2, 1, f, .5, f + s, .5), r.push(3 * u + 0, 3 * u + 1, 3 * u + 2);
        var c = 3 * u + 0;
        for (e.push(0, 0, 0), t.push(0, 0, -1), n.push(.25, .25), u = 1, l = 0; u <= this.radialSamples - 1; u++, l += o) e.push(Math.cos(l) * this.radius, Math.sin(l) * this.radius, 0), t.push(0, 0, -1), n.push(.25 * Math.cos(l) + .25, .25 * Math.sin(l) + .25), r.push(c + u, c, c + u + 1);
        return e.push(Math.cos(l) * this.radius, Math.sin(l) * this.radius, 0), t.push(0, 0, -1), n.push(.25 * Math.cos(l) + .25, .25 * Math.sin(l) + .25), r.push(c + this.radialSamples, c, c + 1), this.getAttributeBuffer(a.default.POSITION).set(e), this.getAttributeBuffer(a.default.NORMAL).set(t), this.getAttributeBuffer(a.default.TEXCOORD0).set(n), this.getIndexBuffer().set(r), this
    }, i.prototype.clone = function() {
        return new i(u.default.shallowSelectiveClone(this, ["radialSamples", "radius", "height"]))
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(59),
        c = r(f),
        d = n(96),
        h = r(d),
        p = n(70),
        m = r(p),
        y = function(e) {
            function t(e, n) {
                i(this, t);
                var r = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return r.type = "Dom3dComponent", n = n || {}, r.hidden = !1, r.width = n.width || 500, r.height = n.height || 500, r.backfaceVisibility = n.backfaceVisibility || "hidden", r.updated = !0, r.entity = null, r.initDom(e), r.meshData = new c.default(1, 1), r.meshDataComponent = new m.default(r.meshData), r.meshRendererComponent = new h.default, r._transformDirty = !0, r._transformUpdatedListener = null, Object.seal(r), r
            }
            return a(t, e), s(t, [{
                key: "attached",
                value: function(e) {
                    e.setComponent(this.meshDataComponent), e.setComponent(this.meshRendererComponent);
                    var t = this;
                    this.entity.on("transformUpdated", this._transformUpdatedListener = function() {
                        t._transformDirty = !0
                    })
                }
            }, {
                key: "detached",
                value: function(e) {
                    null !== this.domElement.parentNode && this.domElement.parentNode.removeChild(this.domElement), e.clearComponent("meshRendererComponent"), e.clearComponent("meshDataComponent"), this.entity.off("transformUpdated", this._transformUpdatedListener), this._transformUpdatedListener = null
                }
            }, {
                key: "initDom",
                value: function(e) {
                    this.domElement && null !== this.domElement.parentNode && this.domElement.parentNode.removeChild(this.domElement), this.domElement = document.createElement("div"), e && (e.style.width || (e.style.width = "100%"), e.style.height || (e.style.height = "100%"), this.domElement.appendChild(e)), this.domElement.style.position = "absolute", this.domElement.style.margin = "0px", this.domElement.style.padding = "0px", this.domElement.style.backgroundColor = "white", this.domElement.style.backfaceVisibility = this.backfaceVisibility, this.domElement.style.overflow = "hidden", this.setSize(this.width, this.height)
                }
            }, {
                key: "setSize",
                value: function(e, t) {
                    this.width = e || this.width, this.height = t || this.height, this.domElement.style.width = this.width + "px", this.domElement.style.height = this.height + "px"
                }
            }, {
                key: "destroy",
                value: function(e) {
                    this.meshData.destroy(e)
                }
            }]), t
        }(l.default);
    y.type = "Dom3dComponent", t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        u.default.apply(this, arguments), this._componentHandlers = {}
    }

    function o(e, t) {
        if (e._tags.clear(), t)
            for (var n in t) e.setTag(n)
    }

    function a(e, t) {
        if (e._attributes.clear(), t)
            for (var n in t) e.setAttribute(n, t[n])
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = n(25),
        u = r(s),
        l = n(20),
        f = r(l),
        c = n(12),
        d = r(c),
        h = n(56),
        p = r(h),
        m = n(17),
        y = r(m),
        v = n(3),
        _ = r(v);
    i.prototype = Object.create(u.default.prototype), i.prototype.constructor = i, u.default._registerClass("entity", i), i.prototype._create = function() {
        return this.world.createEntity()
    }, i.prototype._remove = function(e) {
        var t = this._objects.get(e),
            n = this;
        if (t) {
            for (var r = [], i = t._components.slice(0), o = 0; o < i.length; o++) {
                var a = this._getComponentType(i[o]),
                    s = this._updateComponent(t, a, null);
                s instanceof d.default.Promise && r.push(s)
            }
            return d.default.all(r).then(function() {
                t.removeFromWorld(), n._objects.delete(e)
            })
        }
    }, i.prototype._update = function(e, t, n) {
        function r(e, t) {
            for (var r = e._components, i = 0; i < r.length; i++) {
                var o = s._getComponentType(r[i]);
                t[o] || s._updateComponent(e, o, null, n)
            }
        }

        function i(e, t) {
            var r = [];
            for (var i in t) {
                var o = s._updateComponent(e, i, t[i], n);
                o ? r.push(o) : console.error("Error handling component " + i)
            }
            return r
        }
        var s = this;
        return u.default.prototype._update.call(this, e, t, n).then(function(n) {
            if (n) {
                n.id = e, n.name = t.name, n.static = !!t.static, o(n, t.tags), a(n, t.customAttributes), r(n, t.components);
                var s = {},
                    u = _.default.deepClone(t.components);
                return t.components.animation && t.components.transform && (s.transform = t.components.transform, delete u.transform), y.default.optimisticAll(i(n, s)).then(function() {
                    return y.default.optimisticAll(i(n, u)).then(function() {
                        return t.hidden ? n.hide() : n.show(), n
                    })
                })
            }
        })
    }, i.prototype._updateComponent = function(e, t, n, r) {
        var i = this._getHandler(t);
        if (!i) return null;
        var o = i.update(e, n, r);
        return o && o.then ? o : null
    }, i.prototype._getComponentType = function(e) {
        var t = e.type;
        return t = t.slice(0, t.lastIndexOf("Component")), t = p.default.uncapitalize(t), "howler" === t && (t = "sound"), "hMDCamera" === t && (t = "hmdcamera"), "vRController" === t && (t = "vrcontroller"), "vRCameraRig" === t && (t = "vr"), t
    }, i.prototype._getHandler = function(e) {
        if (!this._componentHandlers[e]) {
            var t = f.default.getHandler(e);
            t && (this._componentHandlers[e] = new t(this.world, this.getConfig, this.updateObject, this.loadObject))
        }
        return this._componentHandlers[e]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(20),
        l = r(u),
        f = n(294),
        c = r(f),
        d = n(3),
        h = r(d),
        p = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e._type = "HostComponent", e
            }
            return a(t, e), s(t, [{
                key: "_prepare",
                value: function(e) {
                    h.default.defaults(e, {
                        pointOfInterestType: "None",
                        lookAtTargetEntityId: null,
                        animateLipSync: !1,
                        animateGestures: !1,
                        gestureMinPeriod: 1.5,
                        gestureHoldTime: 3,
                        hostConfig: {
                            pointOfInterest: {
                                leftEyeName: "def_l_eye",
                                rightEyeName: "def_r_eye",
                                neckAName: "def_c_neckA",
                                neckBName: "def_c_neckB",
                                eyelidRegEx: "^def_[lr]_(upper|lower)Lid[0-9]+$",
                                browRegEx: "^def_[clr]_(foreheadUp|foreheadMid|brow|upEye|noseBridge|temple|underEye|cheekUp|cheekMid|zygomatic)[0-9]*$",
                                lookAnim_u: "look_u",
                                lookAnim_ur: "look_ur",
                                lookAnim_r: "look_r",
                                lookAnim_dr: "look_dr",
                                lookAnim_d: "look_d",
                                lookAnim_dl: "look_dl",
                                lookAnim_l: "look_l",
                                lookAnim_ul: "look_ul",
                                lookAnim_neutral: "look_neutral",
                                headRotateSpeed: 3.5,
                                eyeRotateSpeed: 25,
                                browSpeed: 10
                            }
                        }
                    })
                }
            }, {
                key: "_create",
                value: function() {
                    return new c.default
                }
            }, {
                key: "update",
                value: function(e, t, n) {
                    return l.default.prototype.update.call(this, e, t, n).then(function(e) {
                        e && e.updateFromConfig(t)
                    })
                }
            }]), t
        }(l.default);
    l.default._registerClass("host", p), t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(63),
        c = (r(f), n(204)),
        d = r(c),
        h = n(205),
        p = r(h),
        m = n(295),
        y = r(m),
        v = n(206),
        _ = r(v),
        g = n(98),
        b = r(g),
        x = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e.type = "HostComponent", e._animateGestures, e._pointOfInterestType = "None", e._lookAtTargetEntityId = null, e._animateLipSync = !1, e._animateGestures = !1, e._hostConfig = {}, e._hostEntity = null, e._lipSyncer = null, e._pointOfInterestTargeter = null, e._gesturer = null, e._emoter = null, e
            }
            return a(t, e), s(t, [{
                key: "attached",
                value: function(e) {
                    this._entityGestureEventBusName = this.entity.id + ".gestureEvent"
                }
            }, {
                key: "detached",
                value: function() {
                    this._lipSyncer && this._lipSyncer.entityDetached(), this._gesturer && this._gesturer.entityDetached(), this._emoter && this._emoter.entityDetached(), this._pointOfInterestTargeter && this._pointOfInterestTargeter.entityDetached()
                }
            }, {
                key: "setupHost",
                value: function(e) {
                    if (this._hostEntity = null, e.name === t.HOST_CHILD_ENTITY_NAME) {
                        if (this._hostEntity = e, this._animateLipSync && (this._lipSyncer || (this._lipSyncer = new p.default(this.entity, this._hostEntity))), this._animateGestures && (this._gesturer || (this._gesturer = new y.default(this.entity, this._hostEntity, this._gestureMinPeriod, this._gestureHoldTime))), "LookAtEntity" === this._pointOfInterestType && !this._pointOfInterestTargeter && this._lookAtTargetEntityId) {
                            var n = this.entity._world.entityManager.getEntityById(this._lookAtTargetEntityId);
                            if (n) try {
                                this._pointOfInterestTargeter = new _.default(this._hostConfig.pointOfInterest, this._pointOfInterestType, this.entity, this._hostEntity, n)
                            } catch (e) {
                                if (!(e instanceof b.default)) throw e;
                                console.error(e.message)
                            }
                        }
                        this._emoter = new d.default(this.entity, this._hostEntity, this._gesturer)
                    }
                }
            }, {
                key: "process",
                value: function(e) {
                    this._pointOfInterestTargeter && this._pointOfInterestTargeter.process(), this._gesturer && this._gesturer.process(e), this._emoter && this._emoter.process(e)
                }
            }, {
                key: "updateFromConfig",
                value: function(e) {
                    void 0 !== e.pointOfInterestType && (this._pointOfInterestType = e.pointOfInterestType), e.lookAtTargetEntityId && (this._lookAtTargetEntityId = e.lookAtTargetEntityId), void 0 !== e.animateLipSync && (this._animateLipSync = e.animateLipSync), void 0 !== e.animateGestures && (this._animateGestures = e.animateGestures), void 0 !== e.gestureMinPeriod && (this._gestureMinPeriod = e.gestureMinPeriod), void 0 !== e.gestureHoldTime && (this._gestureHoldTime = e.gestureHoldTime), void 0 !== e.hostConfig && (this._hostConfig = e.hostConfig)
                }
            }]), t
        }(l.default);
    Object.defineProperty(x, "HOST_CHILD_ENTITY_NAME", {
        writable: !1,
        enumerable: !0,
        configurable: !1,
        value: "HostEntity"
    }), t.default = x
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(4),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(98),
        h = r(d),
        p = n(121),
        m = r(p),
        y = function(e) {
            function t(e, n, r, a) {
                i(this, t);
                var s = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, n));
                return s._gestureMinPeriod = r, s._gestureHoldTime = a, s._isTransitioning = !1, s._currentGestureIdx = null, s._initGestures(), s._entitySsmlEventBusName = e.id + ".ssmlEvent", c.default.addListener(s._entitySsmlEventBusName, s.onSsmlEvent = function(e) {
                    var n = new RegExp(t.GESTURE_SSML_EVENT_PREFIX + "(.*)"),
                        r = n.exec(e);
                    if (r) {
                        var i = r[1];
                        s._transitionToGesture(i)
                    }
                }), s._transitionToIdleAnimation(), s._currentGestureTimer = a, s
            }
            return a(t, e), s(t, [{
                key: "_initAnimLayersAndStates",
                value: function() {
                    if (this._gestureLayer = this._animationComponent.layers.find(function(e) {
                            return e._name === t.GESTURE_LAYER_NAME
                        }), !this._gestureLayer) throw new h.default("[Sumerian] Could not find Gesture Layer '" + t.GESTURE_LAYER_NAME + "'");
                    if (this._gestureStandAnimState = this._gestureLayer.getStateByName(t.GESTURE_STAND_ANIMSTATE_NAME), !this._gestureStandAnimState) throw new h.default("[Sumerian] Could not find expected Standing Gesture Animation State '" + t.GESTURE_STAND_ANIMSTATE_NAME + "' in AnimLayer '" + t.GESTURE_LAYER_NAME + "'")
                }
            }, {
                key: "_initGestures",
                value: function() {
                    var e = this;
                    this._initAnimLayersAndStates(), this._gestures = [], t.GESTURE_NAMES.forEach(function(t) {
                        var n = e._gestureLayer.getStateByName("idle_to_" + t),
                            r = e._gestureLayer.getStateByName(t + "_to_idle"),
                            i = e._gestureLayer.getStateByName(t + "_settle"),
                            o = e._gestureLayer.getStateByName(t),
                            a = void 0 !== n && void 0 !== r && void 0 !== i && void 0 !== o;
                        e._gestures.push({
                            name: t,
                            idleToGestureAnimState: n,
                            gestureToIdleAnimState: r,
                            interGestureAnimState: i,
                            gestureAnimState: o,
                            hasAllAnimStates: a
                        })
                    })
                }
            }, {
                key: "_transitionToAnimState",
                value: function(e) {
                    this._gestureLayer.setCurrentState(e), this._currentGestureTimer = 0
                }
            }, {
                key: "_transitionToIdleAnimation",
                value: function() {
                    this._gestureLayer.setCurrentState(this._gestureStandAnimState, !0), this._currentGestureTimer = this._gestureHoldTime, this._currentGestureIdx = null, this._isTransitioning = !1
                }
            }, {
                key: "_transitionToGesture",
                value: function(e) {
                    var n = this;
                    if (t.GESTURE_NAMES.includes(e)) {
                        var r = this._gestures.findIndex(function(t) {
                            return t.name === e
                        });
                        if (-1 !== r && r != this._currentGestureIdx && !this._isTransitioning && this._gestures[r].hasAllAnimStates && this._currentGestureTimer > this._gestureMinPeriod) {
                            var i = function() {
                                n._isTransitioning = !1, n._currentGestureTimer = 0, n._gestureLayer.setCurrentState(n._gestures[n._currentGestureIdx].gestureAnimState, !0)
                            };
                            this._gestureLayer.transitionTo(this._gestures[r].interGestureAnimState.id, void 0, i), this._isTransitioning = !0, this._currentGestureIdx = r
                        } else console.warn("Skipping gesture. gestureIdx: " + r + " currentGestureIdx: " + this._currentGestureIdx + " isTransitioning: " + this._isTransitioning + " hasAllAnimStates: " + this._gestures[r].hasAllAnimStates + " gestureTimer: " + this._currentGestureTimer)
                    } else console.warn("[Sumerian] Received unrecognized gesture '" + e + "'")
                }
            }, {
                key: "entityDetached",
                value: function() {
                    this.onSsmlEvent && c.default.removeListener(this._entitySsmlEventBusName, this.onSsmlEvent), this.onStartSpeakingEvent && c.default.removeListener(this._entityStartSpeakingEventBusName, this.onStartSpeakingEvent), this.onStopSpeakingEvent && c.default.removeListener(this._entityStopSpeakingEventBusName, this.onStopSpeakingEvent)
                }
            }, {
                key: "process",
                value: function(e) {
                    var t = this;
                    null !== this._currentGestureIdx && (this._currentGestureTimer = l.default.clamp(this._currentGestureTimer + e, 0, this._gestureHoldTime), this._currentGestureTimer >= this._gestureHoldTime && !this._isTransitioning && (this._isTransitioning = !0, this._gestureLayer.transitionTo(this._gestures[this._currentGestureIdx].gestureToIdleAnimState.id, void 0, function() {
                        t._transitionToIdleAnimation()
                    })))
                }
            }]), t
        }(m.default),
        v = function(e, t) {
            Object.defineProperty(y, e, {
                value: t,
                writable: !1,
                enumerable: !0,
                configurable: !1
            })
        };
    ! function() {
        v("GESTURE_SSML_EVENT_PREFIX", "gesture:"), v("GESTURE_LAYER_NAME", "__Gesture__"), v("GESTURE_STAND_ANIMSTATE_NAME", "stand_idle"), v("GESTURE_NAMES", ["big", "heart", "in", "movement", "many", "one", "defense", "wave", "self", "you", "aggressive", "small", "before", "after", "impact", "destroy", "agreement", "face", "generic_a", "generic_b", "generic_c"])
    }(), t.default = y
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(208),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.resetClips = function(e) {
        o.default.prototype.resetClips.call(this, e), this._targetState.resetClips(this._sourceState._globalStartTime)
    }, r.prototype.shiftClipTime = function(e) {
        o.default.prototype.shiftClipTime.call(this, e), this._targetState.shiftClipTime(this._sourceState._globalStartTime + e), this._sourceState.shiftClipTime(e)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(209),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.update = function(e) {
        o.default.prototype.update.call(this, e), this._targetState && this._targetState.update(e)
    }, r.prototype.postUpdate = function() {
        this._targetState && this._targetState.postUpdate()
    }, r.prototype.resetClips = function(e) {
        o.default.prototype.resetClips.call(this, e), this._targetState.resetClips(e)
    }, r.prototype.shiftClipTime = function(e) {
        o.default.prototype.shiftClipTime.call(this, e), this._targetState.shiftClipTime(e)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {
        this._blendWeight = null, this._layerA = null, this._layerB = null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(154),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.getBlendedSourceData = function() {
        var e = this._layerA.getCurrentSourceData(),
            t = this._layerB._currentState ? this._layerB._currentState.getCurrentSourceData() : null;
        return o.default.combineSourceData(e, t, this._blendWeight, null, "Additive" === this._layerB._layerType)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(17),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("json", i), i.prototype._update = function(e, t) {
        if (!t) return this._remove(e), u.default.resolve();
        var n = void 0;
        try {
            n = JSON.parse(t.body)
        } catch (e) {
            n = {}
        }
        return u.default.resolve(n)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "LightComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(123),
        u = r(s),
        l = n(110),
        f = r(l),
        c = n(93),
        d = r(c),
        h = n(81),
        p = r(h),
        m = n(0),
        y = r(m),
        v = n(3),
        _ = r(v);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("light", i), i.prototype._prepare = function(e) {
        if (_.default.defaults(e, {
                direction: [0, 0, 0],
                color: [1, 1, 1],
                shadowCaster: !1,
                lightCookie: null
            }), "DirectionalLight" !== e.type && (e.range = void 0 !== e.range ? e.range : 1e3), e.shadowCaster) {
            e.shadowSettings = e.shadowSettings || {}, _.default.defaults(e.shadowSettings, {
                shadowType: "Basic",
                near: 1,
                far: 1e3,
                resolution: [512, 512],
                darkness: .5,
                shadowOffset: -.001
            });
            var t = e.shadowSettings;
            "Parallel" === t.projection ? t.size = void 0 !== t.size ? t.size : 400 : t.fov = void 0 !== t.fov ? t.fov : 55
        }
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype.update = function(e, t, n) {
        var r = this,
            i = {
                SpotLight: d.default,
                DirectionalLight: p.default,
                PointLight: f.default
            };
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e) {
                var o = e.light;
                o && i[t.type] === o.constructor || (o = new i[t.type], e.light = o);
                for (var a in t) {
                    var s = t[a];
                    if (o.hasOwnProperty(a))
                        if ("shadowSettings" === a)
                            for (var a in s) {
                                var u = s[a];
                                o.shadowSettings[a] instanceof y.default ? o.shadowSettings[a].setDirect(u[0], u[1], u[2]) : o.shadowSettings[a] = _.default.clone(u)
                            } else o[a] instanceof y.default ? o[a].setDirect(s[0], s[1], s[2]) : o[a] = _.default.clone(s)
                }
                if ("PointLight" === t.type && (o.shadowCaster = !1), t.lightCookie && "PointLight" !== t.type) {
                    var l = t.lightCookie;
                    return l && l.textureRef && !1 !== l.enabled ? r._load(l.textureRef, n).then(function(t) {
                        return o.lightCookie = t, e
                    }) : (o.lightCookie = null, e)
                }
                return o.lightCookie = null, e
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(9),
        u = r(s),
        l = n(15),
        f = r(l),
        c = n(150),
        d = r(c),
        h = n(12),
        p = r(h),
        m = n(3),
        y = r(m);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("material", i), i.GOO_SHADER_PREFIX = "GOO_ENGINE_SHADERS/", i.ENGINE_SHADER_PREFIX = "SUMERIAN_ENGINE_SHADERS/", i.prototype._prepare = function(e) {
        y.default.defaults(e, {
            blendState: {},
            cullState: {},
            depthState: {},
            renderQueue: -1,
            dualTransparency: !1,
            wireframe: !1,
            flat: !1
        }), y.default.defaults(e.blendState, {
            blending: "NoBlending",
            blendEquation: "AddEquation",
            blendSrc: "SrcAlphaFactor",
            blendDst: "OneMinusSrcAlphaFactor"
        }), y.default.defaults(e.cullState, {
            enabled: !0,
            cullFace: "Back",
            frontFace: "CCW"
        }), y.default.defaults(e.depthState, {
            enabled: !0,
            write: !0
        })
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        t && (t.empty(), this._objects.delete(e))
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        return a.default.prototype._update.call(this, e, t, n).then(function(e) {
            if (e) {
                var o = [];
                y.default.extend(e.blendState, t.blendState), y.default.extend(e.cullState, t.cullState), y.default.extend(e.depthState, t.depthState), e.id = t.id, e.name = t.name, e.wireframe = t.wireframe, e.flat = t.flat, e.dualTransparency = t.dualTransparency, -1 === t.renderQueue ? "NoBlending" !== t.blendState.blending ? e.renderQueue = d.default.TRANSPARENT : e.renderQueue = null : e.renderQueue = t.renderQueue, e.uniforms = {};
                for (var a in t.uniforms) void 0 === t.uniforms[a].enabled ? e.uniforms[a] = y.default.clone(t.uniforms[a]) : t.uniforms[a].enabled && (e.uniforms[a] = y.default.clone(t.uniforms[a].value));
                void 0 !== e.uniforms.materialDiffuse && (e.uniforms.materialDiffuse[3] = 1), void 0 !== e.uniforms.materialAmbient && (e.uniforms.materialAmbient[3] = 1), void 0 !== e.uniforms.materialEmissive && (e.uniforms.materialEmissive[3] = 1), void 0 !== e.uniforms.materialSpecular && void 0 !== e.uniforms.materialSpecularPower && (e.uniforms.materialSpecular[3] = e.uniforms.materialSpecularPower);
                var s = t.shaderRef;
                if (s)
                    if (0 === s.indexOf(i.ENGINE_SHADER_PREFIX)) {
                        var l = s.slice(i.ENGINE_SHADER_PREFIX.length);
                        e.shader = u.default.createShader(f.default[l])
                    } else if (0 === s.indexOf(i.GOO_SHADER_PREFIX)) {
                    var c = s.slice(i.GOO_SHADER_PREFIX.length);
                    e.shader = u.default.createShader(f.default[c])
                } else {
                    var h = r._load(s, n).then(function(t) {
                        e.shader = t
                    }).then(null, function(e) {
                        throw new Error("Error loading shader: " + e)
                    });
                    o.push(h)
                } else e.shader = u.default.createShader(f.default.texturedLit, "DefaultShader");
                var m = void 0;
                for (var v in t.texturesMapping) m = t.texturesMapping[v], m && m.textureRef && !1 !== m.enabled ? o.push(function(t, n, i) {
                    return r._load(n, i).then(function(n) {
                        e.setTexture(t, n)
                    }).then(null, function(e) {
                        throw new Error("Error loading texture: " + n + " - " + e)
                    })
                }(v, m.textureRef, n)) : e.removeTexture(v);
                for (var v in e._textureMaps) t.texturesMapping[v] || e.removeTexture(v);
                return p.default.all(o).then(function() {
                    return e
                })
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "MeshDataComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(70),
        u = r(s),
        l = n(46),
        f = r(l),
        c = n(201),
        d = r(c),
        h = n(12),
        p = r(h),
        m = n(3),
        y = r(m),
        v = n(56),
        _ = r(v),
        g = n(0),
        b = r(g);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("meshData", i), i.prototype._prepare = function(e) {
        return y.default.defaults(e, {})
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype._remove = function(e) {
        //! AT: why is this check needed?
        e.meshDataComponent && e.meshDataComponent.meshData && this.world.sumerianRunner && e.meshDataComponent.meshData.destroy(this.world.sumerianRunner.renderer.context), e.clearComponent("MeshDataComponent")
    }, i.prototype.update = function(e, t, n) {
        var r = this;
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e)
                if (e.meshData = null, e.currentPose = null, t.shape) {
                    var i = d.default["create" + _.default.capitalize(t.shape)];
                    if (i) return e.meshData = i(t.shapeOptions, e.meshData), e.modelBoundDirty = !0, e
                } else {
                    if (t.meshRef) {
                        var o = [];
                        return o.push(r._load(t.meshRef, n).then(function(t) {
                            if (e.meshData = t, t.boundingBox) {
                                var n = t.boundingBox.min,
                                    r = t.boundingBox.max,
                                    i = [r[0] - n[0], r[1] - n[1], r[2] - n[2]],
                                    o = new b.default(r[0] + n[0], r[1] + n[1], r[2] + n[2]).scale(.5),
                                    a = new f.default(o, i[0] / 2, i[1] / 2, i[2] / 2);
                                e.setModelBound(a, !1)
                            }
                        })), t.poseRef && o.push(r._load(t.poseRef, n).then(function(t) {
                            e.currentPose || (e.currentPose = t)
                        })), p.default.all(o).then(function() {
                            return e
                        })
                    }
                    e.modelBoundDirty = !0
                }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(6),
        u = r(s),
        l = n(146),
        f = r(l),
        c = n(26),
        d = r(c),
        h = n(17),
        p = r(h),
        m = n(64),
        y = r(m);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("mesh", i), i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        t && this.world.sumerianRunner && t.destroy(this.world.sumerianRunner.renderer.context), this._objects.delete(e)
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        if (!t) return this._remove(e), p.default.resolve();
        var i = this._objects.get(e);
        return i ? p.default.resolve(i) : this.loadObject(t.binaryRef, n).then(function(n) {
            if (!n) throw new Error("Binary mesh data was empty");
            var i = r._createMeshData(t, n);
            return r._fillMeshData(i, t, n), r._objects.set(e, i), i
        })
    }, i.prototype._createMeshData = function(e) {
        var t = "SkinnedMesh" === e.type,
            n = e.vertexCount;
        if (0 === n) return null;
        var r = 0;
        e.indexLengths ? r = e.indexLengths.reduce(function(e, t) {
            return e + t
        }) : e.indices && (r = e.indices.wordLength);
        var i = {
            float32: "Float",
            uint8: "UnsignedByte",
            uint16: "UnsignedShort",
            uint32: "UnsignedInt"
        };
        "Trident" === f.default.browserType && (i.uint8 = "UnsignedShort");
        var o = {};
        for (var a in e.attributes) {
            var s = e.attributes[a],
                l = s.value[2];
            o[a] = u.default.createAttribute(s.dimensions, i[l])
        }
        var c = new u.default(o, n, r);
        return c.type = t ? u.default.SKINMESH : u.default.MESH, c
    }, i.prototype._fillMeshData = function(e, t, n) {
        var r = e.type === u.default.SKINMESH;
        for (var i in t.attributes)
            if ("JOINTIDS" !== i) {
                var o = t.attributes[i].value;
                e.getAttributeBuffer(i).set(y.default.getTypedArray(n, o))
            }
        if (r && t.attributes.JOINTIDS) {
            for (var a = e.getAttributeBuffer(u.default.JOINTIDS), s = y.default.getTypedArray(n, t.attributes.JOINTIDS.value), l = [], f = 0, c = 0; c < s.length; c++) {
                var h = s[c];
                void 0 === l[h] && (l[h] = f++), a.set([l[h]], c)
            }
            for (var p = [], h = 0; h < l.length; h++) {
                var f = l[h];
                null !== f && (p[f] = h)
            }
            e.paletteMap = p, e.weightsPerVertex = 4
        }
        if (e.getIndexBuffer().set(y.default.getTypedArray(n, t.indices)), e.indexModes = t.indexModes.slice(), e.indexLengths = t.indexLengths.slice(), t.boundingVolume) {
            if ("BoundingBox" !== t.boundingVolume.type) throw new Error("Bounding volume was not BoundingBox");
            e.boundingBox = {
                min: t.boundingVolume.min,
                max: t.boundingVolume.max
            }
        }
        return !d.default.ElementIndexUInt && e.vertexCount > 65536 && e.deIndex(), e
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "MeshRendererComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(96),
        u = r(s),
        l = n(9),
        f = r(l),
        c = n(15),
        d = r(c),
        h = n(12),
        p = r(h),
        m = n(3),
        y = r(m);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("meshRenderer", i), i.DEFAULT_MATERIAL = new f.default(d.default.uber, "Default material"), i.prototype._prepare = function(e) {
        return y.default.defaults(e, {
            cullMode: "Dynamic",
            castShadows: !0,
            receiveShadows: !0,
            reflectable: !0
        })
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype.update = function(e, t, n) {
        var r = this;
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e) {
                e.cullMode = t.cullMode, e.castShadows = t.castShadows, e.receiveShadows = t.receiveShadows, e.isReflectable = t.reflectable;
                var o = t.materials;
                if (!o || !Object.keys(o).length) {
                    var a = e.materials.filter(function(e) {
                        return "sumerianSelectionIndicator" === e.name
                    });
                    return e.materials = [i.DEFAULT_MATERIAL].concat(a), e
                }
                var s = [];
                return y.default.forEach(o, function(e) {
                    s.push(r._load(e.materialRef, n))
                }, null, "sortValue"), p.default.all(s).then(function(t) {
                    var n = e.materials.filter(function(e) {
                        return "sumerianSelectionIndicator" === e.name
                    });
                    return e.materials = t.concat(n), e
                })
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(5),
        u = r(s),
        l = n(12),
        f = r(l),
        c = n(69),
        d = r(c);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("scene", i), i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        if (t)
            for (var n = 0; n < t.entities.length; n++) t.entities[n].removeFromWorld();
        this._objects.delete(e)
    }, i.prototype._create = function() {
        return {
            id: null,
            entities: {},
            posteffects: [],
            environment: null,
            initialCameraRef: null,
            initialVRCameraRigRef: null
        }
    }, i.prototype._update = function(e, t, n) {
        var r = this,
            i = this;
        return a.default.prototype._update.call(this, e, t, n).then(function(o) {
            if (o) {
                o.id = e;
                var a = [];
                if (a.push(i._handleEntities(t, o, n)), t.posteffectsRef && a.push(i._load(t.posteffectsRef, n)), t.environmentRef && a.push(i._load(t.environmentRef, n)), !n.scene || !n.scene.dontSetCamera) {
                    var s = r._setInitialCamera(i, t, o, n);
                    s && a.push(s);
                    var u = r._setInitialVRCameraRig(i, t, o, n);
                    u && a.push(u)
                }
                var l = r.world.getSystem("AwsSystem");
                return l && a.push(l.updateConfig(t.aws, n.aws)), f.default.all(a).then(function() {
                    return o
                })
            }
        })
    }, i.prototype._setInitialCamera = function(e, t, n, r) {
        if (t.initialCameraRef && t.initialCameraRef !== n.initialCameraRef) return e._load(t.initialCameraRef, r).then(function(e) {
            e && e.cameraComponent && u.default.emit("sumerian.setCurrentCamera", {
                camera: e.cameraComponent.camera,
                entity: e
            }), n.initialCameraRef = t.initialCameraRef
        })
    }, i.prototype._setInitialVRCameraRig = function(e, t, n, r) {
        if (t.initialVRCameraRigRef && t.initialVRCameraRigRef !== n.initialVRCameraRigRef) return e._load(t.initialVRCameraRigRef, r).then(function(e) {
            e && e.vRCameraRigComponent && u.default.emit(d.default.SET_CURRENT_VR, {
                entity: e
            }), n.initialVRCameraRigRef = t.initialVRCameraRigRef
        })
    }, i.prototype._handleEntities = function(e, t, n) {
        var r = this,
            i = Object.keys(t.entities).filter(function(t) {
                return !e.entities[t]
            });
        return f.default.all([this._loadEntities(Object.keys(e.entities)), this._loadEntities(i)]).then(function(e) {
            r._addEntities(t, e[0], n), r._removeEntities(t, e[1])
        })
    }, i.prototype._loadEntities = function(e, t) {
        var n = this;
        return f.default.all(e.map(function(e) {
            return n._load(e, t)
        }))
    }, i.prototype._addEntities = function(e, t, n) {
        t.forEach(function(t) {
            e.entities[t.id] = t, t.hasTag("sumerian.EditModeOnly") && !n.editMode || t.addToWorld()
        })
    }, i.prototype._removeEntities = function(e, t) {
        t.forEach(function(t) {
            if (!t.parent().first()) {
                t.removeFromWorld(!1)
            }
            delete e.entities[t.id]
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(9),
        u = r(s),
        l = n(67),
        f = r(l),
        c = n(12),
        d = r(c),
        h = n(17),
        p = r(h);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("shader", i), i.prototype._remove = function(e) {
        var t = this._objects.get(e);
        t && this.world.sumerianRunner && (t.destroy(this.world.sumerianRunner.renderer.context), this._objects.delete(e))
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        if (!t) return this._remove(e), p.default.resolve();
        if (!t.vshaderRef) return p.default.reject("Shader error, missing vertex shader ref");
        if (!t.fshaderRef) return p.default.reject("Shader error, missing fragment shader ref");
        var i = [this.loadObject(t.vshaderRef, n), this.loadObject(t.fshaderRef, n)];
        return d.default.all(i).then(function(n) {
            var i = n[0],
                o = n[1];
            if (!i) return p.default.reject("Vertex shader" + t.vshaderRef + "in shader" + e + "not found");
            if (!o) return p.default.reject("Fragment shader" + t.fshaderRef + "in shader" + e + "not found");
            var a = {
                defines: t.defines || {},
                attributes: t.attributes || {},
                uniforms: t.uniforms || {},
                vshader: i,
                fshader: o
            };
            if (t.processors) {
                a.processors = [];
                for (var s = 0; s < t.processors.length; s++) {
                    var l = t.processors[s];
                    f.default[l] ? a.processors.push(f.default[l].processor) : console.error("Unknown processor " + l)
                }
            }
            var c = u.default.createShader(a, e);
            return r._objects.set(e, c), c
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "TransformComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(149),
        u = r(s),
        l = n(4),
        f = r(l),
        c = n(3),
        d = r(c),
        h = n(12),
        p = r(h);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("transform", i), i.prototype._prepare = function(e) {
        return d.default.defaults(e, {
            translation: [0, 0, 0],
            rotation: [0, 0, 0],
            scale: [1, 1, 1]
        })
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype._remove = function(e) {
        var t = e.transformComponent;
        t.transform.translation.setDirect(0, 0, 0), t.transform.setRotationXYZ(0, 0, 0), t.transform.scale.setDirect(1, 1, 1);
        for (var n = 0; n < t.children.length; n++) {
            var r = t.children[n];
            t.detachChild(r)
        }
        t.setUpdated()
    }, i.prototype.update = function(e, t, n) {
        function r(e, t) {
            return i.loadObject(t, n).then(function(t) {
                if (t && t.transformComponent) {
                    e.attachChild(t.transformComponent);
                    var n = i.world.entityManager.containsEntity(t) || -1 !== i.world._addedEntities.indexOf(t),
                        r = i.world.entityManager.containsEntity(e.entity) || i.world._addedEntities.indexOf(e.entity) > -1; //! AT: most probably not needed anymore
                    !n && r && t.addToWorld()
                } else console.error("Failed to add child to transform component");
                return e
            })
        }
        var i = this;
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e) {
                e.transform.translation.setDirect(t.translation[0], t.translation[1], t.translation[2]), e.transform.setRotationXYZ(f.default.DEG_TO_RAD * t.rotation[0], f.default.DEG_TO_RAD * t.rotation[1], f.default.DEG_TO_RAD * t.rotation[2]), e.transform.scale.setDirect(t.scale[0], t.scale[1], t.scale[2]);
                var n = [];
                if (t.children) {
                    for (var i = Object.keys(t.children), o = 0; o < i.length; o++) {
                        var a = t.children[i[o]].entityRef;
                        n.push(r(e, a))
                    }
                    for (var o = 0; o < e.children.length; o++) {
                        var s = e.children[o],
                            u = s.entity.id;
                        t.children[u] || e.detachChild(s)
                    }
                } else
                    for (var o = 0; o < e.children.length; o++) {
                        var s = e.children[o];
                        e.detachChild(s)
                    }
                return p.default.all(n).then(function() {
                    return e.setUpdated(), e
                })
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.apply(this, arguments)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(25),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, o.default._registerClass("project", r), r.prototype._remove = function(e, t) {
        var n = this._objects.get(e);
        n && this.updateObject(n.mainScene.id, null, t)
    }, r.prototype._create = function() {
        return {
            mainScene: null
        }
    }, r.prototype._update = function(e, t, n) {
        var r = this;
        return o.default.prototype._update.call(this, e, t, n).then(function(e) {
            function i() {
                return r._load(t.mainSceneRef, n).then(function(t) {
                    return e.mainScene = t, e
                })
            }
            if (e) return e.mainScene && t.mainSceneRef !== e.mainScene.id ? r.updateObject(e.mainScene.id, null, n).then(i) : i()
        })
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "SoundComponent"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(20),
        a = r(o),
        s = n(310),
        u = r(s),
        l = n(75),
        f = r(l),
        c = n(12),
        d = r(c),
        h = n(17),
        p = r(h),
        m = n(3),
        y = r(m);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, a.default._registerClass("sound", i), i.prototype._remove = function(e) {
        var t = e.soundComponent;
        if (t && t.sounds)
            for (var n = t.sounds, r = 0; r < n.length; r++) n[r].stop()
    }, i.prototype._prepare = function(e) {
        y.default.defaults(e, {
            volume: 1,
            reverb: 0
        })
    }, i.prototype._create = function() {
        return new u.default
    }, i.prototype.update = function(e, t, n) {
        if (!f.default.isSupported()) return p.default.resolve();
        var r = this;
        return a.default.prototype.update.call(this, e, t, n).then(function(e) {
            if (e) {
                e.updateConfig(t);
                for (var i = 0; i < e.sounds.length; i++) {
                    var o = e.sounds[i];
                    t.sounds[o.id] || e.removeSound(o)
                }
                var a = [];
                return y.default.forEach(t.sounds, function(e) {
                    a.push(r._load(e.soundRef, n))
                }, null, "sortValue"), d.default.all(a).then(function(t) {
                    for (var n = 0; n < t.length; n++) - 1 === e.sounds.indexOf(t[n]) && e.addSound(t[n]);
                    return e
                })
            }
        })
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(75),
        c = r(f),
        d = n(0),
        h = r(d),
        p = n(4),
        m = r(p),
        y = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return e.type = "SoundComponent", e._system = null, e.sounds = [], e._isPanned = !0, e._outDryNode = c.default.getContext().createGain(), e._outWetNode = c.default.getContext().createGain(), e.connectTo(), e._pannerNode = c.default.getContext().createPanner(), e._pannerNode.connect(e._outDryNode), e._inNode = c.default.getContext().createGain(), e._inNode.connect(e._pannerNode), e._inNode2d = c.default.getContext().createGain(), e._inNode2d.connect(e._outDryNode), e._oldPosition = new h.default, e._position = new h.default, e._orientation = new h.default, e._attachedToCamera = !1, e._autoPlayDirty = !1, Object.seal(e), e
            }
            return a(t, e), s(t, [{
                key: "addSound",
                value: function(e) {
                    -1 === this.sounds.indexOf(e) && (e.spatialize ? e.connectTo([this._inNode, this._outWetNode]) : e.connectTo([this._inNode2d]), this.sounds.push(e), this._autoPlayDirty = !0)
                }
            }, {
                key: "removeSound",
                value: function(e) {
                    var t = this.sounds.indexOf(e);
                    t > -1 && (e.stop(), this.sounds.splice(t, 1), e.spatialize ? e.disconnectFrom([this._inNode, this._outWetNode]) : e.disconnectFrom([this._inNode2d]))
                }
            }, {
                key: "getSoundById",
                value: function(e) {
                    for (var t = 0; t < this.sounds.length; t++)
                        if (this.sounds[t].id === e) return this.sounds[t]
                }
            }, {
                key: "connectTo",
                value: function(e) {
                    this._outDryNode.disconnect(), this._outWetNode.disconnect(), e && e.dry && this._outDryNode.connect(e.dry), e && e.wet && this._outWetNode.connect(e.wet)
                }
            }, {
                key: "updateConfig",
                value: function(e) {
                    void 0 !== e.volume && (this._outDryNode.gain.value = m.default.clamp(e.volume, 0, 1)), void 0 !== e.reverb && (this._outWetNode.gain.value = m.default.clamp(e.reverb, 0, 1))
                }
            }, {
                key: "_autoPlaySounds",
                value: function() {
                    for (var e = this.sounds, t = 0; t < e.length; t++) {
                        var n = e[t];
                        n.autoPlay && n.play()
                    }
                }
            }, {
                key: "process",
                value: function(e, t) {
                    if (this._pannerNode.rolloffFactor = e.rolloffFactor, this._pannerNode.maxDistance = e.maxDistance, this._autoPlayDirty && this._system && !this._system.passive && (this._autoPlaySounds(), this._autoPlayDirty = !1), this._attachedToCamera || !t) return this._isPanned && (this._inNode.disconnect(), this._inNode.connect(this._outDryNode), this._isPanned = !1), this._pannerNode.setPosition(0, 0, 0), void this._pannerNode.setOrientation(0, 0, 0);
                    this._isPanned || (this._inNode.disconnect(), this._inNode.connect(this._pannerNode), this._isPanned = !0), t.getTranslation(this._position), this._oldPosition.set(this._position), this._orientation.setDirect(0, 0, -1), this._orientation.applyPostVector(t), this._pannerNode.setPosition(this._position.x, this._position.y, this._position.z), this._pannerNode.setOrientation(this._orientation.x, this._orientation.y, this._orientation.z)
                }
            }]), t
        }(l.default);
    y.type = "SoundComponent", t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.id = null, this.name = null, this._loop = !1, this._rate = 1, this._offset = 0, this._duration = null, this._volume = 1, this._buffer = null, this._stream = null, this._streamSource = null, this._currentSource = null, this._outNode = a.default.getContext().createGain(), this.connectTo(), this._playStart = 0, this._pausePos = 0, this._endPromise = null, this._paused = !1, this.spatialize = !0, this.autoPlay = !1, Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(75),
        a = r(o),
        s = n(4),
        u = r(s),
        l = n(124),
        f = r(l),
        c = n(12),
        d = r(c);
    i.prototype.play = function(e) {
        if (e = e || 0, this._currentSource) return this._endPromise; //! AT: this needs refactoring
        if (this._endPromise = new d.default.Promise, !this._buffer || this._stream) return this._endPromise;
        var t = this._currentSource = a.default.getContext().createBufferSource();
        this._paused = !1, this._currentSource.onended = function() {
            this._currentSource !== t || this._paused || this.stop()
        }.bind(this), this._currentSource.playbackRate.value = this._rate, this._currentSource.connect(this._outNode), this._currentSource.buffer = this._buffer, this._currentSource.loop = this._loop, this._loop && (this._currentSource.loopStart = this._offset, this._currentSource.loopEnd = this._duration + this._offset), this._playStart = a.default.getContext().currentTime - this._pausePos;
        var n = this._duration - this._pausePos;
        return this._loop ? this._currentSource.start(e, this._pausePos + this._offset) : this._currentSource.start(e, this._pausePos + this._offset, n), this._endPromise
    }, i.prototype.pause = function() {
        this._currentSource && (this._paused = !0, this._pausePos = (a.default.getContext().currentTime - this._playStart) % this._duration, this._pausePos /= this._rate, this._stop())
    }, i.prototype.stop = function(e) {
        this._paused = !1, this._pausePos = 0, this._endPromise && this._endPromise.resolve(), this._currentSource && this._stop(e)
    }, i.prototype.fadeIn = function(e) {
        this.stop();
        var t = this._volume;
        this._outNode.gain.value = 0;
        var n = this.fade(t, e);
        return this.play(), n
    }, i.prototype.fadeOut = function(e) {
        return this._outNode.gain.value = this._volume, this.fade(0, e)
    }, i.prototype.fade = function(e, t) {
        return this._outNode.gain.cancelScheduledValues(a.default.getContext().currentTime), this._outNode.gain.setValueAtTime(this._outNode.gain.value, a.default.getContext().currentTime), this._outNode.gain.linearRampToValueAtTime(e, a.default.getContext().currentTime + t), f.default.delay(e, 1e3 * t)
    }, i.prototype.isPlaying = function() {
        return !!this._currentSource
    }, i.prototype._stop = function(e) {
        e = e || 0, this._currentSource.stop(e), this._currentSource = null
    }, i.prototype.update = function(e) {
        e = e || {}, void 0 !== e.id && (this.id = e.id), void 0 !== e.name && (this.name = e.name), void 0 !== e.loop && (this._loop = !!e.loop, this._currentSource && (this._currentSource.loop = this._loop)), void 0 !== e.volume && (this._volume = u.default.clamp(e.volume, 0, 1), this._outNode.gain.value = this._volume), void 0 !== e.offset && (this._offset = e.offset), void 0 !== e.duration && (this._duration = e.duration), void 0 !== e.timeScale && (this._rate = e.timeScale,
            //! AT: should have the same name if they are the same thing
            this._currentSource && (this._currentSource.playbackRate.value = e.timeScale)), void 0 !== e.spatialize && (this.spatialize = e.spatialize), void 0 !== e.autoPlay && (this.autoPlay = e.autoPlay), this._buffer && this._clampInterval()
    }, i.prototype._clampInterval = function() {
        this._offset = Math.min(this._offset, this._buffer.duration), null !== this._duration ? this._duration = Math.min(this._buffer.duration - this._offset, this._duration) : this._duration = this._buffer.duration - this._offset, this._pausePos = u.default.clamp(this._pausePos, 0, this._duration)
    }, i.prototype.connectTo = function(e) {
        if (e) {
            e instanceof Array || (e = [e]);
            for (var t = 0; t < e.length; t++) this._outNode.connect(e[t])
        }
    }, i.prototype.disconnectFrom = function(e) {
        if (e) {
            e instanceof Array || (e = [e]);
            for (var t = 0; t < e.length; t++) this._outNode.disconnect(e[t])
        }
    }, i.prototype.setAudioBuffer = function(e) {
        this.setAudioStream(null), this._buffer = e, this._clampInterval()
    }, i.prototype.setAudioStream = function(e) {
        if (!e) return void(this._streamSource && (this._streamSource.disconnect(), this._streamSource = null));
        this.stop(), this._stream = e, this._streamSource = a.default.getContext().createMediaStreamSource(e), this._streamSource.connect(this._outNode)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(20),
        l = r(u),
        f = n(313),
        c = r(f),
        d = n(12),
        h = r(d),
        p = n(3),
        m = r(p),
        y = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments));
                return e._type = "SpeechComponent", e
            }
            return a(t, e), s(t, [{
                key: "_create",
                value: function() {
                    return new c.default
                }
            }, {
                key: "_remove",
                value: function(e) {
                    var t = e.speechComponent;
                    if (t && t.speeches) {
                        var n = !0,
                            r = !1,
                            i = void 0;
                        try {
                            for (var o, a = t.speeches[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) {
                                o.value.stop()
                            }
                        } catch (e) {
                            r = !0, i = e
                        } finally {
                            try {
                                !n && a.return && a.return()
                            } finally {
                                if (r) throw i
                            }
                        }
                    }
                }
            }, {
                key: "update",
                value: function(e, t, n) {
                    var r = this;
                    return l.default.prototype.update.call(this, e, t, n).then(function(e) {
                        if (e) {
                            e.updateConfig(t), e.speeches.forEach(function(n) {
                                t.speeches[n.id] || e.removeSpeechFile(n)
                            });
                            var i = [];
                            return m.default.forEach(t.speeches, function(e) {
                                i.push(r._load(e.speechRef, n))
                            }, null, "sortValue"), h.default.all(i).then(function(t) {
                                return t.forEach(function(t, n) {
                                    e.speeches.includes(t) || e.addSpeech(t)
                                }), e
                            })
                        }
                    })
                }
            }]), t
        }(l.default);
    l.default._registerClass("speech", y), t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(8),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t() {
                r(this, t);
                var e = i(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments));
                return e.type = "SpeechComponent", e.system = null, e.voice = null, e.volume = null, e.speeches = [], e
            }
            return o(t, e), a(t, [{
                key: "addSpeech",
                value: function(e) {
                    this.speeches.includes(e) || (e.updateConfig({
                        entity: this.entity
                    }), this.speeches.push(e))
                }
            }, {
                key: "removeSpeech",
                value: function(e) {
                    var t = this.speeches.indexOf(e);
                    t > -1 && (e.stop(), this.speeches.splice(t, 1))
                }
            }, {
                key: "getSpeechById",
                value: function(e) {
                    return this.speeches.find(function(t) {
                        return t.id === e
                    })
                }
            }, {
                key: "updateConfig",
                value: function(e) {
                    e.volume && (this.volume = e.volume), e.voice && (this.voice = e.voice)
                }
            }, {
                key: "process",
                value: function() {
                    this.speeches.length > 0 && this.speeches.forEach(function(e) {
                        e.process()
                    })
                }
            }]), t
        }(u.default);
    t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(25),
        f = r(l),
        c = n(315),
        d = r(c),
        h = n(3),
        p = r(h),
        m = function(e) {
            function t() {
                return i(this, t), o(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments))
            }
            return a(t, e), s(t, [{
                key: "_remove",
                value: function(e) {
                    var t = this._objects.get(e);
                    t && (t.stop(), this._objects.delete(e))
                }
            }, {
                key: "_prepare",
                value: function(e) {
                    p.default.defaults(e, {
                        name: "Speech",
                        volume: 1
                    })
                }
            }, {
                key: "_create",
                value: function() {
                    return new d.default
                }
            }, {
                key: "_update",
                value: function(e, n, r) {
                    return u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "_update", this).call(this, e, n, r).then(function(e) {
                        if (e) return e.updateConfig(n), e
                    })
                }
            }]), t
        }(f.default);
    f.default._registerClass("speech", m), t.default = m
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        a = n(212),
        s = r(a),
        u = n(5),
        l = r(u),
        f = n(205),
        c = r(f),
        d = function() {
            function e() {
                var t = this;
                i(this, e), this.body = null, this.id = null, this.name = null, this.type = null, this.voiceId = null, this.volume = 1, this._audio = null, this._playing = !1, this._speechMarks = null, this._sentenceOffset = 0, this._ssmlOffset = -500, this._visemeOffset = -35, this._wordOffset = 0, this._currentSentence = "", this._currentSSML = "", this._currentViseme = "", this._currentWord = "", this._currentSentenceMarkIndex = 0, this._currentSSMLMarkIndex = 0, this._currentVisemeMarkIndex = 0, this._currentWordMarkIndex = 0, l.default.addListener(s.default.SDK_READY, function() {
                    t.polly = new AWS.Polly
                }, !0), this._waitForAudioToEnd = this._waitForAudioToEnd.bind(this)
            }
            return o(e, [{
                key: "updateConfig",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
                    e.entity && (this.entity = e.entity, this.events = Object.assign({}, {
                        entityStartSpeech: l.default.makeChannel("" + (this.entity.id + c.default.START_SPEECH_CHANNEL_SUFFIX)),
                        entityStopSpeech: l.default.makeChannel("" + (this.entity.id + c.default.STOP_SPEECH_CHANNEL_SUFFIX)),
                        entitySentence: l.default.makeChannel(this.entity.id + ".sentenceEvent"),
                        entitySSML: l.default.makeChannel(this.entity.id + ".ssmlEvent"),
                        entityViseme: l.default.makeChannel(this.entity.id + ".visemeEvent"),
                        entityWord: l.default.makeChannel(this.entity.id + ".wordEvent")
                    })), e.id && (this.id = e.id), e.name && (this.name = e.name), e.body && (e.body !== this.body && (this._audio = null), this.body = e.body), e.type && (this.type = e.type), e.volume && (this.volume = e.volume), e.voice && (e.voice !== this.voiceId && (this._audio = null), this.voiceId = e.voice)
                }
            }, {
                key: "_waitForAudioToEnd",
                value: function() {
                    var e = this;
                    return new Promise(function(t, n) {
                        if (e._audio.paused) return t();
                        e._audio.addEventListener("ended", function() {
                            return e._stopAudio(), t()
                        })
                    })
                }
            }, {
                key: "_playAudio",
                value: function() {
                    var e = this;
                    return this._audio && this._audio.paused ? (this._audio.volume = this.volume, this._audio.addEventListener("playing", function() {
                        e.events.entityStartSpeech.emit()
                    }), this._playing = !0, this._emitStartSpeechEvent(), this._audio.play().then(function() {
                        return e._waitForAudioToEnd()
                    })) : this._waitForAudioToEnd()
                }
            }, {
                key: "_processAudioStream",
                value: function(e) {
                    var t = new Uint8Array(e),
                        n = t.buffer,
                        r = new Blob([n], {
                            type: "audio/mpeg"
                        }),
                        i = URL.createObjectURL(r),
                        o = new Audio(i);
                    return o.crossOrigin = "anonymous", o
                }
            }, {
                key: "play",
                value: function() {
                    var e = this;
                    if (this._audio) return this._playAudio();
                    if (!this.polly) throw new Error("AWS SDK is not available!");
                    var t = [this._getAudio(), this._getSpeechMarks()];
                    return Promise.all(t).then(function() {
                        return e._playAudio()
                    })
                }
            }, {
                key: "_getAudio",
                value: function() {
                    var t = this,
                        n = Object.assign({}, e.POLLY_DEFAULTS, {
                            Text: this._getText()
                        });
                    return this.voiceId && (n.VoiceId = this.voiceId), this.polly.synthesizeSpeech(n).promise().then(function(e) {
                        t._audio = t._processAudioStream(e.AudioStream)
                    }).catch(function(e) {
                        throw e
                    })
                }
            }, {
                key: "_getText",
                value: function() {
                    return this.body.indexOf("<speak>") > -1 ? this.body : "<speak>" + this.body + "</speak>"
                }
            }, {
                key: "_stopAudio",
                value: function() {
                    var e = !(arguments.length > 0 && void 0 !== arguments[0]) || arguments[0];
                    this._playing = !1, e && (this._audio.currentTime = 0, this._audio.volume = this.volume, this._currentSentenceMarkIndex = 0, this._currentSSMLMarkIndex = 0, this._currentVisemeMarkIndex = 0, this._currentWordMarkIndex = 0, this._currentSentence = "", this._currentSSML = "", this._currentViseme = "", this._currentWord = ""), this._emitStopSpeechEvent(), this.events.entityStopSpeech.emit()
                }
            }, {
                key: "_getSpeechMarks",
                value: function() {
                    var t = this,
                        n = Object.assign({}, e.POLLY_SPEECH_MARKS_DEFAULTS, {
                            Text: this._getText()
                        });
                    return this.voiceId && (n.VoiceId = this.voiceId), this.polly.synthesizeSpeech(n).promise().then(function(e) {
                        var n = JSON.stringify(e.AudioStream),
                            r = JSON.parse(n);
                        t._speechMarks = t._parseSpeechMarks(r.data)
                    }).catch(function(e) {
                        throw e
                    })
                }
            }, {
                key: "_parseSpeechMarks",
                value: function(e) {
                    var t = "",
                        n = {
                            sentence: [],
                            ssml: [],
                            viseme: [],
                            word: []
                        },
                        r = !0,
                        i = !1,
                        o = void 0;
                    try {
                        for (var a, s = e[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                            var u = a.value,
                                l = String.fromCharCode(u),
                                f = void 0;
                            if (t += l, "}" === l) {
                                f = JSON.parse(t), t = "";
                                var c = f.type;
                                switch (c) {
                                    case "sentence":
                                    case "ssml":
                                    case "viseme":
                                    case "word":
                                        n[c].length > 0 && this._addDurationToSpeechmark(n[c][n[c].length - 1], f), n[c].push(f)
                                }
                            }
                        }
                    } catch (e) {
                        i = !0, o = e
                    } finally {
                        try {
                            !r && s.return && s.return()
                        } finally {
                            if (i) throw o
                        }
                    }
                    return n
                }
            }, {
                key: "_addDurationToSpeechmark",
                value: function(e, t) {
                    e.duration = t.time - e.time, e.nextMark = t.value
                }
            }, {
                key: "stop",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
                    return this._audio && this._playing && (this._audio.pause(), this._stopAudio(e)), Promise.resolve()
                }
            }, {
                key: "setVolume",
                value: function(e) {
                    return this._audio && (this._audio.volume = e), Promise.resolve()
                }
            }, {
                key: "process",
                value: function() {
                    if (this._speechMarks)
                        if (this._playing) {
                            var e = this._speechMarks.sentence[this._currentSentenceMarkIndex],
                                t = this._speechMarks.ssml[this._currentSSMLMarkIndex],
                                n = this._speechMarks.viseme[this._currentVisemeMarkIndex],
                                r = this._speechMarks.word[this._currentWordMarkIndex];
                            if (this._currentVisemeMarkIndex >= this._speechMarks.viseme.length) this._switchViseme("sil"), this._emitStopSpeechEvent();
                            else {
                                var i = 1e3 * this._audio.currentTime - this._sentenceOffset,
                                    o = 1e3 * this._audio.currentTime - this._ssmlOffset,
                                    a = 1e3 * this._audio.currentTime - this._visemeOffset,
                                    s = 1e3 * this._audio.currentTime - this._wordOffset;
                                this._currentSentenceMarkIndex < this._speechMarks.sentence.length && i > e.time && (this._switchSentence(e.value.trim()), this._currentSentenceMarkIndex++), this._currentSSMLMarkIndex < this._speechMarks.ssml.length && o > t.time && (this._switchSSML(t.value.trim()), this._currentSSMLMarkIndex++), a > n.time && (this._switchViseme(n.value.trim()), this._currentVisemeMarkIndex++), this._currentWordMarkIndex < this._speechMarks.word.length && s > r.time && (this._switchWord(r.value.trim()), this._currentWordMarkIndex++)
                            }
                        } else "sil" !== this._currentViseme && this._switchViseme("sil")
                }
            }, {
                key: "_emitData",
                value: function(e, t) {
                    switch (e) {
                        case "sentence":
                            this.events.entitySentence.emit(t);
                            break;
                        case "ssml":
                            this.events.entitySSML.emit(t);
                            break;
                        case "viseme":
                            this.events.entityViseme.emit(t);
                            break;
                        case "word":
                            this.events.entityWord.emit(t)
                    }
                }
            }, {
                key: "_emitStartSpeechEvent",
                value: function() {
                    e.globalEvents.startSpeech.emit()
                }
            }, {
                key: "_emitStopSpeechEvent",
                value: function() {
                    e.globalEvents.stopSpeech.emit()
                }
            }, {
                key: "_switchSentence",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "";
                    this._currentSentence = e, this._emitData("sentence", this._currentSentence)
                }
            }, {
                key: "_switchSSML",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "";
                    this._currentSSML = e, this._emitData("ssml", this._currentSSML)
                }
            }, {
                key: "_switchViseme",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "";
                    this._currentViseme = e, this._emitData("viseme", this._currentViseme)
                }
            }, {
                key: "_switchWord",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "";
                    this._currentWord = e, this._emitData("word", this._currentWord)
                }
            }]), e
        }();
    d.POLLY_DEFAULTS = {
        LexiconNames: [],
        OutputFormat: "mp3",
        SampleRate: "22050",
        Text: "",
        TextType: "ssml",
        VoiceId: "Amy"
    }, d.POLLY_SPEECH_MARKS_DEFAULTS = {
        LexiconNames: [],
        OutputFormat: "json",
        SampleRate: "22050",
        SpeechMarkTypes: ["sentence", "ssml", "viseme", "word"],
        Text: "",
        TextType: "ssml",
        VoiceId: "Amy"
    }, d.globalEvents = {
        startSpeech: l.default.makeChannel("startSpeechEvent"),
        stopSpeech: l.default.makeChannel("stopSpeechEvent")
    }, t.default = d
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.velocity = 10, this.height = 25, this.material = new a.default(u.default.particles);
        var t = d.default.createFlareTexture(64);
        t.generateMipmaps = !0, this.material.setTexture("DIFFUSE_MAP", t), this.material.blendState.blending = "AdditiveBlending", this.material.cullState.enabled = !1, this.material.depthState.write = !1, this.material.renderQueue = 2002;
        var n = this;
        this.particleCloudEntity = d.default.createParticleSystemEntity(e.world, f.default.getSnow({
            getEmissionPoint: function(e) {
                e.copy(p.default.mainCamera ? p.default.mainCamera.translation : new y.default), e.x += 1e3 * Math.random() - 500, e.y += n.height, e.z += 1e3 * Math.random() - 500
            },
            getEmissionVelocity: function(e) {
                e.x = 2 * (Math.random() - .5), e.y = -(Math.random() + 1) * n.velocity, e.z = 2 * (Math.random() - .5)
            }
        }), this.material), this.particleCloudEntity.name = "_ParticleSystemSnow", this.onCameraChange = function(e) {
            e.entity.attachChild(this.particleCloudEntity)
        }.bind(this), this.particleCloudEntity.transformComponent.transform.translation.copy(p.default.mainCamera ? p.default.mainCamera.translation : new y.default), this.particleCloudEntity.addToWorld()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(9),
        a = r(o),
        s = n(15),
        u = r(s),
        l = n(157),
        f = r(l),
        c = n(112),
        d = r(c),
        h = n(24),
        p = r(h),
        m = n(0),
        y = r(m);
    i.prototype.setEmissionVelocity = function(e) {
        if (e) {
            this.velocity = e;
            for (var t = this.particleCloudEntity.particleComponent, n = t.particles, r = 0; r < n.length; r += 1) n[r].velocity.y = -(Math.random() + 1) * this.velocity
        }
    }, i.prototype.setEmissionHeight = function(e) {
        e && (this.height = e)
    }, i.prototype.setReleaseRatePerSecond = function(e) {
        if (e) {
            this.particleCloudEntity.particleComponent.emitters[0].releaseRatePerSecond = e
        }
    }, i.prototype.remove = function() {
        this.particleCloudEntity.removeFromWorld()
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(318),
        c = r(f),
        d = n(215),
        h = r(d),
        p = n(6),
        m = r(p),
        y = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                if (n.type = "ParticleComponent", e = e || {}, n.emitters = [], e.emitters)
                    for (var r = 0, a = e.emitters.length; r < a; r++) n.emitters.push(new h.default(e.emitters[r]));
                n.timeline = e.timeline ? e.timeline : [], n.uRange = isNaN(e.uRange) ? 1 : e.uRange, n.vRange = isNaN(e.vRange) ? 1 : e.vRange;
                var s = isNaN(e.particleCount) ? 100 : e.particleCount;
                return n.recreateParticles(s), n.enabled = !0, Object.seal(n), n
            }
            return a(t, e), s(t, [{
                key: "generateMeshData",
                value: function() {
                    var e = m.default.defaultMap([m.default.POSITION, m.default.COLOR, m.default.TEXCOORD0]);
                    this.meshData = new m.default(e, 4 * this.particleCount, 6 * this.particleCount), this.meshData.vertexData.setDataUsage("DynamicDraw");
                    for (var t = this.meshData.getAttributeBuffer(m.default.TEXCOORD0), n = this.meshData.getIndexBuffer(), r = 0, i = this.particleCount; r < i; r++) t.set([1, 0], 8 * r + 0), t.set([1, 1], 8 * r + 2), t.set([0, 1], 8 * r + 4), t.set([0, 0], 8 * r + 6), n.set([4 * r + 0, 4 * r + 3, 4 * r + 1, 4 * r + 1, 4 * r + 3, 4 * r + 2], 6 * r)
                }
            }, {
                key: "recreateParticles",
                value: function(e) {
                    this.particleCount = e, this.particles = [];
                    for (var t = 0; t < this.particleCount; t++) this.particles[t] = new c.default(this, t);
                    this.generateMeshData()
                }
            }]), t
        }(l.default);
    y.type = "ParticleComponent", t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.alive = !1, this.position = new u.default, this.velocity = new u.default, this.lifeSpan = 0, this.parent = e, this.age = 0, this.index = t, this.color = new f.default(1, 0, 0, 1), this.size = 0, this.spin = 0, this.mass = 1, this.emitter = null, this.uvIndex = 0, this.lastUVIndex = -1, this.bbX = new u.default, this.bbY = new u.default, this.lastColor = new f.default
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(214),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(36),
        f = r(l),
        c = n(6),
        d = r(c),
        h = new u.default;
    i.prototype.respawnParticle = function(e) {
        this.emitter = e, this.lifeSpan = e.nextParticleLifeSpan(), this.alive = !0, this.age = 0
    };
    var p = [];
    i.prototype.update = function(e, t) {
        if (this.alive) {
            if (this.age += e, this.age > this.lifeSpan) return void this.kill();
            if (this.position.addDirect(this.velocity.x * e, this.velocity.y * e, this.velocity.z * e), a.default.applyTimeline(this, this.emitter && this.emitter.timeline ? this.emitter.timeline : this.parent.timeline), !this.lastColor.equals(this.color)) {
                var n = this.parent.meshData.getAttributeBuffer(d.default.COLOR),
                    r = 16 * this.index;
                n[r + 0 + 0] = this.color.r, n[r + 0 + 1] = this.color.g, n[r + 0 + 2] = this.color.b, n[r + 0 + 3] = this.color.a, n[r + 4 + 0] = this.color.r, n[r + 4 + 1] = this.color.g, n[r + 4 + 2] = this.color.b, n[r + 4 + 3] = this.color.a, n[r + 8 + 0] = this.color.r, n[r + 8 + 1] = this.color.g, n[r + 8 + 2] = this.color.b, n[r + 8 + 3] = this.color.a, n[r + 12 + 0] = this.color.r, n[r + 12 + 1] = this.color.g, n[r + 12 + 2] = this.color.b, n[r + 12 + 3] = this.color.a, this.lastColor.set(this.color)
            }
            if (this.emitter && this.emitter.getParticleBillboardVectors(this, t), 0 === this.spin) this.bbX.scale(this.size), this.bbY.scale(this.size);
            else {
                var i = Math.cos(this.spin) * this.size,
                    o = Math.sin(this.spin) * this.size,
                    s = this.bbY.x,
                    u = this.bbY.y,
                    l = this.bbY.z;
                this.bbY.set(this.bbX), this.bbX.scale(i).addDirect(s * o, u * o, l * o), this.bbY.scale(-o).addDirect(s * i, u * i, l * i)
            }
            var f = this.parent.meshData.getAttributeBuffer(d.default.POSITION),
                c = 12 * this.index;
            if (h.set(this.position).sub(this.bbX).sub(this.bbY), f[c + 0 + 0] = h.x, f[c + 0 + 1] = h.y, f[c + 0 + 2] = h.z, h.set(this.position).sub(this.bbX).add(this.bbY), f[c + 3 + 0] = h.x, f[c + 3 + 1] = h.y, f[c + 3 + 2] = h.z, h.set(this.position).add(this.bbX).add(this.bbY), f[c + 6 + 0] = h.x, f[c + 6 + 1] = h.y, f[c + 6 + 2] = h.z, h.set(this.position).add(this.bbX).sub(this.bbY), f[c + 9 + 0] = h.x, f[c + 9 + 1] = h.y, f[c + 9 + 2] = h.z, this.lastUVIndex !== this.uvIndex) {
                var m = this.parent.meshData.getAttributeBuffer(d.default.TEXCOORD0),
                    y = this.uvIndex % this.parent.uRange / this.parent.uRange,
                    v = 1 - Math.floor(this.uvIndex / this.parent.vRange) / this.parent.vRange,
                    _ = 1 / this.parent.uRange,
                    g = 1 / this.parent.vRange;
                //! AT: why go through this array?! there's only 2 values; what's the point?
                p[0] = y + _, p[1] = v - g, m.set(p, 8 * this.index + 0), p[0] = y + _, p[1] = v, m.set(p, 8 * this.index + 2), p[0] = y, p[1] = v, m.set(p, 8 * this.index + 4), p[0] = y, p[1] = v - g, m.set(p, 8 * this.index + 6), this.lastUVIndex = this.uvIndex
            }
        }
    }, i.prototype.kill = function() {
        this.alive = !1;
        var e = this.parent.meshData.getAttributeBuffer(d.default.POSITION),
            t = e.subarray(12 * this.index, 12 * this.index + 3);
        e.set(t, 12 * this.index + 3), e.set(t, 12 * this.index + 6), e.set(t, 12 * this.index + 9)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        s.default.apply(this, arguments), this._activeSkyboxRef = null;
        var e = new m.default("box", [], null, 0);
        this._skybox = this.world.createEntity(e.meshData, e.materials[0], e.transform), this._skybox.transformComponent.sync(), this._skybox.isSkybox = !0, this._skybox.name = "Skybox_box", this._skyboxTexture = new c.default(null, {
            flipY: !1
        }), this._skyboxTexture.variant = "CUBE", this._skyboxTexture.wrapS = "EdgeClamp", this._skyboxTexture.wrapT = "EdgeClamp", this._skybox.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP", this._skyboxTexture);
        var t = new m.default("sphere", [], null, 0);
        this._skysphere = this.world.createEntity(t.meshData, t.materials[0], t.transform), this._skysphere.transformComponent.sync(), this._skysphere.isSkybox = !0, this._skysphere.name = "Skybox_sphere", this._skysphereTexture = new c.default(null, {
            flipY: !1,
            wrapS: "EdgeClamp",
            wrapT: "EdgeClamp"
        }), this._skysphere.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP", this._skysphereTexture), this._activeSkyshape = null
    }
    //! AT: this can definitely be moved elsewhere
    function o(e, t) {
        var n = e.length;
        if (n !== t.length) return !1;
        for (; n--;)
            if (e[n] !== t[n]) return !1;
        return !0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(25),
        s = r(a),
        u = n(213),
        l = r(u),
        f = n(45),
        c = r(f),
        d = n(67),
        h = r(d),
        p = n(216),
        m = r(p),
        y = n(12),
        v = r(y),
        _ = n(17),
        g = r(_),
        b = n(5),
        x = r(b);
    i.prototype = Object.create(s.default.prototype), i.prototype.constructor = i, s.default._registerClass("skybox", i), i.prototype._remove = function(e) {
        this._objects.delete(e), this._activeSkyboxRef === e && (this._hide(this._skybox), this._hide(this._skysphere), this._skyboxTexture.setImage(null), this._activeSkyshape = null, h.default.SKYBOX = null, h.default.SKYSPHERE = null, this._activeSkyboxRef = null)
    }, i.prototype._create = function() {
        return {
            textures: [],
            enabled: !1
        }
    }, i.prototype._update = function(e, t, n) {
        var r = this;
        return s.default.prototype._update.call(this, e, t, n).then(function(i) {
            if (!i) return g.default.resolve([]);
            var o = [];
            return t.box && o.push(r._updateBox(e, t.box, n, i)), t.sphere && o.push(r._updateSphere(e, t.sphere, n, i)), v.default.all(o).then(function(n) {
                return (t.box || t.sphere) && (r._activeSkyboxRef = e), n
            })
        })
    }, i.prototype._updateSphere = function(e, t, n, r) {
        var i = this;
        return t.sphereRef ? this._load(t.sphereRef, n).then(function(n) {
            if (!n || !n.image) return x.default.emit("sumerian.error.skybox", {
                type: "Sphere",
                message: "The skysphere needs an image to display."
            }), void i._hide(i._skysphere);
            if (n === r.textures[0] && i._activeSkyshape === i._skysphere) return i._skysphere;
            if (e === l.default.currentSkyboxRef && t.enabled) {
                var o = i._skysphereTexture;
                r.textures = [n], o.setImage(n.image), i._show(i._skysphere)
            } else t.enabled || i._hide(i._skysphere);
            return i._skysphere
        }) : (i._skysphereTexture.setImage(null), i._hide(i._skysphere), g.default.resolve(i._skysphere))
    };
    var w = ["rightRef", "leftRef", "topRef", "bottomRef", "frontRef", "backRef"];
    i.prototype._updateBox = function(e, t, n, r) {
        var i = this,
            a = w.map(function(e) {
                return t[e] ? i._load(t[e], n) : g.default.resolve()
            });
        return v.default.all(a).then(function(n) {
            if (o(n, r.textures) && i._activeSkyshape === i._skybox) return i._skybox;
            var a = n.map(function(e) {
                return e ? e.image : null
            });
            if (0 === a.filter(Boolean).length) return i._skyboxTexture.setImage(null), i._hide(i._skybox), i._skybox;
            for (var s = 1, u = 1, f = 0; f < a.length; f++) a[f] && (s = Math.max(s, a[f].width), u = Math.max(u, a[f].width));
            if (e === l.default.currentSkyboxRef && t.enabled) {
                r.textures = n;
                var c = i._skyboxTexture;
                c.setImage(a), c.image.width = s, c.image.height = u, c.image.dataReady = !0, c.setNeedsUpdate(), i._show(i._skybox)
            } else t.enabled || i._hide(i._skybox);
            return i._skybox
        })
    }, i.prototype._hide = function(e) {
        this.world.getSystem("RenderSystem").removed(e), e === this._skybox ? h.default.SKYBOX = null : e === this._skysphere && (h.default.SKYSPHERE = null)
    }, i.prototype._show = function(e) {
        var t = this.world.getSystem("RenderSystem");
        this._activeSkyshape && t.removed(this._activeSkyshape), t.added(e), this._activeSkyshape = e, h.default.SKYBOX = e === this._skybox ? this._skyboxTexture : null, h.default.SKYSPHERE = e === this._skysphere ? this._skysphereTexture : null
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        s.default.apply(this, arguments), this._type = "HtmlComponent"
    }

    function o(e) {
        return "__" + e.replace(p, "-")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(20),
        s = r(a),
        u = n(321),
        l = r(u),
        f = n(12),
        c = r(f),
        d = n(17),
        h = r(d);
    i.prototype = Object.create(s.default.prototype), s.default._registerClass("html", i), i.prototype.constructor = i, i.prototype._prepare = function() {}, i.prototype._create = function() {
        return new l.default
    };
    var p = /\W/g;
    i.prototype.update = function(e, t, n) {
        var r = this;
        return s.default.prototype.update.call(this, e, t, n).then(function(i) {
            if (i) {
                var o = i.domElement;
                return o || (o = i.domElement = r._createDomElement(e, i), r._attachDomElement(o, e)), i.useTransformComponent = !1 !== t.useTransformComponent, i.pixelPerfect = void 0 === t.pixelPerfect || t.pixelPerfect, r._updateHtml(o, e, t, n).then(function() {
                    return r._updateAttributes(o, e, t), i
                })
            }
        })
    }, i.prototype._createDomElement = function(e) {
        var t = document.createElement("div");
        return t.id = o(e.id), t.className = "sumerian-entity", this._addMouseListeners(t, e), this._addTouchListeners(t, e), t
    }, i.prototype._addMouseListeners = function(e, t) {
        var n = function(e) {
            var n = t._world.sumerianRunner,
                r = {
                    entity: t,
                    depth: 0,
                    x: e.pageX,
                    y: e.pageY,
                    domEvent: e,
                    id: t.id,
                    type: e.type
                };
            n.triggerEvent(e.type, r)
        };
        e.addEventListener("mousedown", n), e.addEventListener("mouseup", n), e.addEventListener("click", n)
    }, i.prototype._addTouchListeners = function(e, t) {
        var n = function(e) {
            var n = t._world.sumerianRunner,
                r = n.renderer.domElement,
                i = e.changedTouches[0].pageX - r.getBoundingClientRect().left,
                o = e.changedTouches[0].pageY - r.getBoundingClientRect().top,
                a = {
                    entity: t,
                    depth: 0,
                    x: i,
                    y: o,
                    domEvent: e,
                    id: t.id,
                    type: e.type
                };
            n.triggerEvent(e.type, a)
        };
        e.addEventListener("touchstart", n), e.addEventListener("touchmove", n), e.addEventListener("touchend", n)
    }, i.prototype._attachDomElement = function(e, t) {
        (t._world.sumerianRunner.renderer.domElement.parentElement || document.body).appendChild(e)
    }, i.prototype._updateHtml = function(e, t, n, r) {
        return n.innerHtml === e.prevInnerHtml ? h.default.resolve() : (e.prevInnerHtml = n.innerHtml, e.innerHTML = n.innerHtml, this._loadImages(e, r))
    }, i.prototype._loadImages = function(e, t) {
        function n(e) {
            var n = e.getAttribute("data-id");
            return n ? r.loadObject(n, t).then(function(t) {
                return e.src = t.src, e
            }, function(t) {
                return console.error(t), delete e.src, e
            }) : h.default.resolve()
        }
        var r = this,
            i = [].slice.apply(e.getElementsByTagName("IMG"));
        return c.default.all(i.map(n))
    }, i.prototype._updateAttributes = function(e, t, n) {
        var r = void 0,
            i = void 0,
            o = void 0,
            a = e.prevAttributes || {},
            s = Object.keys(a),
            u = n.attributes || {},
            l = Object.keys(u);
        for (r = 0; r < s.length; ++r) i = s[r], void 0 === u[i] && e.removeAttribute(s[r]);
        for (r = 0; r < l.length; ++r) i = l[r], (o = u[i]) !== a[i] && e.setAttribute(i, o);
        if (e.prevAttributes = n.attributes, !u.style) {
            var f = "position: absolute; z-index: 1;";
            !0 !== n.useTransformComponent && (f += " top: 0; left: 0; display: block;"), e.setAttribute("style", f)
        }
        t._world.getSystem("HtmlSystem").clearStyleCache(e)
    }, i.prototype._remove = function(e) {
        var t = e.htmlComponent;
        s.default.prototype._remove.call(this, e), t.domElement && t.domElement.parentNode.removeChild(t.domElement)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(8),
        s = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(a),
        u = function(e) {
            function t(e, n) {
                r(this, t);
                var o = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n = n || {}, o.type = "HtmlComponent", o.domElement = e, o.hidden = void 0 !== n.hidden && n.hidden, o.useTransformComponent = void 0 === n.useTransformComponent || n.useTransformComponent, o.pixelPerfect = void 0 === n.pixelPerfect || n.pixelPerfect, Object.seal(o), o
            }
            return o(t, e), t
        }(s.default);
    u.type = "HtmlComponent", t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this._type = "GlslShader"
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(25),
        a = r(o),
        s = n(17),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), a.default._registerClass("glsl", i), i.prototype.constructor = i, i.prototype._update = function(e, t) {
        if (!t) return this._remove(e), u.default.resolve();
        var n = {};
        try {
            n = eval.call(null, "({" + t + "})")
        } catch (e) {
            n = {}
        }
        return u.default.resolve(n)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(20),
        l = r(u),
        f = n(324),
        c = r(f),
        d = n(12),
        h = (r(d), n(3)),
        p = (r(h), function(e) {
            function t(e, n, r, a) {
                i(this, t);
                var s = o(this, (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments));
                return s._type = "VRControllerComponent", s
            }
            return a(t, e), s(t, [{
                key: "_create",
                value: function() {
                    return new c.default
                }
            }, {
                key: "update",
                value: function(e, t, n) {
                    return l.default.prototype.update.call(this, e, t, n).then(function(e) {
                        if (e) return e._id = t.id, e
                    })
                }
            }]), t
        }(l.default));
    l.default._registerClass("vrcontroller", p), t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(0),
        c = r(f),
        d = n(38),
        h = (r(d), n(66)),
        p = (r(h), n(4)),
        m = (r(p), n(34)),
        y = r(m),
        v = n(5),
        _ = (r(v), n(158)),
        g = (r(_), n(222)),
        b = (r(g), function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e.type = "VRControllerComponent", e._id = null, e._controller = null, e
            }
            return a(t, e), s(t, [{
                key: "update",
                value: function(e, t) {
                    var n = null,
                        r = null;
                    this._controller = null, "Vive Controller (Left)" === this._id ? (n = "OpenVR Gamepad", r = "left") : "Vive Controller (Right)" === this._id ? (n = "OpenVR Gamepad", r = "right") : "Oculus Touch (Left)" === this._id ? (n = this._id, r = "left") : "Oculus Touch (Right)" === this._id ? (n = this._id, r = "right") : "Daydream Controller" === this._id && (n = this._id);
                    var i = e.find(function(e) {
                        return r ? e.id === n && e.hand === r : e.id === n
                    });
                    if (this.entity.transformComponent.parent) {
                        var o = this.entity.transformComponent.parent.parent;
                        i && o && o.entity.id === t.id && (this._controller = i)
                    }
                }
            }, {
                key: "updatePose",
                value: function() {
                    if (this._controller) {
                        this.entity._hidden && this.entity.show();
                        var e = this._controller.pose.position,
                            t = this._controller.pose.orientation;
                        if (e && this.entity.transformComponent.setTranslation(new c.default(e)), t) {
                            var n = new y.default(t);
                            this.entity.transformComponent.setRotationMatrix(n.toRotationMatrix())
                        }
                        this.entity.transformComponent.sync()
                    } else this.entity._hidden || this.entity.hide()
                }
            }, {
                key: "id",
                get: function() {
                    return this._id
                }
            }]), t
        }(l.default));
    t.default = b
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        return P[e]
    }

    function o() {
        return P
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(126),
        s = r(a),
        u = n(217),
        l = r(u),
        f = n(218),
        c = r(f),
        d = n(326),
        h = r(d),
        p = n(327),
        m = r(p),
        y = n(219),
        v = r(y),
        _ = n(221),
        g = r(_),
        b = n(220),
        x = r(b),
        w = n(328),
        E = r(w),
        S = n(329),
        M = r(S),
        C = n(330),
        T = r(C),
        R = n(331),
        A = r(R),
        O = {
            OrbitCamControlScript: l.default,
            OrbitNPanControlScript: c.default,
            FlyControlScript: h.default,
            AxisAlignedCamControlScript: m.default,
            PanCamScript: v.default,
            MouseLookControlScript: g.default,
            WasdControlScript: x.default,
            ButtonScript: E.default,
            PickAndRotateScript: M.default,
            LensFlareScript: T.default,
            HMDControlScript: A.default
        },
        P = {},
        D = Object.keys(O),
        I = !0,
        k = !1,
        N = void 0;
    try {
        for (var L, B = D[Symbol.iterator](); !(I = (L = B.next()).done); I = !0) {
            var F = L.value;
            ! function(e) {
                var t = e.externals.key || e.externals.name;
                if (P[t]) return void console.warn("Script already registered for key " + t);
                s.default.fillParameterSpecDefaults(e.externals.parameters), P[t] = e, e.externals.name || (e.externals.name = t)
            }(O[F])
        }
    } catch (e) {
        k = !0, N = e
    } finally {
        try {
            !I && B.return && B.return()
        } finally {
            if (k) throw N
        }
    }
    t.default = {
        getScript: i,
        getAllScripts: o
    }
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e(e, t) {
            i.setup(e, t), r.setup(e, t)
        }

        function t(e, t) {
            i.update(e, t), r.update(e, t)
        }

        function n(e, t) {
            i.cleanup(e, t), r.cleanup(e, t)
        }
        var r = a.default.create(u.default),
            i = a.default.create(f.default);
        return {
            setup: e,
            cleanup: n,
            update: t
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(125),
        a = r(o),
        s = n(220),
        u = r(s),
        l = n(221),
        f = r(l),
        c = u.default.externals.parameters,
        d = f.default.externals.parameters,
        h = c.concat(d.slice(1));
    i.externals = {
        key: "FlyControlScript",
        name: "Fly Control",
        description: "This is a combo of the Wasd script and the MouseLook script",
        parameters: h
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        function e(e, t, n) {
            if (t.currentView !== n) {
                switch (t.currentView = n, n) {
                    case "XY":
                        t.axis.set(a.default.UNIT_Z), t.upAxis.set(a.default.UNIT_Y);
                        break;
                    case "ZY":
                        t.axis.set(a.default.UNIT_X), t.upAxis.set(a.default.UNIT_Y)
                }
                t.axisAlignedDirty = !0
            }
        }

        function t(t, n) {
            n.axis = a.default.UNIT_Z.clone(), n.upAxis = a.default.UNIT_Y.clone(), e(t, n, t.view), n.currentView = t.view, n.lookAtPoint = new a.default, n.distance = t.distance, n.smoothness = Math.pow(u.default.clamp(t.smoothness, 0, 1), .3), n.axisAlignedDirty = !0
        }

        function n(e, t) {
            if (e.view !== t.currentView && (t.axisAlignedDirty = !0), t.axisAlignedDirty) {
                var n = t.entity,
                    r = n.transformComponent.transform;
                r.translation.set(t.axis).scale(t.distance).add(t.lookAtPoint), r.lookAt(t.lookAtPoint, t.upAxis), n.transformComponent.setUpdated(), t.axisAlignedDirty = !1
            }
        }

        function r() {}
        return {
            setup: t,
            update: n,
            cleanup: r
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(4),
        u = r(s);
    i.externals = {
        key: "AxisAlignedCamControlScript",
        name: "Axis-aligned Camera Control",
        description: "Aligns a camera along an axis, and enables switching between them.",
        parameters: [{
            key: "whenUsed",
            name: "When Camera Used",
            description: "Script only runs when the camera to which it is added is being used.",
            default: !0,
            type: "boolean"
        }, {
            key: "distance",
            name: "Distance",
            type: "float",
            description: "Camera distance from lookat point",
            control: "slider",
            default: 1,
            min: 1,
            max: 1e3
        }, {
            key: "view",
            type: "string",
            default: "XY",
            control: "select",
            options: ["XY", "ZY"]
        }]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {
        function e(e, t, n) {
            var r = t.domElement.getBoundingClientRect();
            t.mouseState.x = n.pageX - r.left, t.mouseState.y = n.pageY - r.top
        }

        function t(e) {
            var t = e.button;
            return 0 === t && (e.altKey ? t = 2 : e.shiftKey && (t = 1)), t
        }

        function n(e, t, n) {
            var r = t.entity._world.sumerianRunner,
                i = r.pickSync(t.mouseState.x, t.mouseState.y, t.skipUpdateBuffer);
            t.skipUpdateBuffer || o.default.emit("ButtonScript.renderToPick");
            var a = r.world.entityManager.getEntityByIndex(i.id);
            t.mouseState.downOnEntity = !1, a === t.entity && (o.default.emit(e.channel + "." + n, {
                type: n,
                entity: a
            }), "mousedown" !== n && "touchstart" !== n || (t.mouseState.downOnEntity = !0), !e.linkUrl || "click" !== n && "touchend" !== n || window.open(e.linkUrl, e.linkTarget)), "mousemove" !== n || t.mouseState.overEntity || a !== t.entity || o.default.emit(e.channel + ".mouseover", {
                type: "mouseover",
                entity: a
            }), "mousemove" === n && t.mouseState.overEntity && a !== t.entity && o.default.emit(e.channel + ".mouseout", {
                type: "mouseout",
                entity: a
            }), t.mouseState.overEntity = a === t.entity
        }

        function r(r, i) {
            i.button = ["Any", "Left", "Middle", "Right"].indexOf(r.button) - 1, i.button < -1 && (i.button = -1), i.renderToPickHandler = function() {
                i.skipUpdateBuffer = !0
            }, o.default.addListener("ButtonScript.renderToPick", i.renderToPickHandler, !1), i.mouseState = {
                x: 0,
                y: 0,
                down: !1,
                downOnEntity: !1,
                overEntity: !1
            }, i.listeners = {
                mousedown: function(o) {
                    if (r.whenUsed) {
                        t(o) !== i.button && -1 !== i.button || (i.mouseState.down = !0, e(r, i, o), n(r, i, "mousedown"))
                    }
                },
                mouseup: function(o) {
                    if (r.whenUsed) {
                        t(o) !== i.button && -1 !== i.button || (i.mouseState.down = !1, e(r, i, o), i.mouseState.downOnEntity && n(r, i, "click"), n(r, i, "mouseup"))
                    }
                },
                dblclick: function(o) {
                    if (r.whenUsed) {
                        t(o) !== i.button && -1 !== i.button || (i.mouseState.down = !1, e(r, i, o), n(r, i, "dblclick"))
                    }
                },
                mousemove: function(t) {
                    r.whenUsed && r.enableOnMouseMove && (i.mouseState.down = !1, e(r, i, t), n(r, i, "mousemove"))
                },
                touchstart: function(e) {
                    if (r.whenUsed) {
                        i.mouseState.down = !0;
                        var t = e.targetTouches,
                            o = i.domElement.getBoundingClientRect();
                        i.mouseState.x = t[0].pageX - o.left, i.mouseState.y = t[0].pageY - o.top, n(r, i, "touchstart")
                    }
                },
                touchend: function(e) {
                    r.whenUsed && (e.preventDefault(), e.stopPropagation(), i.mouseState.down = !1, n(r, i, "touchend"))
                }
            };
            var a = Object.keys(i.listeners),
                s = !0,
                u = !1,
                l = void 0;
            try {
                for (var f, c = a[Symbol.iterator](); !(s = (f = c.next()).done); s = !0) {
                    var d = f.value;
                    i.domElement.addEventListener(d, i.listeners[d])
                }
            } catch (e) {
                u = !0, l = e
            } finally {
                try {
                    !s && c.return && c.return()
                } finally {
                    if (u) throw l
                }
            }
        }

        function i(e, t) {
            t.skipUpdateBuffer = !1
        }

        function a(e, t) {
            var n = Object.keys(t.listeners),
                r = !0,
                i = !1,
                a = void 0;
            try {
                for (var s, u = n[Symbol.iterator](); !(r = (s = u.next()).done); r = !0) {
                    var l = s.value;
                    t.domElement.removeEventListener(l, t.listeners[l])
                }
            } catch (e) {
                i = !0, a = e
            } finally {
                try {
                    !r && u.return && u.return()
                } finally {
                    if (i) throw a
                }
            }
            o.default.removeListener("ButtonScript.renderToPick", t.renderToPickHandler)
        }
        return {
            setup: r,
            update: i,
            cleanup: a
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(5),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.externals = {
        key: "ButtonScript",
        name: "Button",
        description: "Enables an entity to be interacted with using click or touch.",
        parameters: [{
            key: "whenUsed",
            type: "boolean",
            default: !0
        }, {
            key: "button",
            name: "button",
            description: "Only interact with this mouse button.",
            type: "string",
            control: "select",
            default: "Any",
            options: ["Any", "Left", "Middle", "Right"]
        }, {
            key: "linkUrl",
            name: "linkUrl",
            description: "URL to open when clicking the entity. Leave this field empty to disable.",
            type: "string",
            default: ""
        }, {
            key: "linkTarget",
            name: "linkTarget",
            description: "The window to open the link in.",
            type: "string",
            default: "_blank"
        }, {
            key: "channel",
            name: "channel",
            description: "Event channel to emit to. Will emit channel.click, .mousedown, .mouseup, .mouseover, .mouseout, .dblclick, .touchstart, .touchend",
            type: "string",
            default: "button"
        }, {
            key: "enableOnMouseMove",
            name: "enableOnMouseMove",
            description: "Enables .mousemove, .mouseover, and .mouseout events. For larger scenes, this might be worth turning off, for better performance.",
            type: "boolean",
            default: !0
        }]
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r() {
        function e(e) {
            var t = e.button;
            return 0 === t && (e.altKey ? t = 2 : e.shiftKey && (t = 1)), t
        }

        function t(e) {
            p.x = e.x, p.y = e.y, p.oldX = p.x, p.oldY = p.y, p.down = !0
        }

        function n(n) {
            if (!d.disable) {
                e(n.domEvent) !== h.dragButton && -1 !== h.dragButton || !n.entity || (c = !1, n.entity.traverseUp(function(e) {
                    if (e === h.entity) return c = !0, !1
                }), c && t(n))
            }
        }

        function r() {
            h.entity.transformComponent.transform.rotation.setIdentity(), h.entity.transformComponent.transform.rotation.rotateX(p.ay / 300 * d.yMultiplier), h.entity.transformComponent.transform.rotation.rotateY(p.ax / 200 * d.xMultiplier), h.entity.transformComponent.setUpdated()
        }

        function i(e) {
            if (p.oldX = p.x, p.oldY = p.y, p.x = e.clientX || e.touches[0].clientX, p.y = e.clientY || e.touches[0].clientY, c && p.down) {
                var t = p.x - p.oldX,
                    n = p.y - p.oldY;
                p.ax += t, p.ay += n, r()
            }
        }

        function o() {
            p.down = !1
        }

        function a(e, t) {
            d = e, h = t, h.dragButton = ["Any", "Left", "Middle", "Right"].indexOf(d.dragButton) - 1, h.dragButton < -1 && (h.dragButton = -1), r()
        }

        function s(e, t) {
            f = t.world.sumerianRunner, f.addEventListener("mousedown", n), f.addEventListener("touchstart", n), f.renderer.domElement.addEventListener("mousemove", i), f.renderer.domElement.addEventListener("touchmove", i), f.renderer.domElement.addEventListener("mouseup", o), f.renderer.domElement.addEventListener("touchend", o), p = {
                down: !1,
                x: 0,
                y: 0,
                oldX: 0,
                oldY: 0,
                ax: 0,
                ay: 0
            }, a(e, t)
        }

        function u() {}

        function l(e, t) {
            t.domElement.removeEventListener("mousemove", i), t.domElement.removeEventListener("touchmove", i), t.domElement.removeEventListener("mouseup", o), t.domElement.removeEventListener("touchend", o), f.removeEventListener("mousedown", n), f.removeEventListener("touchstart", n)
        }
        var f = void 0,
            c = void 0,
            d = void 0,
            h = void 0,
            p = void 0;
        return {
            setup: s,
            update: u,
            cleanup: l,
            argsUpdated: a
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.externals = {
        key: "PickAndRotateScript",
        name: "Pick and Rotate",
        description: "Enables pick-drag-rotating entities",
        parameters: [{
            key: "disable",
            description: "Prevent rotation. For preventing this script programmatically.",
            type: "boolean",
            default: !1
        }, {
            key: "dragButton",
            description: "Button to enable dragging",
            default: "Any",
            options: ["Any", "Left", "Middle", "Right"],
            type: "string",
            control: "select"
        }, {
            key: "xMultiplier",
            description: "Horizontal rotation multiplier",
            default: 1,
            type: "float",
            control: "slider",
            min: -4,
            max: 4
        }, {
            key: "yMultiplier",
            description: "Vertical rotation multiplier",
            default: 1,
            type: "float",
            control: "slider",
            min: -4,
            max: 4
        }]
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.camRot = null, this.distance = 0, this.offset = 0, this.centerRatio = 0, this.positionVector = new u.default, this.distanceVector = new u.default, this.centerVector = new u.default, this.displacementVector = new u.default, this.edgeRelevance = e
    }

    function o(e, t, n, r, i, o, a, s, l, f) {
        this.sizeVector = new u.default(r, r, r), this.sizeVector.scale(o), this.positionVector = new u.default, this.flareVector = new u.default, this.intensity = i, this.displace = n, this.color = [e[0] * i, e[1] * i, e[2] * i, 1], this.edgeDampen = a, this.edgeScaling = s;
        var c = new d.default(p.default.uber, "flareShader");
        c.uniforms.materialEmissive = this.color, c.uniforms.materialDiffuse = [0, 0, 0, 1], c.uniforms.materialAmbient = [0, 0, 0, 1], c.uniforms.materialSpecular = [0, 0, 0, 1];
        var h = l[t];
        c.setTexture("DIFFUSE_MAP", h), c.setTexture("EMISSIVE_MAP", h), c.blendState.blending = "AdditiveBlending", c.blendState.blendEquation = "AddEquation", c.blendState.blendSrc = "OneFactor", c.blendState.blendDst = "OneFactor", c.depthState.enabled = !1, c.depthState.write = !1, c.cullState.enabled = !1;
        var m = new y.default(1, 1),
            v = f.createEntity(m, c);
        v.meshRendererComponent.cullMode = "Never", v.addToWorld(), this.material = c, this.quad = v
    }

    function a() {
        function e(e) {
            g.size = e, g.splash = f.default.createSplashTexture(512, {
                trailStartRadius: 25,
                trailEndRadius: 0
            }), g.ring = f.default.createFlareTexture(e, {
                steps: b.ring,
                startRadius: e / 4,
                endRadius: e / 2
            }), g.dot = f.default.createFlareTexture(e, {
                steps: b.dot,
                startRadius: 0,
                endRadius: e / 2
            }), g.bell = f.default.createFlareTexture(e, {
                steps: b.bell,
                startRadius: 0,
                endRadius: e / 2
            }), g.default = f.default.createFlareTexture(e, {
                steps: b.none,
                startRadius: 0,
                endRadius: e / 2
            })
        }

        function t(e, t, n, r, i) {
            for (var a = 0; a < e.length; a++) {
                var s = e[a];
                l.push(new o(t, s.tx, s.displace, s.size, s.intensity * m, n, r, i, g, c))
            }
            return l
        }

        function n(e) {
            for (var t = 0; t < e.length; t++) e[t].quad.removeFromWorld()
        }

        function r(t, n) {
            m = t.intensity, v = new i(100 * t.edgeRelevance);
            var r = y;
            t.highRes && (r *= 4), g.size !== r && e(r), l = [], u = n.entity, c = n.world, d = !1, p = [t.color[0], t.color[1], t.color[2], 1], h = [{
                size: 2.53,
                tx: "bell",
                intensity: .7,
                displace: 1
            }, {
                size: .53,
                tx: "dot",
                intensity: .7,
                displace: 1
            }, {
                size: .83,
                tx: "bell",
                intensity: .2,
                displace: .8
            }, {
                size: .4,
                tx: "ring",
                intensity: .1,
                displace: .6
            }, {
                size: .3,
                tx: "bell",
                intensity: .1,
                displace: .4
            }, {
                size: .6,
                tx: "bell",
                intensity: .1,
                displace: .3
            }, {
                size: .3,
                tx: "dot",
                intensity: .1,
                displace: .15
            }, {
                size: .22,
                tx: "ring",
                intensity: .03,
                displace: -.25
            }, {
                size: .36,
                tx: "dot",
                intensity: .05,
                displace: -.5
            }, {
                size: .8,
                tx: "ring",
                intensity: .1,
                displace: -.8
            }, {
                size: .86,
                tx: "bell",
                intensity: .2,
                displace: -1.1
            }, {
                size: 1.3,
                tx: "ring",
                intensity: .05,
                displace: -1.5
            }], n.bounds = new _.default(n.entity.transformComponent.sync().worldTransform.translation, 0)
        }

        function a() {
            n(l), l = []
        }

        function s(e, r) {
            if (r.bounds.center.copy(r.entity.transformComponent.sync().worldTransform.translation), r.activeCameraEntity.cameraComponent.camera.contains(r.bounds)) {
                v.updateFrameGeometry(u, r.activeCameraEntity), d || (l = t(h, p, e.scale, e.edgeDampen, e.edgeScaling), d = !0);
                for (var i = 0; i < l.length; i++) l[i].updatePosition(v)
            } else d && (n(l), d = !1)
        }
        var u = void 0,
            l = [],
            c = void 0,
            d = void 0,
            h = void 0,
            p = void 0,
            m = void 0,
            y = 64,
            v = void 0,
            g = {},
            b = {
                splash: {
                    trailStartRadius: 25,
                    trailEndRadius: 0
                },
                ring: [{
                    fraction: 0,
                    value: 0
                }, {
                    fraction: .7,
                    value: 0
                }, {
                    fraction: .92,
                    value: 1
                }, {
                    fraction: .98,
                    value: 0
                }],
                dot: [{
                    fraction: 0,
                    value: 1
                }, {
                    fraction: .3,
                    value: .75
                }, {
                    fraction: .5,
                    value: .45
                }, {
                    fraction: .65,
                    value: .21
                }, {
                    fraction: .75,
                    value: .1
                }, {
                    fraction: .98,
                    value: 0
                }],
                bell: [{
                    fraction: 0,
                    value: 1
                }, {
                    fraction: .15,
                    value: .75
                }, {
                    fraction: .3,
                    value: .5
                }, {
                    fraction: .4,
                    value: .25
                }, {
                    fraction: .75,
                    value: .05
                }, {
                    fraction: .98,
                    value: 0
                }],
                none: [{
                    fraction: 0,
                    value: 1
                }, {
                    fraction: 1,
                    value: 0
                }]
            };
        return {
            setup: r,
            lateUpdate: s,
            cleanup: a
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = n(0),
        u = r(s),
        l = n(112),
        f = r(l),
        c = n(9),
        d = r(c),
        h = n(15),
        p = r(h),
        m = n(59),
        y = r(m),
        v = n(65),
        _ = r(v);
    i.prototype.updateFrameGeometry = function(e, t) {
        this.camRot = t.transformComponent.sync().transform.rotation, this.centerVector.set(t.transformComponent.sync().worldTransform.translation), this.displacementVector.set(e.transformComponent.sync().worldTransform.translation), this.displacementVector.sub(this.centerVector), this.distance = this.displacementVector.length(), this.distanceVector.setDirect(0, 0, -this.distance), this.distanceVector.applyPost(this.camRot), this.centerVector.add(this.distanceVector), this.positionVector.set(this.centerVector), this.displacementVector.set(e.transformComponent.sync().worldTransform.translation), this.displacementVector.sub(this.positionVector), this.offset = this.displacementVector.length();
        var n = this.positionVector.length();
        this.centerRatio = n ? 1 - this.offset * this.edgeRelevance / this.positionVector.length() : 1 - this.offset * this.edgeRelevance, this.centerRatio = Math.max(0, this.centerRatio)
    }, o.prototype.updatePosition = function(e) {
        this.flareVector.set(e.displacementVector), this.positionVector.set(e.positionVector), this.flareVector.scale(this.displace), this.positionVector.add(this.flareVector), this.material.uniforms.materialEmissive = [this.color[0] * e.centerRatio * this.edgeDampen, this.color[1] * e.centerRatio * this.edgeDampen, this.color[2] * e.centerRatio * this.edgeDampen, 1];
        var t = e.distance + e.distance * e.centerRatio * this.edgeScaling,
            n = this.quad.transformComponent.transform;
        n.scale.set(this.sizeVector), n.scale.scale(t), n.rotation.set(e.camRot), n.translation.set(this.positionVector), this.quad.transformComponent.setUpdated()
    }, a.externals = {
        key: "LensFlareScript",
        name: "Lens Flare Script",
        description: "Makes an entity shine with some lensflare effect.",
        parameters: [{
            key: "scale",
            name: "Scale",
            type: "float",
            description: "Scale of flare quads",
            control: "slider",
            default: 1,
            min: .01,
            max: 2
        }, {
            key: "intensity",
            name: "Intensity",
            type: "float",
            description: "Intensity of Effect",
            control: "slider",
            default: 1,
            min: .01,
            //! AT: [0, 1] might be the normal domain but the upper allowed bound is 2 because it allows for superbright/superfancy lens flares
            max: 2
        }, {
            key: "edgeRelevance",
            name: "Edge Relevance",
            type: "float",
            description: "How much the effect cares about being centered or not",
            control: "slider",
            default: 0,
            min: 0,
            max: 2
        }, {
            key: "edgeDampen",
            name: "Edge Dampening",
            type: "float",
            description: "Intensity adjustment by distance from center",
            control: "slider",
            default: .2,
            min: 0,
            max: 1
        }, {
            key: "edgeScaling",
            name: "Edge Scaling",
            type: "float",
            description: "Scale adjustment by distance from center",
            control: "slider",
            default: 0,
            min: -2,
            max: 2
        }, {
            key: "color",
            name: "Color",
            type: "vec3",
            description: "Effect Color",
            control: "color",
            default: [.8, .75, .7]
        }, {
            key: "highRes",
            name: "High Resolution",
            type: "boolean",
            description: "Intensity of Effect",
            control: "checkbox",
            default: !1
        }]
    }, t.default = a
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i() {
        return new a
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        a = function() {
            function e() {
                r(this, e)
            }
            return o(e, [{
                key: "setup",
                value: function(e, t) {
                    t.webVR = t.world.sumerianRunner.webVR
                }
            }, {
                key: "update",
                value: function(e, t) {
                    !e.onlyWhenPresenting && t.webVR.canPresent && (t.entity.transformComponent.setRotationMatrix(t.webVR.data.camera.rotation), t.entity.transformComponent.setUpdated())
                }
            }]), e
        }();
    i.externals = {
        key: "HMDControlScript",
        name: "HMD Control",
        description: "Controls camera rotation and translation when in Virtual Reality (VR) using an Head Mounted Display (HMD).",
        parameters: [{
            key: "onlyWhenPresenting",
            name: "Only When Presenting",
            type: "boolean",
            default: !0
        }]
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(199),
        c = r(f),
        d = n(38),
        h = r(d),
        p = n(34),
        m = r(p),
        y = n(0),
        v = r(y),
        _ = function(e) {
            function t(e, n) {
                i(this, t);
                var r = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                if (r._type = "HMDCameraComponent", r._leftEyeCamera = e || new c.default, r._rightEyeCamera = n || new c.default, !e instanceof c.default || !n instanceof c.default) throw new Error("the leftEyeCamera or rightEyeCamera passed in is not WebVRCamera type.");
                return r._data = {}, r._data.frameData = null, r._VRCamRig = null, Object.seal(r), r
            }
            return a(t, e), s(t, [{
                key: "applyOnEntity",
                value: function(e, n, r) {
                    if (e instanceof c.default && n instanceof c.default) {
                        var i = new t(e, n);
                        return r.setComponent(i), !0
                    }
                }
            }, {
                key: "clone",
                value: function() {
                    return new t(this._leftEyeCamera.clone(), this._rightEyeCamera.clone())
                }
            }, {
                key: "copy",
                value: function(e) {
                    return this._leftEyeCamera.copy(e.leftEyeCamera), this._rightEyeCamera.copy(e.rightEyeCamera), this
                }
            }, {
                key: "updateData",
                value: function(e) {
                    if (null === e) return void(this._data = {});
                    this._data.frameData || (this._data.frameData = new VRFrameData), e.getFrameData(this._data.frameData), this._updateCamera()
                }
            }, {
                key: "_updateCamera",
                value: function() {
                    var e = h.default.IDENTITY;
                    this.entity.transformComponent.parent && (e = this.entity.transformComponent.parent.worldTransform.matrix.clone(), e.invert()), this._updateEyeCamera(this._leftEyeCamera, e, this._data.frameData.leftViewMatrix, this._data.frameData.leftProjectionMatrix), this._updateEyeCamera(this._rightEyeCamera, e, this._data.frameData.rightViewMatrix, this._data.frameData.rightProjectionMatrix)
                }
            }, {
                key: "_updateEyeCamera",
                value: function(e, t, n, r) {
                    var i = (new h.default).setArray(n),
                        o = (new h.default).setArray(r);
                    e.setViewMatrix(i, t), e.setProjectionMatrixPerspective(o), e.checkModelViewProjection()
                }
            }, {
                key: "updateTransformByFrameData",
                value: function() {
                    if (this._data.frameData) {
                        var e = this._data.frameData.pose.position,
                            t = this._data.frameData.pose.orientation;
                        if (e && this.entity.transformComponent.setTranslation(new v.default(e)), t) {
                            var n = new m.default(t);
                            this.entity.transformComponent.setRotationMatrix(n.toRotationMatrix())
                        }
                    }
                }
            }, {
                key: "resetData",
                value: function() {
                    return this._VRCamRig ? this.entity.transformComponent.parent && this.entity.transformComponent.parent.parent ? void(this.entity.transformComponent.parent.parent != this._VRCamRig.entity.transformComponent && (this._VRCamRig = null, this._data = {})) : (this._VRCamRig = null, void(this._data = {})) : void(this._data = {})
                }
            }, {
                key: "type",
                get: function() {
                    return this._type
                }
            }, {
                key: "leftEyeCamera",
                get: function() {
                    return this._leftEyeCamera
                }
            }, {
                key: "rightEyeCamera",
                get: function() {
                    return this._rightEyeCamera
                }
            }, {
                key: "vrData",
                get: function() {
                    return this._data
                }
            }, {
                key: "vrCamRig",
                get: function() {
                    return this._VRCamRig
                },
                set: function(e) {
                    this._VRCamRig = e
                }
            }]), t
        }(l.default);
    t.default = _
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        this.world = e, this.gridCount = t || 1, this.gridSize = 1, this.removeOldData = void 0 === n || n, this.keepEntities = void 0 !== r && r, this.createdEntities = []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(109),
        a = r(o),
        s = n(52),
        u = r(s),
        l = n(10),
        f = r(l),
        c = n(0),
        d = r(c),
        h = n(46),
        p = r(h),
        m = n(65),
        y = r(m);
    i.prototype.combine = function() {
        this.world.processEntityChanges(), this.world.getSystem("TransformSystem")._process(), this.world.getSystem("BoundingUpdateSystem")._process();
        var e = this.world.entityManager.getTopEntities();
        this.gridSize > 1 && (this.gridSize = this._calculateBounds(e) / this.gridCount), this._combineList(e)
    }, i.prototype._combineList = function(e) {
        var t = e;
        this.createdEntities = [], e instanceof a.default == !0 && (t = [e]);
        for (var n = new Map, r = [], i = 0; i < t.length; i++) this._buildSubs(t[i], n, r);
        r.length > 1 && (t = this.world.createEntity("RootCombined").addToWorld(), n.set(t, r));
        var o = this;
        n.forEach(function(e, t) {
            e.length > 0 && o._combine(t, e)
        })
    }, i.prototype._buildSubs = function(e, t, n) {
        if (!(e._hidden || e.skip || e.animationComponent || e.particleComponent)) {
            n && !1 !== e.static || (n = [], t.set(e, n)), e.static && e.meshDataComponent && e.meshRendererComponent && e.meshRendererComponent.worldBound && n.push(e);
            for (var r = 0; r < e.transformComponent.children.length; r++) {
                var i = e.transformComponent.children[r];
                this._buildSubs(i.entity, t, n)
            }
        }
    }, i.prototype._combine = function(e, t) {
        var n = e.transformComponent.sync().worldTransform,
            r = new f.default,
            i = new f.default;
        n.invert(r);
        for (var o = new Map, a = 0; a < t.length; a++) {
            var s = t[a],
                l = s.meshRendererComponent.materials[0],
                c = s.meshDataComponent.meshData.attributeMap,
                d = Object.keys(c);
            if (d.sort(), d = d.join("_"), this.gridSize > 1) {
                var h = s.meshRendererComponent.worldBound.center.x / this.gridSize,
                    p = s.meshRendererComponent.worldBound.center.z / this.gridSize;
                d = d + "_" + Math.round(h) + "_" + Math.round(p)
            }
            var m = o.get(l);
            m || (m = new Map, o.set(l, m));
            var y = m.get(d);
            y || (y = [], m.set(d, y)), y.push(s)
        }
        var v = this;
        o.forEach(function(t, n) {
            t.forEach(function(t) {
                if (1 !== t.length) {
                    for (var o = new u.default, a = 0; a < t.length; a += 1) {
                        var s = t[a];
                        e !== s ? i.multiply(r, s.transformComponent.sync().worldTransform) : i.setIdentity(), o.addMeshData(s.meshDataComponent.meshData, i), v.removeOldData ? (s.clearComponent("meshDataComponent"), s.clearComponent("meshRendererComponent"), v.keepEntities || 1 !== s._components.length || 0 !== s.transformComponent.children.length || s.removeFromWorld()) : (s.skip = !0, s._hidden = !0)
                    }
                    var l = o.build(),
                        f = Object.keys(l),
                        c = !0,
                        d = !1,
                        h = void 0;
                    try {
                        for (var p, m = f[Symbol.iterator](); !(c = (p = m.next()).done); c = !0) {
                            var y = p.value,
                                _ = v.world.createEntity(l[y], n);
                            _.addToWorld(), e.attachChild(_), v.createdEntities.push(_)
                        }
                    } catch (e) {
                        d = !0, h = e
                    } finally {
                        try {
                            !c && m.return && m.return()
                        } finally {
                            if (d) throw h
                        }
                    }
                }
            })
        })
    }, i.prototype._calculateBounds = function(e) {
        for (var t = !0, n = new p.default, r = 0; r < e.length; r++) {
            e[r].traverse(function(e) {
                if (e.meshRendererComponent && !e.particleComponent)
                    if (t) {
                        var r = e.meshRendererComponent.worldBound;
                        r instanceof p.default ? n.copy(r) : r instanceof y.default ? (n.center.set(r.center), n.xExtent = n.yExtent = n.zExtent = r.radius) : (n.center.set(d.default.ZERO), n.xExtent = n.yExtent = n.zExtent = 10), t = !1
                    } else n.merge(e.meshRendererComponent.worldBound)
            })
        }
        return 2 * Math.max(n.xExtent, n.zExtent)
    }, i.prototype.cleanup = function() {
        for (var e = this, t = 0; t < this.createdEntities.length; t += 1) ! function(t) {
            var n = e.createdEntities[t];
            n.removeFromWorld(), n.parent().each(function(e) {
                e.detachChild(n)
            })
        }(t)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }

    function a(e) {
        if (e.transformComponent._worldTransformDirty) {
            e.transformComponent.updateWorldTransform(), f++;
            for (var t = e.transformComponent.children, n = 0; n < t.length; n++) t[n]._worldTransformDirty = !0
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(u),
        f = void 0,
        c = function(e) {
            function t() {
                r(this, t);
                var e = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "TransformSystem", ["TransformComponent"]));
                return e.numUpdates = 0, e
            }
            return o(t, e), s(t, [{
                key: "process",
                value: function() {
                    var e = this._activeEntities;
                    f = 0;
                    var t = void 0,
                        n = void 0,
                        r = e.length;
                    for (t = 0; t < r; t++) n = e[t].transformComponent, n._localTransformDirty && n.updateTransform();
                    for (t = 0; t < r; t++) {
                        var i = e[t];
                        n = i.transformComponent, null === n.parent && i.traverse(a)
                    }
                    this.numUpdates = f
                }
            }]), t
        }(l.default);
    t.default = c
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(336),
        h = r(d),
        p = n(9),
        m = r(p),
        y = n(15),
        v = r(y),
        _ = n(3),
        g = r(_),
        b = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "RenderSystem", ["MeshRendererComponent", "MeshDataComponent"]));
                return e.entities = [], e.renderList = [], e.instancedRenderList = new Map, e.postRenderables = [], e.partitioner = new h.default, e.preRenderers = [], e.composers = [], e._composersActive = !0, e.doRender = !0, e._debugMaterials = {}, e.overrideMaterials = [], e.partitioningCamera = null, e.camera = null, e.lights = [], e.currentTpf = 0, c.default.addListener("sumerian.setCurrentCamera", function(t) {
                    e.camera = t.camera
                }), c.default.addListener("sumerian.setLights", function(t) {
                    e.lights = t
                }), e.picking = {
                    doPick: !1,
                    x: 0,
                    y: 0,
                    pickingStore: {},
                    pickingCallback: function(e, t) {
                        console.log(e, t)
                    },
                    skipUpdateBuffer: !1
                }, e
            }
            return a(t, e), s(t, [{
                key: "pick",
                value: function(e, t, n, r) {
                    this.picking.x = e, this.picking.y = t, this.picking.skipUpdateBuffer = void 0 !== r && r, n && (this.picking.pickingCallback = n), this.picking.doPick = !0
                }
            }, {
                key: "inserted",
                value: function(e) {
                    this.partitioner && this.partitioner.added(e)
                }
            }, {
                key: "deleted",
                value: function(e) {
                    this.partitioner && this.partitioner.removed(e)
                }
            }, {
                key: "process",
                value: function(e, t) {
                    this.entities = e, this.currentTpf = t
                }
            }, {
                key: "render",
                value: function(e, t) {
                    if (this.doRender && this.camera) {
                        e.updateShadows(this.partitioner, this.entities, this.lights);
                        for (var n = 0; n < this.preRenderers.length; n++) {
                            this.preRenderers[n].process(e, this.entities, this.partitioner, this.camera, this.lights)
                        }
                        if (this.partitioningCamera ? this.partitioner.process(this.partitioningCamera, this.entities, this.renderList) : e._leftVRCamera && e._rightVRCamera ? this.partitioner.process([e._leftVRCamera, e._rightVRCamera], this.entities, this.renderList, this.instancedRenderList) : this.partitioner.process(this.camera, this.entities, this.renderList, this.instancedRenderList), this.composers.length > 0 && this._composersActive)
                            for (var n = 0; n < this.composers.length; n++) {
                                var r = this.composers[n];
                                r.render(e, this.currentTpf, this.camera, this.lights, null, !0, this.overrideMaterials)
                            } else e.render(this.renderList, t, this.camera, this.lights, null, !0, this.overrideMaterials, this.instancedRenderList)
                    }
                }
            }, {
                key: "renderToPick",
                value: function(e, t) {
                    e.renderToPick(this.renderList, this.camera, !0, t)
                }
            }, {
                key: "enableComposers",
                value: function(e) {
                    this._composersActive = !!e
                }
            }, {
                key: "_createDebugMaterial",
                value: function(e) {
                    if ("" !== e) {
                        var t = void 0;
                        switch (e) {
                            case "wireframe":
                            case "color":
                                t = g.default.deepClone(v.default.simpleColored.fshader);
                                break;
                            case "lit":
                                t = g.default.deepClone(v.default.simpleLit.fshader);
                                break;
                            case "texture":
                                t = g.default.deepClone(v.default.textured.fshader);
                                break;
                            case "normals":
                                t = g.default.deepClone(v.default.showNormals.fshader);
                                break;
                            case "simple":
                                t = g.default.deepClone(v.default.simple.fshader)
                        }
                        var n = g.default.deepClone(v.default.uber);
                        n.fshader = t, "flat" !== e ? (this._debugMaterials[e] = new m.default(n, e), "wireframe" === e && (this._debugMaterials[e].wireframe = !0), "lit" === e && (this._debugMaterials[e]._textureMaps = {
                            EMISSIVE_MAP: null,
                            DIFFUSE_MAP: null,
                            SPECULAR_MAP: null,
                            NORMAL_MAP: null,
                            AO_MAP: null,
                            LIGHT_MAP: null,
                            TRANSPARENCY_MAP: null
                        })) : (this._debugMaterials[e] = m.default.createEmptyMaterial(null, e), this._debugMaterials[e].flat = !0)
                    }
                }
            }, {
                key: "setDebugMaterial",
                value: function(e) {
                    if (!e || "" === e) return void(this.overrideMaterials = []);
                    var t = e.split("+");
                    this.overrideMaterials = [];
                    for (var n = 0; n < t.length; n++) {
                        var e = t[n];
                        this._debugMaterials[e] || this._createDebugMaterial(e), "" === e ? this.overrideMaterials.push(null) : this.overrideMaterials.push(this._debugMaterials[e])
                    }
                }
            }, {
                key: "invalidateHandles",
                value: function(e) {
                    for (var t = 0; t < this.entities.length; t++) {
                        for (var n = this.entities[t], r = n.meshRendererComponent.materials, i = 0; i < r.length; i++) e.invalidateMaterial(r[i]);
                        e.invalidateMeshData(n.meshDataComponent.meshData)
                    }
                    for (var t = 0; t < this.composers.length; t++) {
                        var o = this.composers[t];
                        e.invalidateComposer(o)
                    }
                    e.rendererRecord = null
                }
            }]), t
        }(l.default);
    t.default = b
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(30),
        a = r(o),
        s = n(5),
        u = (r(s), n(69)),
        l = (r(u), n(95));
    r(l);
    i.prototype.added = function() {}, i.prototype.removed = function() {}, i.prototype.process = function(e, t, n, r) {
        var i = 0;
        Array.from(e);
        void 0 != r && r.forEach(function(e, t, n) {
            var r = e.meshLookup;
            e.objCount = 0, r.forEach(function(e, t, n) {
                n.set(t, {
                    objs: [],
                    IDs: []
                })
            })
        });
        for (var o = 0; o < t.length; o++) {
            var s = t[o];
            if (s.meshRendererComponent.materials.length > 0 && s.meshRendererComponent.materials[0].bIsInstanced) {
                var u = s.meshDataComponent.meshData,
                    l = s.meshRendererComponent.materials[0],
                    f = r.get(l);
                void 0 === f && (r.set(l, {
                    meshLookup: new Map,
                    objCount: 0
                }), f = r.get(l));
                var c = f.meshLookup,
                    d = c.get(u);
                void 0 === d && (c.set(u, {
                    objs: [],
                    IDs: []
                }), d = c.get(u)), d.objs.push(s), d.IDs.push(r.get(l).objCount), ++r.get(l).objCount
            } else if (s.skip || s.meshRendererComponent.hidden) s.isVisible = !1, s.isOccluded = !1;
            else if ("Never" === s.meshRendererComponent.cullMode) n[i++] = s, s.isVisible = !0;
            else if (Array.isArray(e)) {
                for (var h = !1, p = 0; p < e.length; p++) {
                    var m = s.meshRendererComponent.worldBound,
                        y = e[p].contains(m);
                    if (y !== a.default.Outside) {
                        h = !0;
                        break
                    }
                }
                h ? (n[i++] = s, s.isVisible = !0) : (s.isVisible = !1, s.isOccluded = !1)
            } else {
                var v = s.meshRendererComponent.worldBound,
                    _ = e.contains(v);
                _ !== a.default.Outside ? (n[i++] = s, s.isVisible = !0) : (s.isVisible = !1, s.isOccluded = !1)
            }
        }
        n.length = i
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(3),
        f = r(l),
        c = n(7),
        d = r(c),
        h = n(5),
        p = r(h),
        m = n(76),
        y = r(m),
        v = function(e) {
            function t(e) {
                i(this, t);
                var n = ["ScriptComponent"],
                    r = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "ScriptSystem", n));
                r._scripts = new Set;
                var a = e.sumerianRunner.renderer;
                return r._worldContext = {
                    domElement: a.domElement,
                    viewportWidth: a.viewportWidth,
                    viewportHeight: a.viewportHeight,
                    world: e,
                    activeCameraEntity: null,
                    worldData: {},
                    playTime: 0
                }, p.default.addListener("sumerian.setCurrentCamera", function(e) {
                    r._worldContext.activeCameraEntity = e.entity
                }), p.default.addListener("sumerian.viewportResize", function(e) {
                    r._worldContext.viewportWidth = e.width, r._worldContext.viewportHeight = e.height
                }), r._playing = !0, r.priority = 500, r._sumerian = "undefined" != typeof window && window.sumerian || {}, r
            }
            return a(t, e), s(t, [{
                key: "play",
                value: function() {
                    this._worldContext.playTime = 0, this._playing = !0
                }
            }, {
                key: "resume",
                value: function() {
                    this._playing = !0
                }
            }, {
                key: "pause",
                value: function() {
                    this._playing = !1
                }
            }, {
                key: "stop",
                value: function() {
                    this.pause()
                }
            }, {
                key: "fixedUpdate",
                value: function(e, t) {
                    for (var n = 0; n < e.length; n++) {
                        e[n].scriptComponent.fixedUpdate(e[n], t)
                    }
                    var r = !0,
                        i = !1,
                        o = void 0;
                    try {
                        for (var a, s = this._scripts[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                            var u = a.value;
                            this.callScriptFunction(u, u.fixedUpdate)
                        }
                    } catch (e) {
                        i = !0, o = e
                    } finally {
                        try {
                            !r && s.return && s.return()
                        } finally {
                            if (i) throw o
                        }
                    }
                }
            }, {
                key: "process",
                value: function(e, t) {
                    this._playing && (this._worldContext.playTime += t);
                    for (var n = 0; n < e.length; n++) {
                        e[n].scriptComponent.run(e[n], t)
                    }
                    var r = !0,
                        i = !1,
                        o = void 0;
                    try {
                        for (var a, s = this._scripts[Symbol.iterator](); !(r = (a = s.next()).done); r = !0) {
                            var u = a.value;
                            this.callScriptFunction(u, u.update)
                        }
                    } catch (e) {
                        i = !0, o = e
                    } finally {
                        try {
                            !r && s.return && s.return()
                        } finally {
                            if (i) throw o
                        }
                    }
                    for (var l = 0; l < e.length; l++) {
                        e[l].scriptComponent.lateRun(e[l], t)
                    }
                    var f = !0,
                        c = !1,
                        d = void 0;
                    try {
                        for (var h, p = this._scripts[Symbol.iterator](); !(f = (h = p.next()).done); f = !0) {
                            var m = h.value;
                            this.callScriptFunction(m, m.lateUpdate)
                        }
                    } catch (e) {
                        c = !0, d = e
                    } finally {
                        try {
                            !f && p.return && p.return()
                        } finally {
                            if (c) throw d
                        }
                    }
                }
            }, {
                key: "addedComponent",
                value: function(e, t) {
                    "ScriptComponent" !== t.type || this.manualSetup || t.setup(e)
                }
            }, {
                key: "removedComponent",
                value: function(e, t) {
                    "ScriptComponent" !== t.type || this.manualSetup || t.cleanup()
                }
            }, {
                key: "clear",
                value: function() {
                    for (var e = 0; e < this._activeEntities.length; e++) {
                        this._activeEntities[e].scriptComponent.cleanup()
                    }
                    var n = !0,
                        r = !1,
                        i = void 0;
                    try {
                        for (var o, a = this._scripts[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) {
                            var s = o.value;
                            this.callScriptFunction(s, s.cleanup)
                        }
                    } catch (e) {
                        r = !0, i = e
                    } finally {
                        try {
                            !n && a.return && a.return()
                        } finally {
                            if (r) throw i
                        }
                    }
                    this._worldContext = null, u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "clear", this).call(this, this)
                }
            }, {
                key: "makeScriptContext",
                value: function(e) {
                    var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
                        n = Object.create(this._worldContext);
                    return n.scriptData = {}, f.default.extend(n, e.getScriptContext()), f.default.extend(n, t), n
                }
            }, {
                key: "addScript",
                value: function(e, t) {
                    var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};
                    t.context = this.makeScriptContext(e, n), this._scripts.add(t), this.callScriptFunction(t, t.setup, !0)
                }
            }, {
                key: "removeScript",
                value: function(e) {
                    this.callScriptFunction(e, e.cleanup, !0), this._scripts.delete(e), e.enabled = !1
                }
            }, {
                key: "callScriptFunction",
                value: function(e, t) {
                    var n = arguments.length > 2 && void 0 !== arguments[2] && arguments[2];
                    if (t && (e.enabled || n)) try {
                        t(e.parameters, e.context, this._sumerian)
                    } catch (n) {
                        this._handleScriptError(e, t, n)
                    }
                }
            }, {
                key: "_handleScriptError",
                value: function(e, t, n) {
                    e.enabled = !1;
                    var r = y.default.makeScriptError(e, n);
                    console.error("[Sumerian] An error occured " + (r.line ? "at line " + r.line + " " : "") + 'when calling the "' + e.name + '" script\'s "' + (t.name || t) + '" function. ' + r.message, n), e.id && p.default.emit("sumerian.scriptError", {
                        id: e.id,
                        errors: [r]
                    })
                }
            }]), t
        }(d.default);
    t.default = v
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(26),
        l = (r(u), n(7)),
        f = r(l),
        c = n(5),
        d = r(c),
        h = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "LightingSystem", ["LightComponent", "TransformComponent"]));
                return e.overrideLights = null, e.lights = [], e._needsUpdate = !0, e
            }
            return a(t, e), s(t, [{
                key: "setOverrideLights",
                value: function(e) {
                    this.overrideLights = e, d.default.emit("sumerian.setLights", this.overrideLights), this._needsUpdate = !0
                }
            }, {
                key: "clearOverrideLights",
                value: function() {
                    this.overrideLights = void 0, this._needsUpdate = !0
                }
            }, {
                key: "inserted",
                value: function(e) {
                    e.lightComponent.updateLight(e.transformComponent.sync().worldTransform)
                }
            }, {
                key: "process",
                value: function(e) {
                    if (!this.overrideLights) {
                        this.lights.length = 0;
                        for (var t = 0; t < e.length; t++) {
                            var n = e[t],
                                r = n.transformComponent,
                                i = n.lightComponent;
                            if (r.sync(), (i._transformDirty || this._needsUpdate) && (i.updateLight(r.worldTransform), i._transformDirty = !1), !i.hidden) {
                                var o = i.light;
                                o.shadowCaster = o.shadowCaster, this.lights.push(o)
                            }
                        }
                        this._needsUpdate = !1, d.default.emit("sumerian.setLights", this.lights)
                    }
                }
            }, {
                key: "invalidateHandles",
                value: function(e) {
                    this._activeEntities.forEach(function(t) {
                        t.lightComponent.light.invalidateHandles(e)
                    })
                }
            }]), t
        }(f.default);
    t.default = h
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(69),
        h = r(d),
        p = n(152),
        m = (r(p), n(95)),
        y = r(m),
        v = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "VRControllerSystem", ["VRControllerComponent"]));
                return e._controllers = [], e._currentDisplayId = null, e._currentCameraRig = null, e._loadGamepads = !0, e._buttonStates = {}, e._axis = {}, c.default.addListener(h.default.VR_PRESENTATION_START, function(t) {
                    e._currentCameraRig = t.entity, e._currentDisplayId = t.entity.vRCameraRigComponent.displayId, e._loadGamepads = t.entity.vRCameraRigComponent.loadGamepads
                }), c.default.addListener(h.default.VR_PRESENTATION_STOP, function(t) {
                    e.controllers = [], e._currentDisplayId = null, e._currentCameraRig = null
                }), e
            }
            return a(t, e), s(t, [{
                key: "updateButtonStates",
                value: function() {
                    if (window.navigator.getGamepads && y.default.canPresent()) {
                        var e = window.navigator.getGamepads(),
                            t = !0,
                            n = !1,
                            r = void 0;
                        try {
                            for (var i, o = e[Symbol.iterator](); !(t = (i = o.next()).done); t = !0) {
                                var a = i.value;
                                if (a) {
                                    var s = a.id;
                                    "OpenVR Gamepad" === a.id && (s = "left" === a.hand ? "Vive Controller (Left)" : "Vive Controller (Right)"), this._buttonStates[s] || (this._buttonStates[s] = {});
                                    for (var u = 0; u < a.buttons.length; ++u) this._buttonStates[s][u] || (this._buttonStates[s][u] = {
                                        pressed: !1,
                                        touched: !1,
                                        value: 0
                                    }), this.updateButton(s, a, u);
                                    this.updateAxes(s, a.axes)
                                }
                            }
                        } catch (e) {
                            n = !0, r = e
                        } finally {
                            try {
                                !t && o.return && o.return()
                            } finally {
                                if (n) throw r
                            }
                        }
                    }
                }
            }, {
                key: "updateAxes",
                value: function(e, t) {
                    var n = !1,
                        r = {};
                    if (this._axis[e])
                        for (var i = 0; i < t.length; ++i) this._axis[e][i] !== t[i] && (n = !0, r[i] = t[i], this._axis[e][i] = t[i]);
                    else {
                        this._axis[e] = [];
                        for (var i = 0; i < t.length; ++i) this._axis[e].push(0), this._axis[e][i] !== t[i] && (n = !0, r[i] = t[i], this._axis[e][i] = t[i])
                    }
                    n && c.default.emit("axisMove", {
                        controllerId: e,
                        axes: r
                    })
                }
            }, {
                key: "onPreRender",
                value: function() {
                    if (this._currentDisplayId && (this._controllers = [], this._currentCameraRig && this._loadGamepads && window.navigator.getGamepads))
                        for (var e = window.navigator.getGamepads(), t = (this._currentDisplayId, 0); t < e.length; t++) e[t] && e[t].pose && this._controllers.push(e[t])
                }
            }, {
                key: "updateButton",
                value: function(e, t, n) {
                    var r = !1,
                        i = this._buttonStates[e][n],
                        o = t.buttons[n],
                        a = {
                            controllerId: e,
                            id: n
                        },
                        s = {
                            controllerId: e,
                            id: n,
                            value: o.value
                        };
                    o.pressed !== i.pressed && (r = !0, o.pressed ? c.default.emit("buttonDown", a) : c.default.emit("buttonUp", a), this._buttonStates[e][n].pressed = o.pressed), o.touched !== i.touched && (r = !0, o.touched ? c.default.emit("buttonTouchStart", a) : c.default.emit("buttonTouchEnd", a), i.touched = o.touched), o.value !== i.value && (r = !0, c.default.emit("buttonValueChanged", s), i.value = o.value), r && c.default.emit("buttonUpdated", a)
                }
            }, {
                key: "process",
                value: function() {
                    if (this.updateButtonStates(), this._currentDisplayId)
                        for (var e = 0; e < this._activeEntities.length; e++) {
                            var t = this._activeEntities[e],
                                n = t.vRControllerComponent;
                            n.update(this._controllers, this._currentCameraRig), n.updatePose()
                        }
                }
            }]), t
        }(l.default);
    t.default = v
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(69),
        h = r(d),
        p = n(95),
        m = (r(p), n(148)),
        y = (r(m), n(30)),
        v = (r(y), function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "HMDCameraSystem", ["HMDCameraComponent"]));
                return e._mainCameraEntity = null, e._leftEye = null, e._rightEye = null, c.default.addListener(h.default.VR_PRESENTATION_START, function(t) {
                    e._initVRMainCamera(t.entity), c.default.emit(h.default.START_VRCAMERAS, {
                        leftEye: e._leftEye,
                        rightEye: e._rightEye
                    })
                }), c.default.addListener(h.default.VR_PRESENTATION_STOP, function(t) {
                    c.default.emit(h.default.STOP_VRCAMERAS), e._mainCameraEntity = null, e._leftEye = null, e._rightEye = null
                }), e
            }
            return a(t, e), s(t, [{
                key: "onPreRender",
                value: function() {
                    this._mainCameraEntity && this._mainCameraEntity.hMDCameraComponent.updateTransformByFrameData();
                    for (var e = 0; e < this._activeEntities.length; e++) {
                        this._activeEntities[e].hMDCameraComponent.resetData()
                    }
                }
            }, {
                key: "_findMainCamera",
                value: function() {
                    return this._activeEntities.find(function(e) {
                        return e.hMDCameraComponent.vrCamRig.isCurrentVR
                    })
                }
            }, {
                key: "_initVRMainCamera",
                value: function(e) {
                    var t = this._findMainCamera();
                    if (!t) throw new Error("[Sumerian] There is no VRCamera defined!");
                    this._mainCameraEntity = t, this._leftEye = this._mainCameraEntity.hMDCameraComponent.leftEyeCamera, this._rightEye = this._mainCameraEntity.hMDCameraComponent.rightEyeCamera;
                    var n = e.vRCameraRigComponent.display,
                        r = e.vRCameraRigComponent.resolutionMultiplier,
                        i = n.getEyeParameters("left"),
                        o = n.getEyeParameters("right");
                    this._mainCameraEntity.hMDCameraComponent.vrData.leftEyeParameters = i, this._mainCameraEntity.hMDCameraComponent.vrData.rightEyeParameters = o, this._mainCameraEntity.hMDCameraComponent.vrData.resolutionMultiplier = r, this._leftEye.setRenderSize(i.renderWidth, i.renderHeight, r), this._rightEye.setRenderSize(o.renderWidth, o.renderHeight, r)
                }
            }, {
                key: "leftEye",
                get: function() {
                    return this._leftEye
                }
            }, {
                key: "rightEye",
                get: function() {
                    return this._rightEye
                }
            }, {
                key: "mainCameraEntity",
                get: function() {
                    return this._mainCameraEntity
                }
            }]), t
        }(l.default));
    t.default = v
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(7),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t() {
                r(this, t);
                var e = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "ParticlesSystem", ["TransformComponent", "MeshRendererComponent", "MeshDataComponent", "ParticleComponent"]));
                return e.passive = !1, e
            }
            return o(t, e), a(t, [{
                key: "process",
                value: function(e, t) {
                    if (!(t > 1))
                        for (var n = 0, r = e.length; n < r; n++) {
                            var i = e[n],
                                o = i.particleComponent;
                            o.enabled && this.updateParticles(i, o, t)
                        }
                }
            }, {
                key: "updateParticles",
                value: function(e, t, n) {
                    for (var r = 0, i = -1, o = void 0, a = !1; r < t.particleCount;) {
                        for (; void 0 === o;)
                            if (i++, t.emitters.length > i) {
                                if (o = t.emitters[i], o.influences.length)
                                    for (var s = 0, u = o.influences.length; s < u; s++) o.influences[s].prepare(e, o);
                                if (!o.enabled) {
                                    o = void 0;
                                    continue
                                }
                                if (0 !== o.totalParticlesToSpawn && (o.particlesWaitingToRelease += o.releaseRatePerSecond * n, o.particlesWaitingToRelease = Math.max(o.particlesWaitingToRelease, 0)), o.particlesWaitingToRelease < 1) {
                                    o = void 0;
                                    continue
                                }
                            } else o = null;
                        var l = t.particles[r];
                        if (l.alive && l.emitter && l.emitter.influences.length)
                            for (var s = 0, u = l.emitter.influences.length; s < u; s++) l.emitter.influences[s].enabled && l.emitter.influences[s].apply(n, l, r);
                        l.alive && (l.update(n, e), a = !0), !l.alive && o && (o.particlesWaitingToRelease--, o.totalParticlesToSpawn >= 1 && o.totalParticlesToSpawn--, l.respawnParticle(o), o.getEmissionPoint(l, e), o.getEmissionVelocity(l, e), (o.particlesWaitingToRelease < 1 || 0 === o.totalParticlesToSpawn) && (o = void 0)), r++
                    }
                    a && (t.meshData.vertexData._dataNeedsRefresh = !0, e.meshDataComponent.modelBoundDirty = !0)
                }
            }, {
                key: "play",
                value: function() {
                    this.passive = !1
                }
            }, {
                key: "pause",
                value: function() {
                    this.passive = !0
                }
            }]), t
        }(u.default);
    l.prototype.resume = l.prototype.play, l.prototype.stop = l.prototype.pause, t.default = l
}, function(e, t, n) {
    "use strict";

    function r() {
        var e = Date.now(),
            t = e,
            n = e,
            r = 0,
            o = 1 / 0,
            a = 0,
            s = 0,
            u = 1 / 0,
            l = 0,
            f = 0,
            c = 0,
            d = document.createElement("div");
        d.id = "stats", d.style.cssText = "width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";
        var h = document.createElement("div");
        h.id = "fps", h.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#002", d.appendChild(h);
        var p = document.createElement("div");
        p.id = "fpsText", p.style.cssText = "color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px", p.innerHTML = "FPS", h.appendChild(p);
        var m = document.createElement("div");
        for (m.id = "fpsGraph", m.style.cssText = "position:relative;width:74px;height:30px;background-color:#0ff", h.appendChild(m); m.children.length < 74;) {
            var y = document.createElement("span");
            y.style.cssText = "width:1px;height:30px;float:left;background-color:#113", m.appendChild(y)
        }
        var v = document.createElement("div");
        v.id = "ms", v.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#020;display:none", d.appendChild(v);
        var _ = document.createElement("div");
        _.id = "msText", _.style.cssText = "color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px", _.innerHTML = "MS", v.appendChild(_);
        var g = document.createElement("div");
        for (g.id = "msGraph", g.style.cssText = "position:relative;width:74px;height:30px;background-color:#0f0", v.appendChild(g); g.children.length < 74;) {
            var b = document.createElement("span");
            b.style.cssText = "width:1px;height:30px;float:left;background-color:#131", g.appendChild(b)
        }
        var x = document.createElement("div");
        x.id = "info", x.style.cssText = "padding:0 0 3px 3px;text-align:left;background-color:#200", d.appendChild(x);
        var w = document.createElement("div");
        w.id = "infoText", w.style.cssText = "color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px", w.innerHTML = "INFO", x.appendChild(w);
        var E = function(e) {
            switch (c = e) {
                case 0:
                    h.style.display = "block", v.style.display = "none";
                    break;
                case 1:
                    h.style.display = "none", v.style.display = "block"
            }
        };
        d.addEventListener("mousedown", function(e) {
            e.preventDefault(), c += 1, E(c % 2)
        }, !1);
        var S = function(e, t) {
            e.appendChild(e.firstChild).style.height = t + "px"
        };
        this.enabled = !1, this.domElement = d, this.setMode = E, this.begin = function() {
            e = Date.now()
        }, this.end = function(c) {
            var d = Date.now();
            return d > n + 100 && (r = d - e, o = Math.min(o, r), a = Math.max(a, r), _.textContent = r + " MS (" + o + "-" + a + ")", S(g, Math.min(30, 30 - r / 200 * 30)), n = d, c && (w.innerHTML = c)), f += 1, d > t + 1e3 && (s = Math.round(1e3 * f / (d - t)), u = Math.min(u, s), l = Math.max(l, s), i.metrics.fps.record(s), p.textContent = s + " FPS (" + u + "-" + l + ")", S(m, Math.min(30, 30 - s / (Math.min(500, l) + 10) * 30)), t = d, f = 0), d
        }, this.update = function(t) {
            e = this.end(t)
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(203);
    t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(75),
        c = r(f),
        d = n(4),
        h = r(d),
        p = n(5),
        m = r(p),
        y = n(38),
        v = r(y),
        _ = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "SoundSystem", ["SoundComponent", "TransformComponent"]));
                if (e._isSupported = c.default.isSupported(), !e._isSupported) return console.warn("Cannot create SoundSystem, WebAudio not supported"), o(e);
                e.entities = [], e._relativeTransform = new v.default, e._pausedSounds = {}, e.initialized = !1, e.rolloffFactor = .4, e.maxDistance = 100, e.volume = 1, e.reverb = 0, e.muted = !1, e.reverbAudioBuffer = null, e._reverbDirty = !0, e._dirty = !0, e._camera = null;
                var n = e;
                return m.default.addListener("sumerian.setCurrentCamera", function(e) {
                    n._camera = e.camera
                }), e._scheduledUpdates = [], e
            }
            return a(t, e), s(t, [{
                key: "_initializeAudioNodes",
                value: function() {
                    this._outNode = c.default.getContext().createGain(), this._outNode.connect(c.default.getContext().destination), this._wetNode = c.default.getContext().createGain(), this._wetNode.connect(this._outNode), this._wetNode.gain.value = .2, this._convolver = c.default.getContext().createConvolver(), this._convolver.connect(this._wetNode), this._listener = c.default.getContext().listener, this._listener.setPosition(0, 0, 0), this._listener.setOrientation(0, 0, -1, 0, 1, 0), this.initialized = !0
                }
            }, {
                key: "inserted",
                value: function(e) {
                    this.initialized || this._initializeAudioNodes(), e.soundComponent.connectTo({
                        dry: this._outNode,
                        wet: this._convolver
                    }), e.soundComponent._system = this
                }
            }, {
                key: "deleted",
                value: function(e) {
                    if (e.soundComponent) {
                        for (var t = e.soundComponent.sounds, n = 0; n < t.length; n++) t[n].stop();
                        e.soundComponent.connectTo(), e.soundComponent._system = null
                    }
                }
            }, {
                key: "updateConfig",
                value: function(e) {
                    e = e || {}, void 0 !== e.maxDistance && (this.maxDistance = e.maxDistance), void 0 !== e.rolloffFactor && (this.rolloffFactor = e.rolloffFactor), void 0 !== e.volume && (this.volume = h.default.clamp(e.volume, 0, 1)), void 0 !== e.reverb && (this.reverb = h.default.clamp(e.reverb, 0, 1)), void 0 !== e.muted && (this.muted = e.muted), this._dirty = !0
                }
            }, {
                key: "setReverb",
                value: function(e) {
                    this.reverbAudioBuffer = e, this._reverbDirty = !0
                }
            }, {
                key: "pause",
                value: function() {
                    if (!this._pausedSounds) {
                        this._pausedSounds = {};
                        for (var e = 0; e < this.entities.length; e++)
                            for (var t = this.entities[e].soundComponent.sounds, n = 0; n < t.length; n++) {
                                var r = t[n];
                                r.isPlaying() && (r.pause(), this._pausedSounds[r.id] = !0)
                            }
                    }
                }
            }, {
                key: "mute",
                value: function() {
                    this.muted = !0, this._dirty = !0
                }
            }, {
                key: "unmute",
                value: function() {
                    this.muted = !1, this._dirty = !0
                }
            }, {
                key: "resume",
                value: function() {
                    if (this._pausedSounds) {
                        for (var e = 0; e < this.entities.length; e++)
                            for (var t = this.entities[e].soundComponent.sounds, n = 0; n < t.length; n++) {
                                var r = t[n];
                                this._pausedSounds[r.id] && r.play()
                            }
                        this._pausedSounds = null
                    }
                }
            }, {
                key: "play",
                value: function() {
                    this.resume(), this.passive = !1
                }
            }, {
                key: "stop",
                value: function() {
                    for (var e = 0; e < this.entities.length; e++)
                        for (var t = this.entities[e].soundComponent.sounds, n = 0; n < t.length; n++) {
                            var r = t[n];
                            r.stop()
                        }
                    this._pausedSounds = null, this.passive = !0
                }
            }, {
                key: "process",
                value: function(e, t) {
                    if (this._isSupported && 0 !== e.length) {
                        this.initialized || this._initializeAudioNodes(), this._reverbDirty && (this._wetNode.disconnect(), !this.reverbAudioBuffer && this._wetNode ? this._convolver.buffer = null : (this._convolver.buffer = this.reverbAudioBuffer, this._wetNode.connect(this._outNode)), this._reverbDirty = !1), this._dirty && (this._outNode.gain.value = this.muted ? 0 : this.volume, this._wetNode.gain.value = this.reverb, this._dirty = !1), this.entities = e;
                        var n = this._relativeTransform,
                            r = void 0;
                        this._camera && (r = this._camera.getViewMatrix());
                        for (var i = 0; i < e.length; i++) {
                            var o = e[i],
                                a = o.soundComponent;
                            a._attachedToCamera = !(!o.cameraComponent || o.cameraComponent.camera !== this._camera), this._camera && !a._attachedToCamera ? (n.mul2(r, o.transformComponent.sync().worldTransform.matrix), a.process(this, n, t)) : a.process(this, null, t)
                        }
                    }
                }
            }]), t
        }(l.default);
    t.default = _
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(7),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t() {
                r(this, t);
                var e = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "SpeechSystem", ["SpeechComponent"]));
                return e.volume = 1, e.priority = 1e3, e
            }
            return o(t, e), a(t, [{
                key: "inserted",
                value: function(e) {
                    e.speechComponent && (e.speechComponent.system = this)
                }
            }, {
                key: "deleted",
                value: function(e) {
                    if (e && e.speechComponent) {
                        var t = e.speechComponent.speeches,
                            n = !0,
                            r = !1,
                            i = void 0;
                        try {
                            for (var o, a = t[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) {
                                o.value.stop()
                            }
                        } catch (e) {
                            r = !0, i = e
                        } finally {
                            try {
                                !n && a.return && a.return()
                            } finally {
                                if (r) throw i
                            }
                        }
                        e.speechComponent.system = null
                    }
                }
            }, {
                key: "updateConfig",
                value: function() {
                    var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
                    e.volume && (this.volume = e.volume)
                }
            }, {
                key: "process",
                value: function(e) {
                    var t = this;
                    this.entities = e, this.entities.forEach(function(e) {
                        e.speechComponent && e.speechComponent.process(t)
                    })
                }
            }]), t
        }(u.default);
    t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(98),
        c = (r(f), function(e) {
            function t() {
                i(this, t);
                var e = ["HostComponent"];
                return o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "HostSystem", e))
            }
            return a(t, e), s(t, [{
                key: "inserted",
                value: function(e) {
                    var t = e.children().top;
                    t && t.forEach(function(t) {
                        t.animationComponent && e.hostComponent.setupHost(t)
                    })
                }
            }, {
                key: "process",
                value: function(e, t) {
                    for (var n = 0; n < e.length; n++) e[n].hostComponent.process(t)
                }
            }]), t
        }(l.default));
    t.default = c
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), r.blue = "#2A3276", r.white = "#FFFFFF";
    var i = {
        color: r.white,
        shadow: !1
    };
    r.getLogo = function(e) {
        e = e || {};
        for (var t in i) void 0 === e[t] && (e[t] = i[t]);
        if (!document.createElementNS) return "";
        var n = "http://www.w3.org/2000/svg",
            r = document.createElementNS(n, "svg");
        r.setAttribute("version", "1.1"), r.setAttribute("xmlns", n), r.setAttribute("x", "0px"), r.setAttribute("y", "0px"), r.setAttribute("viewBox", "0 0 396.603 277.343"), r.setAttribute("enable-background", "new 0 0 396.603 277.343"), r.setAttribute("xml:space", "preserve"), e.width && r.setAttribute("width", e.width), e.height && r.setAttribute("height", e.height);
        var o = document.createElementNS(n, "g");
        r.appendChild(o);
        var a = document.createElementNS(n, "filter");
        a.setAttribute("id", "insetShadow");
        var s = document.createElementNS(n, "feGaussianBlur");
        s.setAttribute("in", "SourceAlpha"), s.setAttribute("stdDeviation", "0");
        var u = document.createElementNS(n, "feOffset");
        u.setAttribute("dx", "0"), u.setAttribute("dy", "-5"), u.setAttribute("result", "offsetblur");
        var l = document.createElementNS(n, "feComponentTransfer"),
            f = document.createElementNS(n, "feFuncA");
        f.setAttribute("type", "linear"), f.setAttribute("slope", "0.5"), l.appendChild(f);
        var c = document.createElementNS(n, "feMerge"),
            d = document.createElementNS(n, "feMergeNode"),
            h = document.createElementNS(n, "feMergeNode");
        h.setAttribute("in", "SourceGraphic"), c.appendChild(d), c.appendChild(h), a.appendChild(s), a.appendChild(u), a.appendChild(l), a.appendChild(c), o.appendChild(a);
        var p = document.createElementNS(n, "path");
        return p.setAttribute("d", "M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"), p.setAttribute("fill", e.color), e.shadow && (o.appendChild(a), p.setAttribute("style", "filter:url(#insetShadow)")), o.appendChild(p), (new XMLSerializer).serializeToString(r)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.world = e, this._material = new a.default(i.COLORED_LINE_SHADER), this._meshData = new u.default(i.ATTRIBUTE_MAP, 2 * i.MAX_NUM_LINES), this._meshData.indexModes = ["Lines"], this._positions = this._meshData.getAttributeBuffer("POSITION"), this._colors = this._meshData.getAttributeBuffer("RGB_COLOR"), this._renderObject = {
            meshData: this._meshData,
            transform: new d.default,
            materials: [this._material]
        }, this._rendering = !1, this._numRenderingLines = 0, this._meshData.vertexCount = 0, this._meshData.vertexData.setDataUsage("DynamicDraw")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(9),
        a = r(o),
        s = n(6),
        u = r(s),
        l = n(29),
        f = r(l),
        c = n(10),
        d = r(c);
    i.ATTRIBUTE_MAP = {
        POSITION: u.default.createAttribute(3, "Float"),
        RGB_COLOR: u.default.createAttribute(3, "Float")
    }, i.COLORED_LINE_SHADER = {
        name: "LineRenderer.colorLineShader",
        glslversion: 300,
        attributes: {
            vertexPosition: "POSITION",
            vertexColor: "RGB_COLOR"
        },
        uniforms: {
            viewProjectionMatrix: f.default.VIEW_PROJECTION_MATRIX
        },
        vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec3 vertexColor;\n\n    uniform mat4 viewProjectionMatrix;\n\n    out vec3 color;\n\n    void main(void) {\n      gl_Position = viewProjectionMatrix * vec4(vertexPosition, 1.0);\n      color = vertexColor;\n    }",
        fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n    #endif\n\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    in vec3 color;\n    \n    void main(void)\n    {\n      fragColor = vec4(color, 1.0);\n    }"
    }, i.MAX_NUM_LINES = 65536, i.prototype._updateVertexData = function() {
        0 === this._numRenderingLines && 0 === this._meshData.vertexCount || (this._meshData.vertexCount = 2 * Math.min(this._numRenderingLines, i.MAX_NUM_LINES), this._meshData.setAttributeDataUpdated("POSITION"), this._meshData.setAttributeDataUpdated("RGB_COLOR"))
    }, i.prototype._clear = function() {
        this._numRenderingLines = 0
    }, i.prototype._manageRenderList = function(e) {
        this._rendering || 0 === this._numRenderingLines ? this._rendering && 0 === this._numRenderingLines && (e.splice(e.indexOf(this._renderObject), 1), this._rendering = !1) : (e.push(this._renderObject), this._rendering = !0)
    }, i.prototype._remove = function() {
        this._meshData.destroy(this.world.sumerianRunner.renderer.context)
    }, i.prototype._addLine = function(e, t, n) {
        if (this._numRenderingLines >= i.MAX_NUM_LINES) return void console.warn("MAX_NUM_LINES has been exceeded in the LineRenderer.");
        for (var r = 6 * this._numRenderingLines, o = 0; o < 3; o++) {
            var a = r + o,
                s = r + 3 + o;
            this._positions[a] = e.getComponent(o), this._positions[s] = t.getComponent(o), this._colors[a] = n.getComponent(o), this._colors[s] = n.getComponent(o)
        }
        this._numRenderingLines++
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        var t = this;
        a.default.call(this, "PhysicsSystem", ["RigidBodyComponent"]), this._settings = e || {}, this.cannonWorld = new CANNON.World({
            broadphase: new CANNON.SAPBroadphase
        }), this._stayingEntities = [], this._entities = {}, this._shapeIdToColliderEntityMap = new Map, v || (v = new CANNON.Vec3, _ = new CANNON.Vec3, x = new CANNON.RaycastResult), this.setGravity(this._settings.gravity || new d.default(0, -10, 0)), this.cannonWorld.addEventListener("beginShapeContact", function(e) {
            var n = t._shapeIdToColliderEntityMap,
                r = n.get(e.shapeA.id),
                i = n.get(e.shapeB.id);
            if (r && i) {
                var o = r.colliderComponent,
                    a = i.colliderComponent;
                o.isTrigger || a.isTrigger ? (t.emitTriggerEnter(r, i), t._stayingEntities.push(r, i)) : (o.getBodyEntity() && !o.getBodyEntity().rigidBodyComponent.isKinematic || a.getBodyEntity() && !a.getBodyEntity().rigidBodyComponent.isKinematic) && (t.emitBeginContact(r, i), t._stayingEntities.push(r, i))
            }
        }), this.cannonWorld.addEventListener("endShapeContact", function(e) {
            for (var n = t._shapeIdToColliderEntityMap, r = n.get(e.shapeA.id), i = n.get(e.shapeB.id), o = t._stayingEntities, a = 0; a < o.length; a += 2)
                if (o[a] === r && o[a + 1] === i || o[a] === i && o[a + 1] === r) {
                    o.splice(a, 2);
                    break
                }
            r.colliderComponent && r.colliderComponent.isTrigger || i.colliderComponent && i.colliderComponent.isTrigger ? t.emitTriggerExit(r, i) : t.emitEndContact(r, i)
        }), this.cannonWorld.addEventListener("postStep", function() {
            t.emitSubStepEvent();
            for (var e = t._stayingEntities, n = 0; n < e.length; n += 2) {
                var r = e[n],
                    i = e[n + 1];
                r.colliderComponent && r.colliderComponent.isTrigger || i.colliderComponent && i.colliderComponent.isTrigger ? t.emitTriggerStay(r, i) : t.emitDuringContact(r, i)
            }
        }), this.initialized = !1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(349),
        a = r(o),
        s = n(222),
        u = r(s),
        l = n(224),
        f = r(l),
        c = n(0),
        d = r(c),
        h = n(34),
        p = r(h),
        m = n(10),
        y = r(m),
        v = void 0,
        _ = void 0,
        g = new p.default,
        b = new d.default,
        x = void 0,
        w = new y.default;
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.setGravity = function(e) {
        this.cannonWorld.gravity.copy(e)
    }, i.prototype.getGravity = function(e) {
        var t = this.cannonWorld.gravity;
        e.x = t.x, e.y = t.y, e.z = t.z
    }, i.prototype.step = function(e) {
        this.cannonWorld.step(e)
    };
    var E = {};
    i.prototype._getCannonRaycastOptions = function(e) {
        return E.collisionFilterMask = void 0 !== e.collisionMask ? e.collisionMask : -1, E.collisionFilterGroup = void 0 !== e.collisionGroup ? e.collisionGroup : -1, E.skipBackfaces = void 0 === e.skipBackfaces || e.skipBackfaces, E
    }, i.prototype._copyCannonRaycastResultToSumerian = function(e, t, n) {
        if (e.hasHit) {
            t.entity = this._shapeIdToColliderEntityMap.get(e.shape.id);
            var r = e.hitPointWorld,
                i = e.hitNormalWorld;
            t.point.setDirect(r.x, r.y, r.z), t.normal.setDirect(i.x, i.y, i.z), t.distance = n.distance(t.point)
        }
        return e.hasHit
    }, i.prototype._getCannonStartEnd = function(e, t, n, r, i) {
        r.copy(e), i.copy(t), i.scale(n, i), i.vadd(e, i)
    }, i.prototype.raycastAny = function(e, t, n, r, i) {
        r instanceof u.default && (i = r, r = {}), r = r || {}, i = i || new u.default;
        var o = v,
            a = _;
        return this._getCannonStartEnd(e, t, n, o, a), this.cannonWorld.raycastAny(o, a, this._getCannonRaycastOptions(r), x), this._copyCannonRaycastResultToSumerian(x, i, e)
    }, i.prototype.raycastClosest = function(e, t, n, r, i) {
        r instanceof u.default && (i = r, r = {}), r = r || {}, i = i || new u.default;
        var o = v,
            a = _;
        return this._getCannonStartEnd(e, t, n, o, a), this.cannonWorld.raycastClosest(o, a, this._getCannonRaycastOptions(r), x), this._copyCannonRaycastResultToSumerian(x, i, e)
    };
    var S = new u.default;
    i.prototype.raycastAll = function(e, t, n, r, i) {
        "function" == typeof r && (i = r, r = {}), i = i || function() {};
        var o = v,
            a = _;
        this._getCannonStartEnd(e, t, n, o, a);
        var s = this,
            u = !1;
        return this.cannonWorld.raycastAll(o, a, this._getCannonRaycastOptions(r), function(t) {
            s._copyCannonRaycastResultToSumerian(t, S, e) && (u = !0), !1 === i(S) && t.abort()
        }), u
    }, i.prototype.play = function() {
        this.passive = !1, this.initialize()
    }, i.prototype.pause = function() {
        this.passive = !0
    }, i.prototype.resume = function() {
        this.passive = !1
    }, i.prototype.stop = function() {
        this.pause(), this.destroy()
    }, i.prototype.initialize = function(e) {
        e = e || this._activeEntities;
        for (var t = e.length, n = 0; n !== t; n++) {
            var r = e[n];
            r.rigidBodyComponent.initialize()
        }
        for (var i = this._activeColliderEntities, n = 0; n !== i.length; n++) {
            var o = i[n];
            o.colliderComponent && (o.colliderComponent.getBodyEntity() || o.colliderComponent.cannonBody || o.colliderComponent.initialize())
        }
        for (var n = 0; n !== t; n++)
            for (var r = e[n], a = r.rigidBodyComponent.joints, s = 0; s < a.length; s++) {
                var u = a[s];
                r.rigidBodyComponent.initializeJoint(u, r, this)
            }
        this.initialized = !0
    }, i.prototype.destroy = function(e) {
        var t = this;
        e = e || this._activeEntities;
        var n = e.length;
        this._shapeIdToColliderEntityMap.forEach(function(e) {
            t._shapeIdToColliderEntityMap.delete(e)
        }), this._stayingEntities.length = 0;
        for (var r = 0; r !== n; r++)
            for (var i = e[r], o = i.rigidBodyComponent.joints, a = 0; a < o.length; a++) {
                var s = o[a];
                i.rigidBodyComponent.destroyJoint(s, i, this)
            }
        for (var r = 0; r !== this._activeColliderEntities.length; r++) {
            var u = this._activeColliderEntities[r];
            u.colliderComponent && (u.colliderComponent.cannonBody && u.colliderComponent.destroy())
        }
        for (var r = 0; r !== n; r++) {
            var i = e[r];
            i.rigidBodyComponent.destroy()
        }
        this.initialized = !1
    }, i.prototype.fixedUpdate = function(e, t) {
        this.initialized || this.initialize(), 0 !== e.length && this.step(t)
    }, i.prototype.process = function(e) {
        this.initialized || this.initialize(), 0 !== e.length && this.syncTransforms(e)
    }, i.prototype.syncTransforms = function(e) {
        for (var t = e.length, n = [], r = 0; r !== t; r++) {
            var i = e[r],
                o = i.rigidBodyComponent;
            i.transformComponent.parent && i.transformComponent.parent.entity.vRControllerComponent ? (i.rigidBodyComponent.setTransformFromEntity(i), i.rigidBodyComponent.cannonBody.aabbNeedsUpdate = !0) : (o._updated = !1, i.transformComponent.parent ? n.unshift(i) : n.push(i))
        }
        for (; n.length;) {
            var i = n.pop(),
                o = i.rigidBodyComponent,
                a = i.transformComponent,
                s = a.transform;
            if (!o._updated) {
                o._updated = !0, o.interpolation === f.default.INTERPOLATE ? (o.getInterpolatedPosition(b), o.getInterpolatedQuaternion(g)) : (o.getPosition(b), o.getQuaternion(g)), s.translation.set(b), s.rotation.copyQuaternion(g);
                var u = a.parent;
                u && (u.entity.transformComponent.sync().worldTransform.invert(w), y.default.combine(w, s, w), s.rotation.copy(w.rotation), s.translation.copy(w.translation)), a.setUpdated()
            }
        }
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.apply(this, arguments), this.priority = -1, this._activeColliderEntities = [], this._colliderInsertedListener = function(e) {
            this._activeColliderEntities.push(e.entity), this._colliderInserted(e.entity)
        }.bind(this), this._colliderDeletedListener = function(e) {
            var t = this._activeColliderEntities,
                n = t.indexOf(e.entity); - 1 !== n && this._activeColliderEntities.splice(n, 1), this._colliderDeleted(e.entity)
        }.bind(this), this._colliderDeletedComponentListener = function(e) {
            this._colliderDeletedComponent(e.entity, e.component)
        }.bind(this), u.default.addListener("sumerian.collider.inserted", this._colliderInsertedListener), u.default.addListener("sumerian.collider.deleted", this._colliderDeletedListener), u.default.addListener("sumerian.collider.deletedComponent", this._colliderDeletedComponentListener)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(7),
        a = r(o),
        s = n(5),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.setGravity = function() {};
    var l = {
        entityA: null,
        entityB: null
    };
    i.prototype.emitSubStepEvent = function() {
        u.default.emit("sumerian.physics.substep")
    }, i.prototype.emitBeginContact = function(e, t) {
        this._emitEvent("sumerian.physics.beginContact", e, t)
    }, i.prototype.emitDuringContact = function(e, t) {
        this._emitEvent("sumerian.physics.duringContact", e, t)
    }, i.prototype.emitEndContact = function(e, t) {
        this._emitEvent("sumerian.physics.endContact", e, t)
    }, i.prototype.emitTriggerEnter = function(e, t) {
        this._emitEvent("sumerian.physics.triggerEnter", e, t)
    }, i.prototype.emitTriggerStay = function(e, t) {
        this._emitEvent("sumerian.physics.triggerStay", e, t)
    }, i.prototype.emitTriggerExit = function(e, t) {
        this._emitEvent("sumerian.physics.triggerExit", e, t)
    }, i.prototype._emitEvent = function(e, t, n) {
        l.entityA = t, l.entityB = n, u.default.emit(e, l), l.entityA = null, l.entityB = null
    }, i.prototype._colliderInserted = function() {}, i.prototype._colliderDeleted = function() {}, i.prototype._colliderDeletedComponent = function() {}, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        a.default.call(this, arguments), this.joints = []
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(8),
        a = r(o),
        s = n(34),
        u = r(s),
        l = n(10),
        f = r(l),
        c = n(5),
        d = r(c),
        h = new u.default;
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.addJoint = function(e) {
        this.joints.push(e)
    }, i.prototype.removeJoint = function(e) {
        var t = this.joints,
            n = t.indexOf(e); - 1 !== n && t.splice(n, 1)
    }, i.initializedEvent = {
        entity: null
    }, i.prototype.emitInitialized = function(e) {
        var t = i.initializedEvent;
        t.entity = e, d.default.emit("sumerian.physics.initialized", t), t.entity = null
    }, i.prototype.initialize = function() {}, i.prototype.destroy = function() {}, i.prototype.initializeJoint = function() {}, i.prototype.destroyJoint = function() {};
    var p = new f.default,
        m = new f.default,
        y = new f.default;
    i.prototype.traverseColliders = function(e, t) {
        var n = e.transformComponent.sync().worldTransform;
        p.copy(n), p.invert(p);
        for (var r = [e]; r.length;) {
            var i = r.pop(),
                o = i.colliderComponent;
            if (o) {
                i.transformComponent.sync(), m.copy(i.transformComponent.worldTransform), f.default.combine(p, m, y);
                var a = y.translation,
                    s = y.rotation;
                h.fromRotationMatrix(s), t.call(this, i, o.collider, a, h)
            }
            for (var u = i.transformComponent.children, l = 0; l < u.length; l++) {
                var c = u[l].entity;
                c.rigidBodyComponent || r.push(c)
            }
        }
    }, i.prototype.attached = function() {}, i.prototype.attached = function(e) {
        this._entity = e, this._system = e._world.getSystem("PhysicsSystem")
    }, i.prototype.detached = function() {
        this._entity = null, this._system = null
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        e = e || {}, a.default.call(this, e), this.localPivot = e.localPivot ? u.default.fromAny(e.localPivot) : new u.default(0, .5, 0), this.autoConfigureConnectedPivot = !e.autoConfigureConnectedPivot || e.autoConfigureConnectedPivot, this.connectedLocalPivot = e.connectedLocalPivot ? u.default.fromAny(e.connectedLocalPivot) : new u.default(0, .5, 0)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(225),
        a = r(o),
        s = n(0),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        e = e || {}, a.default.call(this, e), this.localPivot = e.localPivot ? new u.default(e.localPivot) : new u.default(0, .5, 0), this.autoConfigureConnectedPivot = !e.autoConfigureConnectedPivot || e.autoConfigureConnectedPivot, this.connectedLocalPivot = e.connectedLocalPivot ? new u.default(e.connectedLocalPivot) : new u.default, this.localAxis = e.localAxis ? new u.default(e.localAxis) : new u.default(1, 0, 0)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(225),
        a = r(o),
        s = n(0),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        a.default.apply(this), e = e || {}, this.entity = null, this.collider = e.collider || null, this.worldCollider = this.collider ? this.collider.clone() : null, this.isTrigger = void 0 !== e.isTrigger && e.isTrigger, this.bodyEntity = null, this.material = void 0 !== e.material ? e.material : null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(8),
        a = r(o),
        s = n(82),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.getBodyEntity = function() {
        var e = void 0;
        return this.entity.traverseUp(function(t) {
            if (t.rigidBodyComponent) return e = t, !1
        }), e
    }, i.prototype.updateWorldCollider = function() {
        this.collider.transform(this.entity.transformComponent.sync().worldTransform, this.worldCollider)
    }, i.prototype.attached = function(e) {
        this.entity = e, this.system = e._world.getSystem("PhysicsSystem")
    }, i.prototype.detached = function() {
        this.entity = null
    }, i.applyOnEntity = function(e, t) {
        if (e instanceof u.default) return t.setComponent(new i({
            collider: e
        })), !0
    }, i.prototype.api = {}, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t, n, r) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var i = arguments[0];
            e = i.xSegments, t = i.ySegments, n = i.width, r = i.height
        }
        this.xSegments = e || 10, this.ySegments = t || 10, this.width = n || 1, this.height = r || 1;
        var o = a.default.defaultMap([a.default.POSITION]),
            s = 4 + 2 * (this.xSegments - 1) + 2 * (this.ySegments - 1),
            u = 8 + 2 * (this.xSegments - 1) + 2 * (this.ySegments - 1);
        a.default.call(this, o, s, u), this.indexModes[0] = "Lines", this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = r(o),
        s = n(3),
        u = r(s);
    i.prototype = Object.create(a.default.prototype), i.prototype.constructor = i, i.prototype.rebuild = function() {
        var e = this.width / 2,
            t = this.height / 2,
            n = [],
            r = [];
        n.push(-e, -t, 0, -e, t, 0, e, t, 0, e, -t, 0), r.push(0, 1, 1, 2, 2, 3, 3, 0);
        for (var i = void 0, o = this.width / this.xSegments, s = 1; s < this.xSegments; s++) i = s * o - e, n.push(i, -t, 0, i, t, 0);
        var u = void 0;
        o = this.height / this.ySegments;
        for (var l = 1; l < this.ySegments; l++) u = l * o - t, n.push(-e, u, 0, e, u, 0);
        for (var f = r.length / 2; f < n.length / 3; f += 2) r.push(f, f + 1);
        this.getAttributeBuffer(a.default.POSITION).set(n), this.getIndexBuffer().set(r)
    }, i.prototype.clone = function() {
        return new i(u.default.shallowSelectiveClone(this, ["xSegments", "ySegments", "width", "height"]))
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        if (l.default.call(this, 2, 2), 0 === arguments.length) this.data[0] = 1, this.data[3] = 1;
        else if (1 === arguments.length && "object" === o(arguments[0])) arguments[0] instanceof i ? this.copy(arguments[0]) : this.setArray(arguments[0]);
        else
            for (var e = 0; e < arguments.length; e++) this.data[e] = arguments[e];
        Object.seal(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
            return typeof e
        } : function(e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        a = n(4),
        s = r(a),
        u = n(145),
        l = r(u),
        f = n(3),
        c = r(f);
    i.prototype = Object.create(l.default.prototype), i.prototype.constructor = i, l.default.setupAliases(i.prototype, [
        ["e00"],
        ["e10"],
        ["e01"],
        ["e11"]
    ]), i.IDENTITY = new i(1, 0, 0, 1), i.prototype.add = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] += n[0], t[1] += n[1], t[2] += n[2], t[3] += n[3], this
    }, i.prototype.sub = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] -= n[0], t[1] -= n[1], t[2] -= n[2], t[3] -= n[3], this
    }, i.prototype.scale = function(e) {
        var t = this.data;
        return t[0] *= e, t[1] *= e, t[2] *= e, t[3] *= e, this
    }, i.prototype.mul = function(e) {
        var t = e.data,
            n = t[0],
            r = t[2],
            i = t[1],
            o = t[3],
            a = this.data,
            s = a[0],
            u = a[2],
            l = a[1],
            f = a[3],
            c = this.data;
        return c[0] = n * s + r * l, c[2] = n * l + r * f, c[1] = i * s + o * l, c[3] = i * u + o * f, this
    }, i.prototype.mul2 = function(e, t) {
        var n = e.data,
            r = n[0],
            i = n[2],
            o = n[1],
            a = n[3],
            s = t.data,
            u = s[0],
            l = s[2],
            f = s[1],
            c = s[3],
            d = this.data;
        return d[0] = r * u + i * f, d[2] = r * f + i * c, d[1] = o * u + a * f, d[3] = o * l + a * c, this
    }, i.prototype.transpose = function() {
        var e = this.data,
            t = e[1];
        return e[1] = e[2], e[2] = t, this
    }, i.invert = function(e, t) {
        if (t || (t = new i), t === e) return t.copy(i.invert(e));
        var n = e.determinant();
        return Math.abs(n) < s.default.EPSILON ? t : (n = 1 / n, t.e00 = e.e11 * n, t.e10 = 0 - e.e10 * n, t.e01 = 0 - e.e01 * n, t.e11 = e.e00 * n, t)
    }, i.prototype.invert = function() {
        return i.invert(this, this)
    }, i.prototype.isOrthogonal = function() {
        var e = void 0;
        return e = this.e00 * this.e01 + this.e10 * this.e11, !(Math.abs(e) > s.default.EPSILON)
    }, i.prototype.isNormal = function() {
        var e = void 0;
        return e = this.e00 * this.e00 + this.e10 * this.e10, !(Math.abs(e - 1) > s.default.EPSILON) && (e = this.e01 * this.e01 + this.e11 * this.e11, !(Math.abs(e - 1) > s.default.EPSILON))
    }, i.prototype.isOrthonormal = function() {
        return this.isOrthogonal() && this.isNormal()
    }, i.prototype.determinant = function() {
        return this.e00 * this.e11 - this.e01 * this.e10
    }, i.prototype.setIdentity = function() {
        return this.set(i.IDENTITY), this
    }, i.prototype.equals = function(e) {
        var t = this.data,
            n = e.data;
        return Math.abs(t[0] - n[0]) <= s.default.EPSILON && Math.abs(t[1] - n[1]) <= s.default.EPSILON && Math.abs(t[2] - n[2]) <= s.default.EPSILON && Math.abs(t[3] - n[3]) <= s.default.EPSILON
    }, i.prototype.copy = function(e) {
        var t = this.data,
            n = e.data;
        return t[0] = n[0], t[1] = n[1], t[2] = n[2], t[3] = n[3], this
    }, i.prototype.setArray = function(e) {
        var t = this.data;
        return t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[3], this
    }, i.prototype.set = i.prototype.copy, i.prototype.clone = function() {
        return (new i).copy(this)
    }, l.default.addPostChecks(i.prototype, ["add", "sub", "scale", "transpose", "invert", "isOrthogonal", "determinant", "copy"]), i.add = c.default.warnOnce("Matrix2.add is deprecated. Use Matrix2.prototype.add instead.", function(e, t, n) {
        return n || (n = new i), t instanceof i ? (n.e00 = e.e00 + t.e00, n.e10 = e.e10 + t.e10, n.e01 = e.e01 + t.e01, n.e11 = e.e11 + t.e11) : (n.e00 = e.e00 + t, n.e10 = e.e10 + t, n.e01 = e.e01 + t, n.e11 = e.e11 + t), n
    }), i.combine = c.default.warnOnce("Matrix2.combine is deprecated. Use Matrix2.prototype.multiply instead.", function(e, t, n) {
        return n || (n = new i), n === e || n === t ? l.default.copy(i.combine(e, t), n) : (n.e00 = e.e00 * t.e00 + e.e01 * t.e10, n.e10 = e.e10 * t.e00 + e.e11 * t.e10, n.e01 = e.e00 * t.e01 + e.e01 * t.e11, n.e11 = e.e10 * t.e01 + e.e11 * t.e11, n)
    }), i.div = c.default.warnOnce("Matrix2.div is deprecated. Use Matrix2.prototype.div instead.", function(e, t, n) {
        return n || (n = new i), t instanceof i ? (n.e00 = e.e00 / t.e00, n.e10 = e.e10 / t.e10, n.e01 = e.e01 / t.e01, n.e11 = e.e11 / t.e11) : (t = 1 / t, n.e00 = e.e00 * t, n.e10 = e.e10 * t, n.e01 = e.e01 * t, n.e11 = e.e11 * t), n
    }), i.mul = c.default.warnOnce("Matrix2.mul is deprecated. Use Matrix2.prototype.mul instead.", function(e, t, n) {
        return n || (n = new i), t instanceof i ? (n.e00 = e.e00 * t.e00, n.e10 = e.e10 * t.e10, n.e01 = e.e01 * t.e01, n.e11 = e.e11 * t.e11) : (n.e00 = e.e00 * t, n.e10 = e.e10 * t, n.e01 = e.e01 * t, n.e11 = e.e11 * t), n
    }), i.transpose = c.default.warnOnce("Matrix2.transpose is deprecated. Use Matrix2.prototype.transpose instead.", function(e, t) {
        return t || (t = new i), t === e ? l.default.copy(i.transpose(e), t) : (t.e00 = e.e00, t.e10 = e.e01, t.e01 = e.e10, t.e11 = e.e11, t)
    }), i.sub = c.default.warnOnce("Matrix2.sub is deprecated. Use Matrix2.prototype.sub instead.", function(e, t, n) {
        return n || (n = new i), t instanceof i ? (n.e00 = e.e00 - t.e00, n.e10 = e.e10 - t.e10, n.e01 = e.e01 - t.e01, n.e11 = e.e11 - t.e11) : (n.e00 = e.e00 - t, n.e10 = e.e10 - t, n.e01 = e.e01 - t, n.e11 = e.e11 - t), n
    }), i.prototype.combine = c.default.warnOnce("Matrix2.prototype.combine is deprecated. Use Matrix2.prototype.mul or Matrix2.prototype.mul2 instead.", function(e) {
        return i.combine(this, e, this)
    }), i.prototype.div = c.default.warnOnce("Matrix2.prototype.div is deprecated.", function(e) {
        return i.div(this, e, this)
    }), t.default = i
}, function(e, t, n) {
    "use strict";

    function r() {}
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(4),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.shifter = [37, 91, 12, 128, 216, 96, 51, 153, 39, 231, 223, 180, 160, 157, 135, 179, 74, 50, 205, 151, 4, 213, 196, 58, 212, 120, 53, 45, 10, 195, 137, 159, 103, 144, 109, 170, 202, 48, 121, 13, 245, 68, 232, 28, 210, 174, 197, 80, 107, 206, 156, 116, 155, 240, 162, 79, 41, 59, 147, 117, 0, 242, 118, 164, 129, 101, 98, 126, 214, 105, 89, 26, 130, 254, 85, 199, 8, 165, 76, 75, 187, 166, 64, 143, 217, 149, 78, 7, 172, 230, 87, 119, 42, 247, 84, 139, 16, 141, 134, 86, 154, 71, 253, 60, 99, 235, 168, 30, 34, 55, 113, 140, 191, 69, 31, 106, 40, 82, 73, 33, 81, 14, 234, 131, 255, 88, 169, 136, 248, 148, 220, 138, 219, 102, 44, 127, 36, 200, 95, 208, 54, 152, 47, 20, 23, 15, 52, 123, 177, 224, 122, 171, 215, 173, 211, 188, 190, 133, 244, 167, 236, 35, 63, 145, 221, 104, 65, 24, 70, 100, 56, 150, 49, 77, 110, 228, 112, 209, 198, 1, 237, 185, 250, 225, 93, 201, 124, 108, 218, 72, 243, 21, 22, 6, 114, 38, 125, 29, 66, 249, 222, 111, 241, 11, 186, 61, 176, 183, 17, 163, 229, 161, 57, 238, 227, 132, 67, 83, 207, 226, 46, 189, 115, 193, 194, 233, 182, 192, 18, 27, 25, 2, 3, 252, 97, 62, 184, 239, 175, 92, 246, 142, 251, 204, 203, 32, 146, 90, 19, 9, 178, 158, 181, 94, 43, 5], r.split = function(e) {
        var t = Math.floor(e),
            n = o.default.scurve5(e - t);
        return {
            i0: t + 0,
            i1: t + 1,
            f0: 1 - n,
            f1: 0 + n
        }
    }, r.fractal1d = function(e, t, n, r, i, o) {
        for (var a = 0, s = 1, u = 0, l = 0; l < n; l++) a += s * o.evaluate1d(e, t), u += s, s *= r, e *= i;
        return a / u
    }, r.fractal2d = function(e, t, n, r, i, o, a) {
        for (var s = 0, u = 1, l = 0, f = 0; f < r; f++) s += u * a.evaluate2d(e, t, n), l += u, u *= i, e *= o, t *= o;
        return s / l
    }, r.fractal3d = function(e, t, n, r, i, o, a, s) {
        for (var u = 0, l = 1, f = 0, c = 0; c < i; c++) u += l * s.evaluate3d(e, t, n, r), f += l, l *= o, e *= a, t *= a, n *= a;
        return u / f
    }, r.fractal4d = function(e, t, n, r, i, o, a, s, u) {
        for (var l = 0, f = 1, c = 0, d = 0; d < o; d++) l += f * u.evaluate4d(e, t, n, r, i), c += f, f *= a, e *= s, t *= s, n *= s, r *= s;
        return l / c
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(8),
        l = r(u),
        f = n(33),
        c = r(f),
        d = function(e) {
            function t(e, n, r, a) {
                i(this, t);
                var s = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                n = n || 200, s.options = r || {}, s.options.preciseRecursion = !!s.options.preciseRecursion, s.options.autoUpdate = !1 !== s.options.autoUpdate, s.overrideMaterial = a, s.doUpdate = !0;
                var u = e.aspect;
                return s.type = "PortalComponent", s.camera = e, s.target = new c.default(n, n / u), s.options.preciseRecursion && (s.secondaryTarget = new c.default(n, n / u)), Object.seal(s), s
            }
            return a(t, e), s(t, [{
                key: "requestUpdate",
                value: function() {
                    this.doUpdate = !0
                }
            }]), t
        }(l.default);
    d.type = "PortalComponent", t.default = d
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(7),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t(e, n) {
                r(this, t);
                var o = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "PortalSystem", ["MeshRendererComponent", "MeshDataComponent", "PortalComponent"]));
                return o.renderer = e, o.renderSystem = n, o.renderList = [], o
            }
            return o(t, e), a(t, [{
                key: "process",
                value: function(e) {
                    for (var t = 0; t < e.length; t++) {
                        var n = e[t],
                            r = n.portalComponent;
                        if (r.options.autoUpdate || r.doUpdate) {
                            r.doUpdate = !1;
                            var i = r.camera,
                                o = r.target,
                                a = r.secondaryTarget,
                                s = r.overrideMaterial;
                            this.render(this.renderer, i, o, s);
                            if (n.meshRendererComponent.materials[0].setTexture("DIFFUSE_MAP", o), r.options.preciseRecursion) {
                                var u = o;
                                r.target = a, r.secondaryTarget = u
                            }
                        }
                    }
                }
            }, {
                key: "render",
                value: function(e, t, n, r) {
                    e.updateShadows(this.renderSystem.partitioner, this.renderSystem.entities, this.renderSystem.lights);
                    for (var i = 0; i < this.renderSystem.preRenderers.length; i++) {
                        this.renderSystem.preRenderers[i].process(e, this.renderSystem.entities, this.renderSystem.partitioner, t, this.renderSystem.lights)
                    }
                    this.renderSystem.partitioner.process(t, this.renderSystem.entities, this.renderList), e.render(this.renderList, null, t, this.renderSystem.lights, n, !0, r)
                }
            }]), t
        }(u.default);
    t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        b.default.copyOptions(this, e, {
            translation: p.default.ZERO,
            rotation: y.default.IDENTITY,
            positiveXFar: 1,
            negativeXFar: 1,
            positiveYFar: 1,
            negativeYFar: 1,
            positiveZFar: 1,
            negativeZFar: 1,
            resolution: 512
        }), this.entities = [], this.influenceRadius = Math.max(this.positiveXFar, this.negativeXFar) / 2 + Math.max(this.positiveYFar, this.negativeYFar) / 2 + Math.max(this.positiveZFar, this.negativeZFar) / 2, this.influenceArea = new f.default(this.translation, this.influenceRadius), this.dimensions = new p.default((this.positiveXFar + this.negativeXFar) / 2, (this.positiveYFar + this.negativeYFar) / 2, (this.positiveZFar + this.negativeZFar) / 2);
        var t = new p.default(0, 0, 0),
            n = new p.default(this.negativeXFar, this.negativeYFar, this.negativeZFar).applyPre(this.rotation),
            r = new p.default(0, 0, 0).set(this.dimensions).applyPre(this.rotation);
        t.x = this.translation.x - n.x + r.x, t.y = this.translation.y - n.y + r.y, t.z = this.translation.z - n.z + r.z, this.probeCenter = this.translation, this.translation = t, this.cameras = [];
        for (var i = [new p.default(1, 0, 0).applyPre(this.rotation), new p.default(-1, 0, 0).applyPre(this.rotation), new p.default(0, 1, 0).applyPre(this.rotation), new p.default(0, -1, 0).applyPre(this.rotation), new p.default(0, 0, 1).applyPre(this.rotation), new p.default(0, 0, -1).applyPre(this.rotation)], o = [new p.default(0, -1, 0).applyPre(this.rotation), new p.default(0, -1, 0).applyPre(this.rotation), new p.default(0, 0, 1).applyPre(this.rotation), new p.default(0, 0, -1).applyPre(this.rotation), new p.default(0, -1, 0).applyPre(this.rotation), new p.default(0, -1, 0).applyPre(this.rotation)], a = [this.dimensions.z / this.dimensions.y, this.dimensions.z / this.dimensions.y, this.dimensions.x / this.dimensions.z, this.dimensions.x / this.dimensions.z, this.dimensions.x / this.dimensions.y, this.dimensions.x / this.dimensions.y], s = [this.dimensions.x + 1e-4, this.dimensions.x + 1e-4, this.dimensions.y + 1e-4, this.dimensions.y + 1e-4, this.dimensions.z + 1e-4, this.dimensions.z + 1e-4], l = [MathUtils.degFromRad(2 * Math.atan(this.dimensions.y / this.dimensions.x)), MathUtils.degFromRad(2 * Math.atan(this.dimensions.y / this.dimensions.x)), MathUtils.degFromRad(2 * Math.atan(this.dimensions.z / this.dimensions.y)), MathUtils.degFromRad(2 * Math.atan(this.dimensions.z / this.dimensions.y)), MathUtils.degFromRad(2 * Math.atan(this.dimensions.y / this.dimensions.z)), MathUtils.degFromRad(2 * Math.atan(this.dimensions.y / this.dimensions.z))], c = 0; c < 6; c++) {
            this.cameras.push(new u.default(l[c], a[c], .001, s[c]));
            var h = i[c],
                m = o[c],
                v = new p.default(0, 0, 0).set(m).cross(h).normalize();
            new p.default(0, 0, 0).add(this.probeCenter).applyPre(this.rotation);
            this.cameras[c].setFrame(this.translation, v, m, h)
        }
        this.renderList = [], this.instancedRenderList = [], this.skyMap = new d.default(Math.floor(this.resolution), Math.floor(this.resolution), {
            format: "RGBA",
            type: w.default.Webgl2 ? "Float" : "UnsignedByte",
            minFilter: "Trilinear",
            depthBuffer: !0,
            stencilBuffer: !1,
            readDepthStencilBuffer: !1,
            readColorBuffer: !0,
            generateMipmaps: !0,
            variant: "CUBE"
        }), this.specularIrradianceMap = new d.default(Math.floor(this.resolution / 4), Math.floor(this.resolution / 4), {
            format: "RGBA",
            type: w.default.Webgl2 ? "Float" : "UnsignedByte",
            minFilter: "Trilinear",
            depthBuffer: !1,
            stencilBuffer: !1,
            readDepthStencilBuffer: !1,
            readColorBuffer: !0,
            generateMipmaps: !0,
            renderToMipmaps: !!w.default.Webgl2,
            maxMipmapTargets: w.default.Webgl2 ? 5 : 1,
            variant: "CUBE"
        }), this.shouldUpdate = !0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(6),
        a = (r(o), n(29)),
        s = (r(a), n(30)),
        u = r(s),
        l = n(65),
        f = r(l),
        c = n(33),
        d = r(c),
        h = n(0),
        p = r(h),
        m = n(31),
        y = r(m),
        v = n(10),
        _ = (r(v), n(9)),
        g = (r(_), n(92)),
        b = r(g),
        x = n(26),
        w = r(x);
    i.prototype.process = function(e, t, n, r, i) {
        if (this.shouldUpdate) {
            this.shouldUpdate = !1;
            var o = t.filter(function(e) {
                return e.meshRendererComponent.isReflectable
            });
            this._renderProbe(e, o, n, i), e.computeSpecularMap(this.skyMap, Math.floor(this.resolution / 4), this.specularIrradianceMap)
        }
    }, i.prototype._renderProbe = function(e, t, n, r) {
        for (var i = 0; i < 6; i++) e.setRenderTarget(this.skyMap, i), e.clear(), n.process(this.cameras[i], t, this.renderList, this.instancedRenderList), e._doRender(this.renderList, this.instancedRenderList, null, this.cameras[i], r);
        e.updateRenderTargetMipmap(this.skyMap)
    }, i.prototype.updateProbe = function() {
        this.shouldUpdate = !0
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.controlPoints = e, this.segments = (this.controlPoints.length - 1) / 3
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(37),
        a = r(o),
        s = n(0),
        u = r(s),
        l = n(36),
        f = r(l);
    ! function() {
        var e = new f.default,
            t = new f.default,
            n = new f.default,
            r = new u.default,
            o = new u.default,
            s = new u.default,
            l = new a.default,
            c = new a.default,
            d = new a.default;
        i.quadraticInterpolation = function(i, h, p, m, y) {
            var v = m * m,
                _ = 1 - m,
                g = _ * _;
            y instanceof f.default ? (i.copyTo(e), e.scale(g), h.copyTo(t), t.scale(_ * m * 2), p.copyTo(n), n.scale(v), y.set(e).add(t).add(n)) : y instanceof u.default ? (i.copyTo(r), r.scale(g), h.copyTo(o), o.scale(_ * m * 2), p.copyTo(s), s.scale(v), y.set(r).add(o).add(s)) : y instanceof a.default && (i.copyTo(l), l.scale(g), h.copyTo(c), c.scale(_ * m * 2), p.copyTo(d), d.scale(v), y.set(l).add(c).add(d))
        }
    }(),
    function() {
        var e = new f.default,
            t = new f.default,
            n = new f.default,
            r = new f.default,
            o = new u.default,
            s = new u.default,
            l = new u.default,
            c = new u.default,
            d = new a.default,
            h = new a.default,
            p = new a.default,
            m = new a.default;
        i.cubicInterpolation = function(i, y, v, _, g, b) {
            var x = g * g,
                w = x * g,
                E = 1 - g,
                S = E * E,
                M = S * E;
            b instanceof f.default ? (i.copyTo(e), e.scale(M), y.copyTo(t), t.scale(S * g * 3), v.copyTo(n), n.scale(E * x * 3), _.copyTo(r), r.scale(w), b.set(e).add(t).add(n).add(r)) : b instanceof u.default ? (i.copyTo(o), o.scale(M), y.copyTo(s), s.scale(S * g * 3), v.copyTo(l), l.scale(E * x * 3), _.copyTo(c), c.scale(w), b.set(o).add(s).add(l).add(c)) : b instanceof a.default && (i.copyTo(d), d.scale(M), y.copyTo(h), h.scale(S * g * 3), v.copyTo(p), p.scale(E * x * 3), _.copyTo(m), m.scale(w), b.set(d).add(h).add(p).add(m))
        }
    }(), i.prototype.getPoint = function(e, t) {
            if (e <= 0) return void t.set(this.controlPoints[0]);
            if (e >= 1) return void t.set(this.controlPoints[this.controlPoints.length - 1]);
            var n = this.segments * e,
                r = Math.floor(n),
                o = n - r,
                a = this.controlPoints[3 * r + 0],
                s = this.controlPoints[3 * r + 1],
                u = this.controlPoints[3 * r + 2],
                l = this.controlPoints[3 * r + 3];
            i.cubicInterpolation(a, s, u, l, o, t)
        },
        function() {
            i.getPointsAlongCubicBezierCurve = function(e, t) {
                if (4 !== e.length) throw new Error("[Sumerian] Please provide 4 control points for cubicInterpolation.");
                if (t <= 0) return [];
                if (!Number.isInteger(t)) throw new Error("[Sumerian] Please provide a positive integer for the number of segments.");
                for (var n = i.cubicInterpolation.bind(null, e[0], e[1], e[2], e[3]), r = new u.default, o = [], a = 1 / t, s = 0, l = 0; s <= t; s++, l += a) n(l, r), o[s] = new u.default(r);
                return o
            }
        }(), t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        for (var t = 0, n = 0; n < e.length; n++) t += e[n].length;
        return t
    }

    function o(e, t) {
        this.matrix = e, this.textureUnitsPerLine = t || 8;
        var n = u.default.defaultMap([u.default.POSITION, u.default.NORMAL, u.default.TEXCOORD0]),
            r = i(e);
        u.default.call(this, n, 4 * r, 6 * r), this.rebuild()
    }

    function a(e) {
        var t = [];
        return e.split("\n").forEach(function(e) {
            var n = e.split(""),
                r = n.map(function(e) {
                    return e.charCodeAt(0)
                });
            t.push(r)
        }), t
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = n(6),
        u = r(s),
        l = n(3),
        f = r(l);
    o.prototype = Object.create(u.default.prototype), o.prototype.constructor = o, o.prototype.rebuild = function() {
        for (var e = [], t = [], n = [], r = [], i = 0, o = this.matrix.length / 2, a = 0; a < this.matrix.length; a++)
            for (var s = this.matrix[a].length / 2, l = 0; l < this.matrix[a].length; l++) {
                e.push(l - s, -a - 1 + o, 0, l - s, -a + o, 0, l + 1 - s, -a + o, 0, l + 1 - s, -a - 1 + o, 0), t.push(0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1);
                var f = this.matrix[a][l] % this.textureUnitsPerLine / this.textureUnitsPerLine,
                    c = Math.floor(this.matrix[a][l] / this.textureUnitsPerLine) / this.textureUnitsPerLine;
                c = 1 - c, r.push(f, c - 1 / this.textureUnitsPerLine, f, c, f + 1 / this.textureUnitsPerLine, c, f + 1 / this.textureUnitsPerLine, c - 1 / this.textureUnitsPerLine), n.push(i + 3, i + 1, i + 0, i + 2, i + 1, i + 3), i += 4
            }
        return this.getAttributeBuffer(u.default.POSITION).set(e), this.getAttributeBuffer(u.default.NORMAL).set(t), this.getAttributeBuffer(u.default.TEXCOORD0).set(r), this.getIndexBuffer().set(n), this
    }, o.prototype.clone = function() {
        return new o(f.default.shallowSelectiveClone(this, ["matrix", "textureUnitsPerLine"]))
    }, o.fromString = function(e) {
        return new o(a(e), 16)
    }, t.default = o
}, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), n(519), n(702);
    var i = n(116),
        o = r(i),
        a = n(703),
        s = r(a),
        u = n(194),
        l = r(u),
        f = n(64),
        c = r(f),
        d = n(704),
        h = r(d),
        p = n(705),
        m = r(p),
        y = n(75),
        v = r(y),
        _ = n(46),
        g = r(_),
        b = n(195),
        x = r(b),
        w = n(65),
        E = r(w),
        S = n(272),
        M = r(S),
        C = n(273),
        T = r(C),
        R = n(118),
        A = r(R),
        O = n(57),
        P = r(O),
        D = n(271),
        I = r(D),
        k = n(146),
        N = r(k),
        L = n(268),
        B = r(L),
        F = n(30),
        j = r(F),
        U = n(148),
        V = r(U),
        z = n(274),
        G = r(z),
        W = n(275),
        H = r(W),
        X = n(267),
        Y = r(X),
        q = n(26),
        K = r(q),
        Q = n(8),
        Z = r(Q),
        J = n(20),
        $ = r(J),
        ee = n(289),
        te = r(ee),
        ne = n(290),
        re = r(ne),
        ie = n(25),
        oe = r(ie),
        ae = n(706),
        se = r(ae),
        ue = n(263),
        le = r(ue),
        fe = n(707),
        ce = r(fe),
        de = n(708),
        he = r(de),
        pe = n(120),
        me = r(pe),
        ye = n(144),
        ve = r(ye),
        _e = n(193),
        ge = r(_e),
        be = n(81),
        xe = r(be),
        we = n(200),
        Ee = r(we),
        Se = n(291),
        Me = r(Se),
        Ce = n(709),
        Te = r(Ce),
        Re = n(710),
        Ae = r(Re),
        Oe = n(152),
        Pe = r(Oe),
        De = n(51),
        Ie = r(De),
        ke = n(109),
        Ne = r(ke),
        Le = n(333),
        Be = r(Le),
        Fe = n(292),
        je = r(Fe),
        Ue = n(279),
        Ve = r(Ue),
        ze = n(63),
        Ge = r(ze),
        We = n(158),
        He = r(We),
        Xe = n(213),
        Ye = r(Xe),
        qe = n(266),
        Ke = r(qe),
        Qe = n(278),
        Ze = r(Qe),
        Je = n(50),
        $e = r(Je),
        et = n(94),
        tt = r(et),
        nt = n(159),
        rt = r(nt),
        it = n(715),
        ot = r(it),
        at = n(354),
        st = r(at),
        ut = n(719),
        lt = r(ut),
        ft = n(322),
        ct = r(ft),
        dt = n(321),
        ht = r(dt),
        pt = n(320),
        mt = r(pt),
        yt = n(720),
        vt = r(yt),
        _t = n(121),
        gt = r(_t),
        bt = n(294),
        xt = r(bt),
        wt = n(293),
        Et = r(wt),
        St = n(204),
        Mt = r(St),
        Ct = n(295),
        Tt = r(Ct),
        Rt = n(205),
        At = r(Rt),
        Ot = n(206),
        Pt = r(Ot),
        Dt = n(345),
        It = r(Dt),
        kt = n(299),
        Nt = r(kt),
        Lt = n(119),
        Bt = r(Lt),
        Ft = n(123),
        jt = r(Ft),
        Ut = n(300),
        Vt = r(Ut),
        zt = n(338),
        Gt = r(zt),
        Wt = n(721),
        Ht = r(Wt),
        Xt = n(223),
        Yt = r(Xt),
        qt = n(346),
        Kt = r(qt),
        Qt = n(198),
        Zt = r(Qt),
        Jt = n(9),
        $t = r(Jt),
        en = n(301),
        tn = r(en),
        nn = n(4),
        rn = r(nn),
        on = n(355),
        an = r(on),
        sn = n(722),
        un = r(sn),
        ln = n(31),
        fn = r(ln),
        cn = n(723),
        dn = r(cn),
        hn = n(38),
        pn = r(hn),
        mn = n(724),
        yn = r(mn),
        vn = n(145),
        _n = r(vn),
        gn = n(52),
        bn = r(gn),
        xn = n(6),
        wn = r(xn),
        En = n(70),
        Sn = r(En),
        Mn = n(302),
        Cn = r(Mn),
        Tn = n(303),
        Rn = r(Tn),
        An = n(96),
        On = r(An),
        Pn = n(304),
        Dn = r(Pn),
        In = n(203),
        kn = n(725),
        Nn = r(kn),
        Ln = n(726),
        Bn = r(Ln),
        Fn = n(356),
        jn = r(Fn),
        Un = n(92),
        Vn = r(Un),
        zn = n(3),
        Gn = r(zn),
        Wn = n(217),
        Hn = r(Wn),
        Xn = n(727),
        Yn = r(Xn),
        qn = n(318),
        Kn = r(qn),
        Qn = n(317),
        Zn = r(Qn),
        Jn = n(215),
        $n = r(Jn),
        er = n(728),
        tr = r(er),
        nr = n(157),
        rr = r(nr),
        ir = n(341),
        or = r(ir),
        ar = n(112),
        sr = r(ar),
        ur = n(214),
        lr = r(ur),
        fr = n(68),
        cr = r(fr),
        dr = n(729),
        hr = r(dr),
        pr = n(730),
        mr = r(pr),
        yr = n(107),
        vr = r(yr),
        _r = n(110),
        gr = r(_r),
        br = n(357),
        xr = r(br),
        wr = n(358),
        Er = r(wr),
        Sr = n(731),
        Mr = r(Sr),
        Cr = n(308),
        Tr = r(Cr),
        Rr = n(124),
        Ar = r(Rr),
        Or = n(17),
        Pr = r(Or),
        Dr = n(265),
        Ir = r(Dr),
        kr = n(59),
        Nr = r(kr),
        Lr = n(34),
        Br = r(Lr),
        Fr = n(66),
        jr = r(Fr),
        Ur = n(732),
        Vr = r(Ur),
        zr = n(270),
        Gr = r(zr),
        Wr = n(359),
        Hr = r(Wr),
        Xr = n(733),
        Yr = r(Xr),
        qr = n(24),
        Kr = r(qr),
        Qr = n(196),
        Zr = r(Qr),
        Jr = n(147),
        $r = r(Jr),
        ei = n(285),
        ti = r(ei),
        ni = n(129),
        ri = r(ni),
        ii = n(150),
        oi = r(ii),
        ai = n(283),
        si = r(ai),
        ui = n(335),
        li = r(ui),
        fi = n(33),
        ci = r(fi),
        di = n(12),
        hi = r(di),
        pi = n(197),
        mi = r(pi),
        yi = n(305),
        vi = r(yi),
        _i = n(160),
        gi = r(_i),
        bi = n(125),
        xi = r(bi),
        wi = n(337),
        Ei = r(wi),
        Si = n(126),
        Mi = r(Si),
        Ci = n(269),
        Ti = r(Ci),
        Ri = n(29),
        Ai = r(Ri),
        Oi = n(67),
        Pi = r(Oi),
        Di = n(276),
        Ii = r(Di),
        ki = n(277),
        Ni = r(ki),
        Li = n(58),
        Bi = r(Li),
        Fi = n(306),
        ji = r(Fi),
        Ui = n(15),
        Vi = r(Ui),
        zi = n(282),
        Gi = r(zi),
        Wi = n(201),
        Hi = r(Wi),
        Xi = n(734),
        Yi = r(Xi),
        qi = n(336),
        Ki = r(qi),
        Qi = n(216),
        Zi = r(Qi),
        Ji = n(319),
        $i = r(Ji),
        eo = n(316),
        to = r(eo),
        no = n(311),
        ro = r(no),
        io = n(310),
        oo = r(io),
        ao = n(309),
        so = r(ao),
        uo = n(735),
        lo = r(uo),
        fo = n(211),
        co = r(fo),
        ho = n(343),
        po = r(ho),
        mo = n(315),
        yo = r(mo),
        vo = n(313),
        _o = r(vo),
        go = n(312),
        bo = r(go),
        xo = n(314),
        wo = (r(xo), n(344)),
        Eo = r(wo),
        So = n(97),
        Mo = r(So),
        Co = n(360),
        To = r(Co),
        Ro = n(736),
        Ao = r(Ro),
        Oo = n(93),
        Po = r(Oo),
        Do = n(342),
        Io = r(Do),
        ko = n(737),
        No = r(ko),
        Lo = n(56),
        Bo = r(Lo),
        Fo = n(7),
        jo = r(Fo),
        Uo = n(5),
        Vo = r(Uo),
        zo = n(69),
        Go = r(zo),
        Wo = n(281),
        Ho = r(Wo),
        Xo = n(284),
        Yo = r(Xo),
        qo = n(738),
        Ko = r(qo),
        Qo = n(739),
        Zo = r(Qo),
        Jo = n(45),
        $o = r(Jo),
        ea = n(108),
        ta = r(ea),
        na = n(361),
        ra = r(na),
        ia = n(143),
        oa = r(ia),
        aa = n(264),
        sa = r(aa),
        ua = n(202),
        la = r(ua),
        fa = n(10),
        ca = r(fa),
        da = n(149),
        ha = r(da),
        pa = n(307),
        ma = r(pa),
        ya = n(334),
        va = r(ya),
        _a = n(740),
        ga = r(_a),
        ba = n(37),
        xa = r(ba),
        wa = n(0),
        Ea = r(wa),
        Sa = n(36),
        Ma = r(Sa),
        Ca = n(117),
        Ta = r(Ca),
        Ra = n(324),
        Aa = r(Ra),
        Oa = n(323),
        Pa = r(Oa),
        Da = n(339),
        Ia = r(Da),
        ka = n(151),
        Na = r(ka),
        La = n(95),
        Ba = r(La),
        Fa = n(332),
        ja = r(Fa),
        Ua = n(340),
        Va = r(Ua),
        za = n(741),
        Ga = r(za),
        Wa = n(80),
        Ha = r(Wa),
        Xa = n(286),
        Ya = r(Xa),
        qa = n(287),
        Ka = r(qa),
        Qa = n(288),
        Za = r(Qa),
        Ja = {
            Ajax: o.default,
            ArAnchorComponent: s.default,
            ArrayUtil: l.default,
            ArrayUtils: c.default,
            ArSystem: h.default,
            AtlasNode: m.default,
            AudioContext: v.default,
            BoundingBox: g.default,
            BoundingPicker: x.default,
            BoundingSphere: E.default,
            BoundingTree: M.default,
            BoundingUpdateSystem: T.default,
            BoundingVolume: A.default,
            Box: P.default,
            BufferData: I.default,
            BufferUtils: N.default,
            Bus: B.default,
            Camera: j.default,
            CameraComponent: V.default,
            CameraComponentHandler: G.default,
            CameraSystem: H.default,
            CanvasUtils: Y.default,
            Capabilities: K.default,
            Component: Z.default,
            ComponentHandler: $.default,
            Composer: te.default,
            Cone: re.default,
            ConfigHandler: oe.default,
            ContextLost: se.default,
            CrunchLoader: le.default,
            CssTransformComponent: ce.default,
            CssTransformSystem: he.default,
            Cylinder: me.default,
            DdsLoader: ve.default,
            DdsUtils: ge.default,
            DirectionalLight: xe.default,
            Disk: Ee.default,
            Dom3dComponent: Me.default,
            Dom3dComponentHandler: Te.default,
            Dom3dSystem: Ae.default,
            DynamicLoader: Pe.default,
            Easing: Ie.default,
            Entity: Ne.default,
            EntityCombiner: Be.default,
            EntityHandler: je.default,
            EntityManager: Ve.default,
            EntitySelection: Ge.default,
            EntityUtils: He.default,
            EnvironmentHandler: Ye.default,
            EtcLoader: Ke.default,
            EventTarget: Ze.default,
            FullscreenPass: $e.default,
            FullscreenUtils: tt.default,
            GameUtils: rt.default,
            GlslShaderHandler: ct.default,
            SumerianRunner: ot.default,
            Grid: st.default,
            GridRenderSystem: lt.default,
            HtmlComponent: ht.default,
            HtmlComponentHandler: mt.default,
            HtmlSystem: vt.default,
            HostAnimation: gt.default,
            HostComponent: xt.default,
            HostComponentHandler: Et.default,
            HostEmoter: Mt.default,
            HostGesturer: Tt.default,
            HostLipSyncer: At.default,
            HostPointOfInterest: Pt.default,
            HostSystem: It.default,
            JsonHandler: Nt.default,
            Light: Bt.default,
            LightComponent: jt.default,
            LightComponentHandler: Vt.default,
            LightingSystem: Gt.default,
            LineBox: Ht.default,
            LineRenderSystem: Yt.default,
            Logo: Kt.default,
            Manager: Zt.default,
            Material: $t.default,
            MaterialHandler: tn.default,
            MathUtils: rn.default,
            Matrix2: an.default,
            Matrix2x2: un.default,
            Matrix3: fn.default,
            Matrix3x3: dn.default,
            Matrix4: pn.default,
            Matrix4x4: yn.default,
            Matrix: _n.default,
            MeshBuilder: bn.default,
            MeshData: wn.default,
            MeshDataComponent: Sn.default,
            MeshDataComponentHandler: Cn.default,
            MeshDataHandler: Rn.default,
            MeshRendererComponent: On.default,
            MeshRendererComponentHandler: Dn.default,
            metrics: In.metrics,
            MovementComponent: Nn.default,
            MovementSystem: Bn.default,
            Noise: jn.default,
            ObjectUtil: Vn.default,
            ObjectUtils: Gn.default,
            OrbitCamControlScript: Hn.default,
            OscillatorSound: Yn.default,
            Particle: Kn.default,
            ParticleComponent: Zn.default,
            ParticleEmitter: $n.default,
            ParticleInfluence: tr.default,
            ParticleLib: rr.default,
            ParticlesSystem: or.default,
            ParticleSystemUtils: sr.default,
            ParticleUtils: lr.default,
            Pass: cr.default,
            PickingSystem: hr.default,
            PipRenderSystem: mr.default,
            Plane: vr.default,
            PointLight: gr.default,
            PortalComponent: xr.default,
            PortalSystem: Er.default,
            PrimitivePickLogic: Mr.default,
            ProjectHandler: Tr.default,
            PromiseUtil: Ar.default,
            PromiseUtils: Pr.default,
            PvrtcLoader: Ir.default,
            Quad: Nr.default,
            Quaternion: Br.default,
            Ray: jr.default,
            Rc4Random: Vr.default,
            Rectangle: Gr.default,
            ReflectionProbeRenderer: Hr.default,
            ReflectionProbeSystem: Yr.default,
            Renderer: Kr.default,
            RendererRecord: Zr.default,
            RendererUtils: $r.default,
            RenderInfo: ti.default,
            RenderPass: ri.default,
            RenderQueue: oi.default,
            RenderStats: si.default,
            RenderSystem: li.default,
            RenderTarget: ci.default,
            rsvp: hi.default,
            SamplerObject: mi.default,
            SceneHandler: vi.default,
            ScriptComponent: gi.default,
            Scripts: xi.default,
            ScriptSystem: Ei.default,
            ScriptUtils: Mi.default,
            Selection: Ti.default,
            Shader: Ai.default,
            ShaderBuilder: Pi.default,
            ShaderCall: Ii.default,
            ShaderCallUBO: Ni.default,
            ShaderFragment: Bi.default,
            ShaderHandler: ji.default,
            ShaderLib: Vi.default,
            ShadowHandler: Gi.default,
            ShapeCreatorMemoized: Hi.default,
            SimpleBox: Yi.default,
            SimplePartitioner: Ki.default,
            Skybox: Zi.default,
            SkyboxHandler: $i.default,
            Snow: to.default,
            Sound: ro.default,
            SoundComponent: oo.default,
            SoundComponentHandler: so.default,
            SoundCreator: lo.default,
            SoundHandler: co.default,
            SoundSystem: po.default,
            Speech: yo.default,
            SpeechComponent: _o.default,
            SpeechComponentHandler: bo.default,
            SpeechSystem: Eo.default,
            Sphere: Mo.default,
            Spline: To.default,
            SplineWalker: Ao.default,
            SpotLight: Po.default,
            Stats: Io.default,
            StringUtil: No.default,
            StringUtils: Bo.default,
            System: jo.default,
            SystemBus: Vo.default,
            SystemBusMessage: Go.default,
            TangentGenerator: Ho.default,
            TaskScheduler: Yo.default,
            TextComponent: Ko.default,
            TextSystem: Zo.default,
            Texture: $o.default,
            TextureCreator: ta.default,
            TextureGrid: ra.default,
            TextureHandler: oa.default,
            TgaLoader: sa.default,
            Torus: la.default,
            Transform: ca.default,
            TransformComponent: ha.default,
            TransformComponentHandler: ma.default,
            TransformSystem: va.default,
            ValueNoise: ga.default,
            Vector2: xa.default,
            Vector3: Ea.default,
            Vector4: Ma.default,
            Vector: Ta.default,
            VRControllerComponent: Aa.default,
            VRControllerComponentHandler: Pa.default,
            VRControllerSystem: Ia.default,
            VRCameraRigComponent: Na.default,
            VRCameraRigSystem: Ba.default,
            HMDCameraComponent: ja.default,
            HMDCameraSystem: Va.default,
            ObjectViewer: Ga.default,
            World: Ha.default,
            VRCameraRigEntityNotFoundError: Ya.default,
            VRRigNotFoundError: Ka.default,
            WebVRNotSupportedByBrowserError: Za.default
        };
    "undefined" != typeof window && (window.sumerian = Ja, window.goo = Ja), t.default = Ja
}, function(e, t, n) {
    "use strict";
    (function(e) {
        function t(e, t, n) {
            e[t] || Object[r](e, t, {
                writable: !0,
                configurable: !0,
                value: n
            })
        }
        if (n(520), n(698), n(699), e._babelPolyfill) throw new Error("only one instance of babel-polyfill is allowed");
        e._babelPolyfill = !0;
        var r = "defineProperty";
        t(String.prototype, "padLeft", "".padStart), t(String.prototype, "padRight", "".padEnd), "pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e) {
            [][e] && t(Array, e, Function.call.bind([][e]))
        })
    }).call(t, n(233))
}, function(e, t, n) {
    n(521), n(524), n(525), n(526), n(527), n(528), n(529), n(530), n(531), n(532), n(533), n(534), n(535), n(536), n(537), n(538), n(539), n(540), n(541), n(542), n(543), n(544), n(545), n(546), n(547), n(548), n(549), n(550), n(551), n(552), n(553), n(554), n(555), n(556), n(557), n(558), n(559), n(560), n(561), n(562), n(563), n(564), n(565), n(566), n(567), n(568), n(569), n(570), n(571), n(572), n(573), n(574), n(575), n(576), n(577), n(578), n(579), n(580), n(581), n(582), n(583), n(584), n(585), n(586), n(587), n(588), n(589), n(590), n(591), n(592), n(593), n(594), n(595), n(596), n(597), n(598), n(599), n(600), n(601), n(603), n(604), n(605), n(606), n(607), n(608), n(609), n(612), n(613), n(614), n(615), n(616), n(617), n(618), n(619), n(620), n(621), n(622), n(623), n(624), n(188), n(625), n(626), n(251), n(627), n(628), n(629), n(630), n(631), n(252), n(254), n(255), n(632), n(633), n(634), n(635), n(636), n(637), n(638), n(639), n(640), n(641), n(642), n(643), n(644), n(645), n(646), n(647), n(648), n(649), n(650), n(651), n(652), n(653), n(654), n(655), n(656), n(657), n(658), n(659), n(660), n(661), n(662), n(663), n(664), n(665), n(666), n(667), n(668), n(669), n(670), n(671), n(672), n(673), n(674), n(675), n(676), n(677), n(678), n(679), n(680), n(681), n(682), n(683), n(684), n(685), n(686), n(687), n(688), n(689), n(690), n(691), n(692), n(693), n(696), n(697), e.exports = n(71)
}, function(e, t, n) {
    "use strict";
    var r = n(13),
        i = n(39),
        o = n(27),
        a = n(1),
        s = n(41),
        u = n(78).KEY,
        l = n(14),
        f = n(132),
        c = n(102),
        d = n(83),
        h = n(23),
        p = n(235),
        m = n(168),
        y = n(522),
        v = n(523),
        _ = n(171),
        g = n(11),
        b = n(43),
        x = n(60),
        w = n(77),
        E = n(87),
        S = n(238),
        M = n(48),
        C = n(28),
        T = n(85),
        R = M.f,
        A = C.f,
        O = S.f,
        P = r.Symbol,
        D = r.JSON,
        I = D && D.stringify,
        k = h("_hidden"),
        N = h("toPrimitive"),
        L = {}.propertyIsEnumerable,
        B = f("symbol-registry"),
        F = f("symbols"),
        j = f("op-symbols"),
        U = Object.prototype,
        V = "function" == typeof P,
        z = r.QObject,
        G = !z || !z.prototype || !z.prototype.findChild,
        W = o && l(function() {
            return 7 != E(A({}, "a", {
                get: function() {
                    return A(this, "a", {
                        value: 7
                    }).a
                }
            })).a
        }) ? function(e, t, n) {
            var r = R(U, t);
            r && delete U[t], A(e, t, n), r && e !== U && A(U, t, r)
        } : A,
        H = function(e) {
            var t = F[e] = E(P.prototype);
            return t._k = e, t
        },
        X = V && "symbol" == typeof P.iterator ? function(e) {
            return "symbol" == typeof e
        } : function(e) {
            return e instanceof P
        },
        Y = function(e, t, n) {
            return e === U && Y(j, t, n), g(e), t = x(t, !0), g(n), i(F, t) ? (n.enumerable ? (i(e, k) && e[k][t] && (e[k][t] = !1), n = E(n, {
                enumerable: w(0, !1)
            })) : (i(e, k) || A(e, k, w(1, {})), e[k][t] = !0), W(e, t, n)) : A(e, t, n)
        },
        q = function(e, t) {
            g(e);
            for (var n, r = v(t = b(t)), i = 0, o = r.length; o > i;) Y(e, n = r[i++], t[n]);
            return e
        },
        K = function(e, t) {
            return void 0 === t ? E(e) : q(E(e), t)
        },
        Q = function(e) {
            var t = L.call(this, e = x(e, !0));
            return !(this === U && i(F, e) && !i(j, e)) && (!(t || !i(this, e) || !i(F, e) || i(this, k) && this[k][e]) || t)
        },
        Z = function(e, t) {
            if (e = b(e), t = x(t, !0), e !== U || !i(F, t) || i(j, t)) {
                var n = R(e, t);
                return !n || !i(F, t) || i(e, k) && e[k][t] || (n.enumerable = !0), n
            }
        },
        J = function(e) {
            for (var t, n = O(b(e)), r = [], o = 0; n.length > o;) i(F, t = n[o++]) || t == k || t == u || r.push(t);
            return r
        },
        $ = function(e) {
            for (var t, n = e === U, r = O(n ? j : b(e)), o = [], a = 0; r.length > a;) !i(F, t = r[a++]) || n && !i(U, t) || o.push(F[t]);
            return o
        };
    V || (P = function() {
        if (this instanceof P) throw TypeError("Symbol is not a constructor!");
        var e = d(arguments.length > 0 ? arguments[0] : void 0),
            t = function(n) {
                this === U && t.call(j, n), i(this, k) && i(this[k], e) && (this[k][e] = !1), W(this, e, w(1, n))
            };
        return o && G && W(U, e, {
            configurable: !0,
            set: t
        }), H(e)
    }, s(P.prototype, "toString", function() {
        return this._k
    }), M.f = Z, C.f = Y, n(88).f = S.f = J, n(114).f = Q, n(134).f = $, o && !n(84) && s(U, "propertyIsEnumerable", Q, !0), p.f = function(e) {
        return H(h(e))
    }), a(a.G + a.W + a.F * !V, {
        Symbol: P
    });
    for (var ee = "hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","), te = 0; ee.length > te;) h(ee[te++]);
    for (var ee = T(h.store), te = 0; ee.length > te;) m(ee[te++]);
    a(a.S + a.F * !V, "Symbol", {
        for: function(e) {
            return i(B, e += "") ? B[e] : B[e] = P(e)
        },
        keyFor: function(e) {
            if (X(e)) return y(B, e);
            throw TypeError(e + " is not a symbol!")
        },
        useSetter: function() {
            G = !0
        },
        useSimple: function() {
            G = !1
        }
    }), a(a.S + a.F * !V, "Object", {
        create: K,
        defineProperty: Y,
        defineProperties: q,
        getOwnPropertyDescriptor: Z,
        getOwnPropertyNames: J,
        getOwnPropertySymbols: $
    }), D && a(a.S + a.F * (!V || l(function() {
        var e = P();
        return "[null]" != I([e]) || "{}" != I({
            a: e
        }) || "{}" != I(Object(e))
    })), "JSON", {
        stringify: function(e) {
            if (void 0 !== e && !X(e)) {
                for (var t, n, r = [e], i = 1; arguments.length > i;) r.push(arguments[i++]);
                return t = r[1], "function" == typeof t && (n = t), !n && _(t) || (t = function(e, t) {
                    if (n && (t = n.call(this, e, t)), !X(t)) return t
                }), r[1] = t, I.apply(D, r)
            }
        }
    }), P.prototype[N] || n(40)(P.prototype, N, P.prototype.valueOf), c(P, "Symbol"), c(Math, "Math", !0), c(r.JSON, "JSON", !0)
}, function(e, t, n) {
    var r = n(85),
        i = n(43);
    e.exports = function(e, t) {
        for (var n, o = i(e), a = r(o), s = a.length, u = 0; s > u;)
            if (o[n = a[u++]] === t) return n
    }
}, function(e, t, n) {
    var r = n(85),
        i = n(134),
        o = n(114);
    e.exports = function(e) {
        var t = r(e),
            n = i.f;
        if (n)
            for (var a, s = n(e), u = o.f, l = 0; s.length > l;) u.call(e, a = s[l++]) && t.push(a);
        return t
    }
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Object", {
        create: n(87)
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S + r.F * !n(27), "Object", {
        defineProperty: n(28).f
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S + r.F * !n(27), "Object", {
        defineProperties: n(237)
    })
}, function(e, t, n) {
    var r = n(43),
        i = n(48).f;
    n(61)("getOwnPropertyDescriptor", function() {
        return function(e, t) {
            return i(r(e), t)
        }
    })
}, function(e, t, n) {
    var r = n(35),
        i = n(49);
    n(61)("getPrototypeOf", function() {
        return function(e) {
            return i(r(e))
        }
    })
}, function(e, t, n) {
    var r = n(35),
        i = n(85);
    n(61)("keys", function() {
        return function(e) {
            return i(r(e))
        }
    })
}, function(e, t, n) {
    n(61)("getOwnPropertyNames", function() {
        return n(238).f
    })
}, function(e, t, n) {
    var r = n(19),
        i = n(78).onFreeze;
    n(61)("freeze", function(e) {
        return function(t) {
            return e && r(t) ? e(i(t)) : t
        }
    })
}, function(e, t, n) {
    var r = n(19),
        i = n(78).onFreeze;
    n(61)("seal", function(e) {
        return function(t) {
            return e && r(t) ? e(i(t)) : t
        }
    })
}, function(e, t, n) {
    var r = n(19),
        i = n(78).onFreeze;
    n(61)("preventExtensions", function(e) {
        return function(t) {
            return e && r(t) ? e(i(t)) : t
        }
    })
}, function(e, t, n) {
    var r = n(19);
    n(61)("isFrozen", function(e) {
        return function(t) {
            return !r(t) || !!e && e(t)
        }
    })
}, function(e, t, n) {
    var r = n(19);
    n(61)("isSealed", function(e) {
        return function(t) {
            return !r(t) || !!e && e(t)
        }
    })
}, function(e, t, n) {
    var r = n(19);
    n(61)("isExtensible", function(e) {
        return function(t) {
            return !!r(t) && (!e || e(t))
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S + r.F, "Object", {
        assign: n(239)
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Object", {
        is: n(240)
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Object", {
        setPrototypeOf: n(173).set
    })
}, function(e, t, n) {
    "use strict";
    var r = n(115),
        i = {};
    i[n(23)("toStringTag")] = "z", i + "" != "[object z]" && n(41)(Object.prototype, "toString", function() {
        return "[object " + r(this) + "]"
    }, !0)
}, function(e, t, n) {
    var r = n(1);
    r(r.P, "Function", {
        bind: n(241)
    })
}, function(e, t, n) {
    var r = n(28).f,
        i = n(77),
        o = n(39),
        a = Function.prototype,
        s = /^\s*function ([^ (]*)/,
        u = Object.isExtensible || function() {
            return !0
        };
    "name" in a || n(27) && r(a, "name", {
        configurable: !0,
        get: function() {
            try {
                var e = this,
                    t = ("" + e).match(s)[1];
                return o(e, "name") || !u(e) || r(e, "name", i(5, t)), t
            } catch (e) {
                return ""
            }
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(19),
        i = n(49),
        o = n(23)("hasInstance"),
        a = Function.prototype;
    o in a || n(28).f(a, o, {
        value: function(e) {
            if ("function" != typeof this || !r(e)) return !1;
            if (!r(this.prototype)) return e instanceof this;
            for (; e = i(e);)
                if (this.prototype === e) return !0;
            return !1
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(242);
    r(r.G + r.F * (parseInt != i), {
        parseInt: i
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(243);
    r(r.G + r.F * (parseFloat != i), {
        parseFloat: i
    })
}, function(e, t, n) {
    "use strict";
    var r = n(13),
        i = n(39),
        o = n(53),
        a = n(175),
        s = n(60),
        u = n(14),
        l = n(88).f,
        f = n(48).f,
        c = n(28).f,
        d = n(103).trim,
        h = r.Number,
        p = h,
        m = h.prototype,
        y = "Number" == o(n(87)(m)),
        v = "trim" in String.prototype,
        _ = function(e) {
            var t = s(e, !1);
            if ("string" == typeof t && t.length > 2) {
                t = v ? t.trim() : d(t, 3);
                var n, r, i, o = t.charCodeAt(0);
                if (43 === o || 45 === o) {
                    if (88 === (n = t.charCodeAt(2)) || 120 === n) return NaN
                } else if (48 === o) {
                    switch (t.charCodeAt(1)) {
                        case 66:
                        case 98:
                            r = 2, i = 49;
                            break;
                        case 79:
                        case 111:
                            r = 8, i = 55;
                            break;
                        default:
                            return +t
                    }
                    for (var a, u = t.slice(2), l = 0, f = u.length; l < f; l++)
                        if ((a = u.charCodeAt(l)) < 48 || a > i) return NaN;
                    return parseInt(u, r)
                }
            }
            return +t
        };
    if (!h(" 0o1") || !h("0b1") || h("+0x1")) {
        h = function(e) {
            var t = arguments.length < 1 ? 0 : e,
                n = this;
            return n instanceof h && (y ? u(function() {
                m.valueOf.call(n)
            }) : "Number" != o(n)) ? a(new p(_(t)), n, h) : _(t)
        };
        for (var g, b = n(27) ? l(p) : "MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","), x = 0; b.length > x; x++) i(p, g = b[x]) && !i(h, g) && c(h, g, f(p, g));
        h.prototype = m, m.constructor = h, n(41)(r, "Number", h)
    }
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(79),
        o = n(244),
        a = n(176),
        s = 1..toFixed,
        u = Math.floor,
        l = [0, 0, 0, 0, 0, 0],
        f = "Number.toFixed: incorrect invocation!",
        c = function(e, t) {
            for (var n = -1, r = t; ++n < 6;) r += e * l[n], l[n] = r % 1e7, r = u(r / 1e7)
        },
        d = function(e) {
            for (var t = 6, n = 0; --t >= 0;) n += l[t], l[t] = u(n / e), n = n % e * 1e7
        },
        h = function() {
            for (var e = 6, t = ""; --e >= 0;)
                if ("" !== t || 0 === e || 0 !== l[e]) {
                    var n = String(l[e]);
                    t = "" === t ? n : t + a.call("0", 7 - n.length) + n
                }
            return t
        },
        p = function(e, t, n) {
            return 0 === t ? n : t % 2 == 1 ? p(e, t - 1, n * e) : p(e * e, t / 2, n)
        },
        m = function(e) {
            for (var t = 0, n = e; n >= 4096;) t += 12, n /= 4096;
            for (; n >= 2;) t += 1, n /= 2;
            return t
        };
    r(r.P + r.F * (!!s && ("0.000" !== 8e-5.toFixed(3) || "1" !== .9.toFixed(0) || "1.25" !== 1.255.toFixed(2) || "1000000000000000128" !== (0xde0b6b3a7640080).toFixed(0)) || !n(14)(function() {
        s.call({})
    })), "Number", {
        toFixed: function(e) {
            var t, n, r, s, u = o(this, f),
                l = i(e),
                y = "",
                v = "0";
            if (l < 0 || l > 20) throw RangeError(f);
            if (u != u) return "NaN";
            if (u <= -1e21 || u >= 1e21) return String(u);
            if (u < 0 && (y = "-", u = -u), u > 1e-21)
                if (t = m(u * p(2, 69, 1)) - 69, n = t < 0 ? u * p(2, -t, 1) : u / p(2, t, 1), n *= 4503599627370496, (t = 52 - t) > 0) {
                    for (c(0, n), r = l; r >= 7;) c(1e7, 0), r -= 7;
                    for (c(p(10, r, 1), 0), r = t - 1; r >= 23;) d(1 << 23), r -= 23;
                    d(1 << r), c(1, 1), d(2), v = h()
                } else c(0, n), c(1 << -t, 0), v = h() + a.call("0", l);
            return l > 0 ? (s = v.length, v = y + (s <= l ? "0." + a.call("0", l - s) + v : v.slice(0, s - l) + "." + v.slice(s - l))) : v = y + v, v
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(14),
        o = n(244),
        a = 1..toPrecision;
    r(r.P + r.F * (i(function() {
        return "1" !== a.call(1, void 0)
    }) || !i(function() {
        a.call({})
    })), "Number", {
        toPrecision: function(e) {
            var t = o(this, "Number#toPrecision: incorrect invocation!");
            return void 0 === e ? a.call(t) : a.call(t, e)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Number", {
        EPSILON: Math.pow(2, -52)
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(13).isFinite;
    r(r.S, "Number", {
        isFinite: function(e) {
            return "number" == typeof e && i(e)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Number", {
        isInteger: n(245)
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Number", {
        isNaN: function(e) {
            return e != e
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(245),
        o = Math.abs;
    r(r.S, "Number", {
        isSafeInteger: function(e) {
            return i(e) && o(e) <= 9007199254740991
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Number", {
        MAX_SAFE_INTEGER: 9007199254740991
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Number", {
        MIN_SAFE_INTEGER: -9007199254740991
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(243);
    r(r.S + r.F * (Number.parseFloat != i), "Number", {
        parseFloat: i
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(242);
    r(r.S + r.F * (Number.parseInt != i), "Number", {
        parseInt: i
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(246),
        o = Math.sqrt,
        a = Math.acosh;
    r(r.S + r.F * !(a && 710 == Math.floor(a(Number.MAX_VALUE)) && a(1 / 0) == 1 / 0), "Math", {
        acosh: function(e) {
            return (e = +e) < 1 ? NaN : e > 94906265.62425156 ? Math.log(e) + Math.LN2 : i(e - 1 + o(e - 1) * o(e + 1))
        }
    })
}, function(e, t, n) {
    function r(e) {
        return isFinite(e = +e) && 0 != e ? e < 0 ? -r(-e) : Math.log(e + Math.sqrt(e * e + 1)) : e
    }
    var i = n(1),
        o = Math.asinh;
    i(i.S + i.F * !(o && 1 / o(0) > 0), "Math", {
        asinh: r
    })
}, function(e, t, n) {
    var r = n(1),
        i = Math.atanh;
    r(r.S + r.F * !(i && 1 / i(-0) < 0), "Math", {
        atanh: function(e) {
            return 0 == (e = +e) ? e : Math.log((1 + e) / (1 - e)) / 2
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(177);
    r(r.S, "Math", {
        cbrt: function(e) {
            return i(e = +e) * Math.pow(Math.abs(e), 1 / 3)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        clz32: function(e) {
            return (e >>>= 0) ? 31 - Math.floor(Math.log(e + .5) * Math.LOG2E) : 32
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = Math.exp;
    r(r.S, "Math", {
        cosh: function(e) {
            return (i(e = +e) + i(-e)) / 2
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(178);
    r(r.S + r.F * (i != Math.expm1), "Math", {
        expm1: i
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(177),
        o = Math.pow,
        a = o(2, -52),
        s = o(2, -23),
        u = o(2, 127) * (2 - s),
        l = o(2, -126),
        f = function(e) {
            return e + 1 / a - 1 / a
        };
    r(r.S, "Math", {
        fround: function(e) {
            var t, n, r = Math.abs(e),
                o = i(e);
            return r < l ? o * f(r / l / s) * l * s : (t = (1 + s / a) * r, n = t - (t - r), n > u || n != n ? o * (1 / 0) : o * n)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = Math.abs;
    r(r.S, "Math", {
        hypot: function(e, t) {
            for (var n, r, o = 0, a = 0, s = arguments.length, u = 0; a < s;) n = i(arguments[a++]), u < n ? (r = u / n, o = o * r * r + 1, u = n) : n > 0 ? (r = n / u, o += r * r) : o += n;
            return u === 1 / 0 ? 1 / 0 : u * Math.sqrt(o)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = Math.imul;
    r(r.S + r.F * n(14)(function() {
        return -5 != i(4294967295, 5) || 2 != i.length
    }), "Math", {
        imul: function(e, t) {
            var n = +e,
                r = +t,
                i = 65535 & n,
                o = 65535 & r;
            return 0 | i * o + ((65535 & n >>> 16) * o + i * (65535 & r >>> 16) << 16 >>> 0)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        log10: function(e) {
            return Math.log(e) / Math.LN10
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        log1p: n(246)
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        log2: function(e) {
            return Math.log(e) / Math.LN2
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        sign: n(177)
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(178),
        o = Math.exp;
    r(r.S + r.F * n(14)(function() {
        return -2e-17 != !Math.sinh(-2e-17)
    }), "Math", {
        sinh: function(e) {
            return Math.abs(e = +e) < 1 ? (i(e) - i(-e)) / 2 : (o(e - 1) - o(-e - 1)) * (Math.E / 2)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(178),
        o = Math.exp;
    r(r.S, "Math", {
        tanh: function(e) {
            var t = i(e = +e),
                n = i(-e);
            return t == 1 / 0 ? 1 : n == 1 / 0 ? -1 : (t - n) / (o(e) + o(-e))
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        trunc: function(e) {
            return (e > 0 ? Math.floor : Math.ceil)(e)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(86),
        o = String.fromCharCode,
        a = String.fromCodePoint;
    r(r.S + r.F * (!!a && 1 != a.length), "String", {
        fromCodePoint: function(e) {
            for (var t, n = [], r = arguments.length, a = 0; r > a;) {
                if (t = +arguments[a++], i(t, 1114111) !== t) throw RangeError(t + " is not a valid code point");
                n.push(t < 65536 ? o(t) : o(55296 + ((t -= 65536) >> 10), t % 1024 + 56320))
            }
            return n.join("")
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(43),
        o = n(32);
    r(r.S, "String", {
        raw: function(e) {
            for (var t = i(e.raw), n = o(t.length), r = arguments.length, a = [], s = 0; n > s;) a.push(String(t[s++])), s < r && a.push(String(arguments[s]));
            return a.join("")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(103)("trim", function(e) {
        return function() {
            return e(this, 3)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(179)(!0);
    n(180)(String, "String", function(e) {
        this._t = String(e), this._i = 0
    }, function() {
        var e, t = this._t,
            n = this._i;
        return n >= t.length ? {
            value: void 0,
            done: !0
        } : (e = r(t, n), this._i += e.length, {
            value: e,
            done: !1
        })
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(179)(!1);
    r(r.P, "String", {
        codePointAt: function(e) {
            return i(this, e)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(32),
        o = n(182),
        a = "".endsWith;
    r(r.P + r.F * n(183)("endsWith"), "String", {
        endsWith: function(e) {
            var t = o(this, e, "endsWith"),
                n = arguments.length > 1 ? arguments[1] : void 0,
                r = i(t.length),
                s = void 0 === n ? r : Math.min(i(n), r),
                u = String(e);
            return a ? a.call(t, u, s) : t.slice(s - u.length, s) === u
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(182);
    r(r.P + r.F * n(183)("includes"), "String", {
        includes: function(e) {
            return !!~i(this, e, "includes").indexOf(e, arguments.length > 1 ? arguments[1] : void 0)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.P, "String", {
        repeat: n(176)
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(32),
        o = n(182),
        a = "".startsWith;
    r(r.P + r.F * n(183)("startsWith"), "String", {
        startsWith: function(e) {
            var t = o(this, e, "startsWith"),
                n = i(Math.min(arguments.length > 1 ? arguments[1] : void 0, t.length)),
                r = String(e);
            return a ? a.call(t, r, n) : t.slice(n, n + r.length) === r
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("anchor", function(e) {
        return function(t) {
            return e(this, "a", "name", t)
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("big", function(e) {
        return function() {
            return e(this, "big", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("blink", function(e) {
        return function() {
            return e(this, "blink", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("bold", function(e) {
        return function() {
            return e(this, "b", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("fixed", function(e) {
        return function() {
            return e(this, "tt", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("fontcolor", function(e) {
        return function(t) {
            return e(this, "font", "color", t)
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("fontsize", function(e) {
        return function(t) {
            return e(this, "font", "size", t)
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("italics", function(e) {
        return function() {
            return e(this, "i", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("link", function(e) {
        return function(t) {
            return e(this, "a", "href", t)
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("small", function(e) {
        return function() {
            return e(this, "small", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("strike", function(e) {
        return function() {
            return e(this, "strike", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("sub", function(e) {
        return function() {
            return e(this, "sub", "", "")
        }
    })
}, function(e, t, n) {
    "use strict";
    n(44)("sup", function(e) {
        return function() {
            return e(this, "sup", "", "")
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Date", {
        now: function() {
            return (new Date).getTime()
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(35),
        o = n(60);
    r(r.P + r.F * n(14)(function() {
        return null !== new Date(NaN).toJSON() || 1 !== Date.prototype.toJSON.call({
            toISOString: function() {
                return 1
            }
        })
    }), "Date", {
        toJSON: function(e) {
            var t = i(this),
                n = o(t);
            return "number" != typeof n || isFinite(n) ? t.toISOString() : null
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(14),
        o = Date.prototype.getTime,
        a = function(e) {
            return e > 9 ? e : "0" + e
        };
    r(r.P + r.F * (i(function() {
        return "0385-07-25T07:06:39.999Z" != new Date(-5e13 - 1).toISOString()
    }) || !i(function() {
        new Date(NaN).toISOString()
    })), "Date", {
        toISOString: function() {
            if (!isFinite(o.call(this))) throw RangeError("Invalid time value");
            var e = this,
                t = e.getUTCFullYear(),
                n = e.getUTCMilliseconds(),
                r = t < 0 ? "-" : t > 9999 ? "+" : "";
            return r + ("00000" + Math.abs(t)).slice(r ? -6 : -4) + "-" + a(e.getUTCMonth() + 1) + "-" + a(e.getUTCDate()) + "T" + a(e.getUTCHours()) + ":" + a(e.getUTCMinutes()) + ":" + a(e.getUTCSeconds()) + "." + (n > 99 ? n : "0" + a(n)) + "Z"
        }
    })
}, function(e, t, n) {
    var r = Date.prototype,
        i = r.toString,
        o = r.getTime;
    new Date(NaN) + "" != "Invalid Date" && n(41)(r, "toString", function() {
        var e = o.call(this);
        return e === e ? i.call(this) : "Invalid Date"
    })
}, function(e, t, n) {
    var r = n(23)("toPrimitive"),
        i = Date.prototype;
    r in i || n(40)(i, r, n(602))
}, function(e, t, n) {
    "use strict";
    var r = n(11),
        i = n(60);
    e.exports = function(e) {
        if ("string" !== e && "number" !== e && "default" !== e) throw TypeError("Incorrect hint");
        return i(r(this), "number" != e)
    }
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Array", {
        isArray: n(171)
    })
}, function(e, t, n) {
    "use strict";
    var r = n(72),
        i = n(1),
        o = n(35),
        a = n(247),
        s = n(184),
        u = n(32),
        l = n(185),
        f = n(186);
    i(i.S + i.F * !n(137)(function(e) {
        Array.from(e)
    }), "Array", {
        from: function(e) {
            var t, n, i, c, d = o(e),
                h = "function" == typeof this ? this : Array,
                p = arguments.length,
                m = p > 1 ? arguments[1] : void 0,
                y = void 0 !== m,
                v = 0,
                _ = f(d);
            if (y && (m = r(m, p > 2 ? arguments[2] : void 0, 2)), void 0 == _ || h == Array && s(_))
                for (t = u(d.length), n = new h(t); t > v; v++) l(n, v, y ? m(d[v], v) : d[v]);
            else
                for (c = _.call(d), n = new h; !(i = c.next()).done; v++) l(n, v, y ? a(c, m, [i.value, v], !0) : i.value);
            return n.length = v, n
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(185);
    r(r.S + r.F * n(14)(function() {
        function e() {}
        return !(Array.of.call(e) instanceof e)
    }), "Array", { of: function() {
            for (var e = 0, t = arguments.length, n = new("function" == typeof this ? this : Array)(t); t > e;) i(n, e, arguments[e++]);
            return n.length = t, n
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(43),
        o = [].join;
    r(r.P + r.F * (n(113) != Object || !n(55)(o)), "Array", {
        join: function(e) {
            return o.call(i(this), void 0 === e ? "," : e)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(172),
        o = n(53),
        a = n(86),
        s = n(32),
        u = [].slice;
    r(r.P + r.F * n(14)(function() {
        i && u.call(i)
    }), "Array", {
        slice: function(e, t) {
            var n = s(this.length),
                r = o(this);
            if (t = void 0 === t ? n : t, "Array" == r) return u.call(this, e, t);
            for (var i = a(e, n), l = a(t, n), f = s(l - i), c = Array(f), d = 0; d < f; d++) c[d] = "String" == r ? this.charAt(i + d) : this[i + d];
            return c
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(42),
        o = n(35),
        a = n(14),
        s = [].sort,
        u = [1, 2, 3];
    r(r.P + r.F * (a(function() {
        u.sort(void 0)
    }) || !a(function() {
        u.sort(null)
    }) || !n(55)(s)), "Array", {
        sort: function(e) {
            return void 0 === e ? s.call(o(this)) : s.call(o(this), i(e))
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(0),
        o = n(55)([].forEach, !0);
    r(r.P + r.F * !o, "Array", {
        forEach: function(e) {
            return i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    var r = n(611);
    e.exports = function(e, t) {
        return new(r(e))(t)
    }
}, function(e, t, n) {
    var r = n(19),
        i = n(171),
        o = n(23)("species");
    e.exports = function(e) {
        var t;
        return i(e) && (t = e.constructor, "function" != typeof t || t !== Array && !i(t.prototype) || (t = void 0), r(t) && null === (t = t[o]) && (t = void 0)), void 0 === t ? Array : t
    }
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(1);
    r(r.P + r.F * !n(55)([].map, !0), "Array", {
        map: function(e) {
            return i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(2);
    r(r.P + r.F * !n(55)([].filter, !0), "Array", {
        filter: function(e) {
            return i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(3);
    r(r.P + r.F * !n(55)([].some, !0), "Array", {
        some: function(e) {
            return i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(4);
    r(r.P + r.F * !n(55)([].every, !0), "Array", {
        every: function(e) {
            return i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(248);
    r(r.P + r.F * !n(55)([].reduce, !0), "Array", {
        reduce: function(e) {
            return i(this, e, arguments.length, arguments[1], !1)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(248);
    r(r.P + r.F * !n(55)([].reduceRight, !0), "Array", {
        reduceRight: function(e) {
            return i(this, e, arguments.length, arguments[1], !0)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(133)(!1),
        o = [].indexOf,
        a = !!o && 1 / [1].indexOf(1, -0) < 0;
    r(r.P + r.F * (a || !n(55)(o)), "Array", {
        indexOf: function(e) {
            return a ? o.apply(this, arguments) || 0 : i(this, e, arguments[1])
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(43),
        o = n(79),
        a = n(32),
        s = [].lastIndexOf,
        u = !!s && 1 / [1].lastIndexOf(1, -0) < 0;
    r(r.P + r.F * (u || !n(55)(s)), "Array", {
        lastIndexOf: function(e) {
            if (u) return s.apply(this, arguments) || 0;
            var t = i(this),
                n = a(t.length),
                r = n - 1;
            for (arguments.length > 1 && (r = Math.min(r, o(arguments[1]))), r < 0 && (r = n + r); r >= 0; r--)
                if (r in t && t[r] === e) return r || 0;
            return -1
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.P, "Array", {
        copyWithin: n(249)
    }), n(105)("copyWithin")
}, function(e, t, n) {
    var r = n(1);
    r(r.P, "Array", {
        fill: n(187)
    }), n(105)("fill")
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(5),
        o = !0;
    "find" in [] && Array(1).find(function() {
        o = !1
    }), r(r.P + r.F * o, "Array", {
        find: function(e) {
            return i(this, e, arguments.length > 1 ? arguments[1] : void 0)
        }
    }), n(105)("find")
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(62)(6),
        o = "findIndex",
        a = !0;
    o in [] && Array(1)[o](function() {
        a = !1
    }), r(r.P + r.F * a, "Array", {
        findIndex: function(e) {
            return i(this, e, arguments.length > 1 ? arguments[1] : void 0)
        }
    }), n(105)(o)
}, function(e, t, n) {
    n(89)("Array")
}, function(e, t, n) {
    var r = n(13),
        i = n(175),
        o = n(28).f,
        a = n(88).f,
        s = n(136),
        u = n(138),
        l = r.RegExp,
        f = l,
        c = l.prototype,
        d = /a/g,
        h = /a/g,
        p = new l(d) !== d;
    if (n(27) && (!p || n(14)(function() {
            return h[n(23)("match")] = !1, l(d) != d || l(h) == h || "/a/i" != l(d, "i")
        }))) {
        l = function(e, t) {
            var n = this instanceof l,
                r = s(e),
                o = void 0 === t;
            return !n && r && e.constructor === l && o ? e : i(p ? new f(r && !o ? e.source : e, t) : f((r = e instanceof l) ? e.source : e, r && o ? u.call(e) : t), n ? this : c, l)
        };
        for (var m = a(f), y = 0; m.length > y;) ! function(e) {
            e in l || o(l, e, {
                configurable: !0,
                get: function() {
                    return f[e]
                },
                set: function(t) {
                    f[e] = t
                }
            })
        }(m[y++]);
        c.constructor = l, l.prototype = c, n(41)(r, "RegExp", l)
    }
    n(89)("RegExp")
}, function(e, t, n) {
    "use strict";
    n(251);
    var r = n(11),
        i = n(138),
        o = n(27),
        a = /./.toString,
        s = function(e) {
            n(41)(RegExp.prototype, "toString", e, !0)
        };
    n(14)(function() {
        return "/a/b" != a.call({
            source: "a",
            flags: "b"
        })
    }) ? s(function() {
        var e = r(this);
        return "/".concat(e.source, "/", "flags" in e ? e.flags : !o && e instanceof RegExp ? i.call(e) : void 0)
    }) : "toString" != a.name && s(function() {
        return a.call(this)
    })
}, function(e, t, n) {
    n(139)("match", 1, function(e, t, n) {
        return [function(n) {
            "use strict";
            var r = e(this),
                i = void 0 == n ? void 0 : n[t];
            return void 0 !== i ? i.call(n, r) : new RegExp(n)[t](String(r))
        }, n]
    })
}, function(e, t, n) {
    n(139)("replace", 2, function(e, t, n) {
        return [function(r, i) {
            "use strict";
            var o = e(this),
                a = void 0 == r ? void 0 : r[t];
            return void 0 !== a ? a.call(r, o, i) : n.call(String(o), r, i)
        }, n]
    })
}, function(e, t, n) {
    n(139)("search", 1, function(e, t, n) {
        return [function(n) {
            "use strict";
            var r = e(this),
                i = void 0 == n ? void 0 : n[t];
            return void 0 !== i ? i.call(n, r) : new RegExp(n)[t](String(r))
        }, n]
    })
}, function(e, t, n) {
    n(139)("split", 2, function(e, t, r) {
        "use strict";
        var i = n(136),
            o = r,
            a = [].push,
            s = "length";
        if ("c" == "abbc".split(/(b)*/)[1] || 4 != "test".split(/(?:)/, -1)[s] || 2 != "ab".split(/(?:ab)*/)[s] || 4 != ".".split(/(.?)(.?)/)[s] || ".".split(/()()/)[s] > 1 || "".split(/.?/)[s]) {
            var u = void 0 === /()??/.exec("")[1];
            r = function(e, t) {
                var n = String(this);
                if (void 0 === e && 0 === t) return [];
                if (!i(e)) return o.call(n, e, t);
                var r, l, f, c, d, h = [],
                    p = (e.ignoreCase ? "i" : "") + (e.multiline ? "m" : "") + (e.unicode ? "u" : "") + (e.sticky ? "y" : ""),
                    m = 0,
                    y = void 0 === t ? 4294967295 : t >>> 0,
                    v = new RegExp(e.source, p + "g");
                for (u || (r = new RegExp("^" + v.source + "$(?!\\s)", p));
                    (l = v.exec(n)) && !((f = l.index + l[0][s]) > m && (h.push(n.slice(m, l.index)), !u && l[s] > 1 && l[0].replace(r, function() {
                        for (d = 1; d < arguments[s] - 2; d++) void 0 === arguments[d] && (l[d] = void 0)
                    }), l[s] > 1 && l.index < n[s] && a.apply(h, l.slice(1)), c = l[0][s], m = f, h[s] >= y));) v.lastIndex === l.index && v.lastIndex++;
                return m === n[s] ? !c && v.test("") || h.push("") : h.push(n.slice(m)), h[s] > y ? h.slice(0, y) : h
            }
        } else "0".split(void 0, 0)[s] && (r = function(e, t) {
            return void 0 === e && 0 === t ? [] : o.call(this, e, t)
        });
        return [function(n, i) {
            var o = e(this),
                a = void 0 == n ? void 0 : n[t];
            return void 0 !== a ? a.call(n, o, i) : r.call(String(o), n, i)
        }, r]
    })
}, function(e, t, n) {
    "use strict";
    var r, i, o, a = n(84),
        s = n(13),
        u = n(72),
        l = n(115),
        f = n(1),
        c = n(19),
        d = n(42),
        h = n(90),
        p = n(106),
        m = n(189),
        y = n(190).set,
        v = n(191)(),
        _ = s.TypeError,
        g = s.process,
        b = s.Promise,
        g = s.process,
        x = "process" == l(g),
        w = function() {},
        E = !! function() {
            try {
                var e = b.resolve(1),
                    t = (e.constructor = {})[n(23)("species")] = function(e) {
                        e(w, w)
                    };
                return (x || "function" == typeof PromiseRejectionEvent) && e.then(w) instanceof t
            } catch (e) {}
        }(),
        S = function(e, t) {
            return e === t || e === b && t === o
        },
        M = function(e) {
            var t;
            return !(!c(e) || "function" != typeof(t = e.then)) && t
        },
        C = function(e) {
            return S(b, e) ? new T(e) : new i(e)
        },
        T = i = function(e) {
            var t, n;
            this.promise = new e(function(e, r) {
                if (void 0 !== t || void 0 !== n) throw _("Bad Promise constructor");
                t = e, n = r
            }), this.resolve = d(t), this.reject = d(n)
        },
        R = function(e) {
            try {
                e()
            } catch (e) {
                return {
                    error: e
                }
            }
        },
        A = function(e, t) {
            if (!e._n) {
                e._n = !0;
                var n = e._c;
                v(function() {
                    for (var r = e._v, i = 1 == e._s, o = 0; n.length > o;) ! function(t) {
                        var n, o, a = i ? t.ok : t.fail,
                            s = t.resolve,
                            u = t.reject,
                            l = t.domain;
                        try {
                            a ? (i || (2 == e._h && D(e), e._h = 1), !0 === a ? n = r : (l && l.enter(), n = a(r), l && l.exit()), n === t.promise ? u(_("Promise-chain cycle")) : (o = M(n)) ? o.call(n, s, u) : s(n)) : u(r)
                        } catch (e) {
                            u(e)
                        }
                    }(n[o++]);
                    e._c = [], e._n = !1, t && !e._h && O(e)
                })
            }
        },
        O = function(e) {
            y.call(s, function() {
                var t, n, r, i = e._v;
                if (P(e) && (t = R(function() {
                        x ? g.emit("unhandledRejection", i, e) : (n = s.onunhandledrejection) ? n({
                            promise: e,
                            reason: i
                        }) : (r = s.console) && r.error && r.error("Unhandled promise rejection", i)
                    }), e._h = x || P(e) ? 2 : 1), e._a = void 0, t) throw t.error
            })
        },
        P = function(e) {
            if (1 == e._h) return !1;
            for (var t, n = e._a || e._c, r = 0; n.length > r;)
                if (t = n[r++], t.fail || !P(t.promise)) return !1;
            return !0
        },
        D = function(e) {
            y.call(s, function() {
                var t;
                x ? g.emit("rejectionHandled", e) : (t = s.onrejectionhandled) && t({
                    promise: e,
                    reason: e._v
                })
            })
        },
        I = function(e) {
            var t = this;
            t._d || (t._d = !0, t = t._w || t, t._v = e, t._s = 2, t._a || (t._a = t._c.slice()), A(t, !0))
        },
        k = function(e) {
            var t, n = this;
            if (!n._d) {
                n._d = !0, n = n._w || n;
                try {
                    if (n === e) throw _("Promise can't be resolved itself");
                    (t = M(e)) ? v(function() {
                        var r = {
                            _w: n,
                            _d: !1
                        };
                        try {
                            t.call(e, u(k, r, 1), u(I, r, 1))
                        } catch (e) {
                            I.call(r, e)
                        }
                    }): (n._v = e, n._s = 1, A(n, !1))
                } catch (e) {
                    I.call({
                        _w: n,
                        _d: !1
                    }, e)
                }
            }
        };
    E || (b = function(e) {
        h(this, b, "Promise", "_h"), d(e), r.call(this);
        try {
            e(u(k, this, 1), u(I, this, 1))
        } catch (e) {
            I.call(this, e)
        }
    }, r = function(e) {
        this._c = [], this._a = void 0, this._s = 0, this._d = !1, this._v = void 0, this._h = 0, this._n = !1
    }, r.prototype = n(91)(b.prototype, {
        then: function(e, t) {
            var n = C(m(this, b));
            return n.ok = "function" != typeof e || e, n.fail = "function" == typeof t && t, n.domain = x ? g.domain : void 0, this._c.push(n), this._a && this._a.push(n), this._s && A(this, !1), n.promise
        },
        catch: function(e) {
            return this.then(void 0, e)
        }
    }), T = function() {
        var e = new r;
        this.promise = e, this.resolve = u(k, e, 1), this.reject = u(I, e, 1)
    }), f(f.G + f.W + f.F * !E, {
        Promise: b
    }), n(102)(b, "Promise"), n(89)("Promise"), o = n(71).Promise, f(f.S + f.F * !E, "Promise", {
        reject: function(e) {
            var t = C(this);
            return (0, t.reject)(e), t.promise
        }
    }), f(f.S + f.F * (a || !E), "Promise", {
        resolve: function(e) {
            if (e instanceof b && S(e.constructor, this)) return e;
            var t = C(this);
            return (0, t.resolve)(e), t.promise
        }
    }), f(f.S + f.F * !(E && n(137)(function(e) {
        b.all(e).catch(w)
    })), "Promise", {
        all: function(e) {
            var t = this,
                n = C(t),
                r = n.resolve,
                i = n.reject,
                o = R(function() {
                    var n = [],
                        o = 0,
                        a = 1;
                    p(e, !1, function(e) {
                        var s = o++,
                            u = !1;
                        n.push(void 0), a++, t.resolve(e).then(function(e) {
                            u || (u = !0, n[s] = e, --a || r(n))
                        }, i)
                    }), --a || r(n)
                });
            return o && i(o.error), n.promise
        },
        race: function(e) {
            var t = this,
                n = C(t),
                r = n.reject,
                i = R(function() {
                    p(e, !1, function(e) {
                        t.resolve(e).then(n.resolve, r)
                    })
                });
            return i && r(i.error), n.promise
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(256);
    n(140)("WeakSet", function(e) {
        return function() {
            return e(this, arguments.length > 0 ? arguments[0] : void 0)
        }
    }, {
        add: function(e) {
            return r.def(this, e, !0)
        }
    }, r, !1, !0)
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(141),
        o = n(192),
        a = n(11),
        s = n(86),
        u = n(32),
        l = n(19),
        f = n(13).ArrayBuffer,
        c = n(189),
        d = o.ArrayBuffer,
        h = o.DataView,
        p = i.ABV && f.isView,
        m = d.prototype.slice,
        y = i.VIEW;
    r(r.G + r.W + r.F * (f !== d), {
        ArrayBuffer: d
    }), r(r.S + r.F * !i.CONSTR, "ArrayBuffer", {
        isView: function(e) {
            return p && p(e) || l(e) && y in e
        }
    }), r(r.P + r.U + r.F * n(14)(function() {
        return !new d(2).slice(1, void 0).byteLength
    }), "ArrayBuffer", {
        slice: function(e, t) {
            if (void 0 !== m && void 0 === t) return m.call(a(this), e);
            for (var n = a(this).byteLength, r = s(e, n), i = s(void 0 === t ? n : t, n), o = new(c(this, d))(u(i - r)), l = new h(this), f = new h(o), p = 0; r < i;) f.setUint8(p++, l.getUint8(r++));
            return o
        }
    }), n(89)("ArrayBuffer")
}, function(e, t, n) {
    var r = n(1);
    r(r.G + r.W + r.F * !n(141).ABV, {
        DataView: n(192).DataView
    })
}, function(e, t, n) {
    n(73)("Int8", 1, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Uint8", 1, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Uint8", 1, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    }, !0)
}, function(e, t, n) {
    n(73)("Int16", 2, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Uint16", 2, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Int32", 4, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Uint32", 4, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Float32", 4, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    n(73)("Float64", 8, function(e) {
        return function(t, n, r) {
            return e(this, t, n, r)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(42),
        o = n(11),
        a = (n(13).Reflect || {}).apply,
        s = Function.apply;
    r(r.S + r.F * !n(14)(function() {
        a(function() {})
    }), "Reflect", {
        apply: function(e, t, n) {
            var r = i(e),
                u = o(n);
            return a ? a(r, t, u) : s.call(r, t, u)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(87),
        o = n(42),
        a = n(11),
        s = n(19),
        u = n(14),
        l = n(241),
        f = (n(13).Reflect || {}).construct,
        c = u(function() {
            function e() {}
            return !(f(function() {}, [], e) instanceof e)
        }),
        d = !u(function() {
            f(function() {})
        });
    r(r.S + r.F * (c || d), "Reflect", {
        construct: function(e, t) {
            o(e), a(t);
            var n = arguments.length < 3 ? e : o(arguments[2]);
            if (d && !c) return f(e, t, n);
            if (e == n) {
                switch (t.length) {
                    case 0:
                        return new e;
                    case 1:
                        return new e(t[0]);
                    case 2:
                        return new e(t[0], t[1]);
                    case 3:
                        return new e(t[0], t[1], t[2]);
                    case 4:
                        return new e(t[0], t[1], t[2], t[3])
                }
                var r = [null];
                return r.push.apply(r, t), new(l.apply(e, r))
            }
            var u = n.prototype,
                h = i(s(u) ? u : Object.prototype),
                p = Function.apply.call(e, h, t);
            return s(p) ? p : h
        }
    })
}, function(e, t, n) {
    var r = n(28),
        i = n(1),
        o = n(11),
        a = n(60);
    i(i.S + i.F * n(14)(function() {
        Reflect.defineProperty(r.f({}, 1, {
            value: 1
        }), 1, {
            value: 2
        })
    }), "Reflect", {
        defineProperty: function(e, t, n) {
            o(e), t = a(t, !0), o(n);
            try {
                return r.f(e, t, n), !0
            } catch (e) {
                return !1
            }
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(48).f,
        o = n(11);
    r(r.S, "Reflect", {
        deleteProperty: function(e, t) {
            var n = i(o(e), t);
            return !(n && !n.configurable) && delete e[t]
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(11),
        o = function(e) {
            this._t = i(e), this._i = 0;
            var t, n = this._k = [];
            for (t in e) n.push(t)
        };
    n(181)(o, "Object", function() {
        var e, t = this,
            n = t._k;
        do {
            if (t._i >= n.length) return {
                value: void 0,
                done: !0
            }
        } while (!((e = n[t._i++]) in t._t));
        return {
            value: e,
            done: !1
        }
    }), r(r.S, "Reflect", {
        enumerate: function(e) {
            return new o(e)
        }
    })
}, function(e, t, n) {
    function r(e, t) {
        var n, s, f = arguments.length < 3 ? e : arguments[2];
        return l(e) === f ? e[t] : (n = i.f(e, t)) ? a(n, "value") ? n.value : void 0 !== n.get ? n.get.call(f) : void 0 : u(s = o(e)) ? r(s, t, f) : void 0
    }
    var i = n(48),
        o = n(49),
        a = n(39),
        s = n(1),
        u = n(19),
        l = n(11);
    s(s.S, "Reflect", {
        get: r
    })
}, function(e, t, n) {
    var r = n(48),
        i = n(1),
        o = n(11);
    i(i.S, "Reflect", {
        getOwnPropertyDescriptor: function(e, t) {
            return r.f(o(e), t)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(49),
        o = n(11);
    r(r.S, "Reflect", {
        getPrototypeOf: function(e) {
            return i(o(e))
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Reflect", {
        has: function(e, t) {
            return t in e
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(11),
        o = Object.isExtensible;
    r(r.S, "Reflect", {
        isExtensible: function(e) {
            return i(e), !o || o(e)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Reflect", {
        ownKeys: n(257)
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(11),
        o = Object.preventExtensions;
    r(r.S, "Reflect", {
        preventExtensions: function(e) {
            i(e);
            try {
                return o && o(e), !0
            } catch (e) {
                return !1
            }
        }
    })
}, function(e, t, n) {
    function r(e, t, n) {
        var u, d, h = arguments.length < 4 ? e : arguments[3],
            p = o.f(f(e), t);
        if (!p) {
            if (c(d = a(e))) return r(d, t, n, h);
            p = l(0)
        }
        return s(p, "value") ? !(!1 === p.writable || !c(h)) && (u = o.f(h, t) || l(0), u.value = n, i.f(h, t, u), !0) : void 0 !== p.set && (p.set.call(h, n), !0)
    }
    var i = n(28),
        o = n(48),
        a = n(49),
        s = n(39),
        u = n(1),
        l = n(77),
        f = n(11),
        c = n(19);
    u(u.S, "Reflect", {
        set: r
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(173);
    i && r(r.S, "Reflect", {
        setPrototypeOf: function(e, t) {
            i.check(e, t);
            try {
                return i.set(e, t), !0
            } catch (e) {
                return !1
            }
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(133)(!0);
    r(r.P, "Array", {
        includes: function(e) {
            return i(this, e, arguments.length > 1 ? arguments[1] : void 0)
        }
    }), n(105)("includes")
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(179)(!0);
    r(r.P, "String", {
        at: function(e) {
            return i(this, e)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(258);
    r(r.P, "String", {
        padStart: function(e) {
            return i(this, e, arguments.length > 1 ? arguments[1] : void 0, !0)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(258);
    r(r.P, "String", {
        padEnd: function(e) {
            return i(this, e, arguments.length > 1 ? arguments[1] : void 0, !1)
        }
    })
}, function(e, t, n) {
    "use strict";
    n(103)("trimLeft", function(e) {
        return function() {
            return e(this, 1)
        }
    }, "trimStart")
}, function(e, t, n) {
    "use strict";
    n(103)("trimRight", function(e) {
        return function() {
            return e(this, 2)
        }
    }, "trimEnd")
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(54),
        o = n(32),
        a = n(136),
        s = n(138),
        u = RegExp.prototype,
        l = function(e, t) {
            this._r = e, this._s = t
        };
    n(181)(l, "RegExp String", function() {
        var e = this._r.exec(this._s);
        return {
            value: e,
            done: null === e
        }
    }), r(r.P, "String", {
        matchAll: function(e) {
            if (i(this), !a(e)) throw TypeError(e + " is not a regexp!");
            var t = String(this),
                n = "flags" in u ? String(e.flags) : s.call(e),
                r = new RegExp(e.source, ~n.indexOf("g") ? n : "g" + n);
            return r.lastIndex = o(e.lastIndex), new l(r, t)
        }
    })
}, function(e, t, n) {
    n(168)("asyncIterator")
}, function(e, t, n) {
    n(168)("observable")
}, function(e, t, n) {
    var r = n(1),
        i = n(257),
        o = n(43),
        a = n(48),
        s = n(185);
    r(r.S, "Object", {
        getOwnPropertyDescriptors: function(e) {
            for (var t, n = o(e), r = a.f, u = i(n), l = {}, f = 0; u.length > f;) s(l, t = u[f++], r(n, t));
            return l
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(259)(!1);
    r(r.S, "Object", {
        values: function(e) {
            return i(e)
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(259)(!0);
    r(r.S, "Object", {
        entries: function(e) {
            return i(e)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(35),
        o = n(42),
        a = n(28);
    n(27) && r(r.P + n(142), "Object", {
        __defineGetter__: function(e, t) {
            a.f(i(this), e, {
                get: o(t),
                enumerable: !0,
                configurable: !0
            })
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(35),
        o = n(42),
        a = n(28);
    n(27) && r(r.P + n(142), "Object", {
        __defineSetter__: function(e, t) {
            a.f(i(this), e, {
                set: o(t),
                enumerable: !0,
                configurable: !0
            })
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(35),
        o = n(60),
        a = n(49),
        s = n(48).f;
    n(27) && r(r.P + n(142), "Object", {
        __lookupGetter__: function(e) {
            var t, n = i(this),
                r = o(e, !0);
            do {
                if (t = s(n, r)) return t.get
            } while (n = a(n))
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(35),
        o = n(60),
        a = n(49),
        s = n(48).f;
    n(27) && r(r.P + n(142), "Object", {
        __lookupSetter__: function(e) {
            var t, n = i(this),
                r = o(e, !0);
            do {
                if (t = s(n, r)) return t.set
            } while (n = a(n))
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.P + r.R, "Map", {
        toJSON: n(260)("Map")
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.P + r.R, "Set", {
        toJSON: n(260)("Set")
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "System", {
        global: n(13)
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(53);
    r(r.S, "Error", {
        isError: function(e) {
            return "Error" === i(e)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        iaddh: function(e, t, n, r) {
            var i = e >>> 0,
                o = t >>> 0,
                a = n >>> 0;
            return o + (r >>> 0) + ((i & a | (i | a) & ~(i + a >>> 0)) >>> 31) | 0
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        isubh: function(e, t, n, r) {
            var i = e >>> 0,
                o = t >>> 0,
                a = n >>> 0;
            return o - (r >>> 0) - ((~i & a | ~(i ^ a) & i - a >>> 0) >>> 31) | 0
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        imulh: function(e, t) {
            var n = +e,
                r = +t,
                i = 65535 & n,
                o = 65535 & r,
                a = n >> 16,
                s = r >> 16,
                u = (a * o >>> 0) + (i * o >>> 16);
            return a * s + (u >> 16) + ((i * s >>> 0) + (65535 & u) >> 16)
        }
    })
}, function(e, t, n) {
    var r = n(1);
    r(r.S, "Math", {
        umulh: function(e, t) {
            var n = +e,
                r = +t,
                i = 65535 & n,
                o = 65535 & r,
                a = n >>> 16,
                s = r >>> 16,
                u = (a * o >>> 0) + (i * o >>> 16);
            return a * s + (u >>> 16) + ((i * s >>> 0) + (65535 & u) >>> 16)
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = r.key,
        a = r.set;
    r.exp({
        defineMetadata: function(e, t, n, r) {
            a(e, t, i(n), o(r))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = r.key,
        a = r.map,
        s = r.store;
    r.exp({
        deleteMetadata: function(e, t) {
            var n = arguments.length < 3 ? void 0 : o(arguments[2]),
                r = a(i(t), n, !1);
            if (void 0 === r || !r.delete(e)) return !1;
            if (r.size) return !0;
            var u = s.get(t);
            return u.delete(n), !!u.size || s.delete(t)
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = n(49),
        a = r.has,
        s = r.get,
        u = r.key,
        l = function(e, t, n) {
            if (a(e, t, n)) return s(e, t, n);
            var r = o(t);
            return null !== r ? l(e, r, n) : void 0
        };
    r.exp({
        getMetadata: function(e, t) {
            return l(e, i(t), arguments.length < 3 ? void 0 : u(arguments[2]))
        }
    })
}, function(e, t, n) {
    var r = n(254),
        i = n(261),
        o = n(74),
        a = n(11),
        s = n(49),
        u = o.keys,
        l = o.key,
        f = function(e, t) {
            var n = u(e, t),
                o = s(e);
            if (null === o) return n;
            var a = f(o, t);
            return a.length ? n.length ? i(new r(n.concat(a))) : a : n
        };
    o.exp({
        getMetadataKeys: function(e) {
            return f(a(e), arguments.length < 2 ? void 0 : l(arguments[1]))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = r.get,
        a = r.key;
    r.exp({
        getOwnMetadata: function(e, t) {
            return o(e, i(t), arguments.length < 3 ? void 0 : a(arguments[2]))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = r.keys,
        a = r.key;
    r.exp({
        getOwnMetadataKeys: function(e) {
            return o(i(e), arguments.length < 2 ? void 0 : a(arguments[1]))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = n(49),
        a = r.has,
        s = r.key,
        u = function(e, t, n) {
            if (a(e, t, n)) return !0;
            var r = o(t);
            return null !== r && u(e, r, n)
        };
    r.exp({
        hasMetadata: function(e, t) {
            return u(e, i(t), arguments.length < 3 ? void 0 : s(arguments[2]))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = r.has,
        a = r.key;
    r.exp({
        hasOwnMetadata: function(e, t) {
            return o(e, i(t), arguments.length < 3 ? void 0 : a(arguments[2]))
        }
    })
}, function(e, t, n) {
    var r = n(74),
        i = n(11),
        o = n(42),
        a = r.key,
        s = r.set;
    r.exp({
        metadata: function(e, t) {
            return function(n, r) {
                s(e, t, (void 0 !== r ? i : o)(n), a(r))
            }
        }
    })
}, function(e, t, n) {
    var r = n(1),
        i = n(191)(),
        o = n(13).process,
        a = "process" == n(53)(o);
    r(r.G, {
        asap: function(e) {
            var t = a && o.domain;
            i(t ? t.bind(e) : e)
        }
    })
}, function(e, t, n) {
    "use strict";
    var r = n(1),
        i = n(13),
        o = n(71),
        a = n(191)(),
        s = n(23)("observable"),
        u = n(42),
        l = n(11),
        f = n(90),
        c = n(91),
        d = n(40),
        h = n(106),
        p = h.RETURN,
        m = function(e) {
            return null == e ? void 0 : u(e)
        },
        y = function(e) {
            var t = e._c;
            t && (e._c = void 0, t())
        },
        v = function(e) {
            return void 0 === e._o
        },
        _ = function(e) {
            v(e) || (e._o = void 0, y(e))
        },
        g = function(e, t) {
            l(e), this._c = void 0, this._o = e, e = new b(this);
            try {
                var n = t(e),
                    r = n;
                null != n && ("function" == typeof n.unsubscribe ? n = function() {
                    r.unsubscribe()
                } : u(n), this._c = n)
            } catch (t) {
                return void e.error(t)
            }
            v(this) && y(this)
        };
    g.prototype = c({}, {
        unsubscribe: function() {
            _(this)
        }
    });
    var b = function(e) {
        this._s = e
    };
    b.prototype = c({}, {
        next: function(e) {
            var t = this._s;
            if (!v(t)) {
                var n = t._o;
                try {
                    var r = m(n.next);
                    if (r) return r.call(n, e)
                } catch (e) {
                    try {
                        _(t)
                    } finally {
                        throw e
                    }
                }
            }
        },
        error: function(e) {
            var t = this._s;
            if (v(t)) throw e;
            var n = t._o;
            t._o = void 0;
            try {
                var r = m(n.error);
                if (!r) throw e;
                e = r.call(n, e)
            } catch (e) {
                try {
                    y(t)
                } finally {
                    throw e
                }
            }
            return y(t), e
        },
        complete: function(e) {
            var t = this._s;
            if (!v(t)) {
                var n = t._o;
                t._o = void 0;
                try {
                    var r = m(n.complete);
                    e = r ? r.call(n, e) : void 0
                } catch (e) {
                    try {
                        y(t)
                    } finally {
                        throw e
                    }
                }
                return y(t), e
            }
        }
    });
    var x = function(e) {
        f(this, x, "Observable", "_f")._f = u(e)
    };
    c(x.prototype, {
        subscribe: function(e) {
            return new g(e, this._f)
        },
        forEach: function(e) {
            var t = this;
            return new(o.Promise || i.Promise)(function(n, r) {
                u(e);
                var i = t.subscribe({
                    next: function(t) {
                        try {
                            return e(t)
                        } catch (e) {
                            r(e), i.unsubscribe()
                        }
                    },
                    error: r,
                    complete: n
                })
            })
        }
    }), c(x, {
        from: function(e) {
            var t = "function" == typeof this ? this : x,
                n = m(l(e)[s]);
            if (n) {
                var r = l(n.call(e));
                return r.constructor === t ? r : new t(function(e) {
                    return r.subscribe(e)
                })
            }
            return new t(function(t) {
                var n = !1;
                return a(function() {
                        if (!n) {
                            try {
                                if (h(e, !1, function(e) {
                                        if (t.next(e), n) return p
                                    }) === p) return
                            } catch (e) {
                                if (n) throw e;
                                return void t.error(e)
                            }
                            t.complete()
                        }
                    }),
                    function() {
                        n = !0
                    }
            })
        },
        of: function() {
            for (var e = 0, t = arguments.length, n = Array(t); e < t;) n[e] = arguments[e++];
            return new("function" == typeof this ? this : x)(function(e) {
                var t = !1;
                return a(function() {
                        if (!t) {
                            for (var r = 0; r < n.length; ++r)
                                if (e.next(n[r]), t) return;
                            e.complete()
                        }
                    }),
                    function() {
                        t = !0
                    }
            })
        }
    }), d(x.prototype, s, function() {
        return this
    }), r(r.G, {
        Observable: x
    }), n(89)("Observable")
}, function(e, t, n) {
    var r = n(13),
        i = n(1),
        o = n(135),
        a = n(694),
        s = r.navigator,
        u = !!s && /MSIE .\./.test(s.userAgent),
        l = function(e) {
            return u ? function(t, n) {
                return e(o(a, [].slice.call(arguments, 2), "function" == typeof t ? t : Function(t)), n)
            } : e
        };
    i(i.G + i.B + i.F * u, {
        setTimeout: l(r.setTimeout),
        setInterval: l(r.setInterval)
    })
}, function(e, t, n) {
    "use strict";
    var r = n(695),
        i = n(135),
        o = n(42);
    e.exports = function() {
        for (var e = o(this), t = arguments.length, n = Array(t), a = 0, s = r._, u = !1; t > a;)(n[a] = arguments[a++]) === s && (u = !0);
        return function() {
            var r, o = this,
                a = arguments.length,
                l = 0,
                f = 0;
            if (!u && !a) return i(e, n, o);
            if (r = n.slice(), u)
                for (; t > l; l++) r[l] === s && (r[l] = arguments[f++]);
            for (; a > f;) r.push(arguments[f++]);
            return i(e, r, o)
        }
    }
}, function(e, t, n) {
    e.exports = n(13)
}, function(e, t, n) {
    var r = n(1),
        i = n(190);
    r(r.G + r.B, {
        setImmediate: i.set,
        clearImmediate: i.clear
    })
}, function(e, t, n) {
    for (var r = n(188), i = n(41), o = n(13), a = n(40), s = n(104), u = n(23), l = u("iterator"), f = u("toStringTag"), c = s.Array, d = ["NodeList", "DOMTokenList", "MediaList", "StyleSheetList", "CSSRuleList"], h = 0; h < 5; h++) {
        var p, m = d[h],
            y = o[m],
            v = y && y.prototype;
        if (v) {
            v[l] || a(v, l, c), v[f] || a(v, f, m), s[m] = c;
            for (p in r) v[p] || i(v, p, r[p], !0)
        }
    }
}, function(e, t, n) {
    (function(t, n) {
        ! function(t) {
            "use strict";

            function r(e, t, n, r) {
                var i = Object.create((t || o).prototype),
                    a = new p(r || []);
                return i._invoke = c(e, n, a), i
            }

            function i(e, t, n) {
                try {
                    return {
                        type: "normal",
                        arg: e.call(t, n)
                    }
                } catch (e) {
                    return {
                        type: "throw",
                        arg: e
                    }
                }
            }

            function o() {}

            function a() {}

            function s() {}

            function u(e) {
                ["next", "throw", "return"].forEach(function(t) {
                    e[t] = function(e) {
                        return this._invoke(t, e)
                    }
                })
            }

            function l(e) {
                this.arg = e
            }

            function f(e) {
                function t(t, n) {
                    var r = e[t](n),
                        i = r.value;
                    return i instanceof l ? Promise.resolve(i.arg).then(o, a) : Promise.resolve(i).then(function(e) {
                        return r.value = e, r
                    })
                }

                function r(e, n) {
                    function r() {
                        return t(e, n)
                    }
                    return i = i ? i.then(r, r) : new Promise(function(e) {
                        e(r())
                    })
                }
                "object" == typeof n && n.domain && (t = n.domain.bind(t));
                var i, o = t.bind(e, "next"),
                    a = t.bind(e, "throw");
                t.bind(e, "return");
                this._invoke = r
            }

            function c(e, t, n) {
                var r = w;
                return function(o, a) {
                    if (r === S) throw new Error("Generator is already running");
                    if (r === M) {
                        if ("throw" === o) throw a;
                        return y()
                    }
                    for (;;) {
                        var s = n.delegate;
                        if (s) {
                            if ("return" === o || "throw" === o && s.iterator[o] === v) {
                                n.delegate = null;
                                var u = s.iterator.return;
                                if (u) {
                                    var l = i(u, s.iterator, a);
                                    if ("throw" === l.type) {
                                        o = "throw", a = l.arg;
                                        continue
                                    }
                                }
                                if ("return" === o) continue
                            }
                            var l = i(s.iterator[o], s.iterator, a);
                            if ("throw" === l.type) {
                                n.delegate = null, o = "throw", a = l.arg;
                                continue
                            }
                            o = "next", a = v;
                            var f = l.arg;
                            if (!f.done) return r = E, f;
                            n[s.resultName] = f.value, n.next = s.nextLoc, n.delegate = null
                        }
                        if ("next" === o) n._sent = a, n.sent = r === E ? a : v;
                        else if ("throw" === o) {
                            if (r === w) throw r = M, a;
                            n.dispatchException(a) && (o = "next", a = v)
                        } else "return" === o && n.abrupt("return", a);
                        r = S;
                        var l = i(e, t, n);
                        if ("normal" === l.type) {
                            r = n.done ? M : E;
                            var f = {
                                value: l.arg,
                                done: n.done
                            };
                            if (l.arg !== C) return f;
                            n.delegate && "next" === o && (a = v)
                        } else "throw" === l.type && (r = M, o = "throw", a = l.arg)
                    }
                }
            }

            function d(e) {
                var t = {
                    tryLoc: e[0]
                };
                1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t)
            }

            function h(e) {
                var t = e.completion || {};
                t.type = "normal", delete t.arg, e.completion = t
            }

            function p(e) {
                this.tryEntries = [{
                    tryLoc: "root"
                }], e.forEach(d, this), this.reset(!0)
            }

            function m(e) {
                if (e) {
                    var t = e[g];
                    if (t) return t.call(e);
                    if ("function" == typeof e.next) return e;
                    if (!isNaN(e.length)) {
                        var n = -1,
                            r = function t() {
                                for (; ++n < e.length;)
                                    if (_.call(e, n)) return t.value = e[n], t.done = !1, t;
                                return t.value = v, t.done = !0, t
                            };
                        return r.next = r
                    }
                }
                return {
                    next: y
                }
            }

            function y() {
                return {
                    value: v,
                    done: !0
                }
            }
            var v, _ = Object.prototype.hasOwnProperty,
                g = "function" == typeof Symbol && Symbol.iterator || "@@iterator",
                b = "object" == typeof e,
                x = t.regeneratorRuntime;
            if (x) return void(b && (e.exports = x));
            x = t.regeneratorRuntime = b ? e.exports : {}, x.wrap = r;
            var w = "suspendedStart",
                E = "suspendedYield",
                S = "executing",
                M = "completed",
                C = {},
                T = s.prototype = o.prototype;
            a.prototype = T.constructor = s, s.constructor = a, a.displayName = "GeneratorFunction", x.isGeneratorFunction = function(e) {
                var t = "function" == typeof e && e.constructor;
                return !!t && (t === a || "GeneratorFunction" === (t.displayName || t.name))
            }, x.mark = function(e) {
                return Object.setPrototypeOf ? Object.setPrototypeOf(e, s) : e.__proto__ = s, e.prototype = Object.create(T), e
            }, x.awrap = function(e) {
                return new l(e)
            }, u(f.prototype), x.async = function(e, t, n, i) {
                var o = new f(r(e, t, n, i));
                return x.isGeneratorFunction(t) ? o : o.next().then(function(e) {
                    return e.done ? e.value : o.next()
                })
            }, u(T), T[g] = function() {
                return this
            }, T.toString = function() {
                return "[object Generator]"
            }, x.keys = function(e) {
                var t = [];
                for (var n in e) t.push(n);
                return t.reverse(),
                    function n() {
                        for (; t.length;) {
                            var r = t.pop();
                            if (r in e) return n.value = r, n.done = !1, n
                        }
                        return n.done = !0, n
                    }
            }, x.values = m, p.prototype = {
                constructor: p,
                reset: function(e) {
                    if (this.prev = 0, this.next = 0, this.sent = v, this.done = !1, this.delegate = null, this.tryEntries.forEach(h), !e)
                        for (var t in this) "t" === t.charAt(0) && _.call(this, t) && !isNaN(+t.slice(1)) && (this[t] = v)
                },
                stop: function() {
                    this.done = !0;
                    var e = this.tryEntries[0],
                        t = e.completion;
                    if ("throw" === t.type) throw t.arg;
                    return this.rval
                },
                dispatchException: function(e) {
                    function t(t, r) {
                        return o.type = "throw", o.arg = e, n.next = t, !!r
                    }
                    if (this.done) throw e;
                    for (var n = this, r = this.tryEntries.length - 1; r >= 0; --r) {
                        var i = this.tryEntries[r],
                            o = i.completion;
                        if ("root" === i.tryLoc) return t("end");
                        if (i.tryLoc <= this.prev) {
                            var a = _.call(i, "catchLoc"),
                                s = _.call(i, "finallyLoc");
                            if (a && s) {
                                if (this.prev < i.catchLoc) return t(i.catchLoc, !0);
                                if (this.prev < i.finallyLoc) return t(i.finallyLoc)
                            } else if (a) {
                                if (this.prev < i.catchLoc) return t(i.catchLoc, !0)
                            } else {
                                if (!s) throw new Error("try statement without catch or finally");
                                if (this.prev < i.finallyLoc) return t(i.finallyLoc)
                            }
                        }
                    }
                },
                abrupt: function(e, t) {
                    for (var n = this.tryEntries.length - 1; n >= 0; --n) {
                        var r = this.tryEntries[n];
                        if (r.tryLoc <= this.prev && _.call(r, "finallyLoc") && this.prev < r.finallyLoc) {
                            var i = r;
                            break
                        }
                    }
                    i && ("break" === e || "continue" === e) && i.tryLoc <= t && t <= i.finallyLoc && (i = null);
                    var o = i ? i.completion : {};
                    return o.type = e, o.arg = t, i ? this.next = i.finallyLoc : this.complete(o), C
                },
                complete: function(e, t) {
                    if ("throw" === e.type) throw e.arg;
                    "break" === e.type || "continue" === e.type ? this.next = e.arg : "return" === e.type ? (this.rval = e.arg, this.next = "end") : "normal" === e.type && t && (this.next = t)
                },
                finish: function(e) {
                    for (var t = this.tryEntries.length - 1; t >= 0; --t) {
                        var n = this.tryEntries[t];
                        if (n.finallyLoc === e) return this.complete(n.completion, n.afterLoc), h(n), C
                    }
                },
                catch: function(e) {
                    for (var t = this.tryEntries.length - 1; t >= 0; --t) {
                        var n = this.tryEntries[t];
                        if (n.tryLoc === e) {
                            var r = n.completion;
                            if ("throw" === r.type) {
                                var i = r.arg;
                                h(n)
                            }
                            return i
                        }
                    }
                    throw new Error("illegal catch attempt")
                },
                delegateYield: function(e, t, n) {
                    return this.delegate = {
                        iterator: m(e),
                        resultName: t,
                        nextLoc: n
                    }, C
                }
            }
        }("object" == typeof t ? t : "object" == typeof window ? window : "object" == typeof self ? self : this)
    }).call(t, n(233), n(262))
}, function(e, t, n) {
    n(700), e.exports = n(71).RegExp.escape
}, function(e, t, n) {
    var r = n(1),
        i = n(701)(/[\\^$*+?.()|[\]{}]/g, "\\$&");
    r(r.S, "RegExp", {
        escape: function(e) {
            return i(e)
        }
    })
}, function(e, t) {
    e.exports = function(e, t) {
        var n = t === Object(t) ? function(e) {
            return t[e]
        } : t;
        return function(t) {
            return String(t).replace(e, n)
        }
    }
}, function(e, t, n) {
    "use strict";
    "undefined" != typeof Map && "undefined" != typeof Set || function(e) {
        function t(e, t) {
            function r(e) {
                if (!this || this.constructor !== r) return new r(e);
                this._keys = [], this._values = [], this.objectOnly = t, e && n.call(this, e)
            }
            return t || v(e, "size", {
                get: h
            }), e.constructor = r, r.prototype = e, r
        }

        function n(e) {
            this.add ? e.forEach(this.add, this) : e.forEach(function(e) {
                this.set(e[0], e[1])
            }, this)
        }

        function r(e) {
            return this.has(e) && (this._keys.splice(y, 1), this._values.splice(y, 1)), -1 < y
        }

        function i(e) {
            return this.has(e) ? this._values[y] : void 0
        }

        function o(e, t) {
            if (this.objectOnly && t !== Object(t)) throw new TypeError("Invalid value used as weak collection key");
            if (t != t || 0 === t)
                for (y = e.length; y-- && !_(e[y], t););
            else y = e.indexOf(t);
            return -1 < y
        }

        function a(e) {
            return o.call(this, this._values, e)
        }

        function s(e) {
            return o.call(this, this._keys, e)
        }

        function u(e, t) {
            return this.has(e) ? this._values[y] = t : this._values[this._keys.push(e) - 1] = t, this
        }

        function l(e) {
            return this.has(e) || this._values.push(e), this
        }

        function f() {
            this._values.length = 0
        }

        function c() {
            return this._values.slice()
        }

        function d() {
            return this._keys.slice()
        }

        function h() {
            return this._values.length
        }

        function p(e, t) {
            var n = this,
                r = n._values.slice();
            n._keys.slice().forEach(function(i, o) {
                e.call(t, r[o], i, n)
            })
        }

        function m(e, t) {
            var n = this;
            n._values.slice().forEach(function(r) {
                e.call(t, r, r, n)
            })
        }
        Object.is || (Object.is = function(e, t) {
            return 0 === e && 0 === t ? 1 / e == 1 / t : e !== e ? t !== t : e === t
        });
        var y, v = Object.defineProperty,
            _ = Object.is;
        e.Set || (e.Map = t({
            delete: r,
            has: s,
            get: i,
            set: u,
            keys: d,
            values: c,
            forEach: p,
            clear: f
        }), e.Set = t({
            has: a,
            add: l,
            delete: r,
            clear: f,
            values: c,
            forEach: m
        }))
    }("undefined" != typeof window && window || void 0)
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(8),
        s = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(a),
        u = function(e) {
            function t() {
                r(this, t);
                var e = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return e.type = "ArAnchorComponent", e.anchorId = null, e
            }
            return o(t, e), t
        }(s.default);
    t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(0),
        c = r(f),
        d = n(31),
        h = r(d),
        p = function(e) {
            function t(e) {
                i(this, t);
                var n = ["ArAnchorComponent"],
                    r = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "ArSystem", n));
                return r.enabled = !1, r._delegate = e, r._hitTestCallbackMap = new Map, r._hitTestRequestId = 0, r._registerAnchorCallbackMap = new Map, r._registerAnchorRequestId = 0, r._arViewMatrix = null, r._arProjectionMatrix = null, r._ambientIntensity = 0, r._ambientColorTemperature = 0, r._anchorTransformMap = new Map, r._entityTranslation = new c.default, r._entityScale = new c.default, r._entityRotation = new h.default, r
            }
            return a(t, e), s(t, [{
                key: "getViewMatrix",
                value: function() {
                    return this._arViewMatrix
                }
            }, {
                key: "getProjectionMatrix",
                value: function() {
                    return this._arProjectionMatrix
                }
            }, {
                key: "getAmbientColorTemperature",
                value: function() {
                    return this._ambientColorTemperature
                }
            }, {
                key: "getAmbientIntensity",
                value: function() {
                    return this._ambientIntensity
                }
            }, {
                key: "hitTest",
                value: function(e, t, n) {
                    if (this._delegate) {
                        var r = this._hitTestRequestId.toString();
                        ++this._hitTestRequestId, this._hitTestCallbackMap.set(r, n), this._delegate.requestHitTest(r, e, t)
                    }
                }
            }, {
                key: "registerAnchor",
                value: function(e, t) {
                    if (this._delegate) {
                        var n = this._registerAnchorRequestId.toString();
                        ++this._registerAnchorRequestId, this._registerAnchorCallbackMap.set(n, t), this._delegate.registerAnchor(n, e)
                    }
                }
            }, {
                key: "process",
                value: function(e, t) {
                    var n = !0,
                        r = !1,
                        i = void 0;
                    try {
                        for (var o, a = e[Symbol.iterator](); !(n = (o = a.next()).done); n = !0) {
                            var s = o.value,
                                u = s.getComponent("ArAnchorComponent").anchorId,
                                l = this._anchorTransformMap.get(u);
                            if (l) {
                                var f = s.getComponent("TransformComponent");
                                l.decompose(this._entityTranslation, this._entityRotation, this._entityScale), f.setTranslation(this._entityTranslation), f.setRotationMatrix(this._entityRotation), f.setScale(this._entityScale)
                            }
                        }
                    } catch (e) {
                        r = !0, i = e
                    } finally {
                        try {
                            !n && a.return && a.return()
                        } finally {
                            if (r) throw i
                        }
                    }
                }
            }, {
                key: "_hitTestResponse",
                value: function(e, t) {
                    var n = this._hitTestCallbackMap.get(e);
                    n && (this._hitTestCallbackMap.delete(e), n(t))
                }
            }, {
                key: "_registerAnchorResponse",
                value: function(e, t) {
                    var n = this._registerAnchorCallbackMap.get(e);
                    n && (this._registerAnchorCallbackMap.delete(e), n(t))
                }
            }, {
                key: "_setAnchorTransform",
                value: function(e, t) {
                    this._anchorTransformMap.set(e, t)
                }
            }]), t
        }(l.default);
    t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        this.isLeaf = !0, this.isSet = !1, this.children = [], this.localRectangle = void 0 !== e && void 0 !== t ? new o.default(0, 0, e, t) : null
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(270),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype.getRectangles = function() {
        var e = [];
        return this._getRectangles(e), e
    }, r.prototype._getRectangles = function(e) {
        this.isSet && e.push(this.localRectangle), this.isLeaf || (this.children[0]._getRectangles(e), this.children[1]._getRectangles(e))
    }, r.prototype.insert = function(e, t) {
        return this._insert(new o.default(0, 0, e, t))
    }, r.prototype._insert = function(e) {
        if (!this.isLeaf) {
            var t = this.children[0]._insert(e);
            return null !== t ? t : this.children[1]._insert(e)
        }
        if (this.isSet) return null;
        if (e.w > this.localRectangle.w || e.h > this.localRectangle.h) return null;
        if (e.w === this.localRectangle.w && e.h === this.localRectangle.h) return this.isSet = !0, this;
        this.isLeaf = !1, this.children[0] = new r, this.children[1] = new r;
        var n = this.localRectangle.w - e.w,
            i = this.localRectangle.h - e.h;
        return n > i ? (this.children[0].localRectangle = new o.default(this.localRectangle.x, this.localRectangle.y, e.w, this.localRectangle.h), this.children[1].localRectangle = new o.default(this.localRectangle.x + e.w, this.localRectangle.y, n, this.localRectangle.h)) : (this.children[0].localRectangle = new o.default(this.localRectangle.x, this.localRectangle.y, this.localRectangle.w, e.h), this.children[1].localRectangle = new o.default(this.localRectangle.x, this.localRectangle.y + e.h, this.localRectangle.w, i)), this.children[0]._insert(e)
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    var i = n(24),
        o = r(i),
        a = n(196),
        s = r(a);
    o.default.prototype.invalidateBuffer = function(e) {
        e.glBuffer = null
    }, o.default.prototype.invalidateMeshData = function(e) {
        this.invalidateBuffer(e.vertexData), e.indexData && this.invalidateBuffer(e.indexData), e.wireframeData && this.invalidateMeshData(e.wireframeData), e.flatMeshData && this.invalidateMeshData(e.flatMeshData)
    }, o.default.prototype.invalidateTexture = function(e) {
        e.glTexture = null, e.textureRecord = {}
    }, o.default.prototype.invalidateSampler = function(e) {
        e.glSampler = null
    }, o.default.prototype.invalidateShader = function(e) {
        e.shaderProgram = null, e.vertexShader = null, e.fragmentShader = null
    }, o.default.prototype.invalidateMaterial = function(e) {
        for (var t = Object.keys(e._textureMaps), n = 0; n < t.length; n++) {
            var r = t[n],
                i = e._textureMaps[r];
            this.invalidateTexture(i);
            var o = e._samplerMaps[r];
            o && (this._deallocateSampler(o), this.invalidateSampler(o))
        }
        this.invalidateShader(e.shader)
    }, o.default.prototype.invalidateRenderTarget = function(e) {
        e.glTexture = null, e._glRenderBuffers = [], e._glFrameBuffers = [], e._glMSFrameBuffers = [], delete e.textureRecord
    }, o.default.prototype.invalidateComposer = function(e) {
        e.writeBuffer && !e._passedWriteBuffer && this.invalidateRenderTarget(e.writeBuffer), e.readBuffer && this.invalidateRenderTarget(e.readBuffer), e.copyPass.invalidateHandles(this);
        for (var t = 0; t < e.passes.length; t++) {
            e.passes[t].invalidateHandles(this)
        }
    }, o.default.prototype.invalidatePicking = function() {
        this.hardwarePicking && (this.hardwarePicking.pickingTarget && this.invalidateRenderTarget(this.hardwarePicking.pickingTarget), this.invalidateMaterial(this.hardwarePicking.pickingMaterial))
    }, o.default.prototype._restoreContext = function() {
        this.establishContext(), this.rendererRecord = new s.default, this.context.clearColor(this._clearColor.x, this._clearColor.y, this._clearColor.z, this._clearColor.w)
    }
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(8),
        s = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(a),
        u = function(e) {
            function t(e, n) {
                r(this, t);
                var o = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return o.type = "CssTransformComponent", o.domElement = e, o.scale = 1, o.faceCamera = void 0 !== n && n, Object.seal(o), o
            }
            return o(t, e), t
        }(s.default);
    u.type = "CssTransformComponent", t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(24),
        c = r(f),
        d = n(38),
        h = r(d),
        p = n(4),
        m = r(p),
        y = n(0),
        v = r(y),
        _ = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "CssTransformSystem", ["TransformComponent", "CssTransformComponent"]));
                return n.renderer = e, document.querySelector && (n.viewDom = document.querySelector("#view"), n.containerDom = document.querySelector("#cam1"), n.containerDom2 = document.querySelector("#cam2")), n
            }
            return a(t, e), s(t, [{
                key: "process",
                value: function(e) {
                    if (0 !== e.length) {
                        var t = c.default.mainCamera;
                        if (t) {
                            var n = .5 / Math.tan(m.default.DEG_TO_RAD * t.fov * .5) * this.renderer.domElement.offsetHeight;
                            S(this.viewDom, "perspective", n + "px"), g.copy(t.getViewInverseMatrix()), b.copy(g), g.invert(), g.setTranslation(new v.default(0, 0, n));
                            var r = M(g);
                            S(this.containerDom, "transform", r), b.e03 = -b.e03, b.e23 = -b.e23, b.data[0] = 1, b.data[1] = 0, b.data[2] = 0, b.data[4] = 0, b.data[5] = 1, b.data[6] = 0, b.data[8] = 0, b.data[9] = 0, b.data[10] = 1, r = M(b), S(this.containerDom2, "transform", r);
                            for (var i = 0; i < e.length; i++) {
                                var o = e[i],
                                    a = o.getComponent("CssTransformComponent"),
                                    s = a.domElement,
                                    u = a.scale;
                                u = [u, -u, u].join(","), a.faceCamera ? (o.transformComponent.sync().worldTransform.matrix.getTranslation(x), g.copy(t.getViewInverseMatrix()), g.setTranslation(x)) : g.copy(o.transformComponent.sync().worldTransform.matrix), r = "translate3d(-50%,-50%,0) " + M(g) + "scale3d(" + u + ")", S(s, "transform", r), s.parentNode !== this.containerDom2 && this.containerDom2.appendChild(s)
                            }
                        }
                    }
                }
            }]), t
        }(l.default),
        g = new h.default,
        b = new h.default,
        x = new v.default,
        w = function(e) {
            return Math.abs(e) < 1e-6 ? 0 : e
        },
        E = ["", "-webkit-", "-moz-", "-ms-", "-o-"],
        S = function(e, t, n) {
            for (var r = 0; r < E.length; r++) e.style[E[r] + t] = n
        },
        M = function(e) {
            var t = e.data;
            return "matrix3d(" + w(t[0]) + "," + w(-t[1]) + "," + w(t[2]) + "," + w(t[3]) + "," + w(t[4]) + "," + w(-t[5]) + "," + w(t[6]) + "," + w(t[7]) + "," + w(t[8]) + "," + w(-t[9]) + "," + w(t[10]) + "," + w(t[11]) + "," + w(t[12]) + "," + w(-t[13]) + "," + w(t[14]) + "," + w(t[15]) + ")"
        };
    t.default = _
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        s.default.apply(this, arguments), this._type = "Dom3dComponent"
    }

    function o(e) {
        return "__" + e.replace(p, "-")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = n(20),
        s = r(a),
        u = n(291),
        l = r(u),
        f = n(12),
        c = r(f),
        d = n(17),
        h = r(d);
    i.prototype = Object.create(s.default.prototype), s.default._registerClass("dom3d", i), i.prototype.constructor = i, i.prototype._prepare = function() {}, i.prototype._create = function() {
        return new l.default
    };
    var p = /\W/g;
    i.prototype.update = function(e, t, n) {
        var r = this;
        return s.default.prototype.update.call(this, e, t, n).then(function(i) {
            if (i) {
                var a = o(e.id),
                    s = i.domElement;
                s || (s = document.createElement("div"), s.id = a, s.className = "sumerian-entity", i.initDom(s)), i.setSize(void 0 !== t.width ? t.width : 500, void 0 !== t.height ? t.height : 500);
                var u = t.innerHtml !== s.prevInnerHtml,
                    l = t.style !== s.prevStyle;
                if (s.prevInnerHtml = t.innerHtml, s.prevStyle = t.style, e.meshRendererComponent !== i.meshRendererComponent && e.setComponent(i.meshRendererComponent), e.meshDataComponent !== i.meshDataComponent && e.setComponent(i.meshDataComponent), !u && !l) return h.default.resolve();
                var f = "";
                if (t.style) {
                    f = "<style>\n" + t.style.replace("__entity", "#" + a) + "\n</style>"
                }
                s.innerHTML = f + t.innerHtml;
                var d = s.childNodes;
                if (1 === d.length) {
                    var p = d[0];
                    p.style.width || (p.style.width = "100%"), p.style.height || (p.style.height = "100%")
                }
                for (var m = s.getElementsByTagName("IMG"), y = [], v = 0; v < m.length; v++) {
                    var _ = m[v],
                        g = _.getAttribute("data-id");
                    if (g) {
                        var b = function(e, t) {
                            return r.loadObject(t, n).then(function(t) {
                                return e.src = t.src, e
                            }, function(t) {
                                return console.error(t), delete e.src, e
                            })
                        }(_, g);
                        y.push(b)
                    }
                }
                return c.default.all(y)
            }
        })
    }, i.prototype._remove = function(e) {
        var t = e.dom3dComponent;
        s.default.prototype._remove.call(this, e), t.domElement && t.domElement.parentNode && t.domElement.parentNode.removeChild(t.domElement), (e.meshRendererComponent || e.meshDataComponent) && (e.clearComponent("meshDataComponent"), e.clearComponent("meshRendererComponent")), t.destroy(this.world.sumerianRunner.renderer.context)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(7),
        f = r(l),
        c = n(5),
        d = r(c),
        h = n(9),
        p = r(h),
        m = n(15),
        y = r(m),
        v = n(0),
        _ = r(v),
        g = n(66),
        b = r(g),
        x = n(4),
        w = r(x),
        E = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "Dom3dSystem", ["TransformComponent", "Dom3dComponent"]));
                n.renderer = e, n.camera = null, d.default.addListener("sumerian.setCurrentCamera", function(e) {
                    n.camera = e.camera
                }, !0), n.playing = !0;
                var r = new p.default(y.default.simple);
                r.blendState.blending = "CustomBlending", r.blendState.blendSrc = "ZeroFactor", r.blendState.blendDst = "ZeroFactor";
                var a = new p.default(y.default.uber);
                return a.uniforms.materialDiffuse = [.5, .5, .5, 1], a.cullState.cullFace = "Front", n.materials = [r, a], n.prefixes = ["", "-webkit-"], n.styleCache = new Map, n.precisionScale = 1e3, n
            }
            return a(t, e), s(t, [{
                key: "init",
                value: function() {
                    var e = new b.default,
                        t = [new _.default, new _.default, new _.default, new _.default],
                        n = [new _.default(-.5, -.5, 0), new _.default(-.5, .5, 0), new _.default(.5, .5, 0), new _.default(.5, -.5, 0)],
                        r = !1,
                        i = this,
                        o = function(r) {
                            var o = void 0,
                                a = void 0,
                                s = i.renderer.domElement;
                            if ("touchstart" === r.type || "touchend" === r.type || "touchmove" === r.type) o = r.changedTouches[0].pageX - s.getBoundingClientRect().left, a = r.changedTouches[0].pageY - s.getBoundingClientRect().top;
                            else {
                                var u = s.getBoundingClientRect();
                                o = r.clientX - u.left, a = r.clientY - u.top
                            }
                            i.camera.getPickRay(o, a, i.renderer.domElement.offsetWidth, i.renderer.domElement.offsetHeight, e);
                            for (var l = 0; l < i._activeEntities.length; l++) {
                                for (var f = i._activeEntities[l], c = 0; c < t.length; c++) {
                                    var d = t[c];
                                    d.set(n[c]), d.applyPostPoint(f.transformComponent.sync().worldTransform.matrix)
                                }
                                if (e.intersects(t, !1, null, !0)) return !0
                            }
                            return !1
                        },
                        a = function(e) {
                            if (!i.camera || 0 === i._activeEntities.length) return !1;
                            var t = o(e);
                            t && !r ? (d.default.emit("sumerian.dom3d.enabled", !0), i.renderer.domElement.style.pointerEvents = "none", r = !0) : !t && r && (d.default.emit("sumerian.dom3d.enabled", !1), i.renderer.domElement.style.pointerEvents = "", r = !1)
                        },
                        s = !1;
                    document.addEventListener("mousedown", function(e) {
                        i.camera && 0 !== i._activeEntities.length && (s = !o(e))
                    }, !1), document.addEventListener("mouseup", function(e) {
                        i.camera && 0 !== i._activeEntities.length && (s = !1, i.playing && a(e))
                    }, !1), document.addEventListener("mousemove", function(e) {
                        !s && i.camera && 0 !== i._activeEntities.length && i.playing && a(e)
                    }, !1);
                    var u = this.rootDom = document.createElement("div");
                    this.renderer.domElement.parentNode.insertBefore(u, this.renderer.domElement), u.style.position = "absolute", u.style.overflow = "hidden", u.style.webkitUserSelect = "none", u.style.mozUserSelect = "none", u.style.msUserSelect = "none", u.style.transformStyle = "preserve-3d", u.style.width = "100%", u.style.height = "100%", u.style.top = "0px", u.style.bottom = "0px", u.style.left = "0px", u.style.right = "0px";
                    var l = this.cameraDom = document.createElement("div");
                    l.style.webkitUserSelect = "none", l.style.mozUserSelect = "none", l.style.msUserSelect = "none", l.style.transformStyle = "preserve-3d", l.style.width = "100%", l.style.height = "100%", u.appendChild(l)
                }
            }, {
                key: "play",
                value: function() {
                    this.playing = !0
                }
            }, {
                key: "pause",
                value: function() {}
            }, {
                key: "stop",
                value: function() {
                    this.playing = !1, d.default.emit("sumerian.dom3d.enabled", !1), this.renderer.domElement && (this.renderer.domElement.style.pointerEvents = "")
                }
            }, {
                key: "getCameraCSSMatrix",
                value: function(e) {
                    var t = e.data;
                    return "matrix3d(" + t[0] + "," + -t[1] + "," + t[2] + "," + t[3] + "," + t[4] + "," + -t[5] + "," + t[6] + "," + t[7] + "," + t[8] + "," + -t[9] + "," + t[10] + "," + t[11] + "," + t[12] * this.precisionScale + "," + -t[13] * this.precisionScale + "," + t[14] * this.precisionScale + "," + t[15] + ")"
                }
            }, {
                key: "getEntityCSSMatrix",
                value: function(e) {
                    var t = e.data;
                    return "translate3d(-50%,-50%,0) matrix3d(" + t[0] + "," + t[1] + "," + t[2] + "," + t[3] + "," + -t[4] + "," + -t[5] + "," + -t[6] + "," + -t[7] + "," + t[8] + "," + t[9] + "," + t[10] + "," + t[11] + "," + t[12] * this.precisionScale + "," + t[13] * this.precisionScale + "," + t[14] * this.precisionScale + "," + t[15] + ")"
                }
            }, {
                key: "setStyle",
                value: function(e, t, n) {
                    if (n !== this.styleCache.get(e)) {
                        for (var r = 0; r < this.prefixes.length; r++) e.style[this.prefixes[r] + t] = n;
                        this.styleCache.set(e, n)
                    }
                }
            }, {
                key: "inserted",
                value: function(e) {
                    e.dom3dComponent.meshRendererComponent.materials = this.materials
                }
            }, {
                key: "onPreRender",
                value: function() {
                    var e = this._activeEntities,
                        t = this.camera;
                    if (t && 0 !== e.length) {
                        this.renderer.domElement.parentNode && !this.rootDom && this.init();
                        var n = this.renderer.viewportWidth / this.renderer.devicePixelRatio,
                            r = this.renderer.viewportHeight / this.renderer.devicePixelRatio,
                            i = .5 / Math.tan(w.default.DEG_TO_RAD * t.fov * .5) * r;
                        this.setStyle(this.rootDom, "perspective", i + "px");
                        var o = t.getViewMatrix(),
                            a = "translate3d(0,0," + i + "px) " + this.getCameraCSSMatrix(o) + " translate3d(" + n / 2 + "px," + r / 2 + "px, 0)";
                        this.setStyle(this.cameraDom, "transform", a);
                        for (var s = 0, u = e.length; s < u; s++) {
                            var l = e[s],
                                f = l.dom3dComponent,
                                c = f.domElement;
                            if (c.parentNode !== this.cameraDom && this.cameraDom.appendChild(c), f.hidden) f.domElement.style.display = "none";
                            else if (f.domElement.style.display = "", f.updated || f._transformDirty) {
                                f.updated = !1, f._transformDirty = !1;
                                var d = l.transformComponent.sync().worldTransform;
                                a = this.getEntityCSSMatrix(d.matrix) + " scale(" + this.precisionScale / f.width + ", " + this.precisionScale / f.height + ")", this.setStyle(c, "transform", a)
                            }
                        }
                    }
                }
            }, {
                key: "cleanup",
                value: function() {
                    u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "cleanup", this).call(this), null !== this.rootDom.parentNode && this.rootDom.parentNode.removeChild(this.rootDom)
                }
            }]), t
        }(f.default);
    E.prototype.resume = E.prototype.play, t.default = E
}, function(e, t, n) {
    "use strict";
    t.__esModule = !0;
    var r = function() {
        function e(t, n) {
            void 0 === t && (t = 0), void 0 === n && (n = e.DEFAULT_MAX), this.buckets = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], this.cardinality = 0, this.sum = 0, this.low = t;
            var r = n - t,
                i = Math.pow(r, e.NUM_BUCKETS_ROOT);
            this.arbitraryLogDivisor = Math.log(i)
        }
        return e.prototype.record = function(e) {
            if (e <= this.low) this.buckets[0] += 1;
            else {
                var t = e - this.low,
                    n = Math.floor(Math.log(t) / this.arbitraryLogDivisor),
                    r = Math.min(n + 1, this.buckets.length - 1);
                this.buckets[r] += 1
            }
            this.cardinality += 1, this.sum += e
        }, e.prototype.avg = function() {
            return 0 === this.sum ? 0 : this.sum / this.cardinality
        }, e.prototype.base = function() {
            return Math.pow(Math.E, this.arbitraryLogDivisor)
        }, e.prototype.getSerializable = function() {
            return {
                low: this.low,
                buckets: this.buckets.slice(),
                cardinality: this.cardinality,
                sum: this.sum,
                base: this.base(),
                avg: this.avg()
            }
        }, e.prototype.clear = function() {
            for (var e = 0; e < this.buckets.length; e++) this.buckets[e] = 0;
            this.cardinality = 0, this.sum = 0
        }, e.prototype.getLow = function() {
            return this.low
        }, e.prototype.getHigh = function() {
            return Math.pow(this.base(), e.NUM_ACTUAL_BUCKETS)
        }, e.MAX_SAFE_INT = Math.pow(2, 53) - 1, e.DEFAULT_MAX = e.MAX_SAFE_INT / 4, e.NUM_BUCKETS = 20, e.NUM_ACTUAL_BUCKETS = e.NUM_BUCKETS - 2, e.NUM_BUCKETS_ROOT = 1 / e.NUM_ACTUAL_BUCKETS, e
    }();
    t.default = r
}, function(e, t, n) {
    "use strict";
    t.__esModule = !0;
    var r = function() {
        function e(t, n) {
            this.buckets = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], this.cardinality = 0, this.sum = 0, this.low = t;
            var r = n - t;
            this.bucketWidth = r / e.NUM_ACTUAL_BUCKETS
        }
        return e.prototype.record = function(t) {
            var n = t - this.low;
            if (n < 0) this.buckets[0] += 1;
            else {
                var r = n / this.bucketWidth;
                if (r > e.NUM_ACTUAL_BUCKETS) this.buckets[this.buckets.length - 1] += 1;
                else {
                    var i = Math.floor(r) + 1;
                    this.buckets[i] += 1
                }
            }
            this.cardinality += 1, this.sum += t
        }, e.prototype.avg = function() {
            return this.cardinality / this.sum
        }, e.prototype.getLow = function() {
            return this.low
        }, e.prototype.getHigh = function() {
            return this.bucketWidth * e.NUM_ACTUAL_BUCKETS + this.low
        }, e.prototype.getSerializable = function() {
            return {
                buckets: this.buckets.slice(),
                low: this.low,
                high: this.getHigh(),
                cardinality: this.cardinality,
                sum: this.sum,
                avg: this.avg(),
                width: this.bucketWidth
            }
        }, e.prototype.clear = function() {
            for (var e = 0; e < this.buckets.length; e++) this.buckets[e] = 0;
            this.cardinality = 0, this.sum = 0
        }, e.NUM_BUCKETS = 20, e.NUM_ACTUAL_BUCKETS = e.NUM_BUCKETS - 2, e
    }();
    t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(20),
        f = r(l),
        c = n(332),
        d = r(c),
        h = n(199),
        p = r(h),
        m = n(3),
        y = (r(m), function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e._type = "HMDCameraComponent", e
            }
            return a(t, e), s(t, [{
                key: "_create",
                value: function() {
                    var e = new p.default,
                        t = new p.default;
                    return new d.default(e, t)
                }
            }, {
                key: "update",
                value: function(e, n, r) {
                    return u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "update", this).call(this, e, n, r)
                }
            }]), t
        }(f.default));
    f.default._registerClass("hmdcamera", y), t.default = y
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = function e(t, n, r) {
            null === t && (t = Function.prototype);
            var i = Object.getOwnPropertyDescriptor(t, n);
            if (void 0 === i) {
                var o = Object.getPrototypeOf(t);
                return null === o ? void 0 : e(o, n, r)
            }
            if ("value" in i) return i.value;
            var a = i.get;
            if (void 0 !== a) return a.call(r)
        },
        l = n(20),
        f = r(l),
        c = n(151),
        d = r(c),
        h = n(3),
        p = r(h),
        m = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, arguments));
                return e._type = "VRCameraRigComponent", e
            }
            return a(t, e), s(t, [{
                key: "_prepare",
                value: function(e) {
                    p.default.defaults(e, {
                        onlyShowWhenPresenting: !0,
                        loadGamepads: !0,
                        displayType: "all",
                        startAtCurrentCamera: !0,
                        currentVRCameraRig: !1
                    })
                }
            }, {
                key: "_create",
                value: function() {
                    return new d.default
                }
            }, {
                key: "update",
                value: function(e, n, r) {
                    return u(t.prototype.__proto__ || Object.getPrototypeOf(t.prototype), "update", this).call(this, e, n, r).then(function(e) {
                        if (e) return e.onlyShowWhenPresenting = n.onlyShowWhenPresenting, e.loadGamepads = n.loadGamepads, e.displayType = n.displayType, e.isStartAtCurrentCamera = n.startAtCurrentCamera, e.isCurrentVR = n.currentVRCameraRig, e
                    })
                }
            }]), t
        }(f.default);
    f.default._registerClass("vr", m), t.default = m
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        a = n(80),
        s = r(a),
        u = n(24),
        l = r(u),
        f = n(212),
        c = r(f),
        d = n(334),
        h = r(d),
        p = n(335),
        m = r(p),
        y = n(273),
        v = r(y),
        _ = n(337),
        g = r(_),
        b = n(338),
        x = r(b),
        w = n(275),
        E = r(w),
        S = n(339),
        M = r(S),
        C = n(95),
        T = r(C),
        R = n(340),
        A = r(R),
        O = n(341),
        P = r(O),
        D = n(716),
        I = r(D),
        k = n(342),
        N = r(k),
        L = n(75),
        B = r(L),
        F = n(343),
        j = r(F),
        U = n(344),
        V = r(U),
        z = n(345),
        G = r(z),
        W = n(149),
        H = r(W),
        X = n(70),
        Y = r(X),
        q = n(96),
        K = r(q),
        Q = n(148),
        Z = r(Q),
        J = n(123),
        $ = r(J),
        ee = n(160),
        te = r(ee),
        ne = n(159),
        re = r(ne),
        ie = n(346),
        oe = r(ie),
        ae = n(5),
        se = r(ae),
        ue = n(69),
        le = r(ue),
        fe = n(9),
        ce = r(fe),
        de = n(223),
        he = r(de),
        pe = n(348),
        me = (r(pe), n(194)),
        ye = r(me),
        ve = function() {
            function e(t) {
                var n = this;
                if (i(this, e), t = t || {}, re.default.initAllShims(), this.world = new s.default({
                        sumerianRunner: this,
                        tpfSmoothingCount: t.tpfSmoothingCount
                    }), this.callbacksPreProcess = [], this.callbacksPreRender = [], this.callbacks = [], this.callbacksNextFrame = [], this.renderer = new l.default(this, t), this.useTryCatch = void 0 === t.useTryCatch || t.useTryCatch, this._setupRequestAnimationFrame(), this._setBaseSystems(), this._registerBaseComponents(), this.doProcess = !0, this.doRender = !0, t.showStats && this.addStats(), void 0 === t.logo || t.logo) {
                    var r = this._buildLogo(t.logo);
                    r && document.body.appendChild(r)
                }
                this._takeSnapshots = [], this.start = -1, this.animationId = 0, t.manuallyStartGameLoop || this.startGameLoop(), t.debugKeys && this._addDebugKeys(), this._events = {
                    click: null,
                    mousedown: null,
                    mouseup: null,
                    mousemove: null,
                    touchstart: null,
                    touchend: null,
                    touchmove: null
                }, this._eventListeners = {
                    click: [],
                    mousedown: [],
                    mouseup: [],
                    mousemove: [],
                    touchstart: [],
                    touchend: [],
                    touchmove: []
                }, this._eventTriggered = {
                    click: null,
                    mousedown: null,
                    mouseup: null,
                    mousemove: null,
                    touchstart: null,
                    touchend: null,
                    touchmove: null
                }, re.default.addVisibilityChangeListener(function(e) {
                    e ? n._stopGameLoop() : n.manuallyPaused || n._startGameLoop()
                }), this._picking = {
                    x: 0,
                    y: 0,
                    skipUpdateBuffer: !1,
                    doPick: !1,
                    pickingCallback: null,
                    pickingStore: {},
                    clearColorStore: []
                }, this.manuallyPaused = !!t.manuallyStartGameLoop, this._setupContextLost()
            }
            return o(e, [{
                key: "_setupContextLost",
                value: function() {
                    var e = this;
                    se.default.addListener("sumerian.contextLost", function() {
                        for (var t = 0; t < e.renderSystems.length; t++) {
                            var n = e.renderSystems[t];
                            n.invalidateHandles && n.invalidateHandles(e.renderer)
                        }
                        var r = e.world.getSystem("LightingSystem");
                        r && r.invalidateHandles(e.renderer), e.renderer.shadowHandler && e.renderer.shadowHandler.invalidateHandles(e.renderer), e.renderer.invalidatePicking(), e.stopGameLoop()
                    }), se.default.addListener("sumerian.contextRestored", function() {
                        e.startGameLoop()
                    })
                }
            }, {
                key: "_setupRequestAnimationFrame",
                value: function() {
                    var e = this,
                        t = function() {
                            e.animationId = window.requestAnimationFrame(function(t) {
                                e.run(t)
                            })
                        },
                        n = function(t) {
                            e.animationId = t.vRCameraRigComponent.display.requestAnimationFrame(function(t) {
                                e.run(t)
                            })
                        },
                        r = function(e) {
                            e.submitFrame()
                        };
                    this._requestAnimationFrame = t, this._submitVRFrame = null, se.default.addListener(le.default.VR_PRESENTATION_START, function(t) {
                        var i = e.world.getSystem("VRCameraRigSystem");
                        window.cancelAnimationFrame(e.animationId), e.animationId = 0, e._requestAnimationFrame = n.bind(e, t.entity), e._submitVRFrame = r.bind(e, i), e.callbacks.push(e._submitVRFrame), e._startGameLoop()
                    }), se.default.addListener(le.default.VR_PRESENTATION_STOP, function(n) {
                        e.animationId && (n.entity.vRCameraRigComponent.display && n.entity.vRCameraRigComponent.display.cancelAnimationFrame(e.animationId), e.animationId = 0, e._requestAnimationFrame = t, ye.default.remove(e.callbacks, e._submitVRFrame), e._startGameLoop())
                    })
                }
            }, {
                key: "_setBaseSystems",
                value: function() {
                    this.world.setSystem(new T.default(this.renderer.domElement)), this.world.setSystem(new A.default), this.world.setSystem(new M.default), this.world.setSystem(new g.default(this.world)), this.world.setSystem(new h.default), this.world.setSystem(new E.default), this.world.setSystem(new P.default), this.world.setSystem(new v.default), this.world.setSystem(new x.default), this.world.setSystem(new I.default), this.world.setSystem(new G.default), this.world.setSystem(new c.default), B.default.isSupported() && this.world.setSystem(new j.default), this.world.setSystem(new V.default), this.renderSystem = new m.default, this.lineRenderSystem = new he.default(this.world), this.renderSystems = [this.renderSystem, this.lineRenderSystem], this.world.setSystem(this.renderSystem)
                }
            }, {
                key: "_registerBaseComponents",
                value: function() {
                    this.world.registerComponent(H.default), this.world.registerComponent(Y.default), this.world.registerComponent(K.default), this.world.registerComponent(Z.default), this.world.registerComponent($.default), this.world.registerComponent(te.default)
                }
            }, {
                key: "run",
                value: function(e) {
                    this.useTryCatch ? this._callSafe(this._updateFrame, e) : this._updateFrame(e)
                }
            }, {
                key: "_callSafe",
                value: function(e) {
                    try {
                        e.apply(this, Array.prototype.slice.call(arguments, 1))
                    } catch (e) {
                        e instanceof Error ? console.error(e) : console.log(e)
                    }
                }
            }, {
                key: "setRenderSystem",
                value: function(e, t) {
                    this.world.setSystem(e), void 0 !== t ? this.renderSystems.splice(t, 0, e) : this.renderSystems.push(e)
                }
            }, {
                key: "_updateFrame",
                value: function(e) {
                    this.start < 0 && (this.start = e);
                    var t = (e - this.start) / 1e3;
                    if (t < 0) return this.start = e, void this._requestAnimationFrame();
                    //! AT: doing this to be able to schedule new callbacks from the existing callbacks
                    if (this.start = e, this.callbacksNextFrame.length > 0) {
                        var n = this.callbacksNextFrame;
                        if (this.callbacksNextFrame = [], this.useTryCatch)
                            for (var r = 0; r < n.length; r++) {
                                var i = n[r];
                                this._callSafe(i, t)
                            } else
                                for (var r = 0; r < n.length; r++) {
                                    var i = n[r];
                                    i(t)
                                }
                    }
                    if (this.useTryCatch)
                        for (var r = 0; r < this.callbacksPreProcess.length; r++) {
                            var i = this.callbacksPreProcess[r];
                            this._callSafe(i, t)
                        } else
                            for (var r = 0; r < this.callbacksPreProcess.length; r++) {
                                var i = this.callbacksPreProcess[r];
                                i(t)
                            }
                    if (this.doProcess && this.world.update(t), this.renderer.info.reset(), this.doRender) {
                        this.renderer.checkResize(l.default.mainCamera), this.renderer.setRenderTarget(), this.world.onPreRender();
                        for (var r = 0; r < this.callbacksPreRender.length; r++) this.callbacksPreRender[r](t);
                        for (var r = 0; r < this.renderSystems.length; r++) this.renderSystems[r].passive || this.renderSystems[r].render(this.renderer, this.world.getSystem("OcclusionGraphSystem")._octree);
                        if (this._picking.doPick && l.default.mainCamera) {
                            var o = this.renderer.clearColor;
                            this._picking.clearColorStore[0] = o.r, this._picking.clearColorStore[1] = o.g, this._picking.clearColorStore[2] = o.b, this._picking.clearColorStore[3] = o.a, this.renderer.setClearColor(0, 0, 0, 1);
                            for (var r = 0; r < this.renderSystems.length; r++) this.renderSystems[r].renderToPick && !this.renderSystems[r].passive && this.renderSystems[r].renderToPick(this.renderer, this._picking.skipUpdateBuffer);
                            this.renderer.pick(this._picking.x, this._picking.y, this._picking.pickingStore, l.default.mainCamera), this.useTryCatch ? this._callSafe(this._picking.pickingCallback, this._picking.pickingStore.id, this._picking.pickingStore.depth) : this._picking.pickingCallback(this._picking.pickingStore.id, this._picking.pickingStore.depth), this._picking.doPick = !1, this.renderer.setClearColor.apply(this.renderer, this._picking.clearColorStore)
                        }
                        this.world.onPostRender()
                    }
                    if (this.useTryCatch)
                        for (var r = 0; r < this.callbacks.length; r++) {
                            var i = this.callbacks[r];
                            this._callSafe(i, t)
                        } else
                            for (var r = 0; r < this.callbacks.length; r++) {
                                var i = this.callbacks[r];
                                i(t)
                            }
                    if (this.stats && this.stats.update(this.renderer.info.toString() + "<br>Transforms: " + this.world.getSystem("TransformSystem").numUpdates + "<br>\n          Cached shaders: " + this.renderer.rendererRecord.shaderCache.size), this._takeSnapshots.length) {
                        var a = this.renderer.domElement.toDataURL();
                        if (this.useTryCatch)
                            for (var r = this._takeSnapshots.length - 1; r >= 0; r--) {
                                var i = this._takeSnapshots[r];
                                this._callSafe(i, a)
                            } else
                                for (var r = this._takeSnapshots.length - 1; r >= 0; r--) {
                                    var i = this._takeSnapshots[r];
                                    i(a)
                                }
                        this._takeSnapshots = []
                    }
                    this.animationId && this._requestAnimationFrame()
                }
            }, {
                key: "_buildLogo",
                value: function(e) {
                    var t = document.createElement("div"),
                        n = e && e.color ? e.color : oe.default.white,
                        r = oe.default.getLogo({
                            width: "70px",
                            height: "50px",
                            color: n
                        });
                    if ("" !== r) return t.innerHTML = '<a style="text-decoration: none;" href="http://docs.sumerian.amazonaws.com" target="_blank">' + r + "</a>", t.style.position = "absolute", t.style.zIndex = "2000", e ? "topright" === e || "topright" === e.position ? (t.style.top = "10px", t.style.right = "10px") : "topleft" === e || "topleft" === e.position ? (t.style.top = "10px", t.style.left = "10px") : "bottomright" === e || "bottomright" === e.position ? (t.style.bottom = "10px", t.style.right = "10px") : (t.style.bottom = "10px", t.style.left = "10px") : (t.style.top = "10px", t.style.right = "10px"), t.id = "sumerianlogo", t.style.webkitTouchCallout = "none", t.style.webkitUserSelect = "none", t.style.khtmlUserSelect = "none", t.style.mozUserSelect = "none", t.style.msUserSelect = "none", t.style.userSelect = "none", t.ondragstart = function() {
                        return !1
                    }, t
                }
            }, {
                key: "_addDebugKeys",
                value: function() {
                    var e = this,
                        t = {
                            50: "normals",
                            222: "normals",
                            51: "lit",
                            52: "color",
                            53: "wireframe",
                            54: "flat",
                            55: "texture",
                            191: "texture",
                            56: "+wireframe"
                        };
                    document.addEventListener("keydown", function(n) {
                        if (n.shiftKey) switch (n.which) {
                            case 32:
                                re.default.toggleFullScreen();
                                break;
                            case 13:
                                re.default.togglePointerLock();
                                break;
                            case 49:
                                e.renderSystem.setDebugMaterial();
                                break;
                            default:
                                t[n.which] && e.renderSystem.setDebugMaterial(t[n.which])
                        }
                    }, !1), document.addEventListener("mousedown", function(t) {
                        if (t.shiftKey) {
                            var n = t.clientX,
                                r = t.clientY;
                            e.pick(n, r, function(t, n) {
                                var r = e.world.entityManager.getEntityById(t);
                                console.log("Picked entity:", r, "At depth:", n)
                            })
                        }
                    }, !1)
                }
            }, {
                key: "addEventListener",
                value: function(e, t) {
                    !this._eventListeners[e] || this._eventListeners[e].indexOf(t) > -1 || "function" == typeof t && (this._eventListeners[e].push(t), 1 === this._eventListeners[e].length && this._enableEvent(e))
                }
            }, {
                key: "removeEventListener",
                value: function(e, t) {
                    if (this._eventListeners[e]) {
                        var n = this._eventListeners[e].indexOf(t);
                        n > -1 && this._eventListeners[e].splice(n, 1), 0 === this._eventListeners[e].length && this._disableEvent(e)
                    }
                }
            }, {
                key: "triggerEvent",
                value: function(e, t) {
                    t.type = e, this._eventTriggered[e] = t.domEvent, this._dispatchEvent(t), se.default.emit("sumerian.trigger." + e, t)
                }
            }, {
                key: "_dispatchEvent",
                value: function(e) {
                    for (var t = Object.keys(this._eventTriggered), n = 0; n < t.length; n++) {
                        var r = t[n];
                        if (this._eventTriggered[r] && this._eventListeners[r]) {
                            var i = {
                                entity: e.entity,
                                depth: e.depth,
                                x: e.x,
                                y: e.y,
                                type: r,
                                domEvent: this._eventTriggered[r],
                                id: e.id,
                                intersection: e.intersection
                            };
                            try {
                                for (var o = 0; o < this._eventListeners[r].length && !1 !== this._eventListeners[r][o](i); o++);
                            } catch (e) {
                                console.error(e)
                            }
                            this._eventTriggered[r] = null
                        }
                    }
                }
            }, {
                key: "_enableEvent",
                value: function(e) {
                    if (!this._events[e]) {
                        var t = function(t) {
                            var n = this,
                                r = void 0,
                                i = void 0;
                            if ("touchstart" === t.type || "touchend" === t.type || "touchmove" === t.type) r = t.changedTouches[0].pageX - t.changedTouches[0].target.getBoundingClientRect().left, i = t.changedTouches[0].pageY - t.changedTouches[0].target.getBoundingClientRect().top;
                            else {
                                var o = t.target || t.srcElement,
                                    a = o.getBoundingClientRect();
                                r = t.clientX - a.left, i = t.clientY - a.top
                            }
                            this._eventTriggered[e] = t, this.pick(r, i, function(e, t) {
                                var o = n.renderer.devicePixelRatio,
                                    a = n.world.entityManager.getEntityByIndex(e),
                                    s = l.default.mainCamera.getWorldPosition(r * o, i * o, n.renderer.viewportWidth, n.renderer.viewportHeight, t);
                                n._dispatchEvent({
                                    entity: a,
                                    depth: t,
                                    x: r,
                                    y: i,
                                    id: e,
                                    intersection: s
                                })
                            })
                        }.bind(this);
                        this.renderer.domElement.addEventListener(e, t), this._events[e] = t
                    }
                }
            }, {
                key: "_disableEvent",
                value: function(e) {
                    this._events[e] && this.renderer.domElement.removeEventListener(e, this._events[e]), this._events[e] = null
                }
            }, {
                key: "_startGameLoop",
                value: function() {
                    this.animationId || (this.start = -1, this._requestAnimationFrame())
                }
            }, {
                key: "startGameLoop",
                value: function() {
                    this.manuallyPaused = !1, this._startGameLoop()
                }
            }, {
                key: "_stopGameLoop",
                value: function() {
                    window.cancelAnimationFrame(this.animationId), this.animationId = 0
                }
            }, {
                key: "stopGameLoop",
                value: function() {
                    this.manuallyPaused = !0, this._stopGameLoop()
                }
            }, {
                key: "takeSnapshot",
                value: function(e) {
                    this._takeSnapshots.push(e)
                }
            }, {
                key: "pick",
                value: function(e, t, n, r) {
                    this._picking.x = e, this._picking.y = t, this._picking.skipUpdateBuffer = void 0 !== r && r, n && (this._picking.pickingCallback = n), this._picking.doPick = !0
                }
            }, {
                key: "pickSync",
                value: function(e, t, n) {
                    var r = this.renderer.clearColor;
                    this._picking.skipUpdateBuffer = void 0 !== n && n;
                    var i = r.clone();
                    this.renderer.setClearColor(0, 0, 0, 1), this.renderSystem.renderToPick(this.renderer, !1), this.renderer.setClearColor(i.r, i.g, i.b, i.a);
                    var o = {};
                    return this.renderer.pick(e, t, o, l.default.mainCamera), o
                }
            }, {
                key: "clear",
                value: function() {
                    this.stopGameLoop(), this.world.clear();
                    var e = this.renderer.domElement;
                    e.parentNode && e.parentNode.removeChild(e), se.default.clear(), ce.default.store = [], ce.default.hash = [], l.default.mainCamera = null, re.default.clearVisibilityChangeListeners(), this.world = null, this.renderer = null, this.renderSystem = null, this.renderSystems = null, this.callbacks = null, this.callbacksPreProcess = null, this.callbacksPreRender = null, this.callbacksNextFrame = null, this._takeSnapshots = null, this._events = null
                }
            }, {
                key: "addStats",
                value: function() {
                    this.stats = new N.default, this.stats.domElement.style.position = "absolute", this.stats.domElement.style.left = "10px", this.stats.domElement.style.top = "10px", document.body.appendChild(this.stats.domElement)
                }
            }, {
                key: "removeStats",
                value: function() {
                    this.stats && (this.stats.domElement.parentNode.removeChild(this.stats.domElement), this.stats = null)
                }
            }]), e
        }();
    t.default = ve
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(717),
        c = r(f),
        d = n(46),
        h = r(d),
        p = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "OcclusionGraphSystem", ["TransformComponent", "MeshRendererComponent", "MeshDataComponent"]));
                return e._octreeCreated = !1, e._octreeBuilt = !1, e._octree = null, e._addedEntities = [], e._removedEntities = [], e._updatedEntities = [], e
            }
            return a(t, e), s(t, [{
                key: "setupWorldBounds",
                value: function(e) {
                    this._octreeCreated || (this._octree = new c.default(new h.default(Vector3.ZERO, e, e, e), null), this._octreeCreated = !0)
                }
            }, {
                key: "process",
                value: function(e, t) {
                    if (!this._octreeBuilt && this._octreeCreated) {
                        for (var n = [], r = 0; r < e.length; r++) "DynamicOcclusion" != e[r].meshRendererComponent.cullMode || e[r].meshRendererComponent.materials.length > 0 && "NoBlending" != e[r].meshRendererComponent.materials[0].blendState.blending || n.push(e[r]);
                        this._octree.build(n), this._octreeBuilt = !0
                    } else if (this._addedEntities.length > 0 && (this._octree.insert(this._addedEntities), this._addedEntities = []), this._removedEntities.length > 0 && (this._octree.remove(this._removedEntities), this._removedEntities = []), this._updatedEntities.length > 0) {
                        for (var i = 0; i < this._updatedEntities.length; i++) this._octree.update(this._updatedEntities[i]);
                        this._updatedEntities = []
                    }
                }
            }, {
                key: "inserted",
                value: function(e) {
                    !this._octreeBuilt || "DynamicOcclusion" != e.meshRendererComponent.cullMode || e.meshRendererComponent.materials.length > 0 && "NoBlending" != e.meshRendererComponent.materials[0].blendState.blending || this._addedEntities.push(e)
                }
            }, {
                key: "deleted",
                value: function(e) {
                    !this._octreeBuilt || "DynamicOcclusion" != e.meshRendererComponent.cullMode || e.meshRendererComponent.materials.length > 0 && "NoBlending" != e.meshRendererComponent.materials[0].blendState.blending || this._removedEntities.push(e)
                }
            }, {
                key: "fixedUpdate",
                value: function(e, t) {
                    for (var n = 0; n < e.length; n++) "DynamicOcclusion" != e[n].meshRendererComponent.cullMode || !e[n].meshRendererComponent._occluderBoundDirty || e[n].meshRendererComponent.materials.length > 0 && "NoBlending" != e[n].meshRendererComponent.materials[0].blendState.blending || (e[n].meshRendererComponent._occluderBoundDirty = !1, this._updatedEntities.push(e[n]))
                }
            }]), t
        }(l.default);
    t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.bounds = e, this.parent = t, this.entities = [], this.leafNodes = [], this.children = [], this.activeChildren = 0, this.nActiveChildren = 0, this.occluder = new c.default(e)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(0),
        a = r(o),
        s = n(46),
        u = r(s),
        l = n(109),
        f = (r(l), n(718)),
        c = r(f),
        d = n(4);
    r(d);
    i.prototype.calculateOctantBounds = function(e) {
        var t = (e + 1) % 2 == 0,
            n = (e + 1) % 3 == 0,
            r = (e + 1) % 7 == 0,
            i = (e + 1) % 4 == 0,
            o = t ? 1 : -1,
            s = e > 3 ? 1 : -1,
            l = e < 3 ? n || i ? 1 : -1 : r || i ? 1 : -1,
            f = this.bounds.center.x + this.bounds.xExtent / 2 * o,
            c = this.bounds.center.y + this.bounds.yExtent / 2 * s,
            d = this.bounds.center.z + this.bounds.zExtent / 2 * l,
            h = new a.default(f, c, d);
        return new u.default(h, this.bounds.xExtent / 2, this.bounds.yExtent / 2, this.bounds.zExtent / 2)
    }, i.prototype.build = function(e) {
        this.leafNodes = [], this.children = [], this.activeChildren = 0, this.nActiveChildren = 0;
        for (var t = 0; t < e.length; t++) this.entities.push(e[t]);
        if (!(this.entities.length <= 1 || this.bounds.xExtent <= .5 && this.bounds.yExtent <= .5 && this.bounds.zExtent <= .5)) {
            for (var n = [], r = 0; r < 8; r++) n.push(this.calculateOctantBounds(r));
            for (var o = [
                    [],
                    [],
                    [],
                    [],
                    [],
                    [],
                    [],
                    []
                ], a = [], s = 0; s < this.entities.length; s++)
                for (var u = this.entities[s], l = 0; l < 8; l++)
                    if (n[l].containsBox(u.meshRendererComponent.worldBound)) {
                        o[l].push(u), a.push(u);
                        break
                    }
            for (var f = 0; f < a.length; f++) this.entities.splice(this.entities.indexOf(a[f]), 1);
            for (var c = 0; c < 8; c++) this.children[c] = new i(n[c], this), o[c].length > 0 && (this.children[c].build(o[c]), this.activeChildren |= 1 << c, this.nActiveChildren++);
            for (var d = 0; d < this.entities.length; d++) {
                var h = new i(this.entities[d].meshRendererComponent.worldBound, this);
                h.entities.push(this.entities[d]), this.leafNodes.push(h)
            }
        }
    }, i.prototype.insert = function(e) {
        if (this.entities.length <= 1 && 0 == this.activeChildren) return void this.build(e);
        if (this.bounds.xExtent <= .5 && this.bounds.yExtent <= .5 && this.bounds.zExtent <= .5)
            for (var t = 0; t < e.length; t++) {
                this.entities.push(e[t]);
                var n = new i(e[t].meshRendererComponent.worldBound, this);
                n.entities.push(e[t]), this.leafNodes.push(n)
            } else {
                for (var r = [
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        []
                    ], o = 0; o < e.length; o++) {
                    for (var a = e[o], s = !1, u = 0; u < 8; u++)
                        if (this.children[u].bounds.containsBox(a.meshRendererComponent.worldBound)) {
                            r[u].push(a), s = !0;
                            break
                        }
                    if (!s) {
                        this.entities.push(a);
                        var l = new i(a.meshRendererComponent.worldBound, this);
                        l.entities.push(a), this.leafNodes.push(l)
                    }
                }
                for (var f = 0; f < 8; f++) r[f].length > 0 && (this.children[f].insert(r[f]), this.activeChildren & 1 << f || (this.activeChildren |= 1 << f, this.nActiveChildren++))
            }
    }, i.prototype.remove = function(e) {
        for (var t = 0, n = 0; n < e.length; n++) {
            var r = this.entities.indexOf(e[n]);
            r >= 0 && (this.entities.splice(r, 1), this.leafNodes.splice(r, 1), t++), 1 == this.entities.length && 0 == this.activeChildren && (this.leafNodes = [])
        }
        if (t != e.length) {
            if (0 != this.activeChildren) {
                for (var i = [
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        []
                    ], o = 0; o < e.length; o++)
                    for (var a = e[o], s = 0; s < 8; s++)
                        if (this.children[s].bounds.containsBox(a.meshRendererComponent.worldBound)) {
                            i[s].push(a);
                            break
                        }
                for (var u = 0; u < 8; u++)
                    if (i[u].length > 0)
                        if (this.children[u].remove(i[u]), 0 == this.children[u].entities.length && 0 == this.children[u].nActiveChildren) {
                            if (this.activeChildren ^= 1 << u, 1 == --this.nActiveChildren) {
                                for (var l = -1, f = 0; f < 8; f++)
                                    if (this.activeChildren & 1 << f) {
                                        l = f;
                                        break
                                    }
                                0 == this.children[l].activeChildren && this.build(this.children[l].entities)
                            }
                        } else 0 == this.entities.length && 1 == this.nActiveChildren && this.children[u].entities.length >= 1 && 0 == this.children[u].nActiveChildren && this.build(this.children[u].entities)
            }
        } else if (0 == this.entities.length && 1 == this.nActiveChildren) {
            for (var c = -1, d = 0; d < 8; d++)
                if (this.activeChildren & 1 << d) {
                    c = d;
                    break
                }
            0 == this.children[c].activeChildren && this.build(this.children[c].entities)
        }
    }, i.prototype.update = function(e) {
        if (this.entities.indexOf(e) >= 0) {
            for (var t = this; !t.bounds.containsBox(e.meshRendererComponent.worldBound) && null != t.parent;) t = t.parent;
            return this.remove([e]), t.insert([e]), !0
        }
        for (var n = 0; n < 8; n++)
            if (this.activeChildren & 1 << n) {
                var r = this.children[n].update(e);
                if (r) return this.activeChildren & 1 << n && 0 == this.children[n].entities.length && 0 == this.children[n].activeChildren && (this.activeChildren ^= 1 << n, this.nActiveChildren--), !0
            }
        return !1
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e) {
        this.occlusionQuery = null, this.occlusionQueryR = null, this.isOccluded = !1, this.isOccludedL = !1, this.isOccludedR = !1, this.wasOccluded = !1, this.isOccQueryRunning = !1, this.isOccQueryRunningR = !1, this.transform = new u.default, this.transform.translation = e.center, this.transform.scale.setComponent(0, 2 * e.xExtent), this.transform.scale.setComponent(1, 2 * e.yExtent), this.transform.scale.setComponent(2, 2 * e.zExtent), this.transform.update(), this.nFramesUntilQuery = 0, this.nCoherentVisibilityFrames = 0
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(46),
        a = (r(o), n(0)),
        s = (r(a), n(10)),
        u = r(s);
    t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }

    function s(e, t) {
        for (var n = 0; n < t; ++n) e = Math.pow(e, 2) * (3 - 2 * e);
        return e
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var u = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        l = n(7),
        f = r(l),
        c = n(5),
        d = r(c),
        h = n(6),
        p = r(h),
        m = n(9),
        y = r(m),
        v = n(29),
        _ = r(v),
        g = n(10),
        b = r(g),
        x = n(354),
        w = r(x),
        E = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "GridRenderSystem", []));
                e.renderList = [], e.doRender = {
                    grid: !0
                }, e.scale = 62.5, e.count = 100, e.camera = null, e.lights = [], e.transform1 = new b.default, e.transform1.rotation.rotateX(-Math.PI / 2), e.transform1.scale.setDirect(e.scale, e.scale, e.scale), e.transform1.update(), e.transform2 = new b.default, e.transform2.rotation.rotateX(-Math.PI / 2), e.transform2.scale.setDirect(e.scale, e.scale, e.scale), e.transform2.update();
                var n = new y.default(S, "Grid Material");
                n.blendState.blending = "TransparencyBlending", n.uniforms.color = [.2, .2, .2, 1], n.depthState.write = !1, n.depthState.enabled = !0;
                var r = new y.default(S, "Grid Material");
                r.blendState.blending = "TransparencyBlending", r.uniforms.color = [.2, .2, .2, 1], r.depthState.write = !1, r.depthState.enabled = !0;
                var a = new w.default(e.count, e.count);
                e.grid1 = {
                    meshData: a,
                    materials: [n],
                    transform: e.transform1
                }, e.grid2 = {
                    meshData: a,
                    materials: [r],
                    transform: e.transform2
                }, e.oldHeightScale1 = 0, e.oldX1 = 0, e.oldZ1 = 0, e.oldHeightScale1 = 0, e.oldX1 = 0, e.oldZ1 = 0;
                var s = e;
                return d.default.addListener("sumerian.setCurrentCamera", function(e) {
                    s.camera = e.camera
                }), d.default.addListener("sumerian.setLights", function(e) {
                    s.lights = e
                }), e
            }
            return a(t, e), u(t, [{
                key: "inserted",
                value: function() {}
            }, {
                key: "deleted",
                value: function() {}
            }, {
                key: "process",
                value: function() {
                    if (this.doRender.grid) {
                        var e = Math.max(Math.abs(this.camera.translation.y) / 10, 0),
                            t = Math.pow(e, .15),
                            n = 1 - 2 * Math.abs(t - Math.floor(t) - .5);
                        n = Math.min(2 * n, 1);
                        var r = Math.pow(2, 4 * Math.floor(t) + 2) * this.scale,
                            i = Math.pow(e, .15) + .5,
                            o = 1 - 2 * Math.abs(i - Math.floor(i) - .5);
                        o = Math.min(2 * o, 1);
                        var a = Math.pow(2, 4 * Math.floor(i)) * this.scale;
                        n = s(n, 1), o = s(o, 1), this.grid1.materials[0].uniforms.scale = r, this.grid1.materials[0].uniforms.opacity = n, this.grid2.materials[0].uniforms.scale = a, this.grid2.materials[0].uniforms.opacity = o;
                        var u = Math.floor(this.camera.translation.x * this.count / r),
                            l = Math.floor(this.camera.translation.z * this.count / r);
                        r === this.oldHeightScale1 && u === this.oldX1 && l === this.oldZ1 || (this.transform1.scale.setDirect(r, r, r), this.transform1.translation.x = u * r / this.count, this.transform1.translation.z = l * r / this.count, this.transform1.update(), this.oldX1 = u, this.oldZ1 = l, this.oldHeightScale1 = r), u = Math.floor(this.camera.translation.x * this.count / a), l = Math.floor(this.camera.translation.z * this.count / a), a === this.oldHeightScale2 && u === this.oldX2 && l === this.oldZ2 || (this.transform2.scale.setDirect(a, a, a), this.transform2.translation.x = u * a / this.count, this.transform2.translation.z = l * a / this.count, this.transform2.update(), this.oldX2 = u, this.oldZ2 = l, this.oldHeightScale2 = a), n > o ? (this.renderList[0] = this.grid1, this.renderList[1] = this.grid2) : (this.renderList[0] = this.grid2, this.renderList[1] = this.grid1)
                    }
                }
            }, {
                key: "render",
                value: function(e) {
                    e.checkResize(this.camera), this.camera && this.doRender.grid && e.render(this.renderList, null, this.camera, this.lights, null, !1)
                }
            }, {
                key: "invalidateHandles",
                value: function(e) {
                    this.renderList.forEach(function(t) {
                        t.materials.forEach(function(t) {
                            e.invalidateMaterial(t)
                        }), e.invalidateMeshData(t.meshData)
                    })
                }
            }]), t
        }(f.default),
        S = {
            name: "GridRenderSystem.gridShader",
            glslversion: 300,
            attributes: {
                vertexPosition: p.default.POSITION
            },
            uniforms: {
                viewMatrix: _.default.VIEW_MATRIX,
                projectionMatrix: _.default.PROJECTION_MATRIX,
                worldMatrix: _.default.WORLD_MATRIX,
                color: [.55, .55, .55, 1],
                fogNear: _.default.NEAR_PLANE,
                fogFar: _.default.FAR_PLANE,
                opacity: 1,
                scale: 1
            },
            vshader: "\n  #ifdef WEBGL_1\n    #define in attribute\n    #define out varying\n  #endif\n\n    in vec3 vertexPosition;\n\n    uniform mat4 worldMatrix;\n    uniform mat4 viewMatrix;\n    uniform mat4 projectionMatrix;\n\n    out float depth;\n\n    void main(void) {\n      vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n      depth = -viewPosition.z;\n      gl_Position = projectionMatrix * viewPosition;\n    }",
            fshader: "\n  #ifdef WEBGL_1\n    #define in varying\n  #endif\n  \n    precision mediump float;\n\n    uniform vec4 color;\n    uniform float fogNear;\n    uniform float fogFar;\n    uniform float opacity;\n    uniform float scale;\n\n    in float depth;\n    #ifdef WEBGL_1\n      #define fragColor gl_FragColor\n    #else\n      out vec4 fragColor;\n    #endif\n\n    void main(void) {\n      fragColor = color;\n      float lerpVal = 1.0 - clamp(depth * 3.0 / min(scale, fogFar * 3.0), 0.0, 1.0);\n      fragColor.a = opacity * lerpVal;\n    }"
        };
    t.default = E
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(24),
        c = r(f),
        d = n(0),
        h = r(d),
        p = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "HtmlSystem", ["TransformComponent", "HtmlComponent"]));
                return n.renderer = e, n.styleCache = new Map, n
            }
            return a(t, e), s(t, [{
                key: "setStyle",
                value: function(e, t, n, r) {
                    var i = this.styleCache.get(e);
                    i || (i = new Map, this.styleCache.set(e, i)), n !== i.get(t) && (e.style[t] = n, r && (e.style["-webkit-" + t] = n), i.set(t, n))
                }
            }, {
                key: "clearStyleCache",
                value: function(e) {
                    this.styleCache.delete(e)
                }
            }, {
                key: "process",
                value: function(e) {
                    if (0 !== e.length)
                        for (var t = c.default.mainCamera, n = this.renderer, r = n.viewportWidth, i = n.viewportHeight, o = n.domElement.offsetLeft, a = n.domElement.offsetTop, s = 0; s < e.length; s++) {
                            var u = e[s],
                                l = u.htmlComponent;
                            if (l.useTransformComponent)
                                if (l.hidden) this.setStyle(l.domElement, "display", "none");
                                else if (y.set(t.translation).sub(u.transformComponent.sync().worldTransform.translation), t._direction.dot(y) > 0) this.setStyle(l.domElement, "display", "none");
                            else if (t.getScreenCoordinates(u.transformComponent.sync().worldTransform.translation, r, i, y), y.z < 0) this.setStyle(l.domElement, "display", "none");
                            else {
                                this.setStyle(l.domElement, "display", "");
                                var f = y.x / n.devicePixelRatio,
                                    d = y.y / n.devicePixelRatio;
                                l.pixelPerfect && (f = Math.floor(f), d = Math.floor(d)), this.setStyle(l.domElement, "transform", "translate(-50%, -50%) translate(" + (f + o) + "px, " + (d + a) + "px)", !0), this.setStyle(l.domElement, "zIndex", m - Math.round(y.z * m))
                            } else this.setStyle(l.domElement, "display", l.hidden ? "none" : ""), this.setStyle(l.domElement, "transform", "")
                        }
                }
            }, {
                key: "deleted",
                value: function(e) {
                    if (e && e.htmlComponent) {
                        var t = e.htmlComponent;
                        t.domElement.parentNode && t.domElement.parentNode.removeChild(t.domElement), t.domElement = null
                    }
                }
            }]), t
        }(l.default),
        m = 2147483647,
        y = new h.default;
    t.default = p
}, function(e, t, n) {
    "use strict";

    function r(e, t, n) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var r = arguments[0];
            e = r.width, t = r.height, n = r.length
        }
        this.xExtent = void 0 !== e ? .5 * e : .5, this.yExtent = void 0 !== t ? .5 * t : .5, this.zExtent = void 0 !== n ? .5 * n : .5;
        var i = o.default.defaultMap([o.default.POSITION]);
        o.default.call(this, i, 8, 24), this.indexModes[0] = "Lines", this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(6),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.rebuild = function() {
        var e = this.xExtent,
            t = this.yExtent,
            n = this.zExtent;
        return this.getAttributeBuffer(o.default.POSITION).set([-e, -t, -n, e, -t, -n, e, t, -n, -e, t, -n, -e, -t, n, e, -t, n, e, t, n, -e, t, n]), this.getIndexBuffer().set([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]), this
    }, r.prototype.clone = function() {
        return new r({
            width: 2 * this.xExtent,
            height: 2 * this.yExtent,
            length: 2 * this.zExtent
        })
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(355),
        o = r(i),
        a = n(3),
        s = r(a),
        u = s.default.warnOnce("Matrix2x2 has been renamed to Matrix2.", function() {
            o.default.apply(this, arguments)
        });
    u.prototype = Object.create(o.default.prototype), u.prototype.constructor = u;
    for (var l in o.default) u[l] = o.default[l];
    t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(31),
        o = r(i),
        a = n(3),
        s = r(a),
        u = s.default.warnOnce("Matrix3x3 has been renamed to Matrix3.", function() {
            o.default.apply(this, arguments)
        });
    u.prototype = Object.create(o.default.prototype), u.prototype.constructor = u;
    for (var l in o.default) u[l] = o.default[l];
    t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(38),
        o = r(i),
        a = n(3),
        s = r(a),
        u = s.default.warnOnce("Matrix4x4 has been renamed to Matrix4.", function() {
            o.default.apply(this, arguments)
        });
    u.prototype = Object.create(o.default.prototype), u.prototype.constructor = u;
    for (var l in o.default) u[l] = o.default[l];
    t.default = u
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(0),
        l = r(u),
        f = n(8),
        c = r(f),
        d = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return e.type = "MovementComponent", e.velocity = new l.default, e.rotationVelocity = new l.default, Object.seal(e), e
            }
            return a(t, e), s(t, [{
                key: "addVelocity",
                value: function(e) {
                    this.velocity.add(e)
                }
            }, {
                key: "setVelocity",
                value: function(e) {
                    this.velocity.set(e)
                }
            }, {
                key: "getVelocity",
                value: function() {
                    return this.velocity
                }
            }, {
                key: "addRotationVelocity",
                value: function(e) {
                    this.rotationVelocity.add(e)
                }
            }, {
                key: "setRotationVelocity",
                value: function(e) {
                    this.rotationVelocity.set(e)
                }
            }, {
                key: "getRotationVelocity",
                value: function() {
                    return this.rotationVelocity
                }
            }]), t
        }(c.default);
    d.type = "MovementComponent", t.default = d
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(7),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t() {
                return r(this, t), i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "MovementSystem", ["MovementComponent"]))
            }
            return o(t, e), a(t, [{
                key: "addVelocityToTransform",
                value: function(e, t, n) {
                    t.translation.addDirect(e.x * n, e.y * n, e.z * n)
                }
            }, {
                key: "addRotToTransform",
                value: function(e, t, n) {
                    t.rotation.rotateX(e.x * n), t.rotation.rotateY(e.y * n), t.rotation.rotateZ(e.z * n)
                }
            }, {
                key: "applyMovementToEntity",
                value: function(e) {
                    var t = e._world.tpf,
                        n = e.movementComponent.getRotationVelocity(),
                        r = e.movementComponent.getVelocity(),
                        i = e.transformComponent.transform;
                    this.addVelocityToTransform(r, i, t), this.addRotToTransform(n, i, t), e.transformComponent.setUpdated()
                }
            }, {
                key: "process",
                value: function(e) {
                    for (var t = 0; t < e.length; t++) this.applyMovementToEntity(e[t])
                }
            }]), t
        }(u.default);
    t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.id = null, this._volume = 1, this._frequency = 440, this._type = "sine", this._outNode = a.default.getContext().createGain(), this.connectTo()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(75),
        a = r(o),
        s = n(4),
        u = r(s);
    i.prototype.stop = function() {
        this._oscNode.stop(), this._oscNode = null
    }, i.prototype.play = function() {
        this._oscNode = a.default.getContext().createOscillator(), this._oscNode.connect(this._outNode), this._oscNode.frequency.value = this._frequency, this._oscNode.type = this._type, this._oscNode.start()
    }, i.prototype.update = function(e) {
        void 0 !== e.volume && (this._volume = u.default.clamp(e.volume, 0, 1), this._outNode.gain.value = this._volume), void 0 !== e.frequency && (this._frequency = e.frequency, this._oscNode && (this._oscNode.frequency.value = this._frequency)), void 0 !== e.type && -1 !== i.TYPES.indexOf(e.type) && (this._type = e.type, this._oscNode && (this._oscNode.type = this._type))
    }, i.prototype.connectTo = function(e) {
        if (!a.default.isSupported()) return void console.warn("WebAudio not supported");
        if (this._outNode.disconnect(), e) {
            e instanceof Array || (e = [e]);
            for (var t = 0; t < e.length; t++) this._outNode.connect(e[t])
        }
    }, i.TYPES = ["sine", "square", "sawtooth", "triangle", "custom"], t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        e = e || {}, this.prepare = e.prepare ? e.prepare : function() {}, this.apply = e.apply ? e.apply : function() {}, this.enabled = void 0 === e.enabled || !0 === e.enabled
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(7),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t(e) {
                r(this, t);
                var n = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "PickingSystem", ["MeshRendererComponent", "TransformComponent"]));
                return n.passive = !0, n.pickRay = null, n.onPick = null, e = e || {}, n.setPickLogic(e.pickLogic || null), n
            }
            return o(t, e), a(t, [{
                key: "setPickLogic",
                value: function(e) {
                    this.pickLogic = e, e && -1 === this.interests.indexOf("MeshDataComponent") && this.interests.push("MeshDataComponent")
                }
            }, {
                key: "inserted",
                value: function(e) {
                    e.meshRendererComponent.isPickable && this.pickLogic && this.pickLogic.added(e)
                }
            }, {
                key: "deleted",
                value: function(e) {
                    this.pickLogic && this.pickLogic.removed(e)
                }
            }, {
                key: "process",
                value: function(e) {
                    if (this.pickRay && this.onPick) {
                        for (var t = [], n = 0; n < e.length; n++) {
                            var r = e[n],
                                i = r.meshRendererComponent;
                            if (i.isPickable)
                                if (this.pickLogic) {
                                    this.pickLogic.isConstructed(r) || this.pickLogic.added(r);
                                    var o = this.pickLogic.getPickResult(this.pickRay, r);
                                    o && o.distances && o.distances.length && t.push({
                                        entity: r,
                                        intersection: o
                                    })
                                } else if (i.worldBound) {
                                var o = i.worldBound.intersectsRayWhere(this.pickRay);
                                o && o.distances.length && t.push({
                                    entity: r,
                                    intersection: o
                                })
                            }
                        }
                        t.sort(function(e, t) {
                            return e.intersection.distances[0] - t.intersection.distances[0]
                        }), this.onPick(t)
                    }
                }
            }]), t
        }(u.default);
    t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(5),
        c = r(f),
        d = n(6),
        h = r(d),
        p = n(29),
        m = r(p),
        y = n(59),
        v = r(y),
        _ = n(33),
        g = r(_),
        b = n(9),
        x = r(b),
        w = n(15),
        E = r(w),
        S = n(50),
        M = r(S),
        C = n(94),
        T = r(C),
        R = function(e) {
            function t(e) {
                i(this, t);
                var n = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "PipRenderSystem", null));
                n.renderSystem = e, n.target = new g.default(512, 512), n.outPass = new M.default(E.default.copy);
                var r = n;
                n.outPass.render = function(e, t, n) {
                    this.material.setTexture("DIFFUSE_MAP", n), e.render(this.renderable, null, T.default.camera, [], r.target, !0)
                };
                var a = new x.default(A);
                return a.setTexture("DIFFUSE_MAP", n.target), n.quad = new v.default(1, 1), n.aspect = null, n.width = null, n.height = null, n.renderableQuad = {
                    meshData: n.quad,
                    materials: [a]
                }, n.renderList = [], n.usePostEffects = !1, n.camera = null, n.size = null, n.dirty = !1, c.default.addListener("sumerian.setPipCamera", function(e) {
                    n.camera = e.camera, n.usePostEffects = void 0 !== e.usePostEffects && e.usePostEffects, n.dirty = !0
                }), n._viewportResizeHandler = function(e) {
                    this.size = e, this.dirty = !0
                }.bind(n), c.default.addListener("sumerian.viewportResize", n._viewportResizeHandler, !0), n
            }
            return a(t, e), s(t, [{
                key: "updateQuad",
                value: function(e, t, n, r, i) {
                    e.getAttributeBuffer(h.default.POSITION).set([t, n, 0, t, n + i, 0, t + r, n + i, 0, t + r, n, 0]), e.setVertexDataUpdated()
                }
            }, {
                key: "render",
                value: function(e) {
                    if (this.camera && this.size) {
                        this.renderer = e, this.dirty && (this.dirty = !1, e.checkResize(this.camera, !0));
                        var t = this.camera.aspect,
                            n = .2 * this.size.height,
                            r = n * t;
                        t === this.aspect && r === this.width && n === this.height || (this.aspect = t, this.width = r, this.height = n, this.updateQuad(this.quad, 10, 10, r, n)), e.updateShadows(this.renderSystem.partitioner, this.renderSystem.entities, this.renderSystem.lights);
                        for (var i = 0; i < this.renderSystem.preRenderers.length; i++) {
                            this.renderSystem.preRenderers[i].process(e, this.renderSystem.entities, this.renderSystem.partitioner, this.camera, this.renderSystem.lights)
                        }
                        if (this.renderSystem.partitioner.process(this.camera, this.renderSystem.entities, this.renderList), this.usePostEffects && this.renderSystem.composers.length > 0) {
                            var o = this.renderSystem.composers[0],
                                a = o.passes.length - 1,
                                s = o.passes[a];
                            o.passes[a] = this.outPass, o.render(e, this.renderSystem.currentTpf, this.camera, this.renderSystem.lights, null, !0), o.passes[a] = s
                        } else {
                            e.render(this.renderList, null, this.camera, this.renderSystem.lights, this.target, !0, null)
                        }
                        e.render(this.renderableQuad, null, T.default.camera, [], null, !1)
                    }
                }
            }]), t
        }(l.default),
        A = {
            name: "PipRenderSystem.renderPipQuad",
            glslversion: 300,
            defines: {
                EDGE: !0
            },
            attributes: {
                vertexPosition: h.default.POSITION,
                vertexUV0: h.default.TEXCOORD0
            },
            uniforms: {
                viewProjectionMatrix: m.default.VIEW_PROJECTION_MATRIX,
                worldMatrix: m.default.WORLD_MATRIX,
                diffuseMap: m.default.DIFFUSE_MAP,
                resolution: m.default.RESOLUTION
            },
            vshader: "\n    #ifdef WEBGL_1\n      #define in attribute\n      #define out varying\n    #endif\n\n    in vec3 vertexPosition;\n    in vec2 vertexUV0;\n\n    uniform mat4 viewProjectionMatrix;\n    uniform mat4 worldMatrix;\n    uniform vec2 resolution;\n\n    out vec2 texCoord0;\n\n    void main(void) {\n      texCoord0 = vertexUV0;\n\n      gl_Position = vec4(\n        2.0 * vertexPosition.x / resolution.x - 1.0,\n        2.0 * vertexPosition.y / resolution.y - 1.0,\n        -1.0,\n        1.0\n      );\n    }",
            fshader: "\n    #ifdef WEBGL_1\n      #define in varying\n      #define texture texture2D\n      #define fragColor gl_FragColor\n    #else\n    \tout vec4 fragColor;\n    #endif\n\n    uniform sampler2D diffuseMap;\n    uniform vec2 resolution;\n\n    in vec2 texCoord0;\n\n    const vec4 edgeCol = vec4(0.2, 0.2, 0.2, 1.0);\n\n    void main(void) {\n      vec4 color = texture(diffuseMap, texCoord0);\n      #ifdef EDGE\n        float edge = step(10.0 / resolution.x, min(texCoord0.x, 1.0 - texCoord0.x)) * step(10.0 / resolution.y, min(texCoord0.y, 1.0 - texCoord0.y));\n        fragColor = mix(edgeCol, color, edge);\n      #else\n        fragColor = color;\n      #endif\n    }"
        };
    t.default = R
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        this.invRay = new u.default, this.invMatrix = new f.default
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(272),
        a = r(o),
        s = n(66),
        u = r(s),
        l = n(38),
        f = r(l);
    i.prototype.getPickResult = function(e, t) {
        var n = t.meshDataComponent.meshData.__boundingTree;
        if (!n) return null;
        var r = t.transformComponent.sync().worldTransform;
        this.invMatrix.copy(r.matrix).invert(), this.invRay.origin.set(e.origin).applyPostPoint(this.invMatrix), this.invRay.direction.set(e.direction).applyPostVector(this.invMatrix);
        var i = n.findPick(this.invRay, t),
            o = {};
        return i.length > 0 && (i.sort(function(e, t) {
            return e.distance - t.distance
        }), o.distances = [], o.points = [], o.vertices = [], i.forEach(function(e) {
            o.distances.push(e.distance), o.points.push(e.point), o.vertices.push(e.vertices)
        })), o
    }, i.prototype.added = function(e) {
        this.isConstructed(e) || this.rebuild(e)
    }, i.prototype.removed = function(e) {
        e.meshDataComponent && e.meshDataComponent.meshData && (e.meshDataComponent.meshData.__boundingTree = null)
    }, i.prototype.isConstructed = function(e) {
        return !!e.meshDataComponent.meshData.__boundingTree
    }, i.prototype.rebuild = function(e) {
        e.meshDataComponent.meshData.__boundingTree = new a.default, e.meshDataComponent.meshData.__boundingTree.construct(e)
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e) {
        function t() {
            r = (r + 1) % 256, i = (i + n[r]) % 256;
            var e = n[r];
            return n[r] = n[i], n[i] = e, n[(n[r] + n[i]) % 256]
        }
        var n = [],
            r = 0,
            i = 0;
        this.init = function(e) {
            for (var t = 0; t < 256; t += 1) n[t] = t;
            for (var r = 0, i = 0; i < 256; i += 1) {
                r = (r + n[i] + e.charCodeAt(i % e.length)) % 256;
                var o = n[i];
                n[i] = n[r], n[r] = o
            }
        }, this.init(e), this.getRandomNumber = function() {
            for (var e = 0, n = 1, r = 0; r < 8; r += 1) e += t() * n, n *= 256;
            return e / 0x10000000000000000
        }
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    }), t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(359),
        c = (r(f), n(0)),
        d = r(c),
        h = n(26),
        p = r(h),
        m = function(e) {
            function t() {
                i(this, t);
                var e = o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "ReflectionProbeSystem", ["TransformComponent", "MeshRendererComponent", "MeshDataComponent"]));
                return e.reflectionProbes = [], e
            }
            return a(t, e), s(t, [{
                key: "addReflectionProbes",
                value: function(e, t) {
                    for (var n = this, r = 0; r < t.length; r++) ! function(r) {
                        n.reflectionProbes.push(t[r]), e.renderSystem.preRenderers.push(t[r]), V.delay(2, null, function() {
                            t[r].updateProbe()
                        })
                    }(r)
                }
            }, {
                key: "removeReflectionProbes",
                value: function(e, t) {
                    var n = this.reflectionProbes.findIndex(t);
                    n > 0 && this.reflectionProbes.splice(n, 1);
                    var r = e.renderSystem.preRenderers.findIndex(t);
                    r > 0 && e.renderSystem.preRenderers.splice(r, 1)
                }
            }, {
                key: "process",
                value: function(e, t) {
                    for (var n = e.filter(function(e) {
                            return e.meshRendererComponent.receivesReflections
                        }), r = 0; r < n.length; r++) {
                        for (var i = null, o = 1 / 0, a = null, s = 1 / 0, u = 0; u < this.reflectionProbes.length; u++)
                            if (this.reflectionProbes[u].influenceArea.intersectsBoundingBox(n[r].meshRendererComponent.worldBound)) {
                                var l = new d.default(0, 0, 0).add(this.reflectionProbes[u].translation).sub(n[r].transformComponent.worldTransform.translation).length();
                                o > l ? (a = i, i = this.reflectionProbes[u], s = o, o = l) : s > l && (a = this.reflectionProbes[u], s = l)
                            }
                        if (null != i)
                            for (var f = 0; f < n[r].meshRendererComponent.materials.length; f++) n[r].meshRendererComponent.materials[f].uniforms.primaryReflProbeRotationMatrix = i.rotation, n[r].meshRendererComponent.materials[f].uniforms.primaryReflProbeCenter = [i.probeCenter.x, i.probeCenter.y, i.probeCenter.z], n[r].meshRendererComponent.materials[f].uniforms.primaryReflProbeInfluenceRadius = i.influenceRadius, n[r].meshRendererComponent.materials[f].uniforms.primaryReflProbeInvDimensions = [1 / i.dimensions.x, 1 / i.dimensions.y, 1 / i.dimensions.z], n[r].meshRendererComponent.materials[f].uniforms.primaryReflProbeInvTranslation = [-i.translation.x, -i.translation.y, -i.translation.z], n[r].meshRendererComponent.materials[f].setTexture(Shader.PRIMARY_REFLECTION_PROBE, i.specularIrradianceMap);
                        else
                            for (var c = 0; c < n[r].meshRendererComponent.materials.length; c++) n[r].meshRendererComponent.materials[c].removeTexture(Shader.PRIMARY_REFLECTION_PROBE);
                        if (null != a && p.default.Webgl2)
                            for (var h = 0; h < n[r].meshRendererComponent.materials.length; h++) n[r].meshRendererComponent.materials[h].uniforms.secondaryReflProbeRotationMatrix = a.rotation, n[r].meshRendererComponent.materials[h].uniforms.secondaryReflProbeInvDimensions = [1 / a.dimensions.x, 1 / a.dimensions.y, 1 / a.dimensions.z], n[r].meshRendererComponent.materials[h].uniforms.secondaryReflProbeInvTranslation = [-a.translation.x, -a.translation.y, -a.translation.z], n[r].meshRendererComponent.materials[h].setTexture(Shader.SECONDARY_REFLECTION_PROBE, a.specularIrradianceMap);
                        else
                            for (var m = 0; m < n[r].meshRendererComponent.materials.length; m++) n[r].meshRendererComponent.materials[m].removeTexture(Shader.SECONDARY_REFLECTION_PROBE)
                    }
                }
            }]), t
        }(l.default);
    t.default = m
}, function(e, t, n) {
    "use strict";

    function r(e, t, n) {
        if (1 === arguments.length && arguments[0] instanceof Object) {
            var r = arguments[0];
            e = r.width, t = r.height, n = r.length
        }
        this.xExtent = void 0 !== e ? .5 * e : .5, this.yExtent = void 0 !== t ? .5 * t : .5, this.zExtent = void 0 !== n ? .5 * n : .5;
        var i = o.default.defaultMap([o.default.POSITION]);
        o.default.call(this, i, 8, 36), this.rebuild()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(6),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.prototype.rebuild = function() {
        var e = this.xExtent,
            t = this.yExtent,
            n = this.zExtent;
        return this.getAttributeBuffer(o.default.POSITION).set([-e, -t, -n, e, -t, -n, e, t, -n, -e, t, -n, -e, -t, n, e, -t, n, e, t, n, -e, t, n]), this.getIndexBuffer().set([2, 1, 0, 0, 3, 2, 5, 6, 7, 7, 4, 5, 7, 3, 0, 0, 4, 7, 1, 2, 6, 6, 5, 1, 6, 2, 3, 3, 7, 6, 0, 1, 5, 5, 4, 0]), this
    }, r.prototype.clone = function() {
        return new r({
            width: 2 * this.xExtent,
            height: 2 * this.yExtent,
            length: 2 * this.zExtent
        })
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i() {
        var e = this;
        this.ajax = new f.default, this.soundHandler = new a.default({}, function(t, n) {
            return e.ajax.load(t, !!n && n.noCache)
        }, function() {}, function(t, n) {
            return e.ajax.load(t, !!n && n.noCache)
        })
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(211),
        a = r(o),
        s = n(75),
        u = r(s),
        l = n(116),
        f = r(l),
        c = n(56),
        d = r(c),
        h = n(17),
        p = r(h);
    i.prototype.clear = function() {
        this.ajax.clear(), this.soundHandler.clear()
    }, i.prototype.loadSound = function(e, t) {
        if (!u.default.isSupported()) return p.default.reject(new Error("AudioContext is not supported!"));
        var n = d.default.createUniqueId("sound");
        t = t || {}, t.audioRefs = {};
        var r = d.default.getAfterLast(e, ".");
        t.audioRefs[r] = e;
        var i = this.soundHandler._create();
        return this.soundHandler._objects.set(n, i), this.soundHandler.update(n, t, {})
    }, t.default = i
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        this.substepSize = t || .01, this._spline = e, this._segment = 0, this._localT = 0, this._pointer = e.controlPoints[0].clone()
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(360),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype._localInterpolation = function(e) {
        var t = this._spline.controlPoints[3 * this._segment + 0],
            n = this._spline.controlPoints[3 * this._segment + 1],
            r = this._spline.controlPoints[3 * this._segment + 2],
            i = this._spline.controlPoints[3 * this._segment + 3];
        o.default.cubicInterpolation(t, n, r, i, this._localT, e)
    }, r.prototype._step = function(e, t) {
        if (this._localT += e, this._localT > 1 && (this._localT -= 1, ++this._segment >= this._spline.segments)) return void t.copy(this._spline.controlPoints[this._spline.controlPoints.length - 1]);
        this._localInterpolation(t)
    }, r.prototype.advance = function(e, t) {
        for (var n = 0; n < e && this._segment < this._spline.segments;) this._step(this.substepSize, t), n += this._pointer.distance(t), this._pointer.copy(t)
    }, r.prototype.canWalk = function() {
        return this._segment < this._spline.segments
    }, t.default = r
}, function(e, t, n) {
    "use strict";
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var r = n(56),
        i = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(r);
    t.default = i.default
}, function(e, t, n) {
    "use strict";

    function r(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function i(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function o(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var a = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        s = n(8),
        u = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(s),
        l = function(e) {
            function t(e) {
                r(this, t);
                var n = i(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this));
                return n.type = "TextComponent", n.text = e || "", n.dirty = !0, Object.seal(n), n
            }
            return o(t, e), a(t, [{
                key: "setText",
                value: function(e) {
                    return this.text !== e && (this.text = e, this.dirty = !0), this
                }
            }]), t
        }(u.default);
    l.type = "TextComponent", t.default = l
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
    }

    function o(e, t) {
        if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !t || "object" != typeof t && "function" != typeof t ? e : t
    }

    function a(e, t) {
        if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
        e.prototype = Object.create(t && t.prototype, {
            constructor: {
                value: e,
                enumerable: !1,
                writable: !0,
                configurable: !0
            }
        }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var s = function() {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var r = t[n];
                    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r)
                }
            }
            return function(t, n, r) {
                return n && e(t.prototype, n), r && e(t, r), t
            }
        }(),
        u = n(7),
        l = r(u),
        f = n(361),
        c = r(f),
        d = n(70),
        h = r(d),
        p = function(e) {
            function t() {
                return i(this, t), o(this, (t.__proto__ || Object.getPrototypeOf(t)).call(this, "TextSystem", ["TextComponent"]))
            }
            return a(t, e), s(t, [{
                key: "process",
                value: function(e) {
                    for (var t = 0; t < e.length; t++) {
                        var n = e[t],
                            r = n.textComponent;
                        if (r.dirty) {
                            if (n.hasComponent("MeshDataComponent")) n.getComponent("MeshDataComponent").meshData = c.default.fromString(r.text);
                            else {
                                var i = c.default.fromString(r.text),
                                    o = new h.default(i);
                                n.setComponent(o)
                            }
                            this.dirty = !1
                        }
                    }
                }
            }]), t
        }(l.default);
    t.default = p
}, function(e, t, n) {
    "use strict";

    function r() {
        o.default.call(this)
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var i = n(356),
        o = function(e) {
            return e && e.__esModule ? e : {
                default: e
            }
        }(i);
    r.prototype = Object.create(o.default.prototype), r.prototype.constructor = r, r.sources = [0, 1 / 15, 2 / 15, .2, 4 / 15, 5 / 15, .4, 7 / 15, 8 / 15, .6, 10 / 15, 11 / 15, .8, 13 / 15, 14 / 15, 1], r.evaluate1d = function(e, t) {
        var n = o.default.split(e / t),
            i = 15 & o.default.shifter[255 & n.i0],
            a = 15 & o.default.shifter[255 & n.i1],
            s = 0;
        return s += n.f0 * r.sources[i], s += n.f1 * r.sources[a]
    }, r.evaluate2d = function(e, t, n) {
        var i = o.default.split(e / n),
            a = o.default.split(t / n),
            s = 15 & o.default.shifter[o.default.shifter[255 & a.i0] + i.i0 & 255],
            u = 15 & o.default.shifter[o.default.shifter[255 & a.i0] + i.i1 & 255],
            l = 15 & o.default.shifter[o.default.shifter[255 & a.i1] + i.i0 & 255],
            f = 15 & o.default.shifter[o.default.shifter[255 & a.i1] + i.i1 & 255],
            c = 0;
        return c += a.f0 * i.f0 * r.sources[s], c += a.f0 * i.f1 * r.sources[u], c += a.f1 * i.f0 * r.sources[l], c += a.f1 * i.f1 * r.sources[f]
    }, r.evaluate3d = function(e, t, n, i) {
        var a = o.default.split(e / i),
            s = o.default.split(t / i),
            u = o.default.split(n / i),
            l = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i0] + s.i0 & 255] + a.i0 & 255],
            f = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i0] + s.i0 & 255] + a.i1 & 255],
            c = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i0] + s.i1 & 255] + a.i0 & 255],
            d = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i0] + s.i1 & 255] + a.i1 & 255],
            h = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i1] + s.i0 & 255] + a.i0 & 255],
            p = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i1] + s.i0 & 255] + a.i1 & 255],
            m = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i1] + s.i1 & 255] + a.i0 & 255],
            y = 15 & o.default.shifter[o.default.shifter[o.default.shifter[255 & u.i1] + s.i1 & 255] + a.i1 & 255],
            v = 0;
        return v += u.f0 * s.f0 * a.f0 * r.sources[l], v += u.f0 * s.f0 * a.f1 * r.sources[f], v += u.f0 * s.f1 * a.f0 * r.sources[c], v += u.f0 * s.f1 * a.f1 * r.sources[d], v += u.f1 * s.f0 * a.f0 * r.sources[h], v += u.f1 * s.f0 * a.f1 * r.sources[p], v += u.f1 * s.f1 * a.f0 * r.sources[m], v += u.f1 * s.f1 * a.f1 * r.sources[y]
    }, r.evaluate4d = function(e, t, n, i, a) {
        var s = o.default.split(e / a),
            u = o.default.split(t / a),
            l = o.default.split(n / a),
            f = o.default.split(i / a),
            c = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i0 & 255] + u.i0 & 255] + s.i0 & 255],
            d = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i0 & 255] + u.i0 & 255] + s.i1 & 255],
            h = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i0 & 255] + u.i1 & 255] + s.i0 & 255],
            p = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i0 & 255] + u.i1 & 255] + s.i1 & 255],
            m = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i1 & 255] + u.i0 & 255] + s.i0 & 255],
            y = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i1 & 255] + u.i0 & 255] + s.i1 & 255],
            v = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i1 & 255] + u.i1 & 255] + s.i0 & 255],
            _ = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i0] + l.i1 & 255] + u.i1 & 255] + s.i1 & 255],
            g = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i0 & 255] + u.i0 & 255] + s.i0 & 255],
            b = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i0 & 255] + u.i0 & 255] + s.i1 & 255],
            x = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i0 & 255] + u.i1 & 255] + s.i0 & 255],
            w = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i0 & 255] + u.i1 & 255] + s.i1 & 255],
            E = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i1 & 255] + u.i0 & 255] + s.i0 & 255],
            S = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i1 & 255] + u.i0 & 255] + s.i1 & 255],
            M = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i1 & 255] + u.i1 & 255] + s.i0 & 255],
            C = 15 & o.default.shifter[o.default.shifter[o.default.shifter[o.default.shifter[255 & f.i1] + l.i1 & 255] + u.i1 & 255] + s.i1 & 255],
            T = 0;
        return T += f.f0 * l.f0 * u.f0 * s.f0 * r.sources[c], T += f.f0 * l.f0 * u.f0 * s.f1 * r.sources[d], T += f.f0 * l.f0 * u.f1 * s.f0 * r.sources[h], T += f.f0 * l.f0 * u.f1 * s.f1 * r.sources[p], T += f.f0 * l.f1 * u.f0 * s.f0 * r.sources[m], T += f.f0 * l.f1 * u.f0 * s.f1 * r.sources[y], T += f.f0 * l.f1 * u.f1 * s.f0 * r.sources[v], T += f.f0 * l.f1 * u.f1 * s.f1 * r.sources[_], T += f.f1 * l.f0 * u.f0 * s.f0 * r.sources[g], T += f.f1 * l.f0 * u.f0 * s.f1 * r.sources[b], T += f.f1 * l.f0 * u.f1 * s.f0 * r.sources[x], T += f.f1 * l.f0 * u.f1 * s.f1 * r.sources[w], T += f.f1 * l.f1 * u.f0 * s.f0 * r.sources[E], T += f.f1 * l.f1 * u.f0 * s.f1 * r.sources[S], T += f.f1 * l.f1 * u.f1 * s.f0 * r.sources[M], T += f.f1 * l.f1 * u.f1 * s.f1 * r.sources[C]
    }, t.default = r
}, function(e, t, n) {
    "use strict";

    function r(e) {
        return e && e.__esModule ? e : {
            default: e
        }
    }

    function i(e, t) {
        this.defaultCameraEntity, this.defaultLights = [], this.loader, this.sumerian = e, this.baseUrl = t, this.alreadyLoading = !1
    }
    Object.defineProperty(t, "__esModule", {
        value: !0
    });
    var o = n(30),
        a = r(o),
        s = n(125),
        u = r(s),
        l = n(218),
        f = r(l),
        c = n(160),
        d = r(c),
        h = n(0),
        p = r(h),
        m = n(81),
        y = r(m),
        v = n(123),
        _ = r(v),
        g = n(152),
        b = r(g),
        x = n(4),
        w = r(x);
    i.prototype.loadModel = function(e, t, n) {
        if (!0 === this.alreadyLoading) return console.debug("Already loading a model.... hang on!"), this;
        console.log("Start loading model ", e + ", id = ", t), this.alreadyLoading = !0;
        var r = {};
        this.removeEntities(this.sumerian.world.getEntities()), n && (r.useDefaultCamera = !0, r.useDefaultLight = !0);
        var i = this.initLoader(this.baseUrl + e),
            o = this.loadScene.bind(this, this.loader, r),
            a = this._fitInCameraViewFromBoundingSystem.bind(this);
        return this.loader.load(i, null).then(o).then(a).then(null, function(n) {
            console.error("Cannot load model ", e + ", id = ", t, " due to ", n, ". Aborting...")
        }).then(function() {
            this.alreadyLoading = !1
        }.bind(this)), this
    }, i.prototype.initLoader = function(e) {
        var t = e.lastIndexOf("/") + 1,
            n = e.slice(0, t),
            r = e.slice(t);
        return this.loader = new b.default({
            world: this.sumerian.world,
            rootPath: n
        }), r
    }, i.prototype._fitInCameraViewFromBoundingSystem = function() {
        var e = function(e) {
                var n = this.defaultCameraEntity;
                if (!n) throw new Error("The default camera entity does not exist.");
                var r = n.cameraComponent ? n.cameraComponent.camera : null,
                    i = n.scriptComponent ? n.scriptComponent.scripts : null,
                    o = i && i.length > 0 ? i[0] : null,
                    a = o.context,
                    s = o.parameters;
                if (!r || !a || !s) throw new Error("The default camera does not exist or the default camera does not have cameraScript bound.");
                var u = t(r, e);
                if (a && a.targetSpherical && a.goingToLookAt) isFinite(u.depth) && (a.targetSpherical.x = u.depth, s.maxZoomDistance = 10 * u.depth), a.goingToLookAt.set(u.center);
                else {
                    var l = n.transformComponent.transform.translation;
                    l.set(r._direction).invert().scale(2 * u.diameter), l.add(u.center), n.transformComponent.setUpdated()
                }
                a && (a.dirty = !0)
            }.bind(this),
            t = function(e, t) {
                var n = null,
                    r = null,
                    i = null;
                if (t.center) {
                    var n = t.center;
                    r = 2 * (t.radius || Math.max(t.xExtent, t.yExtent, t.zExtent)), i = r / Math.tan(e.fov * w.default.DEG_TO_RAD) * 2
                } else n = t, r = 1;
                return console.debug("center:", n, ", depth:", i, ", diameter:", r, "bounds:", t), {
                    center: n,
                    depth: i,
                    diameter: r
                }
            };
        this.sumerian.world.getSystem("BoundingUpdateSystem").getWorldBound(e.bind(this))
    }, i.prototype.loadScene = function(e, t, n) {
        var r = function(e, n) {
            var r = [],
                i = [],
                o = function(t) {
                    var o = n.entities[t];
                    t === e ? r.unshift(o) : o.hasComponent("CameraComponent") ? r.push(o) : o.hasComponent("LightComponent") && i.push(o), console.debug("loadEntity: " + t)
                };
            Object.keys(n.entities).forEach(o.bind(this)), 0 === r.length || t.useDefaultCamera ? this.addDefaultCamera() : this.setDefaultCamera(r[0]), (0 === i.length || t.useDefaultLight) && this.addDefaultLights()
        };
        for (var i in n)
            if ("scene" === b.default.getTypeForRef(i)) {
                ! function(e) {
                    e.environmentRef && delete e.environmentRef, e.initialCameraRef && t.useDefaultCamera && delete e.initialCameraRef
                }(n[i]), e.preload(n, !0);
                var o = r.bind(this, n[i].initialCameraRef);
                return function(t, n) {
                    var r = {
                        preloadBinaries: !0
                    };
                    return e.load(t, r).then(n)
                }(i, o)
            }
        throw new Error("Config in bundle ", n, " contained no scene?!")
    }, i.prototype.removeEntities = function(e) {
        return e && e.length ? (e.forEach(function(e) {
            e.removeFromWorld(!0)
        }), this.sumerian.world.process(), this) : this
    }, i.prototype.addDefaultLights = function() {
        var e = this.sumerian.world.getSystem("LightingSystem");
        if (!e) throw new Error("Lighting system does not exist in the world. Please set it");
        var t = function() {
            var e = [],
                t = new y.default(new p.default(1, 1, 1));
            t.intensity = .3, t.specularIntensity = .6;
            var n = this.sumerian.world.createEntity("filllight");
            n.setComponent(new _.default(t)), n.transformComponent.transform.translation.set(.2, .2, 1), n.transformComponent.transform.lookAt(p.default.ZERO, p.default.UNIT_Y), n.addToWorld(), e.push(t);
            var r = new y.default(new p.default(1, 1, 1));
            r.intensity = .5, r.specularIntensity = .9;
            var i = this.sumerian.world.createEntity("highlight");
            i.setComponent(new _.default(r)), i.transformComponent.transform.translation.set(-.2, .5, 1), i.transformComponent.transform.lookAt(p.default.ZERO, p.default.UNIT_Y), i.addToWorld(), e.push(r);
            var o = new y.default(new p.default(1, 1, 1));
            o.intensity = .35, o.specularIntensity = .5;
            var a = this.sumerian.world.createEntity("backlight");
            return a.setComponent(new _.default(o)), a.transformComponent.transform.translation.set(-.2, .5, -1), a.transformComponent.transform.lookAt(p.default.ZERO, p.default.UNIT_Y), a.addToWorld(), e.push(o), e
        }.bind(this);
        return this.defaultLights = 3 === this.defaultLights.length ? this.defaultLights : t(), e.setOverrideLights(this.defaultLights), this
    }, i.prototype.addDefaultCamera = function() {
        var e = u.default.create(f.default, {
                dragButton: "Right",
                panButton: "Middle",
                smoothness: 0,
                spherical: [10, 45, 30],
                lookAtPoint: [0, 0, 0],
                drag: 0,
                lookAtDistance: null
            }),
            t = new a.default(45, 1, .01, 2e3);
        return t.lockedRatio = !1, this.defaultCameraEntity = this.sumerian.world.createEntity("Object Viewer Default Camera", t, e), this.defaultCameraEntity.hide(), this.defaultCameraEntity.addToWorld(), this.defaultCameraEntity.setAsMainCamera(), this
    }, i.prototype.setDefaultCamera = function(e) {
        if (!e) throw new Error("cannot set default camera to null");
        this.defaultCameraEntity = e;
        var t = e.scriptComponent ? e.scriptComponent.scripts : null;
        if (!(t && t.length > 0 ? t[0] : null)) {
            t = [], t.push(this.defaultCamScript);
            var n = new d.default(t);
            this.defaultCameraEntity.set(n)
        }
        return this.defaultCameraEntity.setAsMainCamera(), this
    }, t.default = i
}]);